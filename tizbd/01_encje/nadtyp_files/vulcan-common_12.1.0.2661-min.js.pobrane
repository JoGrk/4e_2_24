(function(aW,F){var a1=aW,a3=a1.document,M=a1.navigator,z=a1.setTimeout,aQ=a1.encodeURIComponent,am=a1.ActiveXObject,ao=a1.Error,ag=a1.Number.parseInt||a1.parseInt,Q=a1.Number.parseFloat||a1.parseFloat,T=a1.Number.isNaN||a1.isNaN,x=a1.Math.round,R=a1.Date.now,ae=a1.Object.keys,aF=a1.Object.defineProperty,az=a1.Object.prototype.hasOwnProperty,k=a1.Array.prototype.slice,aM=function(){var a7=function(a8){return a8};if(typeof a1.wrap==="function"&&typeof a1.unwrap==="function"){try{var a6=a3.createElement("div");var a4=a1.unwrap(a6);if(a6.nodeType===1&&a4&&a4.nodeType===1){a7=a1.unwrap}}catch(a5){}}return a7}();var aH=function(a4){return k.call(a4,0)};var aE=function(){var a7,a5,a4,bb,a9,ba,a6=aH(arguments),a8=a6[0]||{};for(a7=1,a5=a6.length;a7<a5;a7++){if((a4=a6[a7])!=null){for(bb in a4){if(az.call(a4,bb)){a9=a8[bb];ba=a4[bb];if(a8!==ba&&ba!==F){a8[bb]=ba}}}}}return a8};var J=function(a6){var a8,a5,a4,a7;if(typeof a6!=="object"||a6==null){a8=a6}else{if(typeof a6.length==="number"){a8=[];for(a5=0,a4=a6.length;a5<a4;a5++){if(az.call(a6,a5)){a8[a5]=J(a6[a5])}}}else{a8={};for(a7 in a6){if(az.call(a6,a7)){a8[a7]=J(a6[a7])}}}}return a8};var r=function(a8,a7){var a5={};for(var a6=0,a4=a7.length;a6<a4;a6++){if(a7[a6] in a8){a5[a7[a6]]=a8[a7[a6]]}}return a5};var aZ=function(a6,a5){var a4={};for(var a7 in a6){if(a5.indexOf(a7)===-1){a4[a7]=a6[a7]}}return a4};var ah=function(a4){if(a4){for(var a5 in a4){if(az.call(a4,a5)){delete a4[a5]}}}return a4};var aG=function(a4,a5){if(a4&&a4.nodeType===1&&a4.ownerDocument&&a5&&(a5.nodeType===1&&a5.ownerDocument&&a5.ownerDocument===a4.ownerDocument||a5.nodeType===9&&!a5.ownerDocument&&a5===a4.ownerDocument)){do{if(a4===a5){return true}a4=a4.parentNode}while(a4)}return false};var L=function(a5){var a4;if(typeof a5==="string"&&a5){a4=a5.split("#")[0].split("?")[0];a4=a5.slice(0,a5.lastIndexOf("/")+1)}return a4};var P=function(a4){var a5,a6;if(typeof a4==="string"&&a4){a6=a4.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(a6&&a6[1]){a5=a6[1]}else{a6=a4.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/);if(a6&&a6[1]){a5=a6[1]}}}return a5};var ap=function(){var a4,a5;try{throw new ao()}catch(a6){a5=a6}if(a5){a4=a5.sourceURL||a5.fileName||P(a5.stack)}return a4};var aD=function(){var a6,a4,a5;if(a3.currentScript&&(a6=a3.currentScript.src)){return a6}a4=a3.getElementsByTagName("script");if(a4.length===1){return a4[0].src||F}if("readyState" in a4[0]){for(a5=a4.length;a5--;){if(a4[a5].readyState==="interactive"&&(a6=a4[a5].src)){return a6}}}if(a3.readyState==="loading"&&(a6=a4[a4.length-1].src)){return a6}if(a6=ap()){return a6}return F};var A=function(){var a6,a5,a7,a4=a3.getElementsByTagName("script");for(a6=a4.length;a6--;){if(!(a7=a4[a6].src)){a5=null;break}a7=L(a7);if(a5==null){a5=a7}else{if(a5!==a7){a5=null;break}}}return a5||F};var y=function(){var a4=L(aD())||A()||"";return a4+"ZeroClipboard.swf"};var n={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,deactivated:null,overdue:null,ready:null};var ai="11.0.0";var al={};var ab;var q;var s={};var an=null;var l={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}};var aR={swfPath:y(),trustedDomains:aW.location.host?[aW.location.host]:[],cacheBust:true,forceEnhancedClipboard:false,flashLoadTimeout:30000,autoActivate:true,bubbleEvents:true,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:false,title:null,zIndex:999999999};var aB=function(a4){if(typeof a4==="object"&&a4!==null){for(var a5 in a4){if(az.call(a4,a5)){if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(a5)){aR[a5]=a4[a5]}else{if(n.bridge==null){if(a5==="containerId"||a5==="swfObjectId"){if(aX(a4[a5])){aR[a5]=a4[a5]}else{throw new Error("The specified `"+a5+"` value is not valid as an HTML4 Element ID")}}else{aR[a5]=a4[a5]}}}}}}if(typeof a4==="string"&&a4){if(az.call(aR,a4)){return aR[a4]}return}return J(aR)};var aI=function(){return{browser:r(M,["userAgent","platform","appName"]),flash:aZ(n,["bridge"]),zeroclipboard:{version:a2.version,config:a2.config()}}};var v=function(){return !!(n.disabled||n.outdated||n.unavailable||n.deactivated)};var U=function(a7,a9){var a6,a4,a5,a8={};if(typeof a7==="string"&&a7){a5=a7.toLowerCase().split(/\s+/)}else{if(typeof a7==="object"&&a7&&typeof a9==="undefined"){for(a6 in a7){if(az.call(a7,a6)&&typeof a6==="string"&&a6&&typeof a7[a6]==="function"){a2.on(a6,a7[a6])}}}}if(a5&&a5.length){for(a6=0,a4=a5.length;a6<a4;a6++){a7=a5[a6].replace(/^on/,"");a8[a7]=true;if(!al[a7]){al[a7]=[]}al[a7].push(a9)}if(a8.ready&&n.ready){a2.emit({type:"ready"})}if(a8.error){var ba=["disabled","outdated","unavailable","deactivated","overdue"];for(a6=0,a4=ba.length;a6<a4;a6++){if(n[ba[a6]]===true){a2.emit({type:"error",name:"flash-"+ba[a6]});break}}}}return a2};var aY=function(a8,a9){var a7,a4,ba,a6,a5;if(arguments.length===0){a6=ae(al)}else{if(typeof a8==="string"&&a8){a6=a8.split(/\s+/)}else{if(typeof a8==="object"&&a8&&typeof a9==="undefined"){for(a7 in a8){if(az.call(a8,a7)&&typeof a7==="string"&&a7&&typeof a8[a7]==="function"){a2.off(a7,a8[a7])}}}}}if(a6&&a6.length){for(a7=0,a4=a6.length;a7<a4;a7++){a8=a6[a7].toLowerCase().replace(/^on/,"");a5=al[a8];if(a5&&a5.length){if(a9){ba=a5.indexOf(a9);while(ba!==-1){a5.splice(ba,1);ba=a5.indexOf(a9,ba)}}else{a5.length=0}}}}return a2};var c=function(a4){var a5;if(typeof a4==="string"&&a4){a5=J(al[a4])||null}else{a5=J(al)}return a5};var aA=function(a6){var a7,a5,a4;a6=E(a6);if(!a6){return}if(aT(a6)){return}if(a6.type==="ready"&&n.overdue===true){return a2.emit({type:"error",name:"flash-overdue"})}a7=aE({},a6);af.call(this,a7);if(a6.type==="copy"){a4=o(s);a5=a4.data;an=a4.formatMap}return a5};var K=function(){if(typeof n.ready!=="boolean"){n.ready=false}if(!a2.isFlashUnusable()&&n.bridge===null){var a4=aR.flashLoadTimeout;if(typeof a4==="number"&&a4>=0){z(function(){if(typeof n.deactivated!=="boolean"){n.deactivated=true}if(n.deactivated===true){a2.emit({type:"error",name:"flash-deactivated"})}},a4)}n.overdue=false;aq()}};var S=function(){a2.clearData();a2.blur();a2.emit("destroy");f();a2.off()};var e=function(a6,a5){var a4;if(typeof a6==="object"&&a6&&typeof a5==="undefined"){a4=a6;a2.clearData()}else{if(typeof a6==="string"&&a6){a4={};a4[a6]=a5}else{return}}for(var a7 in a4){if(typeof a7==="string"&&a7&&az.call(a4,a7)&&typeof a4[a7]==="string"&&a4[a7]){s[a7]=a4[a7]}}};var p=function(a4){if(typeof a4==="undefined"){ah(s);an=null}else{if(typeof a4==="string"&&az.call(s,a4)){delete s[a4]}}};var B=function(a4){if(typeof a4==="undefined"){return J(s)}else{if(typeof a4==="string"&&az.call(s,a4)){return s[a4]}}};var aJ=function(a6){if(!(a6&&a6.nodeType===1)){return}if(ab){ar(ab,aR.activeClass);if(ab!==a6){ar(ab,aR.hoverClass)}}ab=a6;X(a6,aR.hoverClass);var a7=a6.getAttribute("title")||aR.title;if(typeof a7==="string"&&a7){var a5=a0(n.bridge);if(a5){a5.setAttribute("title",a7)}}var a4=aR.forceHandCursor===true||H(a6,"cursor")==="pointer";aU(a4);aV()};var aC=function(){var a4=a0(n.bridge);if(a4){a4.removeAttribute("title");a4.style.left="0px";a4.style.top="-9999px";a4.style.width="1px";a4.style.top="1px"}if(ab){ar(ab,aR.hoverClass);ar(ab,aR.activeClass);ab=null}};var aa=function(){return ab||null};var aX=function(a4){return typeof a4==="string"&&a4&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(a4)};var E=function(a5){var a4;if(typeof a5==="string"&&a5){a4=a5;a5={}}else{if(typeof a5==="object"&&a5&&typeof a5.type==="string"&&a5.type){a4=a5.type}}if(!a4){return}if(!a5.target&&/^(copy|aftercopy|_click)$/.test(a4.toLowerCase())){a5.target=q}aE(a5,{type:a4.toLowerCase(),target:a5.target||ab||null,relatedTarget:a5.relatedTarget||null,currentTarget:n&&n.bridge||null,timeStamp:a5.timeStamp||R()||null});var a6=l[a5.type];if(a5.type==="error"&&a5.name&&a6){a6=a6[a5.name]}if(a6){a5.message=a6}if(a5.type==="ready"){aE(a5,{target:null,version:n.version})}if(a5.type==="error"){if(/^flash-(disabled|outdated|unavailable|deactivated|overdue)$/.test(a5.name)){aE(a5,{target:null,minimumVersion:ai})}if(/^flash-(outdated|unavailable|deactivated|overdue)$/.test(a5.name)){aE(a5,{version:n.version})}}if(a5.type==="copy"){a5.clipboardData={setData:a2.setData,clearData:a2.clearData}}if(a5.type==="aftercopy"){a5=g(a5,an)}if(a5.target&&!a5.relatedTarget){a5.relatedTarget=O(a5.target)}a5=u(a5);return a5};var O=function(a5){var a4=a5&&a5.getAttribute&&a5.getAttribute("data-clipboard-target");return a4?a3.getElementById(a4):null};var u=function(a5){if(a5&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a5.type)){var bj=a5.target;var bi=a5.type==="_mouseover"&&a5.relatedTarget?a5.relatedTarget:F;var bd=a5.type==="_mouseout"&&a5.relatedTarget?a5.relatedTarget:F;var bk=ay(bj);var bg=a1.screenLeft||a1.screenX||0;var ba=a1.screenTop||a1.screenY||0;var be=a3.body.scrollLeft+a3.documentElement.scrollLeft;var a7=a3.body.scrollTop+a3.documentElement.scrollTop;var bh=bk.left+(typeof a5._stageX==="number"?a5._stageX:0);var bf=bk.top+(typeof a5._stageY==="number"?a5._stageY:0);var a6=bh-be;var a4=bf-a7;var bc=bg+a6;var a9=ba+a4;var bb=typeof a5.movementX==="number"?a5.movementX:0;var a8=typeof a5.movementY==="number"?a5.movementY:0;delete a5._stageX;delete a5._stageY;aE(a5,{srcElement:bj,fromElement:bi,toElement:bd,screenX:bc,screenY:a9,pageX:bh,pageY:bf,clientX:a6,clientY:a4,x:a6,y:a4,movementX:bb,movementY:a8,offsetX:0,offsetY:0,layerX:0,layerY:0})}return a5};var Y=function(a5){var a4=a5&&typeof a5.type==="string"&&a5.type||"";return !/^(?:(?:before)?copy|destroy)$/.test(a4)};var aj=function(a7,a5,a4,a6){if(a6){z(function(){a7.apply(a5,a4)},0)}else{a7.apply(a5,a4)}};var af=function(a4){if(!(typeof a4==="object"&&a4&&a4.type)){return}var a8=Y(a4);var bb=al["*"]||[];var be=al[a4.type]||[];var a7=bb.concat(be);if(a7&&a7.length){var a9,bc,a6,a5,ba,bd=this;for(a9=0,bc=a7.length;a9<bc;a9++){a6=a7[a9];a5=bd;if(typeof a6==="string"&&typeof a1[a6]==="function"){a6=a1[a6]}if(typeof a6==="object"&&a6&&typeof a6.handleEvent==="function"){a5=a6;a6=a6.handleEvent}if(typeof a6==="function"){ba=aE({},a4);aj(a6,a5,[ba],a8)}}}return this};var aT=function(a7){var a5=a7.target||ab||null;var a9=a7._source==="swf";delete a7._source;var a8=["flash-disabled","flash-outdated","flash-unavailable","flash-deactivated","flash-overdue"];switch(a7.type){case"error":if(a8.indexOf(a7.name)!==-1){aE(n,{disabled:a7.name==="flash-disabled",outdated:a7.name==="flash-outdated",unavailable:a7.name==="flash-unavailable",deactivated:a7.name==="flash-deactivated",overdue:a7.name==="flash-overdue",ready:false})}break;case"ready":var a4=n.deactivated===true;aE(n,{disabled:false,outdated:false,unavailable:false,deactivated:false,overdue:a4,ready:!a4});break;case"beforecopy":q=a5;break;case"copy":var a6,bb,ba=a7.relatedTarget;if(!(s["text/html"]||s["text/plain"])&&ba&&(bb=ba.value||ba.outerHTML||ba.innerHTML)&&(a6=ba.value||ba.textContent||ba.innerText)){a7.clipboardData.clearData();a7.clipboardData.setData("text/plain",a6);if(bb!==a6){a7.clipboardData.setData("text/html",bb)}}else{if(!s["text/plain"]&&a7.target&&(a6=a7.target.getAttribute("data-clipboard-text"))){a7.clipboardData.clearData();a7.clipboardData.setData("text/plain",a6)}}break;case"aftercopy":a2.clearData();if(a5&&a5!==ax()&&a5.focus){a5.focus()}break;case"_mouseover":a2.focus(a5);if(aR.bubbleEvents===true&&a9){if(a5&&a5!==a7.relatedTarget&&!aG(a7.relatedTarget,a5)){b(aE({},a7,{type:"mouseenter",bubbles:false,cancelable:false}))}b(aE({},a7,{type:"mouseover"}))}break;case"_mouseout":a2.blur();if(aR.bubbleEvents===true&&a9){if(a5&&a5!==a7.relatedTarget&&!aG(a7.relatedTarget,a5)){b(aE({},a7,{type:"mouseleave",bubbles:false,cancelable:false}))}b(aE({},a7,{type:"mouseout"}))}break;case"_mousedown":X(a5,aR.activeClass);if(aR.bubbleEvents===true&&a9){b(aE({},a7,{type:a7.type.slice(1)}))}break;case"_mouseup":ar(a5,aR.activeClass);if(aR.bubbleEvents===true&&a9){b(aE({},a7,{type:a7.type.slice(1)}))}break;case"_click":q=null;if(aR.bubbleEvents===true&&a9){b(aE({},a7,{type:a7.type.slice(1)}))}break;case"_mousemove":if(aR.bubbleEvents===true&&a9){b(aE({},a7,{type:a7.type.slice(1)}))}break}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a7.type)){return true}};var b=function(a5){if(!(a5&&typeof a5.type==="string"&&a5)){return}var a9,a8=a5.target||null,a7=a8&&a8.ownerDocument||a3,a6={view:a7.defaultView||a1,canBubble:true,cancelable:true,detail:a5.type==="click"?1:0,button:typeof a5.which==="number"?a5.which-1:typeof a5.button==="number"?a5.button:a7.createEvent?0:1},a4=aE(a6,a5);if(!a8){return}if(a7.createEvent&&a8.dispatchEvent){a4=[a4.type,a4.canBubble,a4.cancelable,a4.view,a4.detail,a4.screenX,a4.screenY,a4.clientX,a4.clientY,a4.ctrlKey,a4.altKey,a4.shiftKey,a4.metaKey,a4.button,a4.relatedTarget];a9=a7.createEvent("MouseEvents");if(a9.initMouseEvent){a9.initMouseEvent.apply(a9,a4);a9._source="js";a8.dispatchEvent(a9)}}};var a=function(){var a4=a3.createElement("div");a4.id=aR.containerId;a4.className=aR.containerClass;a4.style.position="absolute";a4.style.left="0px";a4.style.top="-9999px";a4.style.width="1px";a4.style.height="1px";a4.style.zIndex=""+au(aR.zIndex);return a4};var a0=function(a5){var a4=a5&&a5.parentNode;while(a4&&a4.nodeName==="OBJECT"&&a4.parentNode){a4=a4.parentNode}return a4||null};var aq=function(){var ba,bc=n.bridge,a4=a0(bc);if(!bc){var a7=aL(a1.location.host,aR);var a5=a7==="never"?"none":"all";var a6=d(aR);var a8=aR.swfPath+w(aR.swfPath,aR);a4=a();var bb=a3.createElement("div");a4.appendChild(bb);a3.body.appendChild(a4);var bd=a3.createElement("div");var a9=n.pluginType==="activex";bd.innerHTML='<object id="'+aR.swfObjectId+'" name="'+aR.swfObjectId+'" width="100%" height="100%" '+(a9?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+a8+'"')+">"+(a9?'<param name="movie" value="'+a8+'"/>':"")+'<param name="allowScriptAccess" value="'+a7+'"/><param name="allowNetworking" value="'+a5+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+a6+'"/></object>';bc=bd.firstChild;bd=null;aM(bc).ZeroClipboard=a2;a4.replaceChild(bc,bb)}if(!bc){bc=a3[aR.swfObjectId];if(bc&&(ba=bc.length)){bc=bc[ba-1]}if(!bc&&a4){bc=a4.firstChild}}n.bridge=bc||null;return bc};var f=function(){var a5=n.bridge;if(a5){var a4=a0(a5);if(a4){if(n.pluginType==="activex"&&"readyState" in a5){a5.style.display="none";(function a6(){if(a5.readyState===4){for(var a7 in a5){if(typeof a5[a7]==="function"){a5[a7]=null}}if(a5.parentNode){a5.parentNode.removeChild(a5)}if(a4.parentNode){a4.parentNode.removeChild(a4)}}else{z(a6,10)}})()}else{if(a5.parentNode){a5.parentNode.removeChild(a5)}if(a4.parentNode){a4.parentNode.removeChild(a4)}}}n.ready=null;n.bridge=null;n.deactivated=null}};var o=function(a6){var a5={},a4={};if(!(typeof a6==="object"&&a6)){return}for(var a7 in a6){if(a7&&az.call(a6,a7)&&typeof a6[a7]==="string"&&a6[a7]){switch(a7.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":a5.text=a6[a7];a4.text=a7;break;case"text/html":case"html":case"air:html":case"flash:html":a5.html=a6[a7];a4.html=a7;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":a5.rtf=a6[a7];a4.rtf=a7;break;default:break}}}return{data:a5,formatMap:a4}};var g=function(a6,a4){if(!(typeof a6==="object"&&a6&&typeof a4==="object"&&a4)){return a6}var a9={};for(var a8 in a6){if(az.call(a6,a8)){if(a8!=="success"&&a8!=="data"){a9[a8]=a6[a8];continue}a9[a8]={};var a5=a6[a8];for(var a7 in a5){if(a7&&az.call(a5,a7)&&az.call(a4,a7)){a9[a8][a4[a7]]=a5[a7]}}}}return a9};var w=function(a6,a4){var a5=a4==null||a4&&a4.cacheBust===true;if(a5){return(a6.indexOf("?")===-1?"?":"&")+"noCache="+R()}else{return""}};var d=function(a6){var a7,a5,a8,a4,a9="",ba=[];if(a6.trustedDomains){if(typeof a6.trustedDomains==="string"){a4=[a6.trustedDomains]}else{if(typeof a6.trustedDomains==="object"&&"length" in a6.trustedDomains){a4=a6.trustedDomains}}}if(a4&&a4.length){for(a7=0,a5=a4.length;a7<a5;a7++){if(az.call(a4,a7)&&a4[a7]&&typeof a4[a7]==="string"){a8=ak(a4[a7]);if(!a8){continue}if(a8==="*"){ba.length=0;ba.push(a8);break}ba.push.apply(ba,[a8,"//"+a8,a1.location.protocol+"//"+a8])}}}if(ba.length){a9+="trustedOrigins="+aQ(ba.join(","))}if(a6.forceEnhancedClipboard===true){a9+=(a9?"&":"")+"forceEnhancedClipboard=true"}if(typeof a6.swfObjectId==="string"&&a6.swfObjectId){a9+=(a9?"&":"")+"swfObjectId="+aQ(a6.swfObjectId)}return a9};var ak=function(a5){if(a5==null||a5===""){return null}a5=a5.replace(/^\s+|\s+$/g,"");if(a5===""){return null}var a6=a5.indexOf("//");a5=a6===-1?a5:a5.slice(a6+2);var a4=a5.indexOf("/");a5=a4===-1?a5:a6===-1||a4===0?null:a5.slice(0,a4);if(a5&&a5.slice(-4).toLowerCase()===".swf"){return null}return a5||null};var aL=function(){var a4=function(a9){var a7,a5,a6,a8=[];if(typeof a9==="string"){a9=[a9]}if(!(typeof a9==="object"&&a9&&typeof a9.length==="number")){return a8}for(a7=0,a5=a9.length;a7<a5;a7++){if(az.call(a9,a7)&&(a6=ak(a9[a7]))){if(a6==="*"){a8.length=0;a8.push("*");break}if(a8.indexOf(a6)===-1){a8.push(a6)}}}return a8};return function(a9,a6){var a8=ak(a6.swfPath);if(a8===null){a8=a9}var a7=a4(a6.trustedDomains);var a5=a7.length;if(a5>0){if(a5===1&&a7[0]==="*"){return"always"}if(a7.indexOf(a9)!==-1){if(a5===1&&a9===a8){return"sameDomain"}return"always"}}return"never"}}();var ax=function(){try{return a3.activeElement}catch(a4){return null}};var X=function(a5,a7){if(!a5||a5.nodeType!==1){return a5}if(a5.classList){if(!a5.classList.contains(a7)){a5.classList.add(a7)}return a5}if(a7&&typeof a7==="string"){var a9=(a7||"").split(/\s+/);if(a5.nodeType===1){if(!a5.className){a5.className=a7}else{var a6=" "+a5.className+" ",a8=a5.className;for(var ba=0,a4=a9.length;ba<a4;ba++){if(a6.indexOf(" "+a9[ba]+" ")<0){a8+=" "+a9[ba]}}a5.className=a8.replace(/^\s+|\s+$/g,"")}}}return a5};var ar=function(a5,a7){if(!a5||a5.nodeType!==1){return a5}if(a5.classList){if(a5.classList.contains(a7)){a5.classList.remove(a7)}return a5}if(typeof a7==="string"&&a7){var a8=a7.split(/\s+/);if(a5.nodeType===1&&a5.className){var a6=(" "+a5.className+" ").replace(/[\n\t]/g," ");for(var a9=0,a4=a8.length;a9<a4;a9++){a6=a6.replace(" "+a8[a9]+" "," ")}a5.className=a6.replace(/^\s+|\s+$/g,"")}}return a5};var H=function(a4,a6){var a5=a1.getComputedStyle(a4,null).getPropertyValue(a6);if(a6==="cursor"){if(!a5||a5==="auto"){if(a4.nodeName==="A"){return"pointer"}}}return a5};var aw=function(){var a6,a7,a4,a5=1;if(typeof a3.body.getBoundingClientRect==="function"){a6=a3.body.getBoundingClientRect();a7=a6.right-a6.left;a4=a3.body.offsetWidth;a5=x(a7/a4*100)/100}return a5};var ay=function(bb){var ba={left:0,top:0,width:0,height:0};if(bb.getBoundingClientRect){var a7=bb.getBoundingClientRect();var a6,a9,a5;if("pageXOffset" in a1&&"pageYOffset" in a1){a6=a1.pageXOffset;a9=a1.pageYOffset}else{a5=aw();a6=x(a3.documentElement.scrollLeft/a5);a9=x(a3.documentElement.scrollTop/a5)}var a8=a3.documentElement.clientLeft||0;var a4=a3.documentElement.clientTop||0;ba.left=a7.left+a6-a8;ba.top=a7.top+a9-a4;ba.width="width" in a7?a7.width:a7.right-a7.left;ba.height="height" in a7?a7.height:a7.bottom-a7.top}return ba};var aV=function(){var a4;if(ab&&(a4=a0(n.bridge))){var a5=ay(ab);aE(a4.style,{width:a5.width+"px",height:a5.height+"px",top:a5.top+"px",left:a5.left+"px",zIndex:""+au(aR.zIndex)})}};var aU=function(a4){if(n.ready===true){if(n.bridge&&typeof n.bridge.setHandCursor==="function"){n.bridge.setHandCursor(a4)}else{n.ready=false}}};var au=function(a4){if(/^(?:auto|inherit)$/.test(a4)){return a4}var a5;if(typeof a4==="number"&&!T(a4)){a5=a4}else{if(typeof a4==="string"){a5=au(ag(a4,10))}}return typeof a5==="number"?a5:"auto"};var ad=function(a8){var bc,a4,a5,be=false,bg=false,bb=false,a6="";function ba(bj){var bi=bj.match(/[\d]+/g);bi.length=3;return bi.join(".")}function a7(bi){return !!bi&&(bi=bi.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(bi)||bi.slice(-13)==="chrome.plugin")}function a9(bi){if(bi){be=true;if(bi.version){a6=ba(bi.version)}if(!a6&&bi.description){a6=ba(bi.description)}if(bi.filename){bb=a7(bi.filename)}}}if(M.plugins&&M.plugins.length){bc=M.plugins["Shockwave Flash"];a9(bc);if(M.plugins["Shockwave Flash 2.0"]){be=true;a6="2.0.0.11"}}else{if(M.mimeTypes&&M.mimeTypes.length){a5=M.mimeTypes["application/x-shockwave-flash"];bc=a5&&a5.enabledPlugin;a9(bc)}else{if(typeof a8!=="undefined"){bg=true;try{a4=new a8("ShockwaveFlash.ShockwaveFlash.7");be=true;a6=ba(a4.GetVariable("$version"))}catch(bh){try{a4=new a8("ShockwaveFlash.ShockwaveFlash.6");be=true;a6="6.0.21"}catch(bf){try{a4=new a8("ShockwaveFlash.ShockwaveFlash");be=true;a6=ba(a4.GetVariable("$version"))}catch(bd){bg=false}}}}}}n.disabled=be!==true;n.outdated=a6&&Q(a6)<Q(ai);n.version=a6||"0.0.0";n.pluginType=bb?"pepper":bg?"activex":be?"netscape":"unknown"};ad(am);var a2=function(){if(!(this instanceof a2)){return new a2()}if(typeof a2._createClient==="function"){a2._createClient.apply(this,aH(arguments))}};aF(a2,"version",{value:"2.1.6",writable:false,configurable:true,enumerable:true});a2.config=function(){return aB.apply(this,aH(arguments))};a2.state=function(){return aI.apply(this,aH(arguments))};a2.isFlashUnusable=function(){return v.apply(this,aH(arguments))};a2.on=function(){return U.apply(this,aH(arguments))};a2.off=function(){return aY.apply(this,aH(arguments))};a2.handlers=function(){return c.apply(this,aH(arguments))};a2.emit=function(){return aA.apply(this,aH(arguments))};a2.create=function(){return K.apply(this,aH(arguments))};a2.destroy=function(){return S.apply(this,aH(arguments))};a2.setData=function(){return e.apply(this,aH(arguments))};a2.clearData=function(){return p.apply(this,aH(arguments))};a2.getData=function(){return B.apply(this,aH(arguments))};a2.focus=a2.activate=function(){return aJ.apply(this,aH(arguments))};a2.blur=a2.deactivate=function(){return aC.apply(this,aH(arguments))};a2.activeElement=function(){return aa.apply(this,aH(arguments))};var Z=0;var D={};var h=0;var av={};var I={};aE(aR,{autoActivate:true});var aO=function(a5){var a4=this;a4.id=""+Z++;D[a4.id]={instance:a4,elements:[],handlers:{}};if(a5){a4.clip(a5)}a2.on("*",function(a6){return a4.emit(a6)});a2.on("destroy",function(){a4.destroy()});a2.create()};var at=function(a8,ba){var a7,a4,a6,a9={},a5=D[this.id]&&D[this.id].handlers;if(typeof a8==="string"&&a8){a6=a8.toLowerCase().split(/\s+/)}else{if(typeof a8==="object"&&a8&&typeof ba==="undefined"){for(a7 in a8){if(az.call(a8,a7)&&typeof a7==="string"&&a7&&typeof a8[a7]==="function"){this.on(a7,a8[a7])}}}}if(a6&&a6.length){for(a7=0,a4=a6.length;a7<a4;a7++){a8=a6[a7].replace(/^on/,"");a9[a8]=true;if(!a5[a8]){a5[a8]=[]}a5[a8].push(ba)}if(a9.ready&&n.ready){this.emit({type:"ready",client:this})}if(a9.error){var bb=["disabled","outdated","unavailable","deactivated","overdue"];for(a7=0,a4=bb.length;a7<a4;a7++){if(n[bb[a7]]){this.emit({type:"error",name:"flash-"+bb[a7],client:this});break}}}}return this};var aK=function(a9,ba){var a8,a4,bb,a7,a5,a6=D[this.id]&&D[this.id].handlers;if(arguments.length===0){a7=ae(a6)}else{if(typeof a9==="string"&&a9){a7=a9.split(/\s+/)}else{if(typeof a9==="object"&&a9&&typeof ba==="undefined"){for(a8 in a9){if(az.call(a9,a8)&&typeof a8==="string"&&a8&&typeof a9[a8]==="function"){this.off(a8,a9[a8])}}}}}if(a7&&a7.length){for(a8=0,a4=a7.length;a8<a4;a8++){a9=a7[a8].toLowerCase().replace(/^on/,"");a5=a6[a9];if(a5&&a5.length){if(ba){bb=a5.indexOf(ba);while(bb!==-1){a5.splice(bb,1);bb=a5.indexOf(ba,bb)}}else{a5.length=0}}}}return this};var aN=function(a5){var a6=null,a4=D[this.id]&&D[this.id].handlers;if(a4){if(typeof a5==="string"&&a5){a6=a4[a5]?a4[a5].slice(0):[]}else{a6=J(a4)}}return a6};var W=function(a4){if(ac.call(this,a4)){if(typeof a4==="object"&&a4&&typeof a4.type==="string"&&a4.type){a4=aE({},a4)}var a5=aE({},E(a4),{client:this});m.call(this,a5)}return this};var V=function(a6){a6=aP(a6);for(var a5=0;a5<a6.length;a5++){if(az.call(a6,a5)&&a6[a5]&&a6[a5].nodeType===1){if(!a6[a5].zcClippingId){a6[a5].zcClippingId="zcClippingId_"+h++;av[a6[a5].zcClippingId]=[this.id];if(aR.autoActivate===true){G(a6[a5])}}else{if(av[a6[a5].zcClippingId].indexOf(this.id)===-1){av[a6[a5].zcClippingId].push(this.id)}}var a4=D[this.id]&&D[this.id].elements;if(a4.indexOf(a6[a5])===-1){a4.push(a6[a5])}}}return this};var C=function(a8){var a9=D[this.id];if(!a9){return this}var a5=a9.elements;var a4;if(typeof a8==="undefined"){a8=a5.slice(0)}else{a8=aP(a8)}for(var a6=a8.length;a6--;){if(az.call(a8,a6)&&a8[a6]&&a8[a6].nodeType===1){a4=0;while((a4=a5.indexOf(a8[a6],a4))!==-1){a5.splice(a4,1)}var a7=av[a8[a6].zcClippingId];if(a7){a4=0;while((a4=a7.indexOf(this.id,a4))!==-1){a7.splice(a4,1)}if(a7.length===0){if(aR.autoActivate===true){aS(a8[a6])}delete a8[a6].zcClippingId}}}}return this};var t=function(){var a4=D[this.id];return a4&&a4.elements?a4.elements.slice(0):[]};var N=function(){this.unclip();this.off();delete D[this.id]};var ac=function(a8){if(!(a8&&a8.type)){return false}if(a8.client&&a8.client!==this){return false}var a9=D[this.id]&&D[this.id].elements;var a4=!!a9&&a9.length>0;var a5=!a8.target||a4&&a9.indexOf(a8.target)!==-1;var a6=a8.relatedTarget&&a4&&a9.indexOf(a8.relatedTarget)!==-1;var a7=a8.client&&a8.client===this;if(!(a5||a6||a7)){return false}return true};var m=function(a4){if(!(typeof a4==="object"&&a4&&a4.type)){return}var a8=Y(a4);var bb=D[this.id]&&D[this.id].handlers["*"]||[];var be=D[this.id]&&D[this.id].handlers[a4.type]||[];var a7=bb.concat(be);if(a7&&a7.length){var a9,bc,a6,a5,ba,bd=this;for(a9=0,bc=a7.length;a9<bc;a9++){a6=a7[a9];a5=bd;if(typeof a6==="string"&&typeof a1[a6]==="function"){a6=a1[a6]}if(typeof a6==="object"&&a6&&typeof a6.handleEvent==="function"){a5=a6;a6=a6.handleEvent}if(typeof a6==="function"){ba=aE({},a4);aj(a6,a5,[ba],a8)}}}return this};var aP=function(a4){if(typeof a4==="string"){a4=[]}return typeof a4.length!=="number"?[a4]:a4};var G=function(a5){if(!(a5&&a5.nodeType===1)){return}var a4=function(a7){if(!(a7||(a7=a1.event))){return}if(a7._source!=="js"){a7.stopImmediatePropagation();a7.preventDefault()}delete a7._source};var a6=function(a7){if(!(a7||(a7=a1.event))){return}a4(a7);a2.focus(a5)};a5.addEventListener("mouseover",a6,false);a5.addEventListener("mouseout",a4,false);a5.addEventListener("mouseenter",a4,false);a5.addEventListener("mouseleave",a4,false);a5.addEventListener("mousemove",a4,false);I[a5.zcClippingId]={mouseover:a6,mouseout:a4,mouseenter:a4,mouseleave:a4,mousemove:a4}};var aS=function(a9){if(!(a9&&a9.nodeType===1)){return}var a5=I[a9.zcClippingId];if(!(typeof a5==="object"&&a5)){return}var a8,ba,a6=["move","leave","enter","out","over"];for(var a7=0,a4=a6.length;a7<a4;a7++){a8="mouse"+a6[a7];ba=a5[a8];if(typeof ba==="function"){a9.removeEventListener(a8,ba,false)}}delete I[a9.zcClippingId]};a2._createClient=function(){aO.apply(this,aH(arguments))};a2.prototype.on=function(){return at.apply(this,aH(arguments))};a2.prototype.off=function(){return aK.apply(this,aH(arguments))};a2.prototype.handlers=function(){return aN.apply(this,aH(arguments))};a2.prototype.emit=function(){return W.apply(this,aH(arguments))};a2.prototype.clip=function(){return V.apply(this,aH(arguments))};a2.prototype.unclip=function(){return C.apply(this,aH(arguments))};a2.prototype.elements=function(){return t.apply(this,aH(arguments))};a2.prototype.destroy=function(){return N.apply(this,aH(arguments))};a2.prototype.setText=function(a4){a2.setData("text/plain",a4);return this};a2.prototype.setHtml=function(a4){a2.setData("text/html",a4);return this};a2.prototype.setRichText=function(a4){a2.setData("application/rtf",a4);return this};a2.prototype.setData=function(){a2.setData.apply(this,aH(arguments));return this};a2.prototype.clearData=function(){a2.clearData.apply(this,aH(arguments));return this};a2.prototype.getData=function(){return a2.getData.apply(this,aH(arguments))};if(typeof define==="function"&&define.amd){define(function(){return a2})}else{if(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports){module.exports=a2}else{aW.ZeroClipboard=a2}}})(function(){return this||window}());Array.prototype.remove=function(b){var a=this.indexOf(b);if(a!=-1){this.splice(a,1)}};String.prototype.endsWith=function(a){return(this.match(a+"$")==a)};String.prototype.startsWith=function(a){return(this.match("^"+a)==a)};String.prototype.trim=function(){return(this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,""))};Ext.panel.Panel.prototype.titleCollapse=true;Ext.panel.Panel.prototype.animCollapse=false;Ext.tab.Panel.prototype.plain=true;Ext.util.Filter.prototype.anyMatch=true;Ext.form.field.ComboBox.prototype.anyMatch=true;Ext.form.field.Date.prototype.minValue="01.01.1900";Ext.picker.Date.prototype.todayTip="{0}";Ext.form.field.Number.prototype.hideTrigger=true;Ext.form.field.Number.prototype.step=0;Ext.data.Connection.prototype.timeout=120000;Ext.data.proxy.Ajax.prototype.timeout=120000;Ext.override(Ext.data.Connection,{request:function(c){var d=this,b=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("antiForgeryToken"),a=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("appGuid"),e={"X-V-RequestVerificationToken":b,"X-V-AppGuid":a};if(c){if(!Ext.isDefined(c.headers)){c.headers=e}else{if(Ext.isFunction(c.headers.extend)){c.headers.extend(e)}else{c.headers["X-V-RequestVerificationToken"]=b;c.headers["X-V-AppGuid"]=a}}}return d.callOverridden([c])}});Ext.override(Ext.tree.Column,{flex:1,dataIndex:"text",renderer:function(f,c,b,g,e,d,a){return Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(f)}});Ext.app.Application.prototype.parseDate=function(c){var e=/[:T]/g,d=null,b=0,a;c=c.replace(e,"-");d=c.split("-");if(d.length!=6){return null}for(a=d.length;b<a;++b){d[b]=parseInt(d[b],10);if(isNaN(d[b])){return null}}return new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5])};Ext.app.Application.prototype.loaderCounter=0;Ext.override(Ext.util.Sorter,{defaultSorterFn:function(d,b){var k=this,c=k.transform,f=k.getRoot(d),e=k.getRoot(b),m=f[k.property],l=e[k.property],n=0,h=" 0123456789AaĄąBbCcĆćDdEeĘęFfGgHhIiJjKkLlŁłMmNnŃńOoÓóPpQqRrSsŚśTtUuVvWwXxYyZzŹźŻż!@#$%^&*()_+-=[];',./{}|: \"<>?";if(c){m=c(m,f);l=c(l,e)}if((typeof m=="string")&&(typeof l=="string")){if(m.length===0&&l.length===0){return 0}if(m.length===0){return -1}if(l.length===0){return 1}for(i=0;!n&&i<m.length&&i<l.length;++i){var g=h.indexOf(m[i]);var a=h.indexOf(l[i]);n=(g>a)?1:((g<a)?-1:0)}}else{n=m>l?1:(m<l?-1:0)}return n}});Ext.override(Ext.ZIndexManager,{bringToFront:function(b){var d=this,a=d.front,c=d.callOverridden(arguments);if(c&&a&&a!==d.front&&(a.isXType("loadmask")&&(typeof a.vulcan!="undefined")||a.isXType("messagebox"))){if(a.isXType("loadmask")&&(typeof a.vulcan!="undefined")&&!d.front.isXType("messagebox")){a.toFront(true)}}}});Ext.override(Ext.form.field.Base,{getModelData:function(){var a=this,b=null;if(!a.isFileUpload()){b={};b[a.getName()]=a.getValue()}return b}});Ext.form.field.ComboBox.prototype.listeners={blur:{fn:function(b){if(b.activeFilter){try{b.clearFilter();delete b.activeFilter;b.getPicker().refresh()}catch(a){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("ExtJS fix for ComboBox failed while clearFilter on blur")}}}}};delete Ext.tip.Tip.prototype.minWidth;if(Ext.isIE){Ext.override(Ext.Window,{constrain:true})}else{Ext.override(Ext.Window,{constrainHeader:true})}Ext.onReady(function(){var a=Ext.ClassManager,b=Ext.Function.bind(a.get,a);if(b("Ext.util.Format")){Ext.apply(Ext.util.Format,{thousandSeparator:" ",decimalSeparator:",",currencySign:"\u007a\u0142",dateFormat:"d.m.Y"})}if(Ext.form.NumberField){Ext.apply(Ext.form.NumberField.prototype,{negativeText:"Wartość nie może być ujemna"})}});Ext.override(Ext.form.CheckboxGroup,{invalidCls:Ext.baseCSSPrefix+"form-invalid"});Ext.define("Ext.patch.selection.CheckboxModel",{override:"Ext.selection.CheckboxModel",updateHeaderState:function(){if(this.preventUpdateHeaderState){return}this.callParent(arguments)}});Ext.override(Ext.util.Sorter,{getRoot:function(c){var b=this,a=(this.root===undefined?c:c[this.root]);return a===undefined?c:a}});Ext.override(Ext.menu.Menu,{canActivateItem:function(a){if(a&&a.getXTypes().indexOf("menuitem")<0&&a.canActivate===false){return}return this.callParent(arguments)}});Ext.override(Ext.selection.CheckboxModel,{checkOnly:true});Ext.app.Application.prototype.addController=function(e,b){var d=this;var a=e;if(typeof e=="string"){a=d.controllers.get(e)}if(!a){var c={application:d,id:e};Ext.applyIf(c,b);a=Ext.create(d.getModuleClassName(e,"controller"),c);d.controllers.add(a);a.init()}return a};Ext.data.Operation.prototype.getFeedbackModel=function(){var a=this;try{var b=a.request.proxy.reader.rawData.feedback;if(b){return Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel",b)}else{throw"No feedback data in proxy reader"}}catch(c){try{var b=Ext.decode(a.request.callback.arguments[2].responseText);if(b){return Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel",b)}else{throw"No feedback data in response text"}}catch(c){return Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel")}}};Ext.container.Container.addMembers({vget:function(c){var b=this;var a=b.getComponent(c);if(!a){b.items.each(function(d){if(Ext.isFunction(d.vget)){a=d.vget(c)}if(a){return false}})}return a}});Ext.onReady(function(){Ext.getBody().on({keydown:function(a){var c=false;if(a.keyCode===8){var b=a.srcElement||a.target;if((b.tagName.toUpperCase()==="INPUT"&&(b.type.toUpperCase()==="TEXT"||b.type.toUpperCase()==="PASSWORD"))||b.tagName.toUpperCase()==="TEXTAREA"){c=b.readOnly||b.disabled}else{c=true}}if(c){a.preventDefault()}}})});Ext.override(Ext.form.field.Base,{onFocus:function(){var a=this;a.callParent(arguments);if(Ext.isFunction(a.getValue)){a.onFocusValue=a.getValue();a.on("specialkey",function(c,b){if(b.getKey()===b.ESC){c.setValue(a.onFocusValue)}})}}});Ext.button.Button.prototype.fireHandler=Ext.Function.createInterceptor(Ext.button.Button.prototype.fireHandler,function(b){var a=this;if(a.fireEvent("beforeclick",a,b)===false){return false}});Ext.Function.interceptBefore(Ext.button.Button.prototype,"onClick",function(a){if(Ext.isDefined(a)&&Ext.isDefined(a.target)&&Ext.isFunction(a.target.blur)){a.target.blur()}});Ext.data.Store.prototype.vFilterUpdated=function(a){return a.dirty===true&&a.phantom!==true};Ext.data.Store.prototype.vGetUpdatedRecords=function(){return(this.snapshot||this.data).filterBy(this.vFilterUpdated).items};Ext.data.Store.prototype.getRejectRecords=function(){return Ext.Array.push(this.data.filterBy(this.filterNewOnly).items,this.vGetUpdatedRecords())};Ext.onReady(function(){Ext.ux.grid.Printer.print=Ext.Function.createInterceptor(Ext.ux.grid.Printer.print,function(){var d=this;if(d.stylesheetPath===null){var b=document.getElementsByTagName("link");for(var c=0;c<b.length;c++){var a=b[c];if(a.href&&a.href.indexOf("vulcan-print")!==-1){this.stylesheetPath=a.href;break}}}});Ext.ux.grid.Printer.printLinkText="Drukuj";Ext.ux.grid.Printer.closeLinkText="Zamknij";Ext.ux.grid.Printer.printAutomatically=true;Ext.ux.grid.Printer.closeAutomaticallyAfterPrint=true});if(!Array.prototype.push){Array.prototype.push=function(){for(var b=0,a=arguments.length;b<a;b++){this[this.length]=arguments[b]}return this.length}}if(!Array.prototype.shift){Array.prototype.shift=function(){if(this.length>0){var c=this[0];for(var b=0,a=this.length-1;b<a;b++){this[b]=this[b+1]}this.length=this.length-1;return c}}}if(!Array.prototype.splice){Array.prototype.splice=function(h,e){var b=this.slice(h+e);var c=this.slice(h,h+e);this.length=h;var f=[];for(var d=0,a=arguments.length;d<a;d++){f[d]=arguments[d]}var g=(f.length>2)?b=f.slice(2).concat(b):b;for(d=0,a=g.length;d<a;d++){this.push(g[d])}return c}}var log4javascript=(function(){function isUndefined(obj){return typeof obj=="undefined"}function EventSupport(){}EventSupport.prototype={eventTypes:[],eventListeners:{},setEventTypes:function(eventTypesParam){if(eventTypesParam instanceof Array){this.eventTypes=eventTypesParam;this.eventListeners={};for(var i=0,len=this.eventTypes.length;i<len;i++){this.eventListeners[this.eventTypes[i]]=[]}}else{handleError("log4javascript.EventSupport ["+this+"]: setEventTypes: eventTypes parameter must be an Array")}},addEventListener:function(eventType,listener){if(typeof listener=="function"){if(!array_contains(this.eventTypes,eventType)){handleError("log4javascript.EventSupport ["+this+"]: addEventListener: no event called '"+eventType+"'")}this.eventListeners[eventType].push(listener)}else{handleError("log4javascript.EventSupport ["+this+"]: addEventListener: listener must be a function")}},removeEventListener:function(eventType,listener){if(typeof listener=="function"){if(!array_contains(this.eventTypes,eventType)){handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: no event called '"+eventType+"'")}array_remove(this.eventListeners[eventType],listener)}else{handleError("log4javascript.EventSupport ["+this+"]: removeEventListener: listener must be a function")}},dispatchEvent:function(eventType,eventArgs){if(array_contains(this.eventTypes,eventType)){var listeners=this.eventListeners[eventType];for(var i=0,len=listeners.length;i<len;i++){listeners[i](this,eventType,eventArgs)}}else{handleError("log4javascript.EventSupport ["+this+"]: dispatchEvent: no event called '"+eventType+"'")}}};var applicationStartDate=new Date();var uniqueId="log4javascript_"+applicationStartDate.getTime()+"_"+Math.floor(Math.random()*100000000);var emptyFunction=function(){};var newLine="\r\n";var pageLoaded=false;function Log4JavaScript(){}Log4JavaScript.prototype=new EventSupport();log4javascript=new Log4JavaScript();log4javascript.version="1.4.2";log4javascript.edition="log4javascript";function toStr(obj){if(obj&&obj.toString){return obj.toString()}else{return String(obj)}}function getExceptionMessage(ex){if(ex.message){return ex.message}else{if(ex.description){return ex.description}else{return toStr(ex)}}}function getUrlFileName(url){var lastSlashIndex=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));return url.substr(lastSlashIndex+1)}function getExceptionStringRep(ex){if(ex){var exStr="Exception: "+getExceptionMessage(ex);try{if(ex.lineNumber){exStr+=" on line number "+ex.lineNumber}if(ex.fileName){exStr+=" in file "+getUrlFileName(ex.fileName)}}catch(localEx){logLog.warn("Unable to obtain file and line information for error")}if(showStackTraces&&ex.stack){exStr+=newLine+"Stack trace:"+newLine+ex.stack}return exStr}return null}function bool(obj){return Boolean(obj)}function trim(str){return str.replace(/^\s+/,"").replace(/\s+$/,"")}function splitIntoLines(text){var text2=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return text2.split("\n")}var urlEncode=(typeof window.encodeURIComponent!="undefined")?function(str){return encodeURIComponent(str)}:function(str){return escape(str).replace(/\+/g,"%2B").replace(/"/g,"%22").replace(/'/g,"%27").replace(/\//g,"%2F").replace(/=/g,"%3D")};var urlDecode=(typeof window.decodeURIComponent!="undefined")?function(str){return decodeURIComponent(str)}:function(str){return unescape(str).replace(/%2B/g,"+").replace(/%22/g,'"').replace(/%27/g,"'").replace(/%2F/g,"/").replace(/%3D/g,"=")};function array_remove(arr,val){var index=-1;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===val){index=i;break}}if(index>=0){arr.splice(index,1);return true}else{return false}}function array_contains(arr,val){for(var i=0,len=arr.length;i<len;i++){if(arr[i]==val){return true}}return false}function extractBooleanFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue}else{return bool(param)}}function extractStringFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue}else{return String(param)}}function extractIntFromParam(param,defaultValue){if(isUndefined(param)){return defaultValue}else{try{var value=parseInt(param,10);return isNaN(value)?defaultValue:value}catch(ex){logLog.warn("Invalid int param "+param,ex);return defaultValue}}}function extractFunctionFromParam(param,defaultValue){if(typeof param=="function"){return param}else{return defaultValue}}function isError(err){return(err instanceof Error)}if(!Function.prototype.apply){Function.prototype.apply=function(obj,args){var methodName="__apply__";if(typeof obj[methodName]!="undefined"){methodName+=String(Math.random()).substr(2)}obj[methodName]=this;var argsStrings=[];for(var i=0,len=args.length;i<len;i++){argsStrings[i]="args["+i+"]"}var script="obj."+methodName+"("+argsStrings.join(",")+")";var returnValue=eval(script);delete obj[methodName];return returnValue}}if(!Function.prototype.call){Function.prototype.call=function(obj){var args=[];for(var i=1,len=arguments.length;i<len;i++){args[i-1]=arguments[i]}return this.apply(obj,args)}}function getListenersPropertyName(eventName){return"__log4javascript_listeners__"+eventName}function addEvent(node,eventName,listener,useCapture,win){win=win?win:window;if(node.addEventListener){node.addEventListener(eventName,listener,useCapture)}else{if(node.attachEvent){node.attachEvent("on"+eventName,listener)}else{var propertyName=getListenersPropertyName(eventName);if(!node[propertyName]){node[propertyName]=[];node["on"+eventName]=function(evt){evt=getEvent(evt,win);var listenersPropertyName=getListenersPropertyName(eventName);var listeners=this[listenersPropertyName].concat([]);var currentListener;while((currentListener=listeners.shift())){currentListener.call(this,evt)}}}node[propertyName].push(listener)}}}function removeEvent(node,eventName,listener,useCapture){if(node.removeEventListener){node.removeEventListener(eventName,listener,useCapture)}else{if(node.detachEvent){node.detachEvent("on"+eventName,listener)}else{var propertyName=getListenersPropertyName(eventName);if(node[propertyName]){array_remove(node[propertyName],listener)}}}}function getEvent(evt,win){win=win?win:window;return evt?evt:win.event}function stopEventPropagation(evt){if(evt.stopPropagation){evt.stopPropagation()}else{if(typeof evt.cancelBubble!="undefined"){evt.cancelBubble=true}}evt.returnValue=false}var logLog={quietMode:false,debugMessages:[],setQuietMode:function(quietMode){this.quietMode=bool(quietMode)},numberOfErrors:0,alertAllErrors:false,setAlertAllErrors:function(alertAllErrors){this.alertAllErrors=alertAllErrors},debug:function(message){this.debugMessages.push(message)},displayDebug:function(){alert(this.debugMessages.join(newLine))},warn:function(message,exception){},error:function(message,exception){if(++this.numberOfErrors==1||this.alertAllErrors){if(!this.quietMode){var alertMessage="log4javascript error: "+message;if(exception){alertMessage+=newLine+newLine+"Original error: "+getExceptionStringRep(exception)}alert(alertMessage)}}}};log4javascript.logLog=logLog;log4javascript.setEventTypes(["load","error"]);function handleError(message,exception){logLog.error(message,exception);log4javascript.dispatchEvent("error",{message:message,exception:exception})}log4javascript.handleError=handleError;var enabled=!((typeof log4javascript_disabled!="undefined")&&log4javascript_disabled);log4javascript.setEnabled=function(enable){enabled=bool(enable)};log4javascript.isEnabled=function(){return enabled};var useTimeStampsInMilliseconds=true;log4javascript.setTimeStampsInMilliseconds=function(timeStampsInMilliseconds){useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds)};log4javascript.isTimeStampsInMilliseconds=function(){return useTimeStampsInMilliseconds};log4javascript.evalInScope=function(expr){return eval(expr)};var showStackTraces=false;log4javascript.setShowStackTraces=function(show){showStackTraces=bool(show)};var Level=function(level,name){this.level=level;this.name=name};Level.prototype={toString:function(){return this.name},equals:function(level){return this.level==level.level},isGreaterOrEqual:function(level){return this.level>=level.level}};Level.ALL=new Level(Number.MIN_VALUE,"ALL");Level.TRACE=new Level(10000,"TRACE");Level.DEBUG=new Level(20000,"DEBUG");Level.INFO=new Level(30000,"INFO");Level.WARN=new Level(40000,"WARN");Level.ERROR=new Level(50000,"ERROR");Level.FATAL=new Level(60000,"FATAL");Level.OFF=new Level(Number.MAX_VALUE,"OFF");log4javascript.Level=Level;function Timer(name,level){this.name=name;this.level=isUndefined(level)?Level.INFO:level;this.start=new Date()}Timer.prototype.getElapsedTime=function(){return new Date().getTime()-this.start.getTime()};var anonymousLoggerName="[anonymous]";var defaultLoggerName="[default]";var nullLoggerName="[null]";var rootLoggerName="root";function Logger(name){this.name=name;this.parent=null;this.children=[];var appenders=[];var loggerLevel=null;var isRoot=(this.name===rootLoggerName);var isNull=(this.name===nullLoggerName);var appenderCache=null;var appenderCacheInvalidated=false;this.addChild=function(childLogger){this.children.push(childLogger);childLogger.parent=this;childLogger.invalidateAppenderCache()};var additive=true;this.getAdditivity=function(){return additive};this.setAdditivity=function(additivity){var valueChanged=(additive!=additivity);additive=additivity;if(valueChanged){this.invalidateAppenderCache()}};this.addAppender=function(appender){if(isNull){handleError("Logger.addAppender: you may not add an appender to the null logger")}else{if(appender instanceof log4javascript.Appender){if(!array_contains(appenders,appender)){appenders.push(appender);appender.setAddedToLogger(this);this.invalidateAppenderCache()}}else{handleError("Logger.addAppender: appender supplied ('"+toStr(appender)+"') is not a subclass of Appender")}}};this.removeAppender=function(appender){array_remove(appenders,appender);appender.setRemovedFromLogger(this);this.invalidateAppenderCache()};this.removeAllAppenders=function(){var appenderCount=appenders.length;if(appenderCount>0){for(var i=0;i<appenderCount;i++){appenders[i].setRemovedFromLogger(this)}appenders.length=0;this.invalidateAppenderCache()}};this.getEffectiveAppenders=function(){if(appenderCache===null||appenderCacheInvalidated){var parentEffectiveAppenders=(isRoot||!this.getAdditivity())?[]:this.parent.getEffectiveAppenders();appenderCache=parentEffectiveAppenders.concat(appenders);appenderCacheInvalidated=false}return appenderCache};this.invalidateAppenderCache=function(){appenderCacheInvalidated=true;for(var i=0,len=this.children.length;i<len;i++){this.children[i].invalidateAppenderCache()}};this.log=function(level,params){if(enabled&&level.isGreaterOrEqual(this.getEffectiveLevel())){var exception;var finalParamIndex=params.length-1;var lastParam=params[finalParamIndex];if(params.length>1&&isError(lastParam)){exception=lastParam;finalParamIndex--}var messages=[];for(var i=0;i<=finalParamIndex;i++){messages[i]=params[i]}var loggingEvent=new LoggingEvent(this,new Date(),level,messages,exception);this.callAppenders(loggingEvent)}};this.callAppenders=function(loggingEvent){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].doAppend(loggingEvent)}};this.setLevel=function(level){if(isRoot&&level===null){handleError("Logger.setLevel: you cannot set the level of the root logger to null")}else{if(level instanceof Level){loggerLevel=level}else{handleError("Logger.setLevel: level supplied to logger "+this.name+" is not an instance of log4javascript.Level")}}};this.getLevel=function(){return loggerLevel};this.getEffectiveLevel=function(){for(var logger=this;logger!==null;logger=logger.parent){var level=logger.getLevel();if(level!==null){return level}}};this.group=function(name,initiallyExpanded){if(enabled){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].group(name,initiallyExpanded)}}};this.groupEnd=function(name){if(enabled){var effectiveAppenders=this.getEffectiveAppenders();for(var i=0,len=effectiveAppenders.length;i<len;i++){effectiveAppenders[i].groupEnd()}}};var timers={};this.time=function(name,level){if(enabled){if(isUndefined(name)){handleError("Logger.time: a name for the timer must be supplied")}else{if(level&&!(level instanceof Level)){handleError("Logger.time: level supplied to timer "+name+" is not an instance of log4javascript.Level")}else{timers[name]=new Timer(name,level)}}}};this.timeEnd=function(name){if(enabled){if(isUndefined(name)){handleError("Logger.timeEnd: a name for the timer must be supplied")}else{if(timers[name]){var timer=timers[name];var milliseconds=timer.getElapsedTime();this.log(timer.level,["Timer "+toStr(name)+" completed in "+milliseconds+"ms"]);delete timers[name]}else{logLog.warn("Logger.timeEnd: no timer found with name "+name)}}}};this.assert=function(expr){if(enabled&&!expr){var args=[];for(var i=1,len=arguments.length;i<len;i++){args.push(arguments[i])}args=(args.length>0)?args:["Assertion Failure"];args.push(newLine);args.push(expr);this.log(Level.ERROR,args)}};this.toString=function(){return"Logger["+this.name+"]"}}Logger.prototype={trace:function(){this.log(Level.TRACE,arguments)},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)},isEnabledFor:function(level){return level.isGreaterOrEqual(this.getEffectiveLevel())},isTraceEnabled:function(){return this.isEnabledFor(Level.TRACE)},isDebugEnabled:function(){return this.isEnabledFor(Level.DEBUG)},isInfoEnabled:function(){return this.isEnabledFor(Level.INFO)},isWarnEnabled:function(){return this.isEnabledFor(Level.WARN)},isErrorEnabled:function(){return this.isEnabledFor(Level.ERROR)},isFatalEnabled:function(){return this.isEnabledFor(Level.FATAL)}};Logger.prototype.trace.isEntryPoint=true;Logger.prototype.debug.isEntryPoint=true;Logger.prototype.info.isEntryPoint=true;Logger.prototype.warn.isEntryPoint=true;Logger.prototype.error.isEntryPoint=true;Logger.prototype.fatal.isEntryPoint=true;var loggers={};var loggerNames=[];var ROOT_LOGGER_DEFAULT_LEVEL=Level.DEBUG;var rootLogger=new Logger(rootLoggerName);rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL);log4javascript.getRootLogger=function(){return rootLogger};log4javascript.getLogger=function(loggerName){if(!(typeof loggerName=="string")){loggerName=anonymousLoggerName;logLog.warn("log4javascript.getLogger: non-string logger name "+toStr(loggerName)+" supplied, returning anonymous logger")}if(loggerName==rootLoggerName){handleError("log4javascript.getLogger: root logger may not be obtained by name")}if(!loggers[loggerName]){var logger=new Logger(loggerName);loggers[loggerName]=logger;loggerNames.push(loggerName);var lastDotIndex=loggerName.lastIndexOf(".");var parentLogger;if(lastDotIndex>-1){var parentLoggerName=loggerName.substring(0,lastDotIndex);parentLogger=log4javascript.getLogger(parentLoggerName)}else{parentLogger=rootLogger}parentLogger.addChild(logger)}return loggers[loggerName]};var defaultLogger=null;log4javascript.getDefaultLogger=function(){if(!defaultLogger){defaultLogger=log4javascript.getLogger(defaultLoggerName);var a=new log4javascript.PopUpAppender();defaultLogger.addAppender(a)}return defaultLogger};var nullLogger=null;log4javascript.getNullLogger=function(){if(!nullLogger){nullLogger=new Logger(nullLoggerName);nullLogger.setLevel(Level.OFF)}return nullLogger};log4javascript.resetConfiguration=function(){rootLogger.setLevel(ROOT_LOGGER_DEFAULT_LEVEL);loggers={}};var LoggingEvent=function(logger,timeStamp,level,messages,exception){this.logger=logger;this.timeStamp=timeStamp;this.timeStampInMilliseconds=timeStamp.getTime();this.timeStampInSeconds=Math.floor(this.timeStampInMilliseconds/1000);this.milliseconds=this.timeStamp.getMilliseconds();this.level=level;this.messages=messages;this.exception=exception};LoggingEvent.prototype={getThrowableStrRep:function(){return this.exception?getExceptionStringRep(this.exception):""},getCombinedMessages:function(){return(this.messages.length==1)?this.messages[0]:this.messages.join(newLine)},toString:function(){return"LoggingEvent["+this.level+"]"}};log4javascript.LoggingEvent=LoggingEvent;var Layout=function(){};Layout.prototype={defaults:{loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url"},loggerKey:"logger",timeStampKey:"timestamp",millisecondsKey:"milliseconds",levelKey:"level",messageKey:"message",exceptionKey:"exception",urlKey:"url",batchHeader:"",batchFooter:"",batchSeparator:"",returnsPostData:false,overrideTimeStampsSetting:false,useTimeStampsInMilliseconds:null,format:function(){handleError("Layout.format: layout supplied has no format() method")},ignoresThrowable:function(){handleError("Layout.ignoresThrowable: layout supplied has no ignoresThrowable() method")},getContentType:function(){return"text/plain"},allowBatching:function(){return true},setTimeStampsInMilliseconds:function(timeStampsInMilliseconds){this.overrideTimeStampsSetting=true;this.useTimeStampsInMilliseconds=bool(timeStampsInMilliseconds)},isTimeStampsInMilliseconds:function(){return this.overrideTimeStampsSetting?this.useTimeStampsInMilliseconds:useTimeStampsInMilliseconds},getTimeStampValue:function(loggingEvent){return this.isTimeStampsInMilliseconds()?loggingEvent.timeStampInMilliseconds:loggingEvent.timeStampInSeconds},getDataValues:function(loggingEvent,combineMessages){var dataValues=[[this.loggerKey,loggingEvent.logger.name],[this.timeStampKey,this.getTimeStampValue(loggingEvent)],[this.levelKey,loggingEvent.level.name],[this.urlKey,window.location.href],[this.messageKey,combineMessages?loggingEvent.getCombinedMessages():loggingEvent.messages]];if(!this.isTimeStampsInMilliseconds()){dataValues.push([this.millisecondsKey,loggingEvent.milliseconds])}if(loggingEvent.exception){dataValues.push([this.exceptionKey,getExceptionStringRep(loggingEvent.exception)])}if(this.hasCustomFields()){for(var i=0,len=this.customFields.length;i<len;i++){var val=this.customFields[i].value;if(typeof val==="function"){val=val(this,loggingEvent)}dataValues.push([this.customFields[i].name,val])}}return dataValues},setKeys:function(loggerKey,timeStampKey,levelKey,messageKey,exceptionKey,urlKey,millisecondsKey){this.loggerKey=extractStringFromParam(loggerKey,this.defaults.loggerKey);this.timeStampKey=extractStringFromParam(timeStampKey,this.defaults.timeStampKey);this.levelKey=extractStringFromParam(levelKey,this.defaults.levelKey);this.messageKey=extractStringFromParam(messageKey,this.defaults.messageKey);this.exceptionKey=extractStringFromParam(exceptionKey,this.defaults.exceptionKey);this.urlKey=extractStringFromParam(urlKey,this.defaults.urlKey);this.millisecondsKey=extractStringFromParam(millisecondsKey,this.defaults.millisecondsKey)},setCustomField:function(name,value){var fieldUpdated=false;for(var i=0,len=this.customFields.length;i<len;i++){if(this.customFields[i].name===name){this.customFields[i].value=value;fieldUpdated=true}}if(!fieldUpdated){this.customFields.push({name:name,value:value})}},hasCustomFields:function(){return(this.customFields.length>0)},toString:function(){handleError("Layout.toString: all layouts must override this method")}};log4javascript.Layout=Layout;var Appender=function(){};Appender.prototype=new EventSupport();Appender.prototype.layout=new PatternLayout();Appender.prototype.threshold=Level.ALL;Appender.prototype.loggers=[];Appender.prototype.doAppend=function(loggingEvent){if(enabled&&loggingEvent.level.level>=this.threshold.level){this.append(loggingEvent)}};Appender.prototype.append=function(loggingEvent){};Appender.prototype.setLayout=function(layout){if(layout instanceof Layout){this.layout=layout}else{handleError("Appender.setLayout: layout supplied to "+this.toString()+" is not a subclass of Layout")}};Appender.prototype.getLayout=function(){return this.layout};Appender.prototype.setThreshold=function(threshold){if(threshold instanceof Level){this.threshold=threshold}else{handleError("Appender.setThreshold: threshold supplied to "+this.toString()+" is not a subclass of Level")}};Appender.prototype.getThreshold=function(){return this.threshold};Appender.prototype.setAddedToLogger=function(logger){this.loggers.push(logger)};Appender.prototype.setRemovedFromLogger=function(logger){array_remove(this.loggers,logger)};Appender.prototype.group=emptyFunction;Appender.prototype.groupEnd=emptyFunction;Appender.prototype.toString=function(){handleError("Appender.toString: all appenders must override this method")};log4javascript.Appender=Appender;function SimpleLayout(){this.customFields=[]}SimpleLayout.prototype=new Layout();SimpleLayout.prototype.format=function(loggingEvent){return loggingEvent.level.name+" - "+loggingEvent.getCombinedMessages()};SimpleLayout.prototype.ignoresThrowable=function(){return true};SimpleLayout.prototype.toString=function(){return"SimpleLayout"};log4javascript.SimpleLayout=SimpleLayout;function NullLayout(){this.customFields=[]}NullLayout.prototype=new Layout();NullLayout.prototype.format=function(loggingEvent){return loggingEvent.messages};NullLayout.prototype.ignoresThrowable=function(){return true};NullLayout.prototype.toString=function(){return"NullLayout"};log4javascript.NullLayout=NullLayout;function XmlLayout(combineMessages){this.combineMessages=extractBooleanFromParam(combineMessages,true);this.customFields=[]}XmlLayout.prototype=new Layout();XmlLayout.prototype.isCombinedMessages=function(){return this.combineMessages};XmlLayout.prototype.getContentType=function(){return"text/xml"};XmlLayout.prototype.escapeCdata=function(str){return str.replace(/\]\]>/,"]]>]]&gt;<![CDATA[")};XmlLayout.prototype.format=function(loggingEvent){var layout=this;var i,len;function formatMessage(message){message=(typeof message==="string")?message:toStr(message);return"<log4javascript:message><![CDATA["+layout.escapeCdata(message)+"]]></log4javascript:message>"}var str='<log4javascript:event logger="'+loggingEvent.logger.name+'" timestamp="'+this.getTimeStampValue(loggingEvent)+'"';if(!this.isTimeStampsInMilliseconds()){str+=' milliseconds="'+loggingEvent.milliseconds+'"'}str+=' level="'+loggingEvent.level.name+'">'+newLine;if(this.combineMessages){str+=formatMessage(loggingEvent.getCombinedMessages())}else{str+="<log4javascript:messages>"+newLine;for(i=0,len=loggingEvent.messages.length;i<len;i++){str+=formatMessage(loggingEvent.messages[i])+newLine}str+="</log4javascript:messages>"+newLine}if(this.hasCustomFields()){for(i=0,len=this.customFields.length;i<len;i++){str+='<log4javascript:customfield name="'+this.customFields[i].name+'"><![CDATA['+this.customFields[i].value.toString()+"]]></log4javascript:customfield>"+newLine}}if(loggingEvent.exception){str+="<log4javascript:exception><![CDATA["+getExceptionStringRep(loggingEvent.exception)+"]]></log4javascript:exception>"+newLine}str+="</log4javascript:event>"+newLine+newLine;return str};XmlLayout.prototype.ignoresThrowable=function(){return false};XmlLayout.prototype.toString=function(){return"XmlLayout"};log4javascript.XmlLayout=XmlLayout;function escapeNewLines(str){return str.replace(/\r\n|\r|\n/g,"\\r\\n")}function JsonLayout(readable,combineMessages){this.readable=extractBooleanFromParam(readable,false);this.combineMessages=extractBooleanFromParam(combineMessages,true);this.batchHeader=this.readable?"["+newLine:"[";this.batchFooter=this.readable?"]"+newLine:"]";this.batchSeparator=this.readable?","+newLine:",";this.setKeys();this.colon=this.readable?": ":":";this.tab=this.readable?"\t":"";this.lineBreak=this.readable?newLine:"";this.customFields=[]}JsonLayout.prototype=new Layout();JsonLayout.prototype.isReadable=function(){return this.readable};JsonLayout.prototype.isCombinedMessages=function(){return this.combineMessages};JsonLayout.prototype.format=function(loggingEvent){var layout=this;var dataValues=this.getDataValues(loggingEvent,this.combineMessages);var str="{"+this.lineBreak;var i,len;function formatValue(val,prefix,expand){var formattedValue;var valType=typeof val;if(val instanceof Date){formattedValue=String(val.getTime())}else{if(expand&&(val instanceof Array)){formattedValue="["+layout.lineBreak;for(var i=0,len=val.length;i<len;i++){var childPrefix=prefix+layout.tab;formattedValue+=childPrefix+formatValue(val[i],childPrefix,false);if(i<val.length-1){formattedValue+=","}formattedValue+=layout.lineBreak}formattedValue+=prefix+"]"}else{if(valType!=="number"&&valType!=="boolean"){formattedValue='"'+escapeNewLines(toStr(val).replace(/\"/g,'\\"'))+'"'}else{formattedValue=val}}}return formattedValue}for(i=0,len=dataValues.length-1;i<=len;i++){str+=this.tab+'"'+dataValues[i][0]+'"'+this.colon+formatValue(dataValues[i][1],this.tab,true);if(i<len){str+=","}str+=this.lineBreak}str+="}"+this.lineBreak;return str};JsonLayout.prototype.ignoresThrowable=function(){return false};JsonLayout.prototype.toString=function(){return"JsonLayout"};JsonLayout.prototype.getContentType=function(){return"application/json"};log4javascript.JsonLayout=JsonLayout;function HttpPostDataLayout(){this.setKeys();this.customFields=[];this.returnsPostData=true}HttpPostDataLayout.prototype=new Layout();HttpPostDataLayout.prototype.allowBatching=function(){return false};HttpPostDataLayout.prototype.format=function(loggingEvent){var dataValues=this.getDataValues(loggingEvent);var queryBits=[];for(var i=0,len=dataValues.length;i<len;i++){var val=(dataValues[i][1] instanceof Date)?String(dataValues[i][1].getTime()):dataValues[i][1];queryBits.push(urlEncode(dataValues[i][0])+"="+urlEncode(val))}return queryBits.join("&")};HttpPostDataLayout.prototype.ignoresThrowable=function(loggingEvent){return false};HttpPostDataLayout.prototype.toString=function(){return"HttpPostDataLayout"};log4javascript.HttpPostDataLayout=HttpPostDataLayout;function formatObjectExpansion(obj,depth,indentation){var objectsExpanded=[];function doFormat(obj,depth,indentation){var i,j,len,childDepth,childIndentation,childLines,expansion,childExpansion;if(!indentation){indentation=""}function formatString(text){var lines=splitIntoLines(text);for(var j=1,jLen=lines.length;j<jLen;j++){lines[j]=indentation+lines[j]}return lines.join(newLine)}if(obj===null){return"null"}else{if(typeof obj=="undefined"){return"undefined"}else{if(typeof obj=="string"){return formatString(obj)}else{if(typeof obj=="object"&&array_contains(objectsExpanded,obj)){try{expansion=toStr(obj)}catch(ex){expansion="Error formatting property. Details: "+getExceptionStringRep(ex)}return expansion+" [already expanded]"}else{if((obj instanceof Array)&&depth>0){objectsExpanded.push(obj);expansion="["+newLine;childDepth=depth-1;childIndentation=indentation+"  ";childLines=[];for(i=0,len=obj.length;i<len;i++){try{childExpansion=doFormat(obj[i],childDepth,childIndentation);childLines.push(childIndentation+childExpansion)}catch(ex){childLines.push(childIndentation+"Error formatting array member. Details: "+getExceptionStringRep(ex)+"")}}expansion+=childLines.join(","+newLine)+newLine+indentation+"]";return expansion}else{if(typeof obj=="object"&&depth>0){objectsExpanded.push(obj);expansion="{"+newLine;childDepth=depth-1;childIndentation=indentation+"  ";childLines=[];for(i in obj){try{childExpansion=doFormat(obj[i],childDepth,childIndentation);childLines.push(childIndentation+i+": "+childExpansion)}catch(ex){childLines.push(childIndentation+i+": Error formatting property. Details: "+getExceptionStringRep(ex))}}expansion+=childLines.join(","+newLine)+newLine+indentation+"}";return expansion}else{return formatString(toStr(obj))}}}}}}}return doFormat(obj,depth,indentation)}var SimpleDateFormat;(function(){var regex=/('[^']*')|(G+|y+|M+|w+|W+|D+|d+|F+|E+|a+|H+|k+|K+|h+|m+|s+|S+|Z+)|([a-zA-Z]+)|([^a-zA-Z']+)/;var monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];var dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var TEXT2=0,TEXT3=1,NUMBER=2,YEAR=3,MONTH=4,TIMEZONE=5;var types={G:TEXT2,y:YEAR,M:MONTH,w:NUMBER,W:NUMBER,D:NUMBER,d:NUMBER,F:NUMBER,E:TEXT3,a:TEXT2,H:NUMBER,k:NUMBER,K:NUMBER,h:NUMBER,m:NUMBER,s:NUMBER,S:NUMBER,Z:TIMEZONE};var ONE_DAY=24*60*60*1000;var ONE_WEEK=7*ONE_DAY;var DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK=1;var newDateAtMidnight=function(year,month,day){var d=new Date(year,month,day,0,0,0);d.setMilliseconds(0);return d};Date.prototype.getDifference=function(date){return this.getTime()-date.getTime()};Date.prototype.isBefore=function(d){return this.getTime()<d.getTime()};Date.prototype.getUTCTime=function(){return Date.UTC(this.getFullYear(),this.getMonth(),this.getDate(),this.getHours(),this.getMinutes(),this.getSeconds(),this.getMilliseconds())};Date.prototype.getTimeSince=function(d){return this.getUTCTime()-d.getUTCTime()};Date.prototype.getPreviousSunday=function(){var midday=new Date(this.getFullYear(),this.getMonth(),this.getDate(),12,0,0);var previousSunday=new Date(midday.getTime()-this.getDay()*ONE_DAY);return newDateAtMidnight(previousSunday.getFullYear(),previousSunday.getMonth(),previousSunday.getDate())};Date.prototype.getWeekInYear=function(minimalDaysInFirstWeek){if(isUndefined(this.minimalDaysInFirstWeek)){minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK}var previousSunday=this.getPreviousSunday();var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);var numberOfSundays=previousSunday.isBefore(startOfYear)?0:1+Math.floor(previousSunday.getTimeSince(startOfYear)/ONE_WEEK);var numberOfDaysInFirstWeek=7-startOfYear.getDay();var weekInYear=numberOfSundays;if(numberOfDaysInFirstWeek<minimalDaysInFirstWeek){weekInYear--}return weekInYear};Date.prototype.getWeekInMonth=function(minimalDaysInFirstWeek){if(isUndefined(this.minimalDaysInFirstWeek)){minimalDaysInFirstWeek=DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK}var previousSunday=this.getPreviousSunday();var startOfMonth=newDateAtMidnight(this.getFullYear(),this.getMonth(),1);var numberOfSundays=previousSunday.isBefore(startOfMonth)?0:1+Math.floor(previousSunday.getTimeSince(startOfMonth)/ONE_WEEK);var numberOfDaysInFirstWeek=7-startOfMonth.getDay();var weekInMonth=numberOfSundays;if(numberOfDaysInFirstWeek>=minimalDaysInFirstWeek){weekInMonth++}return weekInMonth};Date.prototype.getDayInYear=function(){var startOfYear=newDateAtMidnight(this.getFullYear(),0,1);return 1+Math.floor(this.getTimeSince(startOfYear)/ONE_DAY)};SimpleDateFormat=function(formatString){this.formatString=formatString};SimpleDateFormat.prototype.setMinimalDaysInFirstWeek=function(days){this.minimalDaysInFirstWeek=days};SimpleDateFormat.prototype.getMinimalDaysInFirstWeek=function(){return isUndefined(this.minimalDaysInFirstWeek)?DEFAULT_MINIMAL_DAYS_IN_FIRST_WEEK:this.minimalDaysInFirstWeek};var padWithZeroes=function(str,len){while(str.length<len){str="0"+str}return str};var formatText=function(data,numberOfLetters,minLength){return(numberOfLetters>=4)?data:data.substr(0,Math.max(minLength,numberOfLetters))};var formatNumber=function(data,numberOfLetters){var dataString=""+data;return padWithZeroes(dataString,numberOfLetters)};SimpleDateFormat.prototype.format=function(date){var formattedString="";var result;var searchString=this.formatString;while((result=regex.exec(searchString))){var quotedString=result[1];var patternLetters=result[2];var otherLetters=result[3];var otherCharacters=result[4];if(quotedString){if(quotedString=="''"){formattedString+="'"}else{formattedString+=quotedString.substring(1,quotedString.length-1)}}else{if(otherLetters){}else{if(otherCharacters){formattedString+=otherCharacters}else{if(patternLetters){var patternLetter=patternLetters.charAt(0);var numberOfLetters=patternLetters.length;var rawData="";switch(patternLetter){case"G":rawData="AD";break;case"y":rawData=date.getFullYear();break;case"M":rawData=date.getMonth();break;case"w":rawData=date.getWeekInYear(this.getMinimalDaysInFirstWeek());break;case"W":rawData=date.getWeekInMonth(this.getMinimalDaysInFirstWeek());break;case"D":rawData=date.getDayInYear();break;case"d":rawData=date.getDate();break;case"F":rawData=1+Math.floor((date.getDate()-1)/7);break;case"E":rawData=dayNames[date.getDay()];break;case"a":rawData=(date.getHours()>=12)?"PM":"AM";break;case"H":rawData=date.getHours();break;case"k":rawData=date.getHours()||24;break;case"K":rawData=date.getHours()%12;break;case"h":rawData=(date.getHours()%12)||12;break;case"m":rawData=date.getMinutes();break;case"s":rawData=date.getSeconds();break;case"S":rawData=date.getMilliseconds();break;case"Z":rawData=date.getTimezoneOffset();break}switch(types[patternLetter]){case TEXT2:formattedString+=formatText(rawData,numberOfLetters,2);break;case TEXT3:formattedString+=formatText(rawData,numberOfLetters,3);break;case NUMBER:formattedString+=formatNumber(rawData,numberOfLetters);break;case YEAR:if(numberOfLetters<=3){var dataString=""+rawData;formattedString+=dataString.substr(2,2)}else{formattedString+=formatNumber(rawData,numberOfLetters)}break;case MONTH:if(numberOfLetters>=3){formattedString+=formatText(monthNames[rawData],numberOfLetters,numberOfLetters)}else{formattedString+=formatNumber(rawData+1,numberOfLetters)}break;case TIMEZONE:var isPositive=(rawData>0);var prefix=isPositive?"-":"+";var absData=Math.abs(rawData);var hours=""+Math.floor(absData/60);hours=padWithZeroes(hours,2);var minutes=""+(absData%60);minutes=padWithZeroes(minutes,2);formattedString+=prefix+hours+minutes;break}}}}}searchString=searchString.substr(result.index+result[0].length)}return formattedString}})();log4javascript.SimpleDateFormat=SimpleDateFormat;function PatternLayout(pattern){if(pattern){this.pattern=pattern}else{this.pattern=PatternLayout.DEFAULT_CONVERSION_PATTERN}this.customFields=[]}PatternLayout.TTCC_CONVERSION_PATTERN="%r %p %c - %m%n";PatternLayout.DEFAULT_CONVERSION_PATTERN="%m%n";PatternLayout.ISO8601_DATEFORMAT="yyyy-MM-dd HH:mm:ss,SSS";PatternLayout.DATETIME_DATEFORMAT="dd MMM yyyy HH:mm:ss,SSS";PatternLayout.ABSOLUTETIME_DATEFORMAT="HH:mm:ss,SSS";PatternLayout.prototype=new Layout();PatternLayout.prototype.format=function(loggingEvent){var regex=/%(-?[0-9]+)?(\.?[0-9]+)?([acdfmMnpr%])(\{([^\}]+)\})?|([^%]+)/;var formattedString="";var result;var searchString=this.pattern;while((result=regex.exec(searchString))){var matchedString=result[0];var padding=result[1];var truncation=result[2];var conversionCharacter=result[3];var specifier=result[5];var text=result[6];if(text){formattedString+=""+text}else{var replacement="";switch(conversionCharacter){case"a":case"m":var depth=0;if(specifier){depth=parseInt(specifier,10);if(isNaN(depth)){handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character '"+conversionCharacter+"' - should be a number");depth=0}}var messages=(conversionCharacter==="a")?loggingEvent.messages[0]:loggingEvent.messages;for(var i=0,len=messages.length;i<len;i++){if(i>0&&(replacement.charAt(replacement.length-1)!==" ")){replacement+=" "}if(depth===0){replacement+=messages[i]}else{replacement+=formatObjectExpansion(messages[i],depth)}}break;case"c":var loggerName=loggingEvent.logger.name;if(specifier){var precision=parseInt(specifier,10);var loggerNameBits=loggingEvent.logger.name.split(".");if(precision>=loggerNameBits.length){replacement=loggerName}else{replacement=loggerNameBits.slice(loggerNameBits.length-precision).join(".")}}else{replacement=loggerName}break;case"d":var dateFormat=PatternLayout.ISO8601_DATEFORMAT;if(specifier){dateFormat=specifier;if(dateFormat=="ISO8601"){dateFormat=PatternLayout.ISO8601_DATEFORMAT}else{if(dateFormat=="ABSOLUTE"){dateFormat=PatternLayout.ABSOLUTETIME_DATEFORMAT}else{if(dateFormat=="DATE"){dateFormat=PatternLayout.DATETIME_DATEFORMAT}}}}replacement=(new SimpleDateFormat(dateFormat)).format(loggingEvent.timeStamp);break;case"f":if(this.hasCustomFields()){var fieldIndex=0;if(specifier){fieldIndex=parseInt(specifier,10);if(isNaN(fieldIndex)){handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character 'f' - should be a number")}else{if(fieldIndex===0){handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character 'f' - must be greater than zero")}else{if(fieldIndex>this.customFields.length){handleError("PatternLayout.format: invalid specifier '"+specifier+"' for conversion character 'f' - there aren't that many custom fields")}else{fieldIndex=fieldIndex-1}}}}replacement=this.customFields[fieldIndex].value}break;case"n":replacement=newLine;break;case"p":replacement=loggingEvent.level.name;break;case"r":replacement=""+loggingEvent.timeStamp.getDifference(applicationStartDate);break;case"%":replacement="%";break;default:replacement=matchedString;break}var l;if(truncation){l=parseInt(truncation.substr(1),10);var strLen=replacement.length;if(l<strLen){replacement=replacement.substring(strLen-l,strLen)}}if(padding){if(padding.charAt(0)=="-"){l=parseInt(padding.substr(1),10);while(replacement.length<l){replacement+=" "}}else{l=parseInt(padding,10);while(replacement.length<l){replacement=" "+replacement}}}formattedString+=replacement}searchString=searchString.substr(result.index+result[0].length)}return formattedString};PatternLayout.prototype.ignoresThrowable=function(){return true};PatternLayout.prototype.toString=function(){return"PatternLayout"};log4javascript.PatternLayout=PatternLayout;function AlertAppender(){}AlertAppender.prototype=new Appender();AlertAppender.prototype.layout=new SimpleLayout();AlertAppender.prototype.append=function(loggingEvent){var formattedMessage=this.getLayout().format(loggingEvent);if(this.getLayout().ignoresThrowable()){formattedMessage+=loggingEvent.getThrowableStrRep()}alert(formattedMessage)};AlertAppender.prototype.toString=function(){return"AlertAppender"};log4javascript.AlertAppender=AlertAppender;function BrowserConsoleAppender(){}BrowserConsoleAppender.prototype=new log4javascript.Appender();BrowserConsoleAppender.prototype.layout=new NullLayout();BrowserConsoleAppender.prototype.threshold=Level.DEBUG;BrowserConsoleAppender.prototype.append=function(loggingEvent){var appender=this;var getFormattedMessage=function(){var layout=appender.getLayout();var formattedMessage=layout.format(loggingEvent);if(layout.ignoresThrowable()&&loggingEvent.exception){formattedMessage+=loggingEvent.getThrowableStrRep()}return formattedMessage};if((typeof opera!="undefined")&&opera.postError){opera.postError(getFormattedMessage())}else{if(window.console&&window.console.log){var formattedMesage=getFormattedMessage();if(window.console.debug&&Level.DEBUG.isGreaterOrEqual(loggingEvent.level)){window.console.debug(formattedMesage)}else{if(window.console.info&&Level.INFO.equals(loggingEvent.level)){window.console.info(formattedMesage)}else{if(window.console.warn&&Level.WARN.equals(loggingEvent.level)){window.console.warn(formattedMesage)}else{if(window.console.error&&loggingEvent.level.isGreaterOrEqual(Level.ERROR)){window.console.error(formattedMesage)}else{window.console.log(formattedMesage)}}}}}}};BrowserConsoleAppender.prototype.group=function(name){if(window.console&&window.console.group){window.console.group(name)}};BrowserConsoleAppender.prototype.groupEnd=function(){if(window.console&&window.console.groupEnd){window.console.groupEnd()}};BrowserConsoleAppender.prototype.toString=function(){return"BrowserConsoleAppender"};log4javascript.BrowserConsoleAppender=BrowserConsoleAppender;var xmlHttpFactories=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];var getXmlHttp=function(errorHandler){var xmlHttp=null,factory;for(var i=0,len=xmlHttpFactories.length;i<len;i++){factory=xmlHttpFactories[i];try{xmlHttp=factory();getXmlHttp=factory;return xmlHttp}catch(e){}}if(errorHandler){errorHandler()}else{handleError("getXmlHttp: unable to obtain XMLHttpRequest object")}};function isHttpRequestSuccessful(xmlHttp){return(isUndefined(xmlHttp.status)||xmlHttp.status===0||(xmlHttp.status>=200&&xmlHttp.status<300))}function AjaxAppender(url){var appender=this;var isSupported=true;if(!url){handleError("AjaxAppender: URL must be specified in constructor");isSupported=false}var timed=this.defaults.timed;var waitForResponse=this.defaults.waitForResponse;var batchSize=this.defaults.batchSize;var timerInterval=this.defaults.timerInterval;var requestSuccessCallback=this.defaults.requestSuccessCallback;var failCallback=this.defaults.failCallback;var postVarName=this.defaults.postVarName;var sendAllOnUnload=this.defaults.sendAllOnUnload;var sessionId=null;var queuedLoggingEvents=[];var queuedRequests=[];var sending=false;var initialized=false;function checkCanConfigure(configOptionName){if(initialized){handleError("AjaxAppender: configuration option '"+configOptionName+"' may not be set after the appender has been initialized");return false}return true}this.getSessionId=function(){return sessionId};this.setSessionId=function(sessionIdParam){sessionId=extractStringFromParam(sessionIdParam,null);this.layout.setCustomField("sessionid",sessionId)};this.setLayout=function(layoutParam){if(checkCanConfigure("layout")){this.layout=layoutParam;if(sessionId!==null){this.setSessionId(sessionId)}}};this.isTimed=function(){return timed};this.setTimed=function(timedParam){if(checkCanConfigure("timed")){timed=bool(timedParam)}};this.getTimerInterval=function(){return timerInterval};this.setTimerInterval=function(timerIntervalParam){if(checkCanConfigure("timerInterval")){timerInterval=extractIntFromParam(timerIntervalParam,timerInterval)}};this.isWaitForResponse=function(){return waitForResponse};this.setWaitForResponse=function(waitForResponseParam){if(checkCanConfigure("waitForResponse")){waitForResponse=bool(waitForResponseParam)}};this.getBatchSize=function(){return batchSize};this.setBatchSize=function(batchSizeParam){if(checkCanConfigure("batchSize")){batchSize=extractIntFromParam(batchSizeParam,batchSize)}};this.isSendAllOnUnload=function(){return sendAllOnUnload};this.setSendAllOnUnload=function(sendAllOnUnloadParam){if(checkCanConfigure("sendAllOnUnload")){sendAllOnUnload=extractIntFromParam(sendAllOnUnloadParam,sendAllOnUnload)}};this.setRequestSuccessCallback=function(requestSuccessCallbackParam){requestSuccessCallback=extractFunctionFromParam(requestSuccessCallbackParam,requestSuccessCallback)};this.setFailCallback=function(failCallbackParam){failCallback=extractFunctionFromParam(failCallbackParam,failCallback)};this.getPostVarName=function(){return postVarName};this.setPostVarName=function(postVarNameParam){if(checkCanConfigure("postVarName")){postVarName=extractStringFromParam(postVarNameParam,postVarName)}};function sendAll(){if(isSupported&&enabled){sending=true;var currentRequestBatch;if(waitForResponse){if(queuedRequests.length>0){currentRequestBatch=queuedRequests.shift();sendRequest(preparePostData(currentRequestBatch),sendAll)}else{sending=false;if(timed){scheduleSending()}}}else{while((currentRequestBatch=queuedRequests.shift())){sendRequest(preparePostData(currentRequestBatch))}sending=false;if(timed){scheduleSending()}}}}this.sendAll=sendAll;function sendAllRemaining(){if(isSupported&&enabled){var actualBatchSize=appender.getLayout().allowBatching()?batchSize:1;var currentLoggingEvent;var postData="";var batchedLoggingEvents=[];while((currentLoggingEvent=queuedLoggingEvents.shift())){batchedLoggingEvents.push(currentLoggingEvent);if(queuedLoggingEvents.length>=actualBatchSize){queuedRequests.push(batchedLoggingEvents);batchedLoggingEvents=[]}}if(batchedLoggingEvents.length>0){queuedRequests.push(batchedLoggingEvents)}waitForResponse=false;timed=false;sendAll()}}function preparePostData(batchedLoggingEvents){var formattedMessages=[];var currentLoggingEvent;var postData="";while((currentLoggingEvent=batchedLoggingEvents.shift())){var currentFormattedMessage=appender.getLayout().format(currentLoggingEvent);if(appender.getLayout().ignoresThrowable()){currentFormattedMessage+=loggingEvent.getThrowableStrRep()}formattedMessages.push(currentFormattedMessage)}if(batchedLoggingEvents.length==1){postData=formattedMessages.join("")}else{postData=appender.getLayout().batchHeader+formattedMessages.join(appender.getLayout().batchSeparator)+appender.getLayout().batchFooter}postData=appender.getLayout().returnsPostData?postData:urlEncode(postVarName)+"="+urlEncode(postData);if(postData.length>0){postData+="&"}return postData+"layout="+urlEncode(appender.getLayout().toString())}function scheduleSending(){window.setTimeout(sendAll,timerInterval)}function xmlHttpErrorHandler(){var msg="AjaxAppender: could not create XMLHttpRequest object. AjaxAppender disabled";handleError(msg);isSupported=false;if(failCallback){failCallback(msg)}}function sendRequest(postData,successCallback){try{var xmlHttp=getXmlHttp(xmlHttpErrorHandler);if(isSupported){if(xmlHttp.overrideMimeType){xmlHttp.overrideMimeType(appender.getLayout().getContentType())}xmlHttp.onreadystatechange=function(){if(xmlHttp.readyState==4){if(isHttpRequestSuccessful(xmlHttp)){if(requestSuccessCallback){requestSuccessCallback(xmlHttp)}if(successCallback){successCallback(xmlHttp)}}else{var msg="AjaxAppender.append: XMLHttpRequest request to URL "+url+" returned status code "+xmlHttp.status;handleError(msg);if(failCallback){failCallback(msg)}}xmlHttp.onreadystatechange=emptyFunction;xmlHttp=null}};xmlHttp.open("POST",url,true);try{xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(headerEx){var msg="AjaxAppender.append: your browser's XMLHttpRequest implementation does not support setRequestHeader, therefore cannot post data. AjaxAppender disabled";handleError(msg);isSupported=false;if(failCallback){failCallback(msg)}return}xmlHttp.send(postData)}}catch(ex){var errMsg="AjaxAppender.append: error sending log message to "+url;handleError(errMsg,ex);isSupported=false;if(failCallback){failCallback(errMsg+". Details: "+getExceptionStringRep(ex))}}}this.append=function(loggingEvent){if(isSupported){if(!initialized){init()}queuedLoggingEvents.push(loggingEvent);var actualBatchSize=this.getLayout().allowBatching()?batchSize:1;if(queuedLoggingEvents.length>=actualBatchSize){var currentLoggingEvent;var batchedLoggingEvents=[];while((currentLoggingEvent=queuedLoggingEvents.shift())){batchedLoggingEvents.push(currentLoggingEvent)}queuedRequests.push(batchedLoggingEvents);if(!timed&&(!waitForResponse||(waitForResponse&&!sending))){sendAll()}}}};function init(){initialized=true;if(sendAllOnUnload){addEvent(window,"unload",sendAllRemaining)}if(timed){scheduleSending()}}}AjaxAppender.prototype=new Appender();AjaxAppender.prototype.defaults={waitForResponse:false,timed:false,timerInterval:1000,batchSize:1,sendAllOnUnload:true,requestSuccessCallback:null,failCallback:null,postVarName:"data"};AjaxAppender.prototype.layout=new HttpPostDataLayout();AjaxAppender.prototype.toString=function(){return"AjaxAppender"};log4javascript.AjaxAppender=AjaxAppender;function setCookie(name,value,days,path){var expires;path=path?"; path="+path:"";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=escape(name)+"="+escape(value)+expires+path}function getCookie(name){var nameEquals=escape(name)+"=";var ca=document.cookie.split(";");for(var i=0,len=ca.length;i<len;i++){var c=ca[i];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(nameEquals)===0){return unescape(c.substring(nameEquals.length,c.length))}}return null}function getBaseUrl(){var scripts=document.getElementsByTagName("script");for(var i=0,len=scripts.length;i<len;++i){if(scripts[i].src.indexOf("log4javascript")!=-1){var lastSlash=scripts[i].src.lastIndexOf("/");return(lastSlash==-1)?"":scripts[i].src.substr(0,lastSlash+1)}}return null}function isLoaded(win){try{return bool(win.loaded)}catch(ex){return false}}var ConsoleAppender;(function(){var getConsoleHtmlLines=function(){return['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">','<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">',"	<head>","		<title>log4javascript</title>",'		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',"		<!-- Make IE8 behave like IE7, having gone to all the trouble of making IE work -->",'		<meta http-equiv="X-UA-Compatible" content="IE=7" />','		<script type="text/javascript">var isIe = false, isIePre7 = false;<\/script>','		<!--[if IE]><script type="text/javascript">isIe = true<\/script><![endif]-->','		<!--[if lt IE 7]><script type="text/javascript">isIePre7 = true<\/script><![endif]-->','		<script type="text/javascript">',"			//<![CDATA[","			var loggingEnabled = true;","			var logQueuedEventsTimer = null;","			var logEntries = [];","			var logEntriesAndSeparators = [];","			var logItems = [];","			var renderDelay = 100;","			var unrenderedLogItemsExist = false;","			var rootGroup, currentGroup = null;","			var loaded = false;","			var currentLogItem = null;","			var logMainContainer;","","			function copyProperties(obj, props) {","				for (var i in props) {","					obj[i] = props[i];","				}","			}","","			/*----------------------------------------------------------------*/","","			function LogItem() {","			}","","			LogItem.prototype = {","				mainContainer: null,","				wrappedContainer: null,","				unwrappedContainer: null,","				group: null,","","				appendToLog: function() {","					for (var i = 0, len = this.elementContainers.length; i < len; i++) {","						this.elementContainers[i].appendToLog();","					}","					this.group.update();","				},","","				doRemove: function(doUpdate, removeFromGroup) {","					if (this.rendered) {","						for (var i = 0, len = this.elementContainers.length; i < len; i++) {","							this.elementContainers[i].remove();","						}","						this.unwrappedElementContainer = null;","						this.wrappedElementContainer = null;","						this.mainElementContainer = null;","					}","					if (this.group && removeFromGroup) {","						this.group.removeChild(this, doUpdate);","					}","					if (this === currentLogItem) {","						currentLogItem = null;","					}","				},","","				remove: function(doUpdate, removeFromGroup) {","					this.doRemove(doUpdate, removeFromGroup);","				},","","				render: function() {},","","				accept: function(visitor) {","					visitor.visit(this);","				},","","				getUnwrappedDomContainer: function() {","					return this.group.unwrappedElementContainer.contentDiv;","				},","","				getWrappedDomContainer: function() {","					return this.group.wrappedElementContainer.contentDiv;","				},","","				getMainDomContainer: function() {","					return this.group.mainElementContainer.contentDiv;","				}","			};","","			LogItem.serializedItemKeys = {LOG_ENTRY: 0, GROUP_START: 1, GROUP_END: 2};","","			/*----------------------------------------------------------------*/","","			function LogItemContainerElement() {","			}","","			LogItemContainerElement.prototype = {","				appendToLog: function() {","					var insertBeforeFirst = (newestAtTop && this.containerDomNode.hasChildNodes());","					if (insertBeforeFirst) {","						this.containerDomNode.insertBefore(this.mainDiv, this.containerDomNode.firstChild);","					} else {","						this.containerDomNode.appendChild(this.mainDiv);","					}","				}","			};","","			/*----------------------------------------------------------------*/","","			function SeparatorElementContainer(containerDomNode) {","				this.containerDomNode = containerDomNode;",'				this.mainDiv = document.createElement("div");','				this.mainDiv.className = "separator";','				this.mainDiv.innerHTML = "&nbsp;";',"			}","","			SeparatorElementContainer.prototype = new LogItemContainerElement();","","			SeparatorElementContainer.prototype.remove = function() {","				this.mainDiv.parentNode.removeChild(this.mainDiv);","				this.mainDiv = null;","			};","","			/*----------------------------------------------------------------*/","","			function Separator() {","				this.rendered = false;","			}","","			Separator.prototype = new LogItem();","","			copyProperties(Separator.prototype, {","				render: function() {","					var containerDomNode = this.group.contentDiv;","					if (isIe) {","						this.unwrappedElementContainer = new SeparatorElementContainer(this.getUnwrappedDomContainer());","						this.wrappedElementContainer = new SeparatorElementContainer(this.getWrappedDomContainer());","						this.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","					} else {","						this.mainElementContainer = new SeparatorElementContainer(this.getMainDomContainer());","						this.elementContainers = [this.mainElementContainer];","					}","					this.content = this.formattedMessage;","					this.rendered = true;","				}","			});","","			/*----------------------------------------------------------------*/","","			function GroupElementContainer(group, containerDomNode, isRoot, isWrapped) {","				this.group = group;","				this.containerDomNode = containerDomNode;","				this.isRoot = isRoot;","				this.isWrapped = isWrapped;","				this.expandable = false;","","				if (this.isRoot) {","					if (isIe) {",'						this.contentDiv = logMainContainer.appendChild(document.createElement("div"));','						this.contentDiv.id = this.isWrapped ? "log_wrapped" : "log_unwrapped";',"					} else {","						this.contentDiv = logMainContainer;","					}","				} else {","					var groupElementContainer = this;","					",'					this.mainDiv = document.createElement("div");','					this.mainDiv.className = "group";',"",'					this.headingDiv = this.mainDiv.appendChild(document.createElement("div"));','					this.headingDiv.className = "groupheading";',"",'					this.expander = this.headingDiv.appendChild(document.createElement("span"));','					this.expander.className = "expander unselectable greyedout";',"					this.expander.unselectable = true;",'					var expanderText = this.group.expanded ? "-" : "+";',"					this.expanderTextNode = this.expander.appendChild(document.createTextNode(expanderText));","					",'					this.headingDiv.appendChild(document.createTextNode(" " + this.group.name));',"",'					this.contentDiv = this.mainDiv.appendChild(document.createElement("div"));','					var contentCssClass = this.group.expanded ? "expanded" : "collapsed";','					this.contentDiv.className = "groupcontent " + contentCssClass;',"","					this.expander.onclick = function() {","						if (groupElementContainer.group.expandable) {","							groupElementContainer.group.toggleExpanded();","						}","					};","				}","			}","","			GroupElementContainer.prototype = new LogItemContainerElement();","","			copyProperties(GroupElementContainer.prototype, {","				toggleExpanded: function() {","					if (!this.isRoot) {","						var oldCssClass, newCssClass, expanderText;","						if (this.group.expanded) {",'							newCssClass = "expanded";','							oldCssClass = "collapsed";','							expanderText = "-";',"						} else {",'							newCssClass = "collapsed";','							oldCssClass = "expanded";','							expanderText = "+";',"						}","						replaceClass(this.contentDiv, newCssClass, oldCssClass);","						this.expanderTextNode.nodeValue = expanderText;","					}","				},","","				remove: function() {","					if (!this.isRoot) {","						this.headingDiv = null;","						this.expander.onclick = null;","						this.expander = null;","						this.expanderTextNode = null;","						this.contentDiv = null;","						this.containerDomNode = null;","						this.mainDiv.parentNode.removeChild(this.mainDiv);","						this.mainDiv = null;","					}","				},","","				reverseChildren: function() {","					// Invert the order of the log entries","					var node = null;","","					// Remove all the log container nodes","					var childDomNodes = [];","					while ((node = this.contentDiv.firstChild)) {","						this.contentDiv.removeChild(node);","						childDomNodes.push(node);","					}","","					// Put them all back in reverse order","					while ((node = childDomNodes.pop())) {","						this.contentDiv.appendChild(node);","					}","				},","","				update: function() {","					if (!this.isRoot) {","						if (this.group.expandable) {",'							removeClass(this.expander, "greyedout");',"						} else {",'							addClass(this.expander, "greyedout");',"						}","					}","				},","","				clear: function() {","					if (this.isRoot) {",'						this.contentDiv.innerHTML = "";',"					}","				}","			});","","			/*----------------------------------------------------------------*/","","			function Group(name, isRoot, initiallyExpanded) {","				this.name = name;","				this.group = null;","				this.isRoot = isRoot;","				this.initiallyExpanded = initiallyExpanded;","				this.elementContainers = [];","				this.children = [];","				this.expanded = initiallyExpanded;","				this.rendered = false;","				this.expandable = false;","			}","","			Group.prototype = new LogItem();","","			copyProperties(Group.prototype, {","				addChild: function(logItem) {","					this.children.push(logItem);","					logItem.group = this;","				},","","				render: function() {","					if (isIe) {","						var unwrappedDomContainer, wrappedDomContainer;","						if (this.isRoot) {","							unwrappedDomContainer = logMainContainer;","							wrappedDomContainer = logMainContainer;","						} else {","							unwrappedDomContainer = this.getUnwrappedDomContainer();","							wrappedDomContainer = this.getWrappedDomContainer();","						}","						this.unwrappedElementContainer = new GroupElementContainer(this, unwrappedDomContainer, this.isRoot, false);","						this.wrappedElementContainer = new GroupElementContainer(this, wrappedDomContainer, this.isRoot, true);","						this.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","					} else {","						var mainDomContainer = this.isRoot ? logMainContainer : this.getMainDomContainer();","						this.mainElementContainer = new GroupElementContainer(this, mainDomContainer, this.isRoot, false);","						this.elementContainers = [this.mainElementContainer];","					}","					this.rendered = true;","				},","","				toggleExpanded: function() {","					this.expanded = !this.expanded;","					for (var i = 0, len = this.elementContainers.length; i < len; i++) {","						this.elementContainers[i].toggleExpanded();","					}","				},","","				expand: function() {","					if (!this.expanded) {","						this.toggleExpanded();","					}","				},","","				accept: function(visitor) {","					visitor.visitGroup(this);","				},","","				reverseChildren: function() {","					if (this.rendered) {","						for (var i = 0, len = this.elementContainers.length; i < len; i++) {","							this.elementContainers[i].reverseChildren();","						}","					}","				},","","				update: function() {","					var previouslyExpandable = this.expandable;","					this.expandable = (this.children.length !== 0);","					if (this.expandable !== previouslyExpandable) {","						for (var i = 0, len = this.elementContainers.length; i < len; i++) {","							this.elementContainers[i].update();","						}","					}","				},","","				flatten: function() {","					var visitor = new GroupFlattener();","					this.accept(visitor);","					return visitor.logEntriesAndSeparators;","				},","","				removeChild: function(child, doUpdate) {","					array_remove(this.children, child);","					child.group = null;","					if (doUpdate) {","						this.update();","					}","				},","","				remove: function(doUpdate, removeFromGroup) {","					for (var i = 0, len = this.children.length; i < len; i++) {","						this.children[i].remove(false, false);","					}","					this.children = [];","					this.update();","					if (this === currentGroup) {","						currentGroup = this.group;","					}","					this.doRemove(doUpdate, removeFromGroup);","				},","","				serialize: function(items) {","					items.push([LogItem.serializedItemKeys.GROUP_START, this.name]);","					for (var i = 0, len = this.children.length; i < len; i++) {","						this.children[i].serialize(items);","					}","					if (this !== currentGroup) {","						items.push([LogItem.serializedItemKeys.GROUP_END]);","					}","				},","","				clear: function() {","					for (var i = 0, len = this.elementContainers.length; i < len; i++) {","						this.elementContainers[i].clear();","					}","				}","			});","","			/*----------------------------------------------------------------*/","","			function LogEntryElementContainer() {","			}","","			LogEntryElementContainer.prototype = new LogItemContainerElement();","","			copyProperties(LogEntryElementContainer.prototype, {","				remove: function() {","					this.doRemove();","				},","","				doRemove: function() {","					this.mainDiv.parentNode.removeChild(this.mainDiv);","					this.mainDiv = null;","					this.contentElement = null;","					this.containerDomNode = null;","				},","","				setContent: function(content, wrappedContent) {","					if (content === this.formattedMessage) {",'						this.contentElement.innerHTML = "";',"						this.contentElement.appendChild(document.createTextNode(this.formattedMessage));","					} else {","						this.contentElement.innerHTML = content;","					}","				},","","				setSearchMatch: function(isMatch) {",'					var oldCssClass = isMatch ? "searchnonmatch" : "searchmatch";','					var newCssClass = isMatch ? "searchmatch" : "searchnonmatch";',"					replaceClass(this.mainDiv, newCssClass, oldCssClass);","				},","","				clearSearch: function() {",'					removeClass(this.mainDiv, "searchmatch");','					removeClass(this.mainDiv, "searchnonmatch");',"				}","			});","","			/*----------------------------------------------------------------*/","","			function LogEntryWrappedElementContainer(logEntry, containerDomNode) {","				this.logEntry = logEntry;","				this.containerDomNode = containerDomNode;",'				this.mainDiv = document.createElement("div");',"				this.mainDiv.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'				this.mainDiv.className = "logentry wrapped " + this.logEntry.level;',"				this.contentElement = this.mainDiv;","			}","","			LogEntryWrappedElementContainer.prototype = new LogEntryElementContainer();","","			LogEntryWrappedElementContainer.prototype.setContent = function(content, wrappedContent) {","				if (content === this.formattedMessage) {",'					this.contentElement.innerHTML = "";',"					this.contentElement.appendChild(document.createTextNode(this.formattedMessage));","				} else {","					this.contentElement.innerHTML = wrappedContent;","				}","			};","","			/*----------------------------------------------------------------*/","","			function LogEntryUnwrappedElementContainer(logEntry, containerDomNode) {","				this.logEntry = logEntry;","				this.containerDomNode = containerDomNode;",'				this.mainDiv = document.createElement("div");','				this.mainDiv.className = "logentry unwrapped " + this.logEntry.level;','				this.pre = this.mainDiv.appendChild(document.createElement("pre"));',"				this.pre.appendChild(document.createTextNode(this.logEntry.formattedMessage));",'				this.pre.className = "unwrapped";',"				this.contentElement = this.pre;","			}","","			LogEntryUnwrappedElementContainer.prototype = new LogEntryElementContainer();","","			LogEntryUnwrappedElementContainer.prototype.remove = function() {","				this.doRemove();","				this.pre = null;","			};","","			/*----------------------------------------------------------------*/","","			function LogEntryMainElementContainer(logEntry, containerDomNode) {","				this.logEntry = logEntry;","				this.containerDomNode = containerDomNode;",'				this.mainDiv = document.createElement("div");','				this.mainDiv.className = "logentry nonielogentry " + this.logEntry.level;','				this.contentElement = this.mainDiv.appendChild(document.createElement("span"));',"				this.contentElement.appendChild(document.createTextNode(this.logEntry.formattedMessage));","			}","","			LogEntryMainElementContainer.prototype = new LogEntryElementContainer();","","			/*----------------------------------------------------------------*/","","			function LogEntry(level, formattedMessage) {","				this.level = level;","				this.formattedMessage = formattedMessage;","				this.rendered = false;","			}","","			LogEntry.prototype = new LogItem();","","			copyProperties(LogEntry.prototype, {","				render: function() {","					var logEntry = this;","					var containerDomNode = this.group.contentDiv;","","					// Support for the CSS attribute white-space in IE for Windows is","					// non-existent pre version 6 and slightly odd in 6, so instead","					// use two different HTML elements","					if (isIe) {",'						this.formattedMessage = this.formattedMessage.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"						this.unwrappedElementContainer = new LogEntryUnwrappedElementContainer(this, this.getUnwrappedDomContainer());","						this.wrappedElementContainer = new LogEntryWrappedElementContainer(this, this.getWrappedDomContainer());","						this.elementContainers = [this.unwrappedElementContainer, this.wrappedElementContainer];","					} else {","						this.mainElementContainer = new LogEntryMainElementContainer(this, this.getMainDomContainer());","						this.elementContainers = [this.mainElementContainer];","					}","					this.content = this.formattedMessage;","					this.rendered = true;","				},","","				setContent: function(content, wrappedContent) {","					if (content != this.content) {","						if (isIe && (content !== this.formattedMessage)) {",'							content = content.replace(/\\r\\n/g, "\\r"); // Workaround for IE\'s treatment of white space',"						}","						for (var i = 0, len = this.elementContainers.length; i < len; i++) {","							this.elementContainers[i].setContent(content, wrappedContent);","						}","						this.content = content;","					}","				},","","				getSearchMatches: function() {","					var matches = [];","					var i, len;","					if (isIe) {",'						var unwrappedEls = getElementsByClass(this.unwrappedElementContainer.mainDiv, "searchterm", "span");','						var wrappedEls = getElementsByClass(this.wrappedElementContainer.mainDiv, "searchterm", "span");',"						for (i = 0, len = unwrappedEls.length; i < len; i++) {","							matches[i] = new Match(this.level, null, unwrappedEls[i], wrappedEls[i]);","						}","					} else {",'						var els = getElementsByClass(this.mainElementContainer.mainDiv, "searchterm", "span");',"						for (i = 0, len = els.length; i < len; i++) {","							matches[i] = new Match(this.level, els[i]);","						}","					}","					return matches;","				},","","				setSearchMatch: function(isMatch) {","					for (var i = 0, len = this.elementContainers.length; i < len; i++) {","						this.elementContainers[i].setSearchMatch(isMatch);","					}","				},","","				clearSearch: function() {","					for (var i = 0, len = this.elementContainers.length; i < len; i++) {","						this.elementContainers[i].clearSearch();","					}","				},","","				accept: function(visitor) {","					visitor.visitLogEntry(this);","				},","","				serialize: function(items) {","					items.push([LogItem.serializedItemKeys.LOG_ENTRY, this.level, this.formattedMessage]);","				}","			});","","			/*----------------------------------------------------------------*/","","			function LogItemVisitor() {","			}","","			LogItemVisitor.prototype = {","				visit: function(logItem) {","				},","","				visitParent: function(logItem) {","					if (logItem.group) {","						logItem.group.accept(this);","					}","				},","","				visitChildren: function(logItem) {","					for (var i = 0, len = logItem.children.length; i < len; i++) {","						logItem.children[i].accept(this);","					}","				},","","				visitLogEntry: function(logEntry) {","					this.visit(logEntry);","				},","","				visitSeparator: function(separator) {","					this.visit(separator);","				},","","				visitGroup: function(group) {","					this.visit(group);","				}","			};","","			/*----------------------------------------------------------------*/","","			function GroupFlattener() {","				this.logEntriesAndSeparators = [];","			}","","			GroupFlattener.prototype = new LogItemVisitor();","","			GroupFlattener.prototype.visitGroup = function(group) {","				this.visitChildren(group);","			};","","			GroupFlattener.prototype.visitLogEntry = function(logEntry) {","				this.logEntriesAndSeparators.push(logEntry);","			};","","			GroupFlattener.prototype.visitSeparator = function(separator) {","				this.logEntriesAndSeparators.push(separator);","			};","","			/*----------------------------------------------------------------*/","","			window.onload = function() {","				// Sort out document.domain","				if (location.search) {",'					var queryBits = unescape(location.search).substr(1).split("&"), nameValueBits;',"					for (var i = 0, len = queryBits.length; i < len; i++) {",'						nameValueBits = queryBits[i].split("=");','						if (nameValueBits[0] == "log4javascript_domain") {',"							document.domain = nameValueBits[1];","							break;","						}","					}","				}","","				// Create DOM objects",'				logMainContainer = $("log");',"				if (isIePre7) {",'					addClass(logMainContainer, "oldIe");',"				}","",'				rootGroup = new Group("root", true);',"				rootGroup.render();","				currentGroup = rootGroup;","				","				setCommandInputWidth();","				setLogContainerHeight();","				toggleLoggingEnabled();","				toggleSearchEnabled();","				toggleSearchFilter();","				toggleSearchHighlight();","				applyFilters();","				checkAllLevels();","				toggleWrap();","				toggleNewestAtTop();","				toggleScrollToLatest();","				renderQueuedLogItems();","				loaded = true;",'				$("command").value = "";','				$("command").autocomplete = "off";','				$("command").onkeydown = function(evt) {',"					evt = getEvent(evt);","					if (evt.keyCode == 10 || evt.keyCode == 13) { // Return/Enter","						evalCommandLine();","						stopPropagation(evt);","					} else if (evt.keyCode == 27) { // Escape",'						this.value = "";',"						this.focus();","					} else if (evt.keyCode == 38 && commandHistory.length > 0) { // Up","						currentCommandIndex = Math.max(0, currentCommandIndex - 1);","						this.value = commandHistory[currentCommandIndex];","						moveCaretToEnd(this);","					} else if (evt.keyCode == 40 && commandHistory.length > 0) { // Down","						currentCommandIndex = Math.min(commandHistory.length - 1, currentCommandIndex + 1);","						this.value = commandHistory[currentCommandIndex];","						moveCaretToEnd(this);","					}","				};","","				// Prevent the keypress moving the caret in Firefox",'				$("command").onkeypress = function(evt) {',"					evt = getEvent(evt);","					if (evt.keyCode == 38 && commandHistory.length > 0 && evt.preventDefault) { // Up","						evt.preventDefault();","					}","				};","","				// Prevent the keyup event blurring the input in Opera",'				$("command").onkeyup = function(evt) {',"					evt = getEvent(evt);","					if (evt.keyCode == 27 && evt.preventDefault) { // Up","						evt.preventDefault();","						this.focus();","					}","				};","","				// Add document keyboard shortcuts","				document.onkeydown = function keyEventHandler(evt) {","					evt = getEvent(evt);","					switch (evt.keyCode) {","						case 69: // Ctrl + shift + E: re-execute last command","							if (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","								evalLastCommand();","								cancelKeyEvent(evt);","								return false;","							}","							break;","						case 75: // Ctrl + shift + K: focus search","							if (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","								focusSearch();","								cancelKeyEvent(evt);","								return false;","							}","							break;","						case 40: // Ctrl + shift + down arrow: focus command line","						case 76: // Ctrl + shift + L: focus command line","							if (evt.shiftKey && (evt.ctrlKey || evt.metaKey)) {","								focusCommandLine();","								cancelKeyEvent(evt);","								return false;","							}","							break;","					}","				};","","				// Workaround to make sure log div starts at the correct size","				setTimeout(setLogContainerHeight, 20);","","				setShowCommandLine(showCommandLine);","				doSearch();","			};","","			window.onunload = function() {","				if (mainWindowExists()) {","					appender.unload();","				}","				appender = null;","			};","","			/*----------------------------------------------------------------*/","","			function toggleLoggingEnabled() {",'				setLoggingEnabled($("enableLogging").checked);',"			}","","			function setLoggingEnabled(enable) {","				loggingEnabled = enable;","			}","","			var appender = null;","","			function setAppender(appenderParam) {","				appender = appenderParam;","			}","","			function setShowCloseButton(showCloseButton) {",'				$("closeButton").style.display = showCloseButton ? "inline" : "none";',"			}","","			function setShowHideButton(showHideButton) {",'				$("hideButton").style.display = showHideButton ? "inline" : "none";',"			}","","			var newestAtTop = false;","","			/*----------------------------------------------------------------*/","","			function LogItemContentReverser() {","			}","			","			LogItemContentReverser.prototype = new LogItemVisitor();","			","			LogItemContentReverser.prototype.visitGroup = function(group) {","				group.reverseChildren();","				this.visitChildren(group);","			};","","			/*----------------------------------------------------------------*/","","			function setNewestAtTop(isNewestAtTop) {","				var oldNewestAtTop = newestAtTop;","				var i, iLen, j, jLen;","				newestAtTop = Boolean(isNewestAtTop);","				if (oldNewestAtTop != newestAtTop) {","					var visitor = new LogItemContentReverser();","					rootGroup.accept(visitor);","","					// Reassemble the matches array","					if (currentSearch) {","						var currentMatch = currentSearch.matches[currentMatchIndex];","						var matchIndex = 0;","						var matches = [];","						var actOnLogEntry = function(logEntry) {","							var logEntryMatches = logEntry.getSearchMatches();","							for (j = 0, jLen = logEntryMatches.length; j < jLen; j++) {","								matches[matchIndex] = logEntryMatches[j];","								if (currentMatch && logEntryMatches[j].equals(currentMatch)) {","									currentMatchIndex = matchIndex;","								}","								matchIndex++;","							}","						};","						if (newestAtTop) {","							for (i = logEntries.length - 1; i >= 0; i--) {","								actOnLogEntry(logEntries[i]);","							}","						} else {","							for (i = 0, iLen = logEntries.length; i < iLen; i++) {","								actOnLogEntry(logEntries[i]);","							}","						}","						currentSearch.matches = matches;","						if (currentMatch) {","							currentMatch.setCurrent();","						}","					} else if (scrollToLatest) {","						doScrollToLatest();","					}","				}",'				$("newestAtTop").checked = isNewestAtTop;',"			}","","			function toggleNewestAtTop() {",'				var isNewestAtTop = $("newestAtTop").checked;',"				setNewestAtTop(isNewestAtTop);","			}","","			var scrollToLatest = true;","","			function setScrollToLatest(isScrollToLatest) {","				scrollToLatest = isScrollToLatest;","				if (scrollToLatest) {","					doScrollToLatest();","				}",'				$("scrollToLatest").checked = isScrollToLatest;',"			}","","			function toggleScrollToLatest() {",'				var isScrollToLatest = $("scrollToLatest").checked;',"				setScrollToLatest(isScrollToLatest);","			}","","			function doScrollToLatest() {","				var l = logMainContainer;",'				if (typeof l.scrollTop != "undefined") {',"					if (newestAtTop) {","						l.scrollTop = 0;","					} else {","						var latestLogEntry = l.lastChild;","						if (latestLogEntry) {","							l.scrollTop = l.scrollHeight;","						}","					}","				}","			}","","			var closeIfOpenerCloses = true;","","			function setCloseIfOpenerCloses(isCloseIfOpenerCloses) {","				closeIfOpenerCloses = isCloseIfOpenerCloses;","			}","","			var maxMessages = null;","","			function setMaxMessages(max) {","				maxMessages = max;","				pruneLogEntries();","			}","","			var showCommandLine = false;","","			function setShowCommandLine(isShowCommandLine) {","				showCommandLine = isShowCommandLine;","				if (loaded) {",'					$("commandLine").style.display = showCommandLine ? "block" : "none";',"					setCommandInputWidth();","					setLogContainerHeight();","				}","			}","","			function focusCommandLine() {","				if (loaded) {",'					$("command").focus();',"				}","			}","","			function focusSearch() {","				if (loaded) {",'					$("searchBox").focus();',"				}","			}","","			function getLogItems() {","				var items = [];","				for (var i = 0, len = logItems.length; i < len; i++) {","					logItems[i].serialize(items);","				}","				return items;","			}","","			function setLogItems(items) {","				var loggingReallyEnabled = loggingEnabled;","				// Temporarily turn logging on","				loggingEnabled = true;","				for (var i = 0, len = items.length; i < len; i++) {","					switch (items[i][0]) {","						case LogItem.serializedItemKeys.LOG_ENTRY:","							log(items[i][1], items[i][2]);","							break;","						case LogItem.serializedItemKeys.GROUP_START:","							group(items[i][1]);","							break;","						case LogItem.serializedItemKeys.GROUP_END:","							groupEnd();","							break;","					}","				}","				loggingEnabled = loggingReallyEnabled;","			}","","			function log(logLevel, formattedMessage) {","				if (loggingEnabled) {","					var logEntry = new LogEntry(logLevel, formattedMessage);","					logEntries.push(logEntry);","					logEntriesAndSeparators.push(logEntry);","					logItems.push(logEntry);","					currentGroup.addChild(logEntry);","					if (loaded) {","						if (logQueuedEventsTimer !== null) {","							clearTimeout(logQueuedEventsTimer);","						}","						logQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","						unrenderedLogItemsExist = true;","					}","				}","			}","","			function renderQueuedLogItems() {","				logQueuedEventsTimer = null;","				var pruned = pruneLogEntries();","","				// Render any unrendered log entries and apply the current search to them","				var initiallyHasMatches = currentSearch ? currentSearch.hasMatches() : false;","				for (var i = 0, len = logItems.length; i < len; i++) {","					if (!logItems[i].rendered) {","						logItems[i].render();","						logItems[i].appendToLog();","						if (currentSearch && (logItems[i] instanceof LogEntry)) {","							currentSearch.applyTo(logItems[i]);","						}","					}","				}","				if (currentSearch) {","					if (pruned) {","						if (currentSearch.hasVisibleMatches()) {","							if (currentMatchIndex === null) {","								setCurrentMatchIndex(0);","							}","							displayMatches();","						} else {","							displayNoMatches();","						}","					} else if (!initiallyHasMatches && currentSearch.hasVisibleMatches()) {","						setCurrentMatchIndex(0);","						displayMatches();","					}","				}","				if (scrollToLatest) {","					doScrollToLatest();","				}","				unrenderedLogItemsExist = false;","			}","","			function pruneLogEntries() {","				if ((maxMessages !== null) && (logEntriesAndSeparators.length > maxMessages)) {","					var numberToDelete = logEntriesAndSeparators.length - maxMessages;","					var prunedLogEntries = logEntriesAndSeparators.slice(0, numberToDelete);","					if (currentSearch) {","						currentSearch.removeMatches(prunedLogEntries);","					}","					var group;","					for (var i = 0; i < numberToDelete; i++) {","						group = logEntriesAndSeparators[i].group;","						array_remove(logItems, logEntriesAndSeparators[i]);","						array_remove(logEntries, logEntriesAndSeparators[i]);","						logEntriesAndSeparators[i].remove(true, true);","						if (group.children.length === 0 && group !== currentGroup && group !== rootGroup) {","							array_remove(logItems, group);","							group.remove(true, true);","						}","					}","					logEntriesAndSeparators = array_removeFromStart(logEntriesAndSeparators, numberToDelete);","					return true;","				}","				return false;","			}","","			function group(name, startExpanded) {","				if (loggingEnabled) {",'					initiallyExpanded = (typeof startExpanded === "undefined") ? true : Boolean(startExpanded);',"					var newGroup = new Group(name, false, initiallyExpanded);","					currentGroup.addChild(newGroup);","					currentGroup = newGroup;","					logItems.push(newGroup);","					if (loaded) {","						if (logQueuedEventsTimer !== null) {","							clearTimeout(logQueuedEventsTimer);","						}","						logQueuedEventsTimer = setTimeout(renderQueuedLogItems, renderDelay);","						unrenderedLogItemsExist = true;","					}","				}","			}","","			function groupEnd() {","				currentGroup = (currentGroup === rootGroup) ? rootGroup : currentGroup.group;","			}","","			function mainPageReloaded() {","				currentGroup = rootGroup;","				var separator = new Separator();","				logEntriesAndSeparators.push(separator);","				logItems.push(separator);","				currentGroup.addChild(separator);","			}","","			function closeWindow() {","				if (appender && mainWindowExists()) {","					appender.close(true);","				} else {","					window.close();","				}","			}","","			function hide() {","				if (appender && mainWindowExists()) {","					appender.hide();","				}","			}","","			var mainWindow = window;",'			var windowId = "log4javascriptConsoleWindow_" + new Date().getTime() + "_" + ("" + Math.random()).substr(2);',"","			function setMainWindow(win) {","				mainWindow = win;","				mainWindow[windowId] = window;","				// If this is a pop-up, poll the opener to see if it's closed","				if (opener && closeIfOpenerCloses) {","					pollOpener();","				}","			}","","			function pollOpener() {","				if (closeIfOpenerCloses) {","					if (mainWindowExists()) {","						setTimeout(pollOpener, 500);","					} else {","						closeWindow();","					}","				}","			}","","			function mainWindowExists() {","				try {","					return (mainWindow && !mainWindow.closed &&","						mainWindow[windowId] == window);","				} catch (ex) {}","				return false;","			}","",'			var logLevels = ["TRACE", "DEBUG", "INFO", "WARN", "ERROR", "FATAL"];',"","			function getCheckBox(logLevel) {",'				return $("switch_" + logLevel);',"			}","","			function getIeWrappedLogContainer() {",'				return $("log_wrapped");',"			}","","			function getIeUnwrappedLogContainer() {",'				return $("log_unwrapped");',"			}","","			function applyFilters() {","				for (var i = 0; i < logLevels.length; i++) {","					if (getCheckBox(logLevels[i]).checked) {","						addClass(logMainContainer, logLevels[i]);","					} else {","						removeClass(logMainContainer, logLevels[i]);","					}","				}","				updateSearchFromFilters();","			}","","			function toggleAllLevels() {",'				var turnOn = $("switch_ALL").checked;',"				for (var i = 0; i < logLevels.length; i++) {","					getCheckBox(logLevels[i]).checked = turnOn;","					if (turnOn) {","						addClass(logMainContainer, logLevels[i]);","					} else {","						removeClass(logMainContainer, logLevels[i]);","					}","				}","			}","","			function checkAllLevels() {","				for (var i = 0; i < logLevels.length; i++) {","					if (!getCheckBox(logLevels[i]).checked) {",'						getCheckBox("ALL").checked = false;',"						return;","					}","				}",'				getCheckBox("ALL").checked = true;',"			}","","			function clearLog() {","				rootGroup.clear();","				currentGroup = rootGroup;","				logEntries = [];","				logItems = [];","				logEntriesAndSeparators = [];"," 				doSearch();","			}","","			function toggleWrap() {",'				var enable = $("wrap").checked;',"				if (enable) {",'					addClass(logMainContainer, "wrap");',"				} else {",'					removeClass(logMainContainer, "wrap");',"				}","				refreshCurrentMatch();","			}","","			/* ------------------------------------------------------------------- */","","			// Search","","			var searchTimer = null;","","			function scheduleSearch() {","				try {","					clearTimeout(searchTimer);","				} catch (ex) {","					// Do nothing","				}","				searchTimer = setTimeout(doSearch, 500);","			}","","			function Search(searchTerm, isRegex, searchRegex, isCaseSensitive) {","				this.searchTerm = searchTerm;","				this.isRegex = isRegex;","				this.searchRegex = searchRegex;","				this.isCaseSensitive = isCaseSensitive;","				this.matches = [];","			}","","			Search.prototype = {","				hasMatches: function() {","					return this.matches.length > 0;","				},","","				hasVisibleMatches: function() {","					if (this.hasMatches()) {","						for (var i = 0; i < this.matches.length; i++) {","							if (this.matches[i].isVisible()) {","								return true;","							}","						}","					}","					return false;","				},","","				match: function(logEntry) {","					var entryText = String(logEntry.formattedMessage);","					var matchesSearch = false;","					if (this.isRegex) {","						matchesSearch = this.searchRegex.test(entryText);","					} else if (this.isCaseSensitive) {","						matchesSearch = (entryText.indexOf(this.searchTerm) > -1);","					} else {","						matchesSearch = (entryText.toLowerCase().indexOf(this.searchTerm.toLowerCase()) > -1);","					}","					return matchesSearch;","				},","","				getNextVisibleMatchIndex: function() {","					for (var i = currentMatchIndex + 1; i < this.matches.length; i++) {","						if (this.matches[i].isVisible()) {","							return i;","						}","					}","					// Start again from the first match","					for (i = 0; i <= currentMatchIndex; i++) {","						if (this.matches[i].isVisible()) {","							return i;","						}","					}","					return -1;","				},","","				getPreviousVisibleMatchIndex: function() {","					for (var i = currentMatchIndex - 1; i >= 0; i--) {","						if (this.matches[i].isVisible()) {","							return i;","						}","					}","					// Start again from the last match","					for (var i = this.matches.length - 1; i >= currentMatchIndex; i--) {","						if (this.matches[i].isVisible()) {","							return i;","						}","					}","					return -1;","				},","","				applyTo: function(logEntry) {","					var doesMatch = this.match(logEntry);","					if (doesMatch) {","						logEntry.group.expand();","						logEntry.setSearchMatch(true);","						var logEntryContent;","						var wrappedLogEntryContent;",'						var searchTermReplacementStartTag = "<span class=\\"searchterm\\">";','						var searchTermReplacementEndTag = "<" + "/span>";','						var preTagName = isIe ? "pre" : "span";','						var preStartTag = "<" + preTagName + " class=\\"pre\\">";','						var preEndTag = "<" + "/" + preTagName + ">";',"						var startIndex = 0;","						var searchIndex, matchedText, textBeforeMatch;","						if (this.isRegex) {",'							var flags = this.isCaseSensitive ? "g" : "gi";','							var capturingRegex = new RegExp("(" + this.searchRegex.source + ")", flags);',"","							// Replace the search term with temporary tokens for the start and end tags",'							var rnd = ("" + Math.random()).substr(2);','							var startToken = "%%s" + rnd + "%%";','							var endToken = "%%e" + rnd + "%%";','							logEntryContent = logEntry.formattedMessage.replace(capturingRegex, startToken + "$1" + endToken);',"","							// Escape the HTML to get rid of angle brackets","							logEntryContent = escapeHtml(logEntryContent);","","							// Substitute the proper HTML back in for the search match","							var result;","							var searchString = logEntryContent;",'							logEntryContent = "";','							wrappedLogEntryContent = "";',"							while ((searchIndex = searchString.indexOf(startToken, startIndex)) > -1) {","								var endTokenIndex = searchString.indexOf(endToken, searchIndex);","								matchedText = searchString.substring(searchIndex + startToken.length, endTokenIndex);","								textBeforeMatch = searchString.substring(startIndex, searchIndex);","								logEntryContent += preStartTag + textBeforeMatch + preEndTag;","								logEntryContent += searchTermReplacementStartTag + preStartTag + matchedText +","									preEndTag + searchTermReplacementEndTag;","								if (isIe) {","									wrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","										matchedText + searchTermReplacementEndTag;","								}","								startIndex = endTokenIndex + endToken.length;","							}","							logEntryContent += preStartTag + searchString.substr(startIndex) + preEndTag;","							if (isIe) {","								wrappedLogEntryContent += searchString.substr(startIndex);","							}","						} else {",'							logEntryContent = "";','							wrappedLogEntryContent = "";',"							var searchTermReplacementLength = searchTermReplacementStartTag.length +","								this.searchTerm.length + searchTermReplacementEndTag.length;","							var searchTermLength = this.searchTerm.length;","							var searchTermLowerCase = this.searchTerm.toLowerCase();","							var logTextLowerCase = logEntry.formattedMessage.toLowerCase();","							while ((searchIndex = logTextLowerCase.indexOf(searchTermLowerCase, startIndex)) > -1) {","								matchedText = escapeHtml(logEntry.formattedMessage.substr(searchIndex, this.searchTerm.length));","								textBeforeMatch = escapeHtml(logEntry.formattedMessage.substring(startIndex, searchIndex));","								var searchTermReplacement = searchTermReplacementStartTag +","									preStartTag + matchedText + preEndTag + searchTermReplacementEndTag;","								logEntryContent += preStartTag + textBeforeMatch + preEndTag + searchTermReplacement;","								if (isIe) {","									wrappedLogEntryContent += textBeforeMatch + searchTermReplacementStartTag +","										matchedText + searchTermReplacementEndTag;","								}","								startIndex = searchIndex + searchTermLength;","							}","							var textAfterLastMatch = escapeHtml(logEntry.formattedMessage.substr(startIndex));","							logEntryContent += preStartTag + textAfterLastMatch + preEndTag;","							if (isIe) {","								wrappedLogEntryContent += textAfterLastMatch;","							}","						}","						logEntry.setContent(logEntryContent, wrappedLogEntryContent);","						var logEntryMatches = logEntry.getSearchMatches();","						this.matches = this.matches.concat(logEntryMatches);","					} else {","						logEntry.setSearchMatch(false);","						logEntry.setContent(logEntry.formattedMessage, logEntry.formattedMessage);","					}","					return doesMatch;","				},","","				removeMatches: function(logEntries) {","					var matchesToRemoveCount = 0;","					var currentMatchRemoved = false;","					var matchesToRemove = [];","					var i, iLen, j, jLen;","","					// Establish the list of matches to be removed","					for (i = 0, iLen = this.matches.length; i < iLen; i++) {","						for (j = 0, jLen = logEntries.length; j < jLen; j++) {","							if (this.matches[i].belongsTo(logEntries[j])) {","								matchesToRemove.push(this.matches[i]);","								if (i === currentMatchIndex) {","									currentMatchRemoved = true;","								}","							}","						}","					}","","					// Set the new current match index if the current match has been deleted","					// This will be the first match that appears after the first log entry being","					// deleted, if one exists; otherwise, it's the first match overall","					var newMatch = currentMatchRemoved ? null : this.matches[currentMatchIndex];","					if (currentMatchRemoved) {","						for (i = currentMatchIndex, iLen = this.matches.length; i < iLen; i++) {","							if (this.matches[i].isVisible() && !array_contains(matchesToRemove, this.matches[i])) {","								newMatch = this.matches[i];","								break;","							}","						}","					}","","					// Remove the matches","					for (i = 0, iLen = matchesToRemove.length; i < iLen; i++) {","						array_remove(this.matches, matchesToRemove[i]);","						matchesToRemove[i].remove();","					}","","					// Set the new match, if one exists","					if (this.hasVisibleMatches()) {","						if (newMatch === null) {","							setCurrentMatchIndex(0);","						} else {","							// Get the index of the new match","							var newMatchIndex = 0;","							for (i = 0, iLen = this.matches.length; i < iLen; i++) {","								if (newMatch === this.matches[i]) {","									newMatchIndex = i;","									break;","								}","							}","							setCurrentMatchIndex(newMatchIndex);","						}","					} else {","						currentMatchIndex = null;","						displayNoMatches();","					}","				}","			};","","			function getPageOffsetTop(el, container) {","				var currentEl = el;","				var y = 0;","				while (currentEl && currentEl != container) {","					y += currentEl.offsetTop;","					currentEl = currentEl.offsetParent;","				}","				return y;","			}","","			function scrollIntoView(el) {","				var logContainer = logMainContainer;","				// Check if the whole width of the element is visible and centre if not",'				if (!$("wrap").checked) {',"					var logContainerLeft = logContainer.scrollLeft;","					var logContainerRight = logContainerLeft  + logContainer.offsetWidth;","					var elLeft = el.offsetLeft;","					var elRight = elLeft + el.offsetWidth;","					if (elLeft < logContainerLeft || elRight > logContainerRight) {","						logContainer.scrollLeft = elLeft - (logContainer.offsetWidth - el.offsetWidth) / 2;","					}","				}","				// Check if the whole height of the element is visible and centre if not","				var logContainerTop = logContainer.scrollTop;","				var logContainerBottom = logContainerTop  + logContainer.offsetHeight;","				var elTop = getPageOffsetTop(el) - getToolBarsHeight();","				var elBottom = elTop + el.offsetHeight;","				if (elTop < logContainerTop || elBottom > logContainerBottom) {","					logContainer.scrollTop = elTop - (logContainer.offsetHeight - el.offsetHeight) / 2;","				}","			}","","			function Match(logEntryLevel, spanInMainDiv, spanInUnwrappedPre, spanInWrappedDiv) {","				this.logEntryLevel = logEntryLevel;","				this.spanInMainDiv = spanInMainDiv;","				if (isIe) {","					this.spanInUnwrappedPre = spanInUnwrappedPre;","					this.spanInWrappedDiv = spanInWrappedDiv;","				}","				this.mainSpan = isIe ? spanInUnwrappedPre : spanInMainDiv;","			}","","			Match.prototype = {","				equals: function(match) {","					return this.mainSpan === match.mainSpan;","				},","","				setCurrent: function() {","					if (isIe) {",'						addClass(this.spanInUnwrappedPre, "currentmatch");','						addClass(this.spanInWrappedDiv, "currentmatch");',"						// Scroll the visible one into view",'						var elementToScroll = $("wrap").checked ? this.spanInWrappedDiv : this.spanInUnwrappedPre;',"						scrollIntoView(elementToScroll);","					} else {",'						addClass(this.spanInMainDiv, "currentmatch");',"						scrollIntoView(this.spanInMainDiv);","					}","				},","","				belongsTo: function(logEntry) {","					if (isIe) {","						return isDescendant(this.spanInUnwrappedPre, logEntry.unwrappedPre);","					} else {","						return isDescendant(this.spanInMainDiv, logEntry.mainDiv);","					}","				},","","				setNotCurrent: function() {","					if (isIe) {",'						removeClass(this.spanInUnwrappedPre, "currentmatch");','						removeClass(this.spanInWrappedDiv, "currentmatch");',"					} else {",'						removeClass(this.spanInMainDiv, "currentmatch");',"					}","				},","","				isOrphan: function() {","					return isOrphan(this.mainSpan);","				},","","				isVisible: function() {","					return getCheckBox(this.logEntryLevel).checked;","				},","","				remove: function() {","					if (isIe) {","						this.spanInUnwrappedPre = null;","						this.spanInWrappedDiv = null;","					} else {","						this.spanInMainDiv = null;","					}","				}","			};","","			var currentSearch = null;","			var currentMatchIndex = null;","","			function doSearch() {",'				var searchBox = $("searchBox");',"				var searchTerm = searchBox.value;",'				var isRegex = $("searchRegex").checked;','				var isCaseSensitive = $("searchCaseSensitive").checked;',"				var i;","",'				if (searchTerm === "") {','					$("searchReset").disabled = true;','					$("searchNav").style.display = "none";','					removeClass(document.body, "searching");','					removeClass(searchBox, "hasmatches");','					removeClass(searchBox, "nomatches");',"					for (i = 0; i < logEntries.length; i++) {","						logEntries[i].clearSearch();","						logEntries[i].setContent(logEntries[i].formattedMessage, logEntries[i].formattedMessage);","					}","					currentSearch = null;","					setLogContainerHeight();","				} else {",'					$("searchReset").disabled = false;','					$("searchNav").style.display = "block";',"					var searchRegex;","					var regexValid;","					if (isRegex) {","						try {",'							searchRegex = isCaseSensitive ? new RegExp(searchTerm, "g") : new RegExp(searchTerm, "gi");',"							regexValid = true;",'							replaceClass(searchBox, "validregex", "invalidregex");','							searchBox.title = "Valid regex";',"						} catch (ex) {","							regexValid = false;",'							replaceClass(searchBox, "invalidregex", "validregex");','							searchBox.title = "Invalid regex: " + (ex.message ? ex.message : (ex.description ? ex.description : "unknown error"));',"							return;","						}","					} else {",'						searchBox.title = "";','						removeClass(searchBox, "validregex");','						removeClass(searchBox, "invalidregex");',"					}",'					addClass(document.body, "searching");',"					currentSearch = new Search(searchTerm, isRegex, searchRegex, isCaseSensitive);","					for (i = 0; i < logEntries.length; i++) {","						currentSearch.applyTo(logEntries[i]);","					}","					setLogContainerHeight();","","					// Highlight the first search match","					if (currentSearch.hasVisibleMatches()) {","						setCurrentMatchIndex(0);","						displayMatches();","					} else {","						displayNoMatches();","					}","				}","			}","","			function updateSearchFromFilters() {","				if (currentSearch) {","					if (currentSearch.hasMatches()) {","						if (currentMatchIndex === null) {","							currentMatchIndex = 0;","						}","						var currentMatch = currentSearch.matches[currentMatchIndex];","						if (currentMatch.isVisible()) {","							displayMatches();","							setCurrentMatchIndex(currentMatchIndex);","						} else {","							currentMatch.setNotCurrent();","							// Find the next visible match, if one exists","							var nextVisibleMatchIndex = currentSearch.getNextVisibleMatchIndex();","							if (nextVisibleMatchIndex > -1) {","								setCurrentMatchIndex(nextVisibleMatchIndex);","								displayMatches();","							} else {","								displayNoMatches();","							}","						}","					} else {","						displayNoMatches();","					}","				}","			}","","			function refreshCurrentMatch() {","				if (currentSearch && currentSearch.hasVisibleMatches()) {","					setCurrentMatchIndex(currentMatchIndex);","				}","			}","","			function displayMatches() {",'				replaceClass($("searchBox"), "hasmatches", "nomatches");','				$("searchBox").title = "" + currentSearch.matches.length + " matches found";','				$("searchNav").style.display = "block";',"				setLogContainerHeight();","			}","","			function displayNoMatches() {",'				replaceClass($("searchBox"), "nomatches", "hasmatches");','				$("searchBox").title = "No matches found";','				$("searchNav").style.display = "none";',"				setLogContainerHeight();","			}","","			function toggleSearchEnabled(enable) {",'				enable = (typeof enable == "undefined") ? !$("searchDisable").checked : enable;','				$("searchBox").disabled = !enable;','				$("searchReset").disabled = !enable;','				$("searchRegex").disabled = !enable;','				$("searchNext").disabled = !enable;','				$("searchPrevious").disabled = !enable;','				$("searchCaseSensitive").disabled = !enable;','				$("searchNav").style.display = (enable && ($("searchBox").value !== "") &&',"						currentSearch && currentSearch.hasVisibleMatches()) ?",'					"block" : "none";',"				if (enable) {",'					removeClass($("search"), "greyedout");','					addClass(document.body, "searching");','					if ($("searchHighlight").checked) {','						addClass(logMainContainer, "searchhighlight");',"					} else {",'						removeClass(logMainContainer, "searchhighlight");',"					}",'					if ($("searchFilter").checked) {','						addClass(logMainContainer, "searchfilter");',"					} else {",'						removeClass(logMainContainer, "searchfilter");',"					}",'					$("searchDisable").checked = !enable;',"				} else {",'					addClass($("search"), "greyedout");','					removeClass(document.body, "searching");','					removeClass(logMainContainer, "searchhighlight");','					removeClass(logMainContainer, "searchfilter");',"				}","				setLogContainerHeight();","			}","","			function toggleSearchFilter() {",'				var enable = $("searchFilter").checked;',"				if (enable) {",'					addClass(logMainContainer, "searchfilter");',"				} else {",'					removeClass(logMainContainer, "searchfilter");',"				}","				refreshCurrentMatch();","			}","","			function toggleSearchHighlight() {",'				var enable = $("searchHighlight").checked;',"				if (enable) {",'					addClass(logMainContainer, "searchhighlight");',"				} else {",'					removeClass(logMainContainer, "searchhighlight");',"				}","			}","","			function clearSearch() {",'				$("searchBox").value = "";',"				doSearch();","			}","","			function searchNext() {","				if (currentSearch !== null && currentMatchIndex !== null) {","					currentSearch.matches[currentMatchIndex].setNotCurrent();","					var nextMatchIndex = currentSearch.getNextVisibleMatchIndex();",'					if (nextMatchIndex > currentMatchIndex || confirm("Reached the end of the page. Start from the top?")) {',"						setCurrentMatchIndex(nextMatchIndex);","					}","				}","			}","","			function searchPrevious() {","				if (currentSearch !== null && currentMatchIndex !== null) {","					currentSearch.matches[currentMatchIndex].setNotCurrent();","					var previousMatchIndex = currentSearch.getPreviousVisibleMatchIndex();",'					if (previousMatchIndex < currentMatchIndex || confirm("Reached the start of the page. Continue from the bottom?")) {',"						setCurrentMatchIndex(previousMatchIndex);","					}","				}","			}","","			function setCurrentMatchIndex(index) {","				currentMatchIndex = index;","				currentSearch.matches[currentMatchIndex].setCurrent();","			}","","			/* ------------------------------------------------------------------------- */","","			// CSS Utilities","","			function addClass(el, cssClass) {","				if (!hasClass(el, cssClass)) {","					if (el.className) {",'						el.className += " " + cssClass;',"					} else {","						el.className = cssClass;","					}","				}","			}","","			function hasClass(el, cssClass) {","				if (el.className) {",'					var classNames = el.className.split(" ");',"					return array_contains(classNames, cssClass);","				}","				return false;","			}","","			function removeClass(el, cssClass) {","				if (hasClass(el, cssClass)) {","					// Rebuild the className property",'					var existingClasses = el.className.split(" ");',"					var newClasses = [];","					for (var i = 0, len = existingClasses.length; i < len; i++) {","						if (existingClasses[i] != cssClass) {","							newClasses[newClasses.length] = existingClasses[i];","						}","					}",'					el.className = newClasses.join(" ");',"				}","			}","","			function replaceClass(el, newCssClass, oldCssClass) {","				removeClass(el, oldCssClass);","				addClass(el, newCssClass);","			}","","			/* ------------------------------------------------------------------------- */","","			// Other utility functions","","			function getElementsByClass(el, cssClass, tagName) {","				var elements = el.getElementsByTagName(tagName);","				var matches = [];","				for (var i = 0, len = elements.length; i < len; i++) {","					if (hasClass(elements[i], cssClass)) {","						matches.push(elements[i]);","					}","				}","				return matches;","			}","","			// Syntax borrowed from Prototype library","			function $(id) {","				return document.getElementById(id);","			}","","			function isDescendant(node, ancestorNode) {","				while (node != null) {","					if (node === ancestorNode) {","						return true;","					}","					node = node.parentNode;","				}","				return false;","			}","","			function isOrphan(node) {","				var currentNode = node;","				while (currentNode) {","					if (currentNode == document.body) {","						return false;","					}","					currentNode = currentNode.parentNode;","				}","				return true;","			}","","			function escapeHtml(str) {",'				return str.replace(/&/g, "&amp;").replace(/[<]/g, "&lt;").replace(/>/g, "&gt;");',"			}","","			function getWindowWidth() {","				if (window.innerWidth) {","					return window.innerWidth;","				} else if (document.documentElement && document.documentElement.clientWidth) {","					return document.documentElement.clientWidth;","				} else if (document.body) {","					return document.body.clientWidth;","				}","				return 0;","			}","","			function getWindowHeight() {","				if (window.innerHeight) {","					return window.innerHeight;","				} else if (document.documentElement && document.documentElement.clientHeight) {","					return document.documentElement.clientHeight;","				} else if (document.body) {","					return document.body.clientHeight;","				}","				return 0;","			}","","			function getToolBarsHeight() {",'				return $("switches").offsetHeight;',"			}","","			function getChromeHeight() {","				var height = getToolBarsHeight();","				if (showCommandLine) {",'					height += $("commandLine").offsetHeight;',"				}","				return height;","			}","","			function setLogContainerHeight() {","				if (logMainContainer) {","					var windowHeight = getWindowHeight();",'					$("body").style.height = getWindowHeight() + "px";','					logMainContainer.style.height = "" +','						Math.max(0, windowHeight - getChromeHeight()) + "px";',"				}","			}","","			function setCommandInputWidth() {","				if (showCommandLine) {",'					$("command").style.width = "" + Math.max(0, $("commandLineContainer").offsetWidth -','						($("evaluateButton").offsetWidth + 13)) + "px";',"				}","			}","","			window.onresize = function() {","				setCommandInputWidth();","				setLogContainerHeight();","			};","","			if (!Array.prototype.push) {","				Array.prototype.push = function() {","			        for (var i = 0, len = arguments.length; i < len; i++){","			            this[this.length] = arguments[i];","			        }","			        return this.length;","				};","			}","","			if (!Array.prototype.pop) {","				Array.prototype.pop = function() {","					if (this.length > 0) {","						var val = this[this.length - 1];","						this.length = this.length - 1;","						return val;","					}","				};","			}","","			if (!Array.prototype.shift) {","				Array.prototype.shift = function() {","					if (this.length > 0) {","						var firstItem = this[0];","						for (var i = 0, len = this.length - 1; i < len; i++) {","							this[i] = this[i + 1];","						}","						this.length = this.length - 1;","						return firstItem;","					}","				};","			}","","			if (!Array.prototype.splice) {","				Array.prototype.splice = function(startIndex, deleteCount) {","					var itemsAfterDeleted = this.slice(startIndex + deleteCount);","					var itemsDeleted = this.slice(startIndex, startIndex + deleteCount);","					this.length = startIndex;","					// Copy the arguments into a proper Array object","					var argumentsArray = [];","					for (var i = 0, len = arguments.length; i < len; i++) {","						argumentsArray[i] = arguments[i];","					}","					var itemsToAppend = (argumentsArray.length > 2) ?","						itemsAfterDeleted = argumentsArray.slice(2).concat(itemsAfterDeleted) : itemsAfterDeleted;","					for (i = 0, len = itemsToAppend.length; i < len; i++) {","						this.push(itemsToAppend[i]);","					}","					return itemsDeleted;","				};","			}","","			function array_remove(arr, val) {","				var index = -1;","				for (var i = 0, len = arr.length; i < len; i++) {","					if (arr[i] === val) {","						index = i;","						break;","					}","				}","				if (index >= 0) {","					arr.splice(index, 1);","					return index;","				} else {","					return false;","				}","			}","","			function array_removeFromStart(array, numberToRemove) {","				if (Array.prototype.splice) {","					array.splice(0, numberToRemove);","				} else {","					for (var i = numberToRemove, len = array.length; i < len; i++) {","						array[i - numberToRemove] = array[i];","					}","					array.length = array.length - numberToRemove;","				}","				return array;","			}","","			function array_contains(arr, val) {","				for (var i = 0, len = arr.length; i < len; i++) {","					if (arr[i] == val) {","						return true;","					}","				}","				return false;","			}","","			function getErrorMessage(ex) {","				if (ex.message) {","					return ex.message;","				} else if (ex.description) {","					return ex.description;","				}",'				return "" + ex;',"			}","","			function moveCaretToEnd(input) {","				if (input.setSelectionRange) {","					input.focus();","					var length = input.value.length;","					input.setSelectionRange(length, length);","				} else if (input.createTextRange) {","					var range = input.createTextRange();","					range.collapse(false);","					range.select();","				}","				input.focus();","			}","","			function stopPropagation(evt) {","				if (evt.stopPropagation) {","					evt.stopPropagation();",'				} else if (typeof evt.cancelBubble != "undefined") {',"					evt.cancelBubble = true;","				}","			}","","			function getEvent(evt) {","				return evt ? evt : event;","			}","","			function getTarget(evt) {","				return evt.target ? evt.target : evt.srcElement;","			}","","			function getRelatedTarget(evt) {","				if (evt.relatedTarget) {","					return evt.relatedTarget;","				} else if (evt.srcElement) {","					switch(evt.type) {",'						case "mouseover":',"							return evt.fromElement;",'						case "mouseout":',"							return evt.toElement;","						default:","							return evt.srcElement;","					}","				}","			}","","			function cancelKeyEvent(evt) {","				evt.returnValue = false;","				stopPropagation(evt);","			}","","			function evalCommandLine() {",'				var expr = $("command").value;',"				evalCommand(expr);",'				$("command").value = "";',"			}","","			function evalLastCommand() {","				if (lastCommand != null) {","					evalCommand(lastCommand);","				}","			}","","			var lastCommand = null;","			var commandHistory = [];","			var currentCommandIndex = 0;","","			function evalCommand(expr) {","				if (appender) {","					appender.evalCommandAndAppend(expr);","				} else {",'					var prefix = ">>> " + expr + "\\r\\n";',"					try {",'						log("INFO", prefix + eval(expr));',"					} catch (ex) {",'						log("ERROR", prefix + "Error: " + getErrorMessage(ex));',"					}","				}","				// Update command history","				if (expr != commandHistory[commandHistory.length - 1]) {","					commandHistory.push(expr);","					// Update the appender","					if (appender) {","						appender.storeCommandHistory(commandHistory);","					}","				}","				currentCommandIndex = (expr == commandHistory[currentCommandIndex]) ? currentCommandIndex + 1 : commandHistory.length;","				lastCommand = expr;","			}","			//]]>","		<\/script>",'		<style type="text/css">',"			body {","				background-color: white;","				color: black;","				padding: 0;","				margin: 0;","				font-family: tahoma, verdana, arial, helvetica, sans-serif;","				overflow: hidden;","			}","","			div#switchesContainer input {","				margin-bottom: 0;","			}","","			div.toolbar {","				border-top: solid #ffffff 1px;","				border-bottom: solid #aca899 1px;","				background-color: #f1efe7;","				padding: 3px 5px;","				font-size: 68.75%;","			}","","			div.toolbar, div#search input {","				font-family: tahoma, verdana, arial, helvetica, sans-serif;","			}","","			div.toolbar input.button {","				padding: 0 5px;","				font-size: 100%;","			}","","			div.toolbar input.hidden {","				display: none;","			}","","			div#switches input#clearButton {","				margin-left: 20px;","			}","","			div#levels label {","				font-weight: bold;","			}","","			div#levels label, div#options label {","				margin-right: 5px;","			}","","			div#levels label#wrapLabel {","				font-weight: normal;","			}","","			div#search label {","				margin-right: 10px;","			}","","			div#search label.searchboxlabel {","				margin-right: 0;","			}","","			div#search input {","				font-size: 100%;","			}","","			div#search input.validregex {","				color: green;","			}","","			div#search input.invalidregex {","				color: red;","			}","","			div#search input.nomatches {","				color: white;","				background-color: #ff6666;","			}","","			div#search input.nomatches {","				color: white;","				background-color: #ff6666;","			}","","			div#searchNav {","				display: none;","			}","","			div#commandLine {","				display: none;","			}","","			div#commandLine input#command {","				font-size: 100%;","				font-family: Courier New, Courier;","			}","","			div#commandLine input#evaluateButton {","			}","","			*.greyedout {","				color: gray !important;","				border-color: gray !important;","			}","","			*.greyedout *.alwaysenabled { color: black; }","","			*.unselectable {","				-khtml-user-select: none;","				-moz-user-select: none;","				user-select: none;","			}","","			div#log {","				font-family: Courier New, Courier;","				font-size: 75%;","				width: 100%;","				overflow: auto;","				clear: both;","				position: relative;","			}","","			div.group {","				border-color: #cccccc;","				border-style: solid;","				border-width: 1px 0 1px 1px;","				overflow: visible;","			}","","			div.oldIe div.group, div.oldIe div.group *, div.oldIe *.logentry {","				height: 1%;","			}","","			div.group div.groupheading span.expander {","				border: solid black 1px;","				font-family: Courier New, Courier;","				font-size: 0.833em;","				background-color: #eeeeee;","				position: relative;","				top: -1px;","				color: black;","				padding: 0 2px;","				cursor: pointer;","				cursor: hand;","				height: 1%;","			}","","			div.group div.groupcontent {","				margin-left: 10px;","				padding-bottom: 2px;","				overflow: visible;","			}","","			div.group div.expanded {","				display: block;","			}","","			div.group div.collapsed {","				display: none;","			}","","			*.logentry {","				overflow: visible;","				display: none;","				white-space: pre;","			}","","			span.pre {","				white-space: pre;","			}","			","			pre.unwrapped {","				display: inline !important;","			}","","			pre.unwrapped pre.pre, div.wrapped pre.pre {","				display: inline;","			}","","			div.wrapped pre.pre {","				white-space: normal;","			}","","			div.wrapped {","				display: none;","			}","","			body.searching *.logentry span.currentmatch {","				color: white !important;","				background-color: green !important;","			}","","			body.searching div.searchhighlight *.logentry span.searchterm {","				color: black;","				background-color: yellow;","			}","","			div.wrap *.logentry {","				white-space: normal !important;","				border-width: 0 0 1px 0;","				border-color: #dddddd;","				border-style: dotted;","			}","","			div.wrap #log_wrapped, #log_unwrapped {","				display: block;","			}","","			div.wrap #log_unwrapped, #log_wrapped {","				display: none;","			}","","			div.wrap *.logentry span.pre {","				overflow: visible;","				white-space: normal;","			}","","			div.wrap *.logentry pre.unwrapped {","				display: none;","			}","","			div.wrap *.logentry span.wrapped {","				display: inline;","			}","","			div.searchfilter *.searchnonmatch {","				display: none !important;","			}","","			div#log *.TRACE, label#label_TRACE {","				color: #666666;","			}","","			div#log *.DEBUG, label#label_DEBUG {","				color: green;","			}","","			div#log *.INFO, label#label_INFO {","				color: #000099;","			}","","			div#log *.WARN, label#label_WARN {","				color: #999900;","			}","","			div#log *.ERROR, label#label_ERROR {","				color: red;","			}","","			div#log *.FATAL, label#label_FATAL {","				color: #660066;","			}","","			div.TRACE#log *.TRACE,","			div.DEBUG#log *.DEBUG,","			div.INFO#log *.INFO,","			div.WARN#log *.WARN,","			div.ERROR#log *.ERROR,","			div.FATAL#log *.FATAL {","				display: block;","			}","","			div#log div.separator {","				background-color: #cccccc;","				margin: 5px 0;","				line-height: 1px;","			}","		</style>","	</head>","",'	<body id="body">','		<div id="switchesContainer">','			<div id="switches">','				<div id="levels" class="toolbar">',"					Filters:",'					<input type="checkbox" id="switch_TRACE" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide trace messages" /><label for="switch_TRACE" id="label_TRACE">trace</label>','					<input type="checkbox" id="switch_DEBUG" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide debug messages" /><label for="switch_DEBUG" id="label_DEBUG">debug</label>','					<input type="checkbox" id="switch_INFO" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide info messages" /><label for="switch_INFO" id="label_INFO">info</label>','					<input type="checkbox" id="switch_WARN" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide warn messages" /><label for="switch_WARN" id="label_WARN">warn</label>','					<input type="checkbox" id="switch_ERROR" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide error messages" /><label for="switch_ERROR" id="label_ERROR">error</label>','					<input type="checkbox" id="switch_FATAL" onclick="applyFilters(); checkAllLevels()" checked="checked" title="Show/hide fatal messages" /><label for="switch_FATAL" id="label_FATAL">fatal</label>','					<input type="checkbox" id="switch_ALL" onclick="toggleAllLevels(); applyFilters()" checked="checked" title="Show/hide all messages" /><label for="switch_ALL" id="label_ALL">all</label>',"				</div>",'				<div id="search" class="toolbar">','					<label for="searchBox" class="searchboxlabel">Search:</label> <input type="text" id="searchBox" onclick="toggleSearchEnabled(true)" onkeyup="scheduleSearch()" size="20" />','					<input type="button" id="searchReset" disabled="disabled" value="Reset" onclick="clearSearch()" class="button" title="Reset the search" />','					<input type="checkbox" id="searchRegex" onclick="doSearch()" title="If checked, search is treated as a regular expression" /><label for="searchRegex">Regex</label>','					<input type="checkbox" id="searchCaseSensitive" onclick="doSearch()" title="If checked, search is case sensitive" /><label for="searchCaseSensitive">Match case</label>','					<input type="checkbox" id="searchDisable" onclick="toggleSearchEnabled()" title="Enable/disable search" /><label for="searchDisable" class="alwaysenabled">Disable</label>','					<div id="searchNav">','						<input type="button" id="searchNext" disabled="disabled" value="Next" onclick="searchNext()" class="button" title="Go to the next matching log entry" />','						<input type="button" id="searchPrevious" disabled="disabled" value="Previous" onclick="searchPrevious()" class="button" title="Go to the previous matching log entry" />','						<input type="checkbox" id="searchFilter" onclick="toggleSearchFilter()" title="If checked, non-matching log entries are filtered out" /><label for="searchFilter">Filter</label>','						<input type="checkbox" id="searchHighlight" onclick="toggleSearchHighlight()" title="Highlight matched search terms" /><label for="searchHighlight" class="alwaysenabled">Highlight all</label>',"					</div>","				</div>",'				<div id="options" class="toolbar">',"					Options:",'					<input type="checkbox" id="enableLogging" onclick="toggleLoggingEnabled()" checked="checked" title="Enable/disable logging" /><label for="enableLogging" id="enableLoggingLabel">Log</label>','					<input type="checkbox" id="wrap" onclick="toggleWrap()" title="Enable / disable word wrap" /><label for="wrap" id="wrapLabel">Wrap</label>','					<input type="checkbox" id="newestAtTop" onclick="toggleNewestAtTop()" title="If checked, causes newest messages to appear at the top" /><label for="newestAtTop" id="newestAtTopLabel">Newest at the top</label>','					<input type="checkbox" id="scrollToLatest" onclick="toggleScrollToLatest()" checked="checked" title="If checked, window automatically scrolls to a new message when it is added" /><label for="scrollToLatest" id="scrollToLatestLabel">Scroll to latest</label>','					<input type="button" id="clearButton" value="Clear" onclick="clearLog()" class="button" title="Clear all log messages"  />','					<input type="button" id="hideButton" value="Hide" onclick="hide()" class="hidden button" title="Hide the console" />','					<input type="button" id="closeButton" value="Close" onclick="closeWindow()" class="hidden button" title="Close the window" />',"				</div>","			</div>","		</div>",'		<div id="log" class="TRACE DEBUG INFO WARN ERROR FATAL"></div>','		<div id="commandLine" class="toolbar">','			<div id="commandLineContainer">','				<input type="text" id="command" title="Enter a JavaScript command here and hit return or press \'Evaluate\'" />','				<input type="button" id="evaluateButton" value="Evaluate" class="button" title="Evaluate the command" onclick="evalCommandLine()" />',"			</div>","		</div>","	</body>","</html>",""]};var defaultCommandLineFunctions=[];ConsoleAppender=function(){};var consoleAppenderIdCounter=1;ConsoleAppender.prototype=new Appender();ConsoleAppender.prototype.create=function(inPage,container,lazyInit,initiallyMinimized,useDocumentWrite,width,height,focusConsoleWindow){var appender=this;var initialized=false;var consoleWindowCreated=false;var consoleWindowLoaded=false;var consoleClosed=false;var queuedLoggingEvents=[];var isSupported=true;var consoleAppenderId=consoleAppenderIdCounter++;initiallyMinimized=extractBooleanFromParam(initiallyMinimized,this.defaults.initiallyMinimized);lazyInit=extractBooleanFromParam(lazyInit,this.defaults.lazyInit);useDocumentWrite=extractBooleanFromParam(useDocumentWrite,this.defaults.useDocumentWrite);var newestMessageAtTop=this.defaults.newestMessageAtTop;var scrollToLatestMessage=this.defaults.scrollToLatestMessage;width=width?width:this.defaults.width;height=height?height:this.defaults.height;var maxMessages=this.defaults.maxMessages;var showCommandLine=this.defaults.showCommandLine;var commandLineObjectExpansionDepth=this.defaults.commandLineObjectExpansionDepth;var showHideButton=this.defaults.showHideButton;var showCloseButton=this.defaults.showCloseButton;var showLogEntryDeleteButtons=this.defaults.showLogEntryDeleteButtons;this.setLayout(this.defaults.layout);var init,createWindow,safeToAppend,getConsoleWindow,open;var appenderName=inPage?"InPageAppender":"PopUpAppender";var checkCanConfigure=function(configOptionName){if(consoleWindowCreated){handleError(appenderName+": configuration option '"+configOptionName+"' may not be set after the appender has been initialized");return false}return true};var consoleWindowExists=function(){return(consoleWindowLoaded&&isSupported&&!consoleClosed)};this.isNewestMessageAtTop=function(){return newestMessageAtTop};this.setNewestMessageAtTop=function(newestMessageAtTopParam){newestMessageAtTop=bool(newestMessageAtTopParam);if(consoleWindowExists()){getConsoleWindow().setNewestAtTop(newestMessageAtTop)}};this.isScrollToLatestMessage=function(){return scrollToLatestMessage};this.setScrollToLatestMessage=function(scrollToLatestMessageParam){scrollToLatestMessage=bool(scrollToLatestMessageParam);if(consoleWindowExists()){getConsoleWindow().setScrollToLatest(scrollToLatestMessage)}};this.getWidth=function(){return width};this.setWidth=function(widthParam){if(checkCanConfigure("width")){width=extractStringFromParam(widthParam,width)}};this.getHeight=function(){return height};this.setHeight=function(heightParam){if(checkCanConfigure("height")){height=extractStringFromParam(heightParam,height)}};this.getMaxMessages=function(){return maxMessages};this.setMaxMessages=function(maxMessagesParam){maxMessages=extractIntFromParam(maxMessagesParam,maxMessages);if(consoleWindowExists()){getConsoleWindow().setMaxMessages(maxMessages)}};this.isShowCommandLine=function(){return showCommandLine};this.setShowCommandLine=function(showCommandLineParam){showCommandLine=bool(showCommandLineParam);if(consoleWindowExists()){getConsoleWindow().setShowCommandLine(showCommandLine)}};this.isShowHideButton=function(){return showHideButton};this.setShowHideButton=function(showHideButtonParam){showHideButton=bool(showHideButtonParam);if(consoleWindowExists()){getConsoleWindow().setShowHideButton(showHideButton)}};this.isShowCloseButton=function(){return showCloseButton};this.setShowCloseButton=function(showCloseButtonParam){showCloseButton=bool(showCloseButtonParam);if(consoleWindowExists()){getConsoleWindow().setShowCloseButton(showCloseButton)}};this.getCommandLineObjectExpansionDepth=function(){return commandLineObjectExpansionDepth};this.setCommandLineObjectExpansionDepth=function(commandLineObjectExpansionDepthParam){commandLineObjectExpansionDepth=extractIntFromParam(commandLineObjectExpansionDepthParam,commandLineObjectExpansionDepth)};var minimized=initiallyMinimized;this.isInitiallyMinimized=function(){return initiallyMinimized};this.setInitiallyMinimized=function(initiallyMinimizedParam){if(checkCanConfigure("initiallyMinimized")){initiallyMinimized=bool(initiallyMinimizedParam);minimized=initiallyMinimized}};this.isUseDocumentWrite=function(){return useDocumentWrite};this.setUseDocumentWrite=function(useDocumentWriteParam){if(checkCanConfigure("useDocumentWrite")){useDocumentWrite=bool(useDocumentWriteParam)}};function QueuedLoggingEvent(loggingEvent,formattedMessage){this.loggingEvent=loggingEvent;this.levelName=loggingEvent.level.name;this.formattedMessage=formattedMessage}QueuedLoggingEvent.prototype.append=function(){getConsoleWindow().log(this.levelName,this.formattedMessage)};function QueuedGroup(name,initiallyExpanded){this.name=name;this.initiallyExpanded=initiallyExpanded}QueuedGroup.prototype.append=function(){getConsoleWindow().group(this.name,this.initiallyExpanded)};function QueuedGroupEnd(){}QueuedGroupEnd.prototype.append=function(){getConsoleWindow().groupEnd()};var checkAndAppend=function(){safeToAppend();if(!initialized){init()}else{if(consoleClosed&&reopenWhenClosed){createWindow()}}if(safeToAppend()){appendQueuedLoggingEvents()}};this.append=function(loggingEvent){if(isSupported){var formattedMessage=appender.getLayout().format(loggingEvent);if(this.getLayout().ignoresThrowable()){formattedMessage+=loggingEvent.getThrowableStrRep()}queuedLoggingEvents.push(new QueuedLoggingEvent(loggingEvent,formattedMessage));checkAndAppend()}};this.group=function(name,initiallyExpanded){if(isSupported){queuedLoggingEvents.push(new QueuedGroup(name,initiallyExpanded));checkAndAppend()}};this.groupEnd=function(){if(isSupported){queuedLoggingEvents.push(new QueuedGroupEnd());checkAndAppend()}};var appendQueuedLoggingEvents=function(){var currentLoggingEvent;while(queuedLoggingEvents.length>0){queuedLoggingEvents.shift().append()}if(focusConsoleWindow){getConsoleWindow().focus()}};this.setAddedToLogger=function(logger){this.loggers.push(logger);if(enabled&&!lazyInit){init()}};this.clear=function(){if(consoleWindowExists()){getConsoleWindow().clearLog()}queuedLoggingEvents.length=0};this.focus=function(){if(consoleWindowExists()){getConsoleWindow().focus()}};this.focusCommandLine=function(){if(consoleWindowExists()){getConsoleWindow().focusCommandLine()}};this.focusSearch=function(){if(consoleWindowExists()){getConsoleWindow().focusSearch()}};var commandWindow=window;this.getCommandWindow=function(){return commandWindow};this.setCommandWindow=function(commandWindowParam){commandWindow=commandWindowParam};this.executeLastCommand=function(){if(consoleWindowExists()){getConsoleWindow().evalLastCommand()}};var commandLayout=new PatternLayout("%m");this.getCommandLayout=function(){return commandLayout};this.setCommandLayout=function(commandLayoutParam){commandLayout=commandLayoutParam};this.evalCommandAndAppend=function(expr){var commandReturnValue={appendResult:true,isError:false};var commandOutput="";try{var result,i;if(!commandWindow.eval&&commandWindow.execScript){commandWindow.execScript("null")}var commandLineFunctionsHash={};for(i=0,len=commandLineFunctions.length;i<len;i++){commandLineFunctionsHash[commandLineFunctions[i][0]]=commandLineFunctions[i][1]}var objectsToRestore=[];var addObjectToRestore=function(name){objectsToRestore.push([name,commandWindow[name]])};addObjectToRestore("appender");commandWindow.appender=appender;addObjectToRestore("commandReturnValue");commandWindow.commandReturnValue=commandReturnValue;addObjectToRestore("commandLineFunctionsHash");commandWindow.commandLineFunctionsHash=commandLineFunctionsHash;var addFunctionToWindow=function(name){addObjectToRestore(name);commandWindow[name]=function(){return this.commandLineFunctionsHash[name](appender,arguments,commandReturnValue)}};for(i=0,len=commandLineFunctions.length;i<len;i++){addFunctionToWindow(commandLineFunctions[i][0])}if(commandWindow===window&&commandWindow.execScript){addObjectToRestore("evalExpr");addObjectToRestore("result");window.evalExpr=expr;commandWindow.execScript("window.result=eval(window.evalExpr);");result=window.result}else{result=commandWindow.eval(expr)}commandOutput=isUndefined(result)?result:formatObjectExpansion(result,commandLineObjectExpansionDepth);for(i=0,len=objectsToRestore.length;i<len;i++){commandWindow[objectsToRestore[i][0]]=objectsToRestore[i][1]}}catch(ex){commandOutput="Error evaluating command: "+getExceptionStringRep(ex);commandReturnValue.isError=true}if(commandReturnValue.appendResult){var message=">>> "+expr;if(!isUndefined(commandOutput)){message+=newLine+commandOutput}var level=commandReturnValue.isError?Level.ERROR:Level.INFO;var loggingEvent=new LoggingEvent(null,new Date(),level,[message],null);var mainLayout=this.getLayout();this.setLayout(commandLayout);this.append(loggingEvent);this.setLayout(mainLayout)}};var commandLineFunctions=defaultCommandLineFunctions.concat([]);this.addCommandLineFunction=function(functionName,commandLineFunction){commandLineFunctions.push([functionName,commandLineFunction])};var commandHistoryCookieName="log4javascriptCommandHistory";this.storeCommandHistory=function(commandHistory){setCookie(commandHistoryCookieName,commandHistory.join(","))};var writeHtml=function(doc){var lines=getConsoleHtmlLines();doc.open();for(var i=0,len=lines.length;i<len;i++){doc.writeln(lines[i])}doc.close()};this.setEventTypes(["load","unload"]);var consoleWindowLoadHandler=function(){var win=getConsoleWindow();win.setAppender(appender);win.setNewestAtTop(newestMessageAtTop);win.setScrollToLatest(scrollToLatestMessage);win.setMaxMessages(maxMessages);win.setShowCommandLine(showCommandLine);win.setShowHideButton(showHideButton);win.setShowCloseButton(showCloseButton);win.setMainWindow(window);var storedValue=getCookie(commandHistoryCookieName);if(storedValue){win.commandHistory=storedValue.split(",");win.currentCommandIndex=win.commandHistory.length}appender.dispatchEvent("load",{win:win})};this.unload=function(){logLog.debug("unload "+this+", caller: "+this.unload.caller);if(!consoleClosed){logLog.debug("really doing unload "+this);consoleClosed=true;consoleWindowLoaded=false;consoleWindowCreated=false;appender.dispatchEvent("unload",{})}};var pollConsoleWindow=function(windowTest,interval,successCallback,errorMessage){function doPoll(){try{if(consoleClosed){clearInterval(poll)}if(windowTest(getConsoleWindow())){clearInterval(poll);successCallback()}}catch(ex){clearInterval(poll);isSupported=false;handleError(errorMessage,ex)}}var poll=setInterval(doPoll,interval)};var getConsoleUrl=function(){var documentDomainSet=(document.domain!=location.hostname);return useDocumentWrite?"":getBaseUrl()+"console_uncompressed.html"+(documentDomainSet?"?log4javascript_domain="+escape(document.domain):"")};if(inPage){var containerElement=null;var cssProperties=[];this.addCssProperty=function(name,value){if(checkCanConfigure("cssProperties")){cssProperties.push([name,value])}};var windowCreationStarted=false;var iframeContainerDiv;var iframeId=uniqueId+"_InPageAppender_"+consoleAppenderId;this.hide=function(){if(initialized&&consoleWindowCreated){if(consoleWindowExists()){getConsoleWindow().$("command").blur()}iframeContainerDiv.style.display="none";minimized=true}};this.show=function(){if(initialized){if(consoleWindowCreated){iframeContainerDiv.style.display="block";this.setShowCommandLine(showCommandLine);minimized=false}else{if(!windowCreationStarted){createWindow(true)}}}};this.isVisible=function(){return !minimized&&!consoleClosed};this.close=function(fromButton){if(!consoleClosed&&(!fromButton||confirm("This will permanently remove the console from the page. No more messages will be logged. Do you wish to continue?"))){iframeContainerDiv.parentNode.removeChild(iframeContainerDiv);this.unload()}};open=function(){var initErrorMessage="InPageAppender.open: unable to create console iframe";function finalInit(){try{if(!initiallyMinimized){appender.show()}consoleWindowLoadHandler();consoleWindowLoaded=true;appendQueuedLoggingEvents()}catch(ex){isSupported=false;handleError(initErrorMessage,ex)}}function writeToDocument(){try{var windowTest=function(win){return isLoaded(win)};if(useDocumentWrite){writeHtml(getConsoleWindow().document)}if(windowTest(getConsoleWindow())){finalInit()}else{pollConsoleWindow(windowTest,100,finalInit,initErrorMessage)}}catch(ex){isSupported=false;handleError(initErrorMessage,ex)}}minimized=false;iframeContainerDiv=containerElement.appendChild(document.createElement("div"));iframeContainerDiv.style.width=width;iframeContainerDiv.style.height=height;iframeContainerDiv.style.border="solid gray 1px";for(var i=0,len=cssProperties.length;i<len;i++){iframeContainerDiv.style[cssProperties[i][0]]=cssProperties[i][1]}var iframeSrc=useDocumentWrite?"":" src='"+getConsoleUrl()+"'";iframeContainerDiv.innerHTML="<iframe id='"+iframeId+"' name='"+iframeId+"' width='100%' height='100%' frameborder='0'"+iframeSrc+" scrolling='no'></iframe>";consoleClosed=false;var iframeDocumentExistsTest=function(win){try{return bool(win)&&bool(win.document)}catch(ex){return false}};if(iframeDocumentExistsTest(getConsoleWindow())){writeToDocument()}else{pollConsoleWindow(iframeDocumentExistsTest,100,writeToDocument,initErrorMessage)}consoleWindowCreated=true};createWindow=function(show){if(show||!initiallyMinimized){var pageLoadHandler=function(){if(!container){containerElement=document.createElement("div");containerElement.style.position="fixed";containerElement.style.left="0";containerElement.style.right="0";containerElement.style.bottom="0";document.body.appendChild(containerElement);appender.addCssProperty("borderWidth","1px 0 0 0");appender.addCssProperty("zIndex",1000000);open()}else{try{var el=document.getElementById(container);if(el.nodeType==1){containerElement=el}open()}catch(ex){handleError("InPageAppender.init: invalid container element '"+container+"' supplied",ex)}}};if(pageLoaded&&container&&container.appendChild){containerElement=container;open()}else{if(pageLoaded){pageLoadHandler()}else{log4javascript.addEventListener("load",pageLoadHandler)}}windowCreationStarted=true}};init=function(){createWindow();initialized=true};getConsoleWindow=function(){var iframe=window.frames[iframeId];if(iframe){return iframe}};safeToAppend=function(){if(isSupported&&!consoleClosed){if(consoleWindowCreated&&!consoleWindowLoaded&&getConsoleWindow()&&isLoaded(getConsoleWindow())){consoleWindowLoaded=true}return consoleWindowLoaded}return false}}else{var useOldPopUp=appender.defaults.useOldPopUp;var complainAboutPopUpBlocking=appender.defaults.complainAboutPopUpBlocking;var reopenWhenClosed=this.defaults.reopenWhenClosed;this.isUseOldPopUp=function(){return useOldPopUp};this.setUseOldPopUp=function(useOldPopUpParam){if(checkCanConfigure("useOldPopUp")){useOldPopUp=bool(useOldPopUpParam)}};this.isComplainAboutPopUpBlocking=function(){return complainAboutPopUpBlocking};this.setComplainAboutPopUpBlocking=function(complainAboutPopUpBlockingParam){if(checkCanConfigure("complainAboutPopUpBlocking")){complainAboutPopUpBlocking=bool(complainAboutPopUpBlockingParam)}};this.isFocusPopUp=function(){return focusConsoleWindow};this.setFocusPopUp=function(focusPopUpParam){focusConsoleWindow=bool(focusPopUpParam)};this.isReopenWhenClosed=function(){return reopenWhenClosed};this.setReopenWhenClosed=function(reopenWhenClosedParam){reopenWhenClosed=bool(reopenWhenClosedParam)};this.close=function(){logLog.debug("close "+this);try{popUp.close();this.unload()}catch(ex){}};this.hide=function(){logLog.debug("hide "+this);if(consoleWindowExists()){this.close()}};this.show=function(){logLog.debug("show "+this);if(!consoleWindowCreated){open()}};this.isVisible=function(){return safeToAppend()};var popUp;open=function(){var windowProperties="width="+width+",height="+height+",status,resizable";var windowName="PopUp_"+location.host.replace(/[^a-z0-9]/gi,"_")+"_"+consoleAppenderId;if(!useOldPopUp||!useDocumentWrite){windowName=windowName+"_"+uniqueId}var checkPopUpClosed=function(win){if(consoleClosed){return true}else{try{return bool(win)&&win.closed}catch(ex){}}return false};var popUpClosedCallback=function(){if(!consoleClosed){appender.unload()}};function finalInit(){getConsoleWindow().setCloseIfOpenerCloses(!useOldPopUp||!useDocumentWrite);consoleWindowLoadHandler();consoleWindowLoaded=true;appendQueuedLoggingEvents();pollConsoleWindow(checkPopUpClosed,500,popUpClosedCallback,"PopUpAppender.checkPopUpClosed: error checking pop-up window")}try{popUp=window.open(getConsoleUrl(),windowName,windowProperties);consoleClosed=false;consoleWindowCreated=true;if(popUp&&popUp.document){if(useDocumentWrite&&useOldPopUp&&isLoaded(popUp)){popUp.mainPageReloaded();finalInit()}else{if(useDocumentWrite){writeHtml(popUp.document)}var popUpLoadedTest=function(win){return bool(win)&&isLoaded(win)};if(isLoaded(popUp)){finalInit()}else{pollConsoleWindow(popUpLoadedTest,100,finalInit,"PopUpAppender.init: unable to create console window")}}}else{isSupported=false;logLog.warn("PopUpAppender.init: pop-ups blocked, please unblock to use PopUpAppender");if(complainAboutPopUpBlocking){handleError("log4javascript: pop-up windows appear to be blocked. Please unblock them to use pop-up logging.")}}}catch(ex){handleError("PopUpAppender.init: error creating pop-up",ex)}};createWindow=function(){if(!initiallyMinimized){open()}};init=function(){createWindow();initialized=true};getConsoleWindow=function(){return popUp};safeToAppend=function(){if(isSupported&&!isUndefined(popUp)&&!consoleClosed){if(popUp.closed||(consoleWindowLoaded&&isUndefined(popUp.closed))){appender.unload();logLog.debug("PopUpAppender: pop-up closed");return false}if(!consoleWindowLoaded&&isLoaded(popUp)){consoleWindowLoaded=true}}return isSupported&&consoleWindowLoaded&&!consoleClosed}}this.getConsoleWindow=getConsoleWindow};ConsoleAppender.addGlobalCommandLineFunction=function(functionName,commandLineFunction){defaultCommandLineFunctions.push([functionName,commandLineFunction])};function PopUpAppender(lazyInit,initiallyMinimized,useDocumentWrite,width,height){this.create(false,null,lazyInit,initiallyMinimized,useDocumentWrite,width,height,this.defaults.focusPopUp)}PopUpAppender.prototype=new ConsoleAppender();PopUpAppender.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:false,focusPopUp:false,lazyInit:true,useOldPopUp:true,complainAboutPopUpBlocking:true,newestMessageAtTop:false,scrollToLatestMessage:true,width:"600",height:"400",reopenWhenClosed:false,maxMessages:null,showCommandLine:true,commandLineObjectExpansionDepth:1,showHideButton:false,showCloseButton:true,showLogEntryDeleteButtons:true,useDocumentWrite:true};PopUpAppender.prototype.toString=function(){return"PopUpAppender"};log4javascript.PopUpAppender=PopUpAppender;function InPageAppender(container,lazyInit,initiallyMinimized,useDocumentWrite,width,height){this.create(true,container,lazyInit,initiallyMinimized,useDocumentWrite,width,height,false)}InPageAppender.prototype=new ConsoleAppender();InPageAppender.prototype.defaults={layout:new PatternLayout("%d{HH:mm:ss} %-5p - %m{1}%n"),initiallyMinimized:false,lazyInit:true,newestMessageAtTop:false,scrollToLatestMessage:true,width:"100%",height:"220px",maxMessages:null,showCommandLine:true,commandLineObjectExpansionDepth:1,showHideButton:false,showCloseButton:false,showLogEntryDeleteButtons:true,useDocumentWrite:true};InPageAppender.prototype.toString=function(){return"InPageAppender"};log4javascript.InPageAppender=InPageAppender;log4javascript.InlineAppender=InPageAppender})();function padWithSpaces(str,len){if(str.length<len){var spaces=[];var numberOfSpaces=Math.max(0,len-str.length);for(var i=0;i<numberOfSpaces;i++){spaces[i]=" "}str+=spaces.join("")}return str}(function(){function dir(obj){var maxLen=0;for(var p in obj){maxLen=Math.max(toStr(p).length,maxLen)}var propList=[];for(p in obj){var propNameStr="  "+padWithSpaces(toStr(p),maxLen+2);var propVal;try{propVal=splitIntoLines(toStr(obj[p])).join(padWithSpaces(newLine,maxLen+6))}catch(ex){propVal="[Error obtaining property. Details: "+getExceptionMessage(ex)+"]"}propList.push(propNameStr+propVal)}return propList.join(newLine)}var nodeTypes={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12};var preFormattedElements=["script","pre"];var emptyElements=["br","img","hr","param","link","area","input","col","base","meta"];var indentationUnit="  ";function getXhtml(rootNode,includeRootNode,indentation,startNewLine,preformatted){includeRootNode=(typeof includeRootNode=="undefined")?true:!!includeRootNode;if(typeof indentation!="string"){indentation=""}startNewLine=!!startNewLine;preformatted=!!preformatted;var xhtml;function isWhitespace(node){return((node.nodeType==nodeTypes.TEXT_NODE)&&/^[ \t\r\n]*$/.test(node.nodeValue))}function fixAttributeValue(attrValue){return attrValue.toString().replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/\"/g,"&quot;")}function getStyleAttributeValue(el){var stylePairs=el.style.cssText.split(";");var styleValue="";var isFirst=true;for(var j=0,len=stylePairs.length;j<len;j++){var nameValueBits=stylePairs[j].split(":");var props=[];if(!/^\s*$/.test(nameValueBits[0])){props.push(trim(nameValueBits[0]).toLowerCase()+":"+trim(nameValueBits[1]))}styleValue=props.join(";")}return styleValue}function getNamespace(el){if(el.prefix){return el.prefix}else{if(el.outerHTML){var regex=new RegExp("<([^:]+):"+el.tagName+"[^>]*>","i");if(regex.test(el.outerHTML)){return RegExp.$1.toLowerCase()}}}return""}var lt="<";var gt=">";if(includeRootNode&&rootNode.nodeType!=nodeTypes.DOCUMENT_FRAGMENT_NODE){switch(rootNode.nodeType){case nodeTypes.ELEMENT_NODE:var tagName=rootNode.tagName.toLowerCase();xhtml=startNewLine?newLine+indentation:"";xhtml+=lt;var prefix=getNamespace(rootNode);var hasPrefix=!!prefix;if(hasPrefix){xhtml+=prefix+":"}xhtml+=tagName;for(i=0,len=rootNode.attributes.length;i<len;i++){var currentAttr=rootNode.attributes[i];if(!currentAttr.specified||currentAttr.nodeValue===null||currentAttr.nodeName.toLowerCase()==="style"||typeof currentAttr.nodeValue!=="string"||currentAttr.nodeName.indexOf("_moz")===0){continue}xhtml+=" "+currentAttr.nodeName.toLowerCase()+'="';xhtml+=fixAttributeValue(currentAttr.nodeValue);xhtml+='"'}if(rootNode.style.cssText){var styleValue=getStyleAttributeValue(rootNode);if(styleValue!==""){xhtml+=' style="'+getStyleAttributeValue(rootNode)+'"'}}if(array_contains(emptyElements,tagName)||(hasPrefix&&!rootNode.hasChildNodes())){xhtml+="/"+gt}else{xhtml+=gt;var childStartNewLine=!(rootNode.childNodes.length===1&&rootNode.childNodes[0].nodeType===nodeTypes.TEXT_NODE);var childPreformatted=array_contains(preFormattedElements,tagName);for(var i=0,len=rootNode.childNodes.length;i<len;i++){xhtml+=getXhtml(rootNode.childNodes[i],true,indentation+indentationUnit,childStartNewLine,childPreformatted)}var endTag=lt+"/"+tagName+gt;xhtml+=childStartNewLine?newLine+indentation+endTag:endTag}return xhtml;case nodeTypes.TEXT_NODE:if(isWhitespace(rootNode)){xhtml=""}else{if(preformatted){xhtml=rootNode.nodeValue}else{var lines=splitIntoLines(trim(rootNode.nodeValue));var trimmedLines=[];for(var i=0,len=lines.length;i<len;i++){trimmedLines[i]=trim(lines[i])}xhtml=trimmedLines.join(newLine+indentation)}if(startNewLine){xhtml=newLine+indentation+xhtml}}return xhtml;case nodeTypes.CDATA_SECTION_NODE:return"<![CDATA["+rootNode.nodeValue+"]]>"+newLine;case nodeTypes.DOCUMENT_NODE:xhtml="";for(var i=0,len=rootNode.childNodes.length;i<len;i++){xhtml+=getXhtml(rootNode.childNodes[i],true,indentation)}return xhtml;default:return""}}else{xhtml="";for(var i=0,len=rootNode.childNodes.length;i<len;i++){xhtml+=getXhtml(rootNode.childNodes[i],true,indentation+indentationUnit)}return xhtml}}var layouts={};function createCommandLineFunctions(appender){ConsoleAppender.addGlobalCommandLineFunction("$",function(appender,args,returnValue){return document.getElementById(args[0])});ConsoleAppender.addGlobalCommandLineFunction("dir",function(appender,args,returnValue){var lines=[];for(var i=0,len=args.length;i<len;i++){lines[i]=dir(args[i])}return lines.join(newLine+newLine)});ConsoleAppender.addGlobalCommandLineFunction("dirxml",function(appender,args,returnValue){var lines=[];for(var i=0,len=args.length;i<len;i++){var win=appender.getCommandWindow();lines[i]=getXhtml(args[i])}return lines.join(newLine+newLine)});ConsoleAppender.addGlobalCommandLineFunction("cd",function(appender,args,returnValue){var win,message;if(args.length===0||args[0]===""){win=window;message="Command line set to run in main window"}else{if(args[0].window==args[0]){win=args[0];message="Command line set to run in frame '"+args[0].name+"'"}else{win=window.frames[args[0]];if(win){message="Command line set to run in frame '"+args[0]+"'"}else{returnValue.isError=true;message="Frame '"+args[0]+"' does not exist";win=appender.getCommandWindow()}}}appender.setCommandWindow(win);return message});ConsoleAppender.addGlobalCommandLineFunction("clear",function(appender,args,returnValue){returnValue.appendResult=false;appender.clear()});ConsoleAppender.addGlobalCommandLineFunction("keys",function(appender,args,returnValue){var keys=[];for(var k in args[0]){keys.push(k)}return keys});ConsoleAppender.addGlobalCommandLineFunction("values",function(appender,args,returnValue){var values=[];for(var k in args[0]){try{values.push(args[0][k])}catch(ex){logLog.warn("values(): Unable to obtain value for key "+k+". Details: "+getExceptionMessage(ex))}}return values});ConsoleAppender.addGlobalCommandLineFunction("expansionDepth",function(appender,args,returnValue){var expansionDepth=parseInt(args[0],10);if(isNaN(expansionDepth)||expansionDepth<0){returnValue.isError=true;return""+args[0]+" is not a valid expansion depth"}else{appender.setCommandLineObjectExpansionDepth(expansionDepth);return"Object expansion depth set to "+expansionDepth}})}function init(){createCommandLineFunctions();initialized=true}init()})();log4javascript.setDocumentReady=function(){pageLoaded=true;log4javascript.dispatchEvent("load",{})};if(window.addEventListener){window.addEventListener("load",log4javascript.setDocumentReady,false)}else{if(window.attachEvent){window.attachEvent("onload",log4javascript.setDocumentReady)}else{var oldOnload=window.onload;if(typeof window.onload!="function"){window.onload=log4javascript.setDocumentReady}else{window.onload=function(evt){if(oldOnload){oldOnload(evt)}log4javascript.setDocumentReady()}}}}window.log4javascript=log4javascript;return log4javascript})();(function(K){function w(l,b){var f=x?b:I(b);var y=f.worker&&Papa.WORKERS_SUPPORTED&&D;if(y){var d=L();d.userStep=f.step;d.userChunk=f.chunk;d.userComplete=f.complete;d.userError=f.error;f.step=N(f.step);f.chunk=N(f.chunk);f.complete=N(f.complete);f.error=N(f.error);delete f.worker;d.postMessage({input:l,config:f,workerId:d.id})}else{if(typeof l==="string"){if(f.download){var t=new J(f);t.stream(l)}else{var m=new M(f);var g=m.parse(l);return g}}else{if(l instanceof File){if(f.step||f.chunk){var t=new F(f);t.stream(l)}else{var m=new M(f);if(x){var c=new FileReaderSync;var n=c.readAsText(l,f.encoding);return m.parse(n)}else{c=new FileReader;c.onload=function(h){var a=new M(f);var o=a.parse(h.target.result)};c.onerror=function(){if(N(f.error)){f.error(c.error,l)}};c.readAsText(l,f.encoding)}}}}}}function O(R,e){function P(){if(typeof e!=="object"){return}if(typeof e.delimiter==="string"&&e.delimiter.length==1&&K.Papa.BAD_DELIMITERS.indexOf(e.delimiter)==-1){d=e.delimiter}if(typeof e.quotes==="boolean"||e.quotes instanceof Array){S=e.quotes}if(typeof e.newline==="string"){Q=e.newline}}function v(c){if(typeof c!=="object"){return[]}var a=[];for(var f in c){a.push(f)}return a}function g(W,Y){var o="";if(typeof W==="string"){W=JSON.parse(W)}if(typeof Y==="string"){Y=JSON.parse(Y)}var c=W instanceof Array&&W.length>0;var T=!(Y[0] instanceof Array);if(c){for(var Z=0;Z<W.length;Z++){if(Z>0){o+=d}o+=y(W[Z],Z)}if(Y.length>0){o+=Q}}for(var X=0;X<Y.length;X++){var V=c?W.length:Y[X].length;for(var u=0;u<V;u++){if(u>0){o+=d}var U=c&&T?W[u]:u;o+=y(Y[X][U],u)}if(X<Y.length-1){o+=Q}}return o}function y(a,f){if(typeof a==="undefined"||a===null){return""}a=a.toString().replace(/"/g,'""');var c=typeof S==="boolean"&&S||S instanceof Array&&S[f]||p(a,K.Papa.BAD_DELIMITERS)||a.indexOf(d)>-1||a.charAt(0)==" "||a.charAt(a.length-1)==" ";return c?'"'+a+'"':a}function p(c,a){for(var f=0;f<a.length;f++){if(c.indexOf(a[f])>-1){return true}}return false}var b="";var m=[];var S=false;var d=",";var Q="\r\n";P();if(typeof R==="string"){R=JSON.parse(R)}if(R instanceof Array){if(!R.length||R[0] instanceof Array){return g(null,R)}else{if(typeof R[0]==="object"){return g(v(R[0]),R)}}}else{if(typeof R==="object"){if(typeof R.data==="string"){R.data=JSON.parse(R.data)}if(R.data instanceof Array){if(!R.fields){R.fields=R.data[0] instanceof Array?R.fields:v(R.data[0])}if(!(R.data[0] instanceof Array)&&typeof R.data[0]!=="object"){R.data=[R.data]}}return g(R.fields||[],R.data||[])}}throw"exception: Unable to serialize unrecognized input"}function J(U){function V(){if(Y){Z();return}ac=new XMLHttpRequest;if(!x){ac.onload=Z;ac.onerror=c}ac.open("GET",aa,!x);if(U.step||U.chunk){var d=Q+e.chunkSize-1;if(X&&d>X){d=X}ac.setRequestHeader("Range","bytes="+Q+"-"+d)}try{ac.send()}catch(a){c(a.message)}if(x&&ac.status==0){c()}else{Q+=e.chunkSize}}function Z(){if(ac.readyState!=4){return}if(ac.status<200||ac.status>=400){c();return}T+=t+ac.responseText;t="";Y=!U.step&&!U.chunk||Q>y(ac);if(!Y){var a=T.lastIndexOf("\r");if(a==-1){a=T.lastIndexOf("\n")}if(a!=-1){t=T.substring(a+1);T=T.substring(0,a)}else{W();return}}var d=ab.parse(T);T="";if(d&&d.data){P+=d.data.length}var g=Y||e.preview&&P>=e.preview;if(x){K.postMessage({results:d,workerId:Papa.WORKER_ID,finished:g})}else{if(N(U.chunk)){U.chunk(d,ab);d=undefined}}if(N(R)&&g){R(d)}if(!g&&(!d||!d.meta.paused)){W()}}function c(d){var a=ac.statusText||d;if(N(U.error)){U.error(a)}else{if(x&&U.error){K.postMessage({workerId:Papa.WORKER_ID,error:a,finished:false})}}}function y(d){var a=d.getResponseHeader("Content-Range");return parseInt(a.substr(a.lastIndexOf("/")+1))}function b(a){e=k(a);R=e.complete;e.complete=undefined;e.chunkSize=parseInt(e.chunkSize);ab=new M(e);ab.streamer=this}U=U||{};if(!U.chunkSize){U.chunkSize=Papa.RemoteChunkSize}var Q=0,X=0,P=0;var T="";var t="";var ac,aa,W,Y;var R,ab,e;b(U);this.resume=function(){paused=false;W()};this.finished=function(){return Y};this.pause=function(){paused=true};this.abort=function(){Y=true;if(N(R)){R({data:[],errors:[],meta:{aborted:true}})}};this.stream=function(a){aa=a;if(x){W=function(){V();Z()}}else{W=function(){V()}}W()}}function F(X){function V(){if(!ae&&(!ac.preview||af<ac.preview)){Q()}}function Q(){var d=Math.min(U+ac.chunkSize,aa.size);var a=ab.readAsText(R.call(aa,U,d),X.encoding);if(!t){c({target:{result:a}})}}function c(d){U+=ac.chunkSize;W+=P+d.target.result;P="";ae=U>=aa.size;if(!ae){var g=W.lastIndexOf("\r");if(g==-1){g=W.lastIndexOf("\n")}if(g!=-1){P=W.substring(g+1);W=W.substring(0,g)}else{V();return}}var a=Y.parse(W);W="";if(a&&a.data){af+=a.data.length}var f=ae||ac.preview&&af>=ac.preview;if(x){K.postMessage({results:a,workerId:Papa.WORKER_ID,finished:f})}else{if(N(X.chunk)){X.chunk(a,Z,aa);if(ad){return}a=undefined}}if(N(y)&&f){y(a)}if(!f&&(!a||!a.meta.paused)){V()}}function e(){if(N(X.error)){X.error(ab.error,aa)}else{if(x&&X.error){K.postMessage({workerId:Papa.WORKER_ID,error:ab.error,file:aa,finished:false})}}}function b(a){ac=k(a);y=ac.complete;ac.complete=undefined;ac.chunkSize=parseInt(ac.chunkSize);Y=new M(ac);Y.streamer=this}X=X||{};if(!X.chunkSize){X.chunkSize=Papa.LocalChunkSize}var U=0;var aa;var R;var W="";var P="";var af=0;var ad=false;var Z=this;var ab,V,R,ae;var y,Y,ac;b(X);var t=typeof FileReader==="function";this.stream=function(a){aa=a;R=aa.slice||aa.webkitSlice||aa.mozSlice;if(t){ab=new FileReader;ab.onload=c;ab.onerror=e}else{ab=new FileReaderSync}V()};this.finished=function(){return ae};this.pause=function(){ad=true};this.resume=function(){ad=false;V()};this.abort=function(){ae=true;if(N(y)){y({data:[],errors:[],meta:{aborted:true}})}}}function M(ab){function ad(){if(aa&&y){P("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Papa.DefaultDelimiter+"'");y=false}if(ab.skipEmptyLines){for(var a=0;a<aa.data.length;a++){if(aa.data[a].length==1&&aa.data[a][0]==""){aa.data.splice(a--,1)}}}if(T()){ac()}return h()}function T(){return ab.header&&ae.length==0}function ac(){if(!aa){return}for(var c=0;T()&&c<aa.data.length;c++){for(var a=0;a<aa.data[c].length;a++){ae.push(aa.data[c][a])}}aa.data.splice(0,1)}function h(){if(!aa||!ab.header&&!ab.dynamicTyping){return aa}for(var c=0;c<aa.data.length;c++){var e={};for(var d=0;d<aa.data[c].length;d++){if(ab.dynamicTyping){var a=aa.data[c][d];if(a=="true"){aa.data[c][d]=true}else{if(a=="false"){aa.data[c][d]=false}else{aa.data[c][d]=b(a)}}}if(ab.header){if(d>=ae.length){if(!e.__parsed_extra){e.__parsed_extra=[]}e.__parsed_extra.push(aa.data[c][d])}else{e[ae[d]]=aa.data[c][d]}}}if(ab.header){aa.data[c]=e;if(d>ae.length){P("FieldMismatch","TooManyFields","Too many fields: expected "+ae.length+" fields but parsed "+d,c)}else{if(d<ae.length){P("FieldMismatch","TooFewFields","Too few fields: expected "+ae.length+" fields but parsed "+d,c)}}}}if(ab.header&&aa.meta){aa.meta.fields=ae}return aa}function W(ak){var m=[",","	","|",";",Papa.RECORD_SEP,Papa.UNIT_SEP];var d,af,al;for(var g=0;g<m.length;g++){var aj=m[g];var ai=0,ag=0;al=undefined;var v=(new H({delimiter:aj,preview:10})).parse(ak);for(var ah=0;ah<v.data.length;ah++){var e=v.data[ah].length;ag+=e;if(typeof al==="undefined"){al=e;continue}else{if(e>1){ai+=Math.abs(e-al);al=e}}}ag/=v.data.length;if((typeof af==="undefined"||ai<af)&&ag>1.99){af=ai;d=aj}}ab.delimiter=d;return{successful:!!d,bestDelimiter:d}}function Z(d){d=d.substr(0,1024*1024);var a=d.split("\r");if(a.length==1){return"\n"}var f=0;for(var c=0;c<a.length;c++){if(a[c][0]=="\n"){f++}}return f>=a.length/2?"\r\n":"\r"}function b(a){var c=Q.test(a);return c?parseFloat(a):a}function P(d,a,f,c){aa.errors.push({type:d,code:a,message:f,row:c})}var Q=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i;var V=this;var S=0;var Y;var R;var U=false;var y;var ae=[];var aa={data:[],errors:[],meta:{}};if(N(ab.step)){var X=ab.step;ab.step=function(a){aa=a;if(T()){ad()}else{ad();if(aa.data.length==0){return}S+=a.data.length;if(ab.preview&&S>ab.preview){R.abort()}else{X(aa,V)}}}}this.parse=function(d){if(!ab.newline){ab.newline=Z(d)}y=false;if(!ab.delimiter){var e=W(d);if(e.successful){ab.delimiter=e.bestDelimiter}else{y=true;ab.delimiter=Papa.DefaultDelimiter}aa.meta.delimiter=ab.delimiter}var c=k(ab);if(ab.preview&&ab.header){c.preview++}Y=d;R=new H(c);aa=R.parse(Y);ad();if(N(ab.complete)&&!U&&(!V.streamer||V.streamer.finished())){ab.complete(aa)}return U?{meta:{paused:true}}:aa||{meta:{paused:false}}};this.pause=function(){U=true;R.ab;ort();Y=Y.substr(R.getCharIndex())};this.resume=function(){U=false;R=new H(ab);R.parse(Y);if(!U){if(V.streamer&&!V.streamer.finished()){V.streamer.resume()}else{if(N(ab.complete)){ab.complete(aa)}}}};this.abort=function(){R.abort();if(N(ab.complete)){ab.complete(aa)}Y=""}}function H(l){function h(a){if(a.length==0){return false}if(a[a.length-1]!='"'){return false}if(a.length>2){return a[a.length-2]!='"'||a[a.length-3]=='"'}if(a.length>1){return a[a.length-2]!='"'}return true}l=l||{};var v=l.delimiter;var d=l.newline;var b=l.comments;var g=l.step;var y=l.preview;var c=l.fastMode;if(typeof v!=="string"||v.length!=1||Papa.BAD_DELIMITERS.indexOf(v)>-1){v=","}if(b===v){throw"Comment character same as delimiter"}else{if(b===true){b="#"}else{if(typeof b!=="string"||Papa.BAD_DELIMITERS.indexOf(b)>-1){b=false}}}if(d!="\n"&&d!="\r"&&d!="\r\n"){d="\n"}var p=0;var m=false;this.parse=function(X){function r(){W.push(X.substr(p));t.push(W);p=U;if(Y){P()}return n()}function a(e){t.push(W);W=[];p=e;u=X.indexOf(d,p)}function n(S){return{data:t,errors:R,meta:{delimiter:v,linebreak:d,aborted:m,truncated:!!S}}}function P(){g(n());t=[],R=[]}if(typeof X!=="string"){throw"Input must be a string"}var U=X.length,Z=v.length,V=d.length,Q=b.length;var Y=typeof g==="function";p=0;var t=[],R=[],W=[];if(!X){return n()}if(c){var o=X.split(d);for(var aa=0;aa<o.length;aa++){if(b&&o[aa].substr(0,Q)==b){continue}if(Y){t=[o[aa].split(v)];P();if(m){return n()}}else{t.push(o[aa].split(v))}if(y&&aa>=y){t=t.slice(0,y);return n(true)}}return n()}var s=X.indexOf(v,p);var u=X.indexOf(d,p);for(;;){if(X[p]=='"'){var f=p;p++;for(;;){var f=X.indexOf('"',f+1);if(f==-1){R.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:t.length,index:p});return r()}if(f==U-1&&h(X.substring(p,f+1))){W.push(X.substring(p,f).replace(/""/g,'"'));t.push(W);if(Y){P()}return n()}if(X[f+1]=='"'){continue}if(X[f+1]==v&&h(X.substring(p,f+1))){W.push(X.substring(p,f).replace(/""/g,'"'));p=f+1+Z;s=X.indexOf(v,p);u=X.indexOf(d,p);break}if(X.substr(f+1,V)==d&&h(X.substring(p,f+1))){W.push(X.substring(p,f).replace(/""/g,'"'));a(f+1+V);s=X.indexOf(v,p);if(Y){P();if(m){return n()}}if(y&&t.length>=y){return n(true)}break}}continue}if(b&&W.length==0&&X.substr(p,Q)==b){if(u==-1){return n()}p=u+V;u=X.indexOf(d,p);s=X.indexOf(v,p);continue}if(s!=-1&&(s<u||u==-1)){W.push(X.substring(p,s));p=s+Z;s=X.indexOf(v,p);continue}if(u!=-1){W.push(X.substring(p,u));a(u+V);if(Y){P();if(m){return n()}}if(y&&t.length>=y){return n(true)}continue}break}return r()};this.abort=function(){m=true};this.getCharIndex=function(){return p}}function B(){var a="worker"+String(Math.random()).substr(2);document.write('<script id="'+a+'"><\/script>');return document.getElementById(a).previousSibling.src}function L(){if(!Papa.WORKERS_SUPPORTED){return false}var a=new K.Worker(D);a.onmessage=q;a.id=G++;A[a.id]=a;return a}function q(c){var b=c.data;var d=A[b.workerId];if(b.error){d.userError(b.error,b.file)}else{if(b.results&&b.results.data){if(N(d.userStep)){for(var a=0;a<b.results.data.length;a++){d.userStep({data:[b.results.data[a]],errors:b.results.errors,meta:b.results.meta})}delete b.results}else{if(N(d.userChunk)){d.userChunk(b.results,b.file);delete b.results}}}}if(b.finished){if(N(A[b.workerId].userComplete)){A[b.workerId].userComplete(b.results)}A[b.workerId].terminate();delete A[b.workerId]}}function E(a){var c=a.data;if(typeof Papa.WORKER_ID==="undefined"&&c){Papa.WORKER_ID=c.workerId}if(typeof c.input==="string"){K.postMessage({workerId:Papa.WORKER_ID,results:Papa.parse(c.input,c.config),finished:true})}else{if(c.input instanceof File){var b=Papa.parse(c.input,c.config);if(b){K.postMessage({workerId:Papa.WORKER_ID,results:b,finished:true})}}}}function I(b){if(typeof b!=="object"){b={}}var a=k(b);if(typeof a.delimiter!=="string"||a.delimiter.length!=1||Papa.BAD_DELIMITERS.indexOf(a.delimiter)>-1){a.delimiter=z.delimiter}if(a.newline!="\n"&&a.newline!="\r"&&a.newline!="\r\n"){a.newline=z.newline}if(typeof a.header!=="boolean"){a.header=z.header}if(typeof a.dynamicTyping!=="boolean"){a.dynamicTyping=z.dynamicTyping}if(typeof a.preview!=="number"){a.preview=z.preview}if(typeof a.step!=="function"){a.step=z.step}if(typeof a.complete!=="function"){a.complete=z.complete}if(typeof a.error!=="function"){a.error=z.error}if(typeof a.encoding!=="string"){a.encoding=z.encoding}if(typeof a.worker!=="boolean"){a.worker=z.worker}if(typeof a.download!=="boolean"){a.download=z.download}if(typeof a.skipEmptyLines!=="boolean"){a.skipEmptyLines=z.skipEmptyLines}if(typeof a.fastMode!=="boolean"){a.fastMode=z.fastMode}return a}function k(b){if(typeof b!=="object"){return b}var a=b instanceof Array?[]:{};for(var c in b){a[c]=k(b[c])}return a}function N(a){return typeof a==="function"}var x=!K.document,D;var A={},G=0;var z={delimiter:"",newline:"",header:false,dynamicTyping:false,preview:0,step:undefined,encoding:"",worker:false,comments:false,complete:undefined,error:undefined,download:false,chunk:undefined,skipEmptyLines:false,fastMode:false};K.Papa={};K.Papa.parse=w;K.Papa.unparse=O;K.Papa.RECORD_SEP=String.fromCharCode(30);K.Papa.UNIT_SEP=String.fromCharCode(31);K.Papa.BYTE_ORDER_MARK="";K.Papa.BAD_DELIMITERS=["\r","\n",'"',K.Papa.BYTE_ORDER_MARK];K.Papa.WORKERS_SUPPORTED=!!K.Worker;K.Papa.LocalChunkSize=1024*1024*10;K.Papa.RemoteChunkSize=1024*1024*5;K.Papa.DefaultDelimiter=",";K.Papa.Parser=H;K.Papa.ParserHandle=M;K.Papa.NetworkStreamer=J;K.Papa.FileStreamer=F;if(K.jQuery){var C=K.jQuery;C.fn.parse=function(c){function b(){if(e.length==0){if(N(c.complete)){c.complete()}return}var h=e[0];if(N(c.before)){var l=c.before(h.file,h.inputElem);if(typeof l==="object"){if(l.action=="abort"){d("AbortError",h.file,h.inputElem,l.reason);return}else{if(l.action=="skip"){a();return}else{if(typeof l.config==="object"){h.instanceConfig=C.extend(h.instanceConfig,l.config)}}}}else{if(l=="skip"){a();return}}}var g=h.instanceConfig.complete;h.instanceConfig.complete=function(m){if(N(g)){g(m,h.file,h.inputElem)}a()};Papa.parse(h.file,h.instanceConfig)}function d(l,m,h,g){if(N(c.error)){c.error({name:l},m,h,g)}}function a(){e.splice(0,1);b()}var f=c.config||{};var e=[];this.each(function(h){var g=C(this).prop("tagName").toUpperCase()=="INPUT"&&C(this).attr("type").toLowerCase()=="file"&&K.FileReader;if(!g||!this.files||this.files.length==0){return true}for(var l=0;l<this.files.length;l++){e.push({file:this.files[l],inputElem:this,instanceConfig:C.extend({},f)})}});b();return this}}if(x){K.onmessage=E}else{if(Papa.WORKERS_SUPPORTED){D=B()}}})(this);__REQUIRED_SEPARATOR=':<span style="color: rgb(255, 0, 0); padding-left: 2px;">*</span>';Ext.data.validations.presenceMessage="To pole jest wymagane";Ext.data.validations.lengthMessage="Podany tekst jest za długi";Ext.data.validations.formatMessage="Podany tekst jest w niepoprawnym formacie";Ext.data.validations.regonMessage="Niepoprawny nr REGON.";Ext.data.validations.regon=function(a,h){if(a.allowEmpty&&h===""){return true}else{var e=[8,9,2,3,4,5,6,7];var d=[2,4,8,5,0,9,7,3,6,1,2,4,8];var f=false;var b=0;if(h.length==9||h.length==14){for(var c=0;c<h.length-1;c++){b+=((h.length==9)?e[c]:d[c])*h[c]}var k=b%11;var g=k==10?0:k;f=g==((h.length==9)?h[8]:h[13])}return f}};Ext.data.validations.postCodeMessage="Niepoprawny kod pocztowy.";Ext.data.validations.postCode=function(a,c){if(a.allowEmpty&&c===""){return true}else{var b=new RegExp("^[0-9]{2}-[0-9]{3}$");return b.test(c)}};Ext.data.validations.nipMessage="Niepoprawny numer NIP.";Ext.data.validations.nip=function(a,c){if(a.allowEmpty&&c===""){return true}else{var b=new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:.[a-zA-Z0-9-]+)*$");return false}};Ext.data.validations.emailMessage="Niepoprawny adres e-mail.";Ext.data.validations.email=function(a,c){if(a.allowEmpty&&c===""){return true}else{var b=new RegExp("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:.[a-zA-Z0-9-]+)*$");return b.test(c)}};Ext.data.validations.uniqueMessage="Wartość musi być unikalna.";Ext.data.validations.unique=function(b,d){if(b.store&&b.store instanceof Ext.data.Store){var a=false;var h=false;var c=false;var g="";if(Ext.isDefined(b.caseSensitive)){a=b.caseSensitive}try{g=d.toString().trim()}catch(f){g=""}if(Ext.isString(g)&&!a){g=g.toUpperCase()}return(b.store.findBy(function(l){var e=l.get(b.field);var k=false;if(Ext.isString(e)){if(!a){e=e.toUpperCase()}k=(e==g)}else{k=(e===d)}if(b.model&&b.model instanceof Ext.data.Model){k=k&&(l.getId()!=b.model.getId())}return k}))==-1}else{return false}};Ext.data.validations.peselMessage="Podany nr PESEL jest niepoprawny.";Ext.data.validations.pesel=function(a,f){if(a.simple){var e=/^\d{11}$/;if((typeof f==="string")&&((Ext.String.trim(f)===""&&a.acceptEmpty)||f.match(e))){return true}else{return false}}else{var c,g,d=0,b=[1,3,7,9,1,3,7,9,1,3];if((typeof f==="string")&&(f.length===11)){d=0;for(c=0;c<=9;c++){d+=f.charAt(c)*b[c]}g=(10-d%10)%10;return(g===Number(f.charAt(10)))}else{return false}}};Ext.data.validations.selectedMessage="To pole jest wymagane.";Ext.data.validations.selected=function(a,b){if(a&&a.allowNegative===true&&((typeof b==="number")&&(b<0))){return true}else{if(((typeof b==="number")&&(b>0))||((typeof b==="string")&&(b))){return true}else{return false}}};Ext.data.validations.rangeMessage="Liczba nie zawiera się w dozwolonym przedziale.";Ext.data.validations.range=function(a,c){var d=true,b=true;if(Ext.isDefined(a.min)){if(typeof a.min==="number"){d=a.min<=c}else{if(a.allowEmpty&&!c&&c!==0){d=true}else{d=false}}}if(Ext.isDefined(a.max)){if(typeof a.max==="number"){b=a.max>=c}else{if(a.allowEmpty&&!c&&c!==0){b=true}else{b=false}}}return d&&b};Ext.apply(Ext.form.field.VTypes,{time24:function(c,b){var a=/^([0-1]{0,1}[0-9]{1}:[0-5]{1}[0-9]{1}|2{1}[0-3]{1}:[0-5]{1}[0-9]{1})$/;return a.test(b.getRawValue())},time24Text:"Podana godzina musi zawierać się w przedziale między 00:00 a 23:59.",time24Mask:/[0-9:]/});Ext.apply(Ext.form.field.VTypes,{timerange:function(d,c){var b=d;if(!b){return false}if(c.startValueField&&(!this.valueRangeMax||(b!=this.valueRangeMax))){var e=c.up("form").down("#"+c.startValueField);e.setMaxValue(b);this.valueRangeMax=b;e.validate()}else{if(c.endValueField&&(!this.valueRangeMin||(b!=this.valueRangeMin))){var a=c.up("form").down("#"+c.endValueField);a.setMinValue(b);this.valueRangeMin=b;a.validate()}}return true},timerangeText:"Wartość początkowa musi być mniejsza od wartości końcowej"});Ext.apply(Ext.form.field.VTypes,{daterange:function(d,c){var b=c.parseDate(d);if(!b){return false}if(c.startDateField&&(!this.dateRangeMax||(b.getTime()!=this.dateRangeMax.getTime()))){var e=c.up("form").down("#"+c.startDateField);e.setMaxValue(b);e.validate();this.dateRangeMax=b}else{if(c.endDateField&&(!this.dateRangeMin||(b.getTime()!=this.dateRangeMin.getTime()))){var a=c.up("form").down("#"+c.endDateField);a.setMinValue(b);a.validate();this.dateRangeMin=b}}return true},daterangeText:"Data początku nie może być datą późniejszą niż data końca."});Ext.Loader.setConfig({enabled:true,paths:{"Ext.ux":"Js/ux"}});Ext.onReady(function(){Ext.application({name:"Vulcan.Common.ExtJS",appFolder:"Js",requires:["Vulcan.Common.ExtJS.controller.abstract.AbstractEditController","Vulcan.Common.ExtJS.controller.abstract.AbstractGridController","Vulcan.Common.ExtJS.controller.abstract.AbstractMassEditController","Vulcan.Common.ExtJS.controller.editor.VEditorController","Vulcan.Common.ExtJS.controller.editor.VFilterWindowController","Vulcan.Common.ExtJS.controller.editor.VGridEditorController","Vulcan.Common.ExtJS.controller.editor.VModelEditorController","Vulcan.Common.ExtJS.controller.editor.VWizardController","Vulcan.Common.ExtJS.controller.generic.GenericEditController","Vulcan.Common.ExtJS.controller.generic.GenericGridController","Vulcan.Common.ExtJS.controller.generic.GenericMassEditController","Vulcan.Common.ExtJS.controller.generic.GenericSortController","Vulcan.Common.ExtJS.controller.generic.GenericTemplatedItemSelectorController","Vulcan.Common.ExtJS.controller.AccessDeniedController","Vulcan.Common.ExtJS.controller.BaseTabController","Vulcan.Common.ExtJS.controller.BaseTabPanelController","Vulcan.Common.ExtJS.controller.BaseTreeSubController","Vulcan.Common.ExtJS.controller.BlankController","Vulcan.Common.ExtJS.controller.MainTreeController","Vulcan.Common.ExtJS.controller.VControllerBase","Vulcan.Common.ExtJS.controller.VMasterController","Vulcan.Common.ExtJS.mixin.TreeControllerMixin","Vulcan.Common.ExtJS.model.helpers.GenericMapping","Vulcan.Common.ExtJS.model.helpers.GenericMappingField","Vulcan.Common.ExtJS.model.ui.ComboBoxIntModel","Vulcan.Common.ExtJS.model.AbstractModel","Vulcan.Common.ExtJS.model.FeedbackModel","Vulcan.Common.ExtJS.model.FilterModel","Vulcan.Common.ExtJS.model.TreeModel","Vulcan.Common.ExtJS.model.ValdictModel","Vulcan.Common.ExtJS.store.statics.AbstractStaticStore","Vulcan.Common.ExtJS.store.statics.GenderStore","Vulcan.Common.ExtJS.store.statics.YesNoStore","Vulcan.Common.ExtJS.store.AbstractFilterStore","Vulcan.Common.ExtJS.store.AbstractStore","Vulcan.Common.ExtJS.store.AbstractTreeStore","Vulcan.Common.ExtJS.store.ValdictStore","Vulcan.Common.ExtJS.view.abstract.AbstractEditView","Vulcan.Common.ExtJS.view.abstract.AbstractGridView","Vulcan.Common.ExtJS.view.abstract.AbstractRibbonView","Vulcan.Common.ExtJS.view.abstract.AbstractSortView","Vulcan.Common.ExtJS.view.blank.AccessDeniedView","Vulcan.Common.ExtJS.view.blank.BlankView","Vulcan.Common.ExtJS.view.blank.LogoView","Vulcan.Common.ExtJS.view.generic.GenericEditView","Vulcan.Common.ExtJS.view.generic.GenericGridView","Vulcan.Common.ExtJS.view.generic.GenericMassEditView","Vulcan.Common.ExtJS.view.generic.GenericPreviewView","Vulcan.Common.ExtJS.view.generic.GenericSortView","Vulcan.Common.ExtJS.view.generic.GenericTemplatedItemSelectorView","Vulcan.Common.ExtJS.view.master.InfoPanelView","Vulcan.Common.ExtJS.view.master.MainTreePanel","Vulcan.Common.ExtJS.view.master.StopkaView","Vulcan.Common.ExtJS.view.master.VViewport","Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget","Vulcan.Common.ExtJS.widget.abstract.VModelAbstract","Vulcan.Common.ExtJS.widget.mixin.CfgProperties","Vulcan.Common.ExtJS.widget.mixin.Guarded","Vulcan.Common.ExtJS.widget.mixin.Stateful","Vulcan.Common.ExtJS.widget.mixin.VGenericAddController","Vulcan.Common.ExtJS.widget.mixin.VWindowController","Vulcan.Common.ExtJS.widget.model.VModelEditor","Vulcan.Common.ExtJS.widget.model.VModelForm","Vulcan.Common.ExtJS.widget.model.VModelSection","Vulcan.Common.ExtJS.widget.model.VModelSectionPanel","Vulcan.Common.ExtJS.widget.model.VVariableModelSection","Vulcan.Common.ExtJS.widget.picker.VTimePicker","Vulcan.Common.ExtJS.widget.window.VDetails","Vulcan.Common.ExtJS.widget.window.VEditor","Vulcan.Common.ExtJS.widget.window.VFilterWindow","Vulcan.Common.ExtJS.widget.window.VGridEditor","Vulcan.Common.ExtJS.widget.window.VWizard","Vulcan.Common.ExtJS.widget.IconLabel","Vulcan.Common.ExtJS.widget.VAccordPanel","Vulcan.Common.ExtJS.widget.Valdict","Vulcan.Common.ExtJS.widget.VBackendTask","Vulcan.Common.ExtJS.widget.VBackendTaskArchive","Vulcan.Common.ExtJS.widget.VBackendTaskItem","Vulcan.Common.ExtJS.widget.VBadgesButton","Vulcan.Common.ExtJS.widget.VClipboardButton","Vulcan.Common.ExtJS.widget.VFileField","Vulcan.Common.ExtJS.widget.VGrid","Vulcan.Common.ExtJS.widget.VHr","Vulcan.Common.ExtJS.widget.VImageButton","Vulcan.Common.ExtJS.widget.VImgFileField","Vulcan.Common.ExtJS.widget.VMonthPicker","Vulcan.Common.ExtJS.widget.VOrgPanel","Vulcan.Common.ExtJS.widget.VPivotGrid","Vulcan.Common.ExtJS.widget.VPropertyGrid","Vulcan.Common.ExtJS.widget.VPropertyGrid2","Vulcan.Common.ExtJS.widget.VSwitchPanel","Vulcan.Common.ExtJS.widget.VTime","Vulcan.Common.ExtJS.plugin.combobox.FilterExtension","Vulcan.Common.ExtJS.plugin.grid.CheckboxExtension","Vulcan.Common.ExtJS.plugin.grid.GroupedCheckboxExtension","Vulcan.Common.ExtJS.plugin.grid.VCellEditing","Vulcan.Common.ExtJS.plugin.grid.VExcelCopyPaste","Vulcan.Common.ExtJS.utils.cache.CacheEngine","Vulcan.Common.ExtJS.utils.cache.CacheItem","Vulcan.Common.ExtJS.utils.derendering.BooleanColumnDerenderer","Vulcan.Common.ExtJS.utils.derendering.DateColumnDerenderer","Vulcan.Common.ExtJS.utils.derendering.StoreColumnColumnDerenderer","Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper","Vulcan.Common.ExtJS.utils.helpers.BankAccountHelper","Vulcan.Common.ExtJS.utils.helpers.Base64Helper","Vulcan.Common.ExtJS.utils.helpers.ContainerHelper","Vulcan.Common.ExtJS.utils.helpers.DateHelper","Vulcan.Common.ExtJS.utils.helpers.FilterHelper","Vulcan.Common.ExtJS.utils.helpers.FormHelper","Vulcan.Common.ExtJS.utils.helpers.GridHelper","Vulcan.Common.ExtJS.utils.helpers.LocalizationHelper","Vulcan.Common.ExtJS.utils.helpers.MathHelper","Vulcan.Common.ExtJS.utils.helpers.ModelHelper","Vulcan.Common.ExtJS.utils.helpers.ParamHelper","Vulcan.Common.ExtJS.utils.helpers.RenderHelper","Vulcan.Common.ExtJS.utils.helpers.SecurityHelper","Vulcan.Common.ExtJS.utils.helpers.StoreHelper","Vulcan.Common.ExtJS.utils.helpers.ValidationHelper","Vulcan.Common.ExtJS.utils.mixin.ControlMixin","Vulcan.Common.ExtJS.utils.security.AccessGuardian","Vulcan.Common.ExtJS.utils.security.AccessLevel","Vulcan.Common.ExtJS.utils.validation.BankAccountValidator","Vulcan.Common.ExtJS.utils.validation.EmailValidator","Vulcan.Common.ExtJS.utils.validation.FormatValidator","Vulcan.Common.ExtJS.utils.validation.LengthValidator","Vulcan.Common.ExtJS.utils.validation.NipValidator","Vulcan.Common.ExtJS.utils.validation.PeselValidator","Vulcan.Common.ExtJS.utils.validation.PostCodeValidator","Vulcan.Common.ExtJS.utils.validation.PresenceValidator","Vulcan.Common.ExtJS.utils.validation.RangeValidator","Vulcan.Common.ExtJS.utils.validation.RegonValidator","Vulcan.Common.ExtJS.utils.validation.SelectedValidator","Vulcan.Common.ExtJS.utils.validation.UniqueValidator","Vulcan.Common.ExtJS.utils.ClipboardManager","Vulcan.Common.ExtJS.utils.ContextHelp","Vulcan.Common.ExtJS.utils.ContextHelpManager","Vulcan.Common.ExtJS.utils.FilterManager","Vulcan.Common.ExtJS.utils.Link","Vulcan.Common.ExtJS.utils.Log","Vulcan.Common.ExtJS.utils.LogLevel","Vulcan.Common.ExtJS.utils.MessageBus","Vulcan.Common.ExtJS.utils.MessageBusEvents","Vulcan.Common.ExtJS.utils.RolesManager","Vulcan.Common.ExtJS.utils.Settings","Vulcan.Common.ExtJS.utils.StatusCodes"]})});Ext.define("Vulcan.Common.ExtJS.controller.VControllerBase",{extend:"Ext.app.Controller",subController:null,control:function(g){var f=this;var c;var e={};for(var b=1;b<arguments.length;b++){c=Vulcan.Common.ExtJS.utils.helpers.ContainerHelper.getComponents(arguments[b]);e=Ext.merge(e,c)}for(var a in g){var d=e[a];if(d){d.on(g[a]);delete g[a]}}f.callParent(arguments)},launch:function(){var b=this,a=b.$className;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("launch controller "+a)},update:function(){var b=this,a=b.$className;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("update controller "+a)},addController:function(b,a){var c=App.addController(b,a);return c},addAndLaunchController:function(b,e,a){var c=this,d=App.addController(b,a);c.launchController(d,e);return d},launchController:function(a,b){if(a&&typeof a.launch=="function"){a.launch(b)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Brak metody launch w kontrolerze "+a)}},replaceContent:function(a,c){var b=this;if(a.getComponent(c)==c){return}a.removeAll(true);if(c instanceof Ext.Component){a.add(c)}else{a.update(c)}},replaceCenterContent:function(d,a){var c=this;c.replaceContent(c.getCenterCnt(),d);if(typeof a=="undefined"){return}if(a){c.loadTree()}else{var b=c.getTreeCnt();if(b){b.removeAll(true);b.expand();b.hide()}}},selectRibbonItem:function(b,a){var c=this;Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.selectRibbonItem,b,a)},showRibbonContextTab:function(a){var b=this;Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.toggleRibbonContextTab,a,false)},hideRibbonContextTab:function(a){var b=this;Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.toggleRibbonContextTab,a,true)},addBackendTask:function(a,b){var c=this;Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.addBackendTask,a,b)},isEventListenerDefined:function(a){var b=this;return Ext.isDefined(b.events[a])&&Ext.isDefined(b.events[a].listeners)&&b.events[a].listeners.length>0},loadTree:function(){var a="for tree functionality the controller should inherit from Vulcan.Common.ExtJS.controller.BaseTreeSubController";Vulcan.Common.ExtJS.utils.Log.getLogger().warn(a)},getCurrentTreeItem:function(){var b=this,c=b.getController("Vulcan.Common.ExtJS.controller.MainTreeController"),a=null;if(c){a=c.currentTreeItem}return a},getCurrentTreeItemObjectDataProperty:function(c){var b=this,a=b.getCurrentTreeItem();return((a&&a.data&&a.data.objectData)?a.data.objectData[c]:undefined)},init:function(){var a=this;a.callParent(arguments);a.addEvents("beforedestroy")},constructor:function(a){Ext.apply(this,a);var c=this,b=[{ref:"centerCnt",selector:"#center-container"},{ref:"treeCnt",selector:"#west-container"},{ref:"treePanel",selector:"#west-container > #main-tree-panel"}];c.refs=c.refs?Ext.Array.merge(c.refs,b):b;c.callParent(arguments)},destroy:function(){var d=this,b=d.$className;if(d.fireEvent("beforedestroy",d)===false){return}if(d.subController!==null&&d.subController instanceof Vulcan.Common.ExtJS.controller.VControllerBase){d.subController.destroy();d.subController=null}d.clearManagedListeners();var a=d.application.eventbus.bus;for(sel in a){if(!a.hasOwnProperty(sel)){continue}for(ctr in a[sel]){if(!a[sel].hasOwnProperty(ctr)){continue}for(ctrId in a[sel][ctr]){if(!a[sel][ctr].hasOwnProperty(ctrId)||!Ext.String.endsWith(b,ctrId)){continue}delete a[sel][ctr][ctrId]}}}var c=false;if(d.id){c=d.application.controllers.remove(d.getController(d.id))}else{c=d.application.controllers.remove(d)}if(d.viewInstance instanceof Ext.Component){d.viewInstance.destroy()}delete d;if(c){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("destroyed controller "+b)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().warn("failed to destroy controller "+b)}}});Ext.define("Vulcan.Common.ExtJS.mixin.TreeControllerMixin",{treeItemChanging:function(c,a,d){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("treeItemChanging poprzedni element: "+(a!==null?a.get("text"):"")+" nastepny: "+d.get("text"));var b=this},treeItemChanged:function(c,a,d){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("treeItemChanged poprzedni element: "+(a!==null?a.get("text"):"")+" nastepny: "+d.get("text"));var b=this;if(d.raw.ctr){b.subController=b.addAndLaunchController(d.raw.ctr,d.raw.param)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().debug("Brak atrybutu ctr na elemencie drzewa "+d.get("text"))}},launch:function(a){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("launch mixin TreeControllerMixin");a.loadTree()}});Ext.define("Vulcan.Common.ExtJS.model.helpers.GenericMapping",{name:"default",config:{createTitle:"Dodanie",editTitle:"Edycja",previewTitle:"Podgląd",canDelete:true},fields:null,assignFromFieldsDefinition:function(b){var a=this;a.fields.each(function(d){for(var c=0;c<b.length;c++){if(b[c].name==d.getField()){d.assignFromFieldsDefinition(b[c]);break}}})},getName:function(){var a=this;return a.name},constructor:function(b,d){var h=this;h.callParent(arguments);h.fields=Ext.create("Ext.util.MixedCollection");var a=null;if(b&&b.extend&&d&&d[b.extend]){a=d[b.extend]}if(a){h.initConfig(a.config);h.fields=a.fields.clone();h.setConfig(b)}else{h.initConfig(b)}if(b){if(b.name){h.name=b.name}}var e=b.fields;if(e&&e.length>0){for(var c=0;c<e.length;c++){var g=Ext.create("Vulcan.Common.ExtJS.model.helpers.GenericMappingField",e[c]);if(g.getField()){var l=h.fields.findBy(function(f){if(f.getField()===g.getField()){return true}});if(l){var k=g.getField();g=Ext.create("Vulcan.Common.ExtJS.model.helpers.GenericMappingField",e[c],l);h.fields.replace(k,g)}else{h.fields.add(g.getField(),g)}}}}}});Ext.define("Vulcan.Common.ExtJS.model.helpers.GenericMappingField",{paramsModelRegExp:new RegExp("{(.+)}"),config:{field:null,type:null,label:null,format:null,height:null,width:null,mask:null,filter:null,minWidth:null,decimalPrecision:2,maxWidth:null,step:null,tdCls:null,store:null,storeDisplayField:"display",storeDisplay:"display",storeValueField:"value",storeValue:"value",storeAllowNull:false,storeAllowNullLabel:"(nie wybrano)",storeDefaultSelection:"none",storeParams:null,renderer:null,rendererTriggers:null,canEdit:true,excludeFromGrid:false,excludeFromEditor:false,excludeFromSection:false,visibleOnEdit:true,visibleOnCreate:true,allowBlank:true,cfgGridColumn:{},cfgExtra:{},editor:null,valdict:null,gridHeaderExtraHtml:null,summaryType:null,summaryRenderer:null},isAllowBlankExplicit:function(){var a=this;return Ext.isDefined(a.config.allowBlank)},assignFromFieldsDefinition:function(a){var b=this;if(!b.getType()){try{b.setType(a.type.type)}catch(c){}}if(!b.getStep()){return b.setStep(0)}if(!b.getRenderer()){switch(b.getType()){case"time24":b.setRenderer(Vulcan.Common.ExtJS.utils.helpers.RenderHelper.time24);break}}if(!b.getRendererTriggers()){try{b.setRendererTriggers(a.computeTriggers)}catch(c){}}},getStoreInstance:function(c){var d=this;var b={source:d.getStore(),params:d.getStoreParams(),policy:"create",config:{},nullLabel:d.getStoreAllowNullLabel(),showNullLabel:false};if(Ext.isObject(d.getStore())&&!(d.getStore() instanceof Ext.data.Store)){b=Ext.apply(b,d.getStore())}var a=null;if(b.source instanceof Ext.data.Store){a=b.source}else{switch(b.policy){case"cache":a=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(b.source,true,false,b.params,b.config);break;case"create":a=Ext.create(b.source,b.config);if(b.params&&Ext.isFunction(a.loadByParams)){var f=Ext.clone(b.params);var e=f.data||f;if(c instanceof Ext.data.Model){Ext.Object.each(e,function(h,k,l){var g=d.paramsModelRegExp.exec(k);if(g){l[h]=c.get(g[1])}})}a.loadByParams(f)}else{a.load()}break;default:log.error("Unkown store policy: "+b.policy);break}}return a},setValdictStore:function(){var a=this;a.setStore({source:"Vulcan.Common.ExtJS.store.ValdictStore",config:{storeId:"valdict-"+a.getValdict()},params:{data:{field:a.getValdict()}},policy:"cache",displayField:"Nazwa",valueField:"Nazwa"})},constructor:function(a,b){var c=this;c.callParent(arguments);if(b){c.initConfig(b.config);c.setConfig(a)}else{c.initConfig(a)}if(!c.getLabel()){c.setLabel(a.field)}if(c.getType()==="valdict"){if(!c.getValdict()){c.setValdict(c.getField())}if(c.getStore()===null){c.setValdictStore()}}if(Ext.isObject(c.getStore())){c.setStoreValueField(c.getStore().valueField);c.setStoreDisplayField(c.getStore().displayField);c.setStoreParams(c.getStore().params);c.setStoreAllowNull(c.getStore().allowNull);c.setStoreAllowNullLabel(c.getStore().allowNullLabel||c.getStore().nullLabel);c.setStoreDefaultSelection(c.getStore().defaultSelection)}if(a.storeValue){c.setStoreValueField(c.getStoreValue())}if(a.storeDisplay){c.setStoreDisplayField(c.getStoreDisplay())}}});Ext.define("Vulcan.Common.ExtJS.model.ui.ComboBoxIntModel",{extend:"Ext.data.Model",fields:[{name:"value",type:"int"},{name:"display",type:"string"}],idProperty:"value",toString:function(){var a=this;return a.get("display")}});Ext.define("Vulcan.Common.ExtJS.model.AbstractModel",{extend:"Ext.data.Model",requires:["Vulcan.Common.ExtJS.model.helpers.GenericMappingField"],proxyController:null,proxyControllerSelectAction:"Select",proxyControllerInsertAction:"Insert",proxyControllerUpdateAction:"Update",proxyControllerDeleteAction:"Delete",dotnetController:null,genericMappings:null,preValidate:function(a){var b=this;if(a){if(b.validations){Ext.each(b.validations,function(c){if(c.type==="unique"){c.store=a.store;c.model=a.model}})}}},setProxyController:function(){var c=this;if(!c.proxyController&&c.dotnetController){c.proxyController=c.dotnetController}if(c.proxyController){var a=Vulcan.Common.ExtJS.utils.helpers.ParamHelper;var b=Ext.clone(Vulcan.Common.ExtJS.model.AbstractModel.defaultProxyBase);b.api={create:a.getActionUrl(c.proxyController,c.proxyControllerInsertAction),read:a.getActionUrl(c.proxyController,c.proxyControllerSelectAction),update:a.getActionUrl(c.proxyController,c.proxyControllerUpdateAction),destroy:a.getActionUrl(c.proxyController,c.proxyControllerDeleteAction)};c.setProxy(b)}},fields:[{name:"Id",type:"int"}],idProperty:"Id",toString:function(){var a=this;return a.$className+"["+a.getId()+"]"},get:function(c){var a=this;if(a.fields&&a.fields.get){var b=a.fields.get(c);if(b){if(b.computeFunction){return Ext.bind(b.computeFunction,a)()}if(Ext.isFunction(b.getter)){return Ext.bind(b.getter,a)()}}}return a.callParent(arguments)},set:function(){var b=this,d={},e=null,c=null;var a=b.callParent(arguments);if(arguments.length==1){d=arguments[0]}if(arguments.length==2){d[arguments[0]]=arguments[1];e=arguments[0];c=arguments[1]}if(b.fields){b.fields.each(function(f){if(Ext.isFunction(f.setter)){Ext.Object.each(d,function(g,h){if(f.name==g){Ext.bind(f.setter,b)(h)}})}if(f.computeTriggers&&Ext.Array.contains(f.computeTriggers,e)){if(f.computeFunction){b.set(f.name,Ext.bind(f.computeFunction,b)())}}})}if(a!==null){b.fireEvent("modelchanged",b,a)}return a},getPersistData:function(){var b=this,a=b.getData();b.fields.each(function(c){if(c.persist===false){delete a[c.name]}});return a},constructor:function(){var a=this;a.callParent(arguments);if(!a.self.genericMappingsConfig){a.self.genericMappingsConfig=a.genericMappings}delete a.genericMappings;if(!a.self.validations){a.self.validations=a.validations}if(!a.self.warnings){a.self.warnings=a.warnings}delete a.warnings;if(!a.self.tips){a.self.tips=a.tips}delete a.tips;a.validate=Ext.Function.createInterceptor(a.validate,a.preValidate,a);a.save=Ext.Function.createInterceptor(a.save,a.setProxyController,a);a.destroy=Ext.Function.createInterceptor(a.destroy,a.setProxyController,a);a.addEvents("modelchanged")},init:function(){},getGenericMapping:function(b){var a=this;return a.self.getGenericMapping(b)},getGenericMappingField:function(c,b){var a=this;return a.self.getGenericMappingField(c,b)},inheritableStatics:{groupByName:function(b){var a={};Ext.Array.each(b,function(c){if(c.field){if(!Ext.isArray(a[c.field])){a[c.field]=[]}a[c.field].push(c)}});return a},tips:null,getTips:function(b){var a=this;if(!Ext.isObject(a.tips)){Ext.create(a);a.tips=a.groupByName(a.tips)}if(b){if(a.tips[b]){return a.tips[b]}else{return[]}}else{return a.tips}},warnings:null,getWarnings:function(b){var a=this;if(!Ext.isObject(a.warnings)){Ext.create(a);a.warnings=a.groupByName(a.warnings)}if(b){if(a.warnings[b]){return a.warnings[b]}else{return[]}}else{return a.warnings}},validations:null,getValidations:function(b){var a=this;if(!Ext.isObject(a.validations)){Ext.create(a);a.validations=a.groupByName(a.validations)}if(a.validations[b]){return a.validations[b]}else{return[]}},genericMappings:null,genericMappingsConfig:null,initGenericMappings:function(){var e=this;var b=e.getFields();if(!e.genericMappingsConfig){var c=Ext.create(this)}var f=e.genericMappingsConfig;e.genericMappings=[];if(!Ext.isDefined(f.length)){f=[f]}if(f.length){for(var d=0;d<f.length;d++){var a=Ext.create("Vulcan.Common.ExtJS.model.helpers.GenericMapping",f[d],e.genericMappings);a.assignFromFieldsDefinition(b);e.genericMappings[a.getName()]=a}}},getGenericMapping:function(c){var b=this;if(!b.genericMappings){b.initGenericMappings()}if(c){return b.genericMappings[c]}else{for(var a in b.genericMappings){return b.genericMappings[a]}}},getGenericMappingField:function(d,c){var b=this;var a=b.getGenericMapping(c);if(a){return a.fields.getByKey(d)}else{return null}},defaultProxyBase:{type:"ajax",reader:{type:"json",allowSingle:false,root:"data",successProperty:"success"},writer:{type:"json",allowSingle:false}}}},function(){Vulcan.Common.ExtJS.model.AbstractModel.__overridenLoad=Vulcan.Common.ExtJS.model.AbstractModel.load;Vulcan.Common.ExtJS.model.AbstractModel.load=function(){var b=this;if(!b.isProxyControllerSet){var a=Ext.create(b);a.setProxyController();b.setProxy(a.getProxy());b.isProxyControllerSet=true}return Ext.callback(Vulcan.Common.ExtJS.model.AbstractModel.__overridenLoad,b,arguments)};Vulcan.Common.ExtJS.model.AbstractModel.prototype.proxy=Vulcan.Common.ExtJS.model.AbstractModel.defaultProxyBase});Ext.define("Vulcan.Common.ExtJS.model.FilterModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string",mapping:"Id"},{name:"model",type:"string",mapping:"Model"},{name:"name",type:"string",mapping:"Name"},{name:"filterFn",mapping:"FilterFn"},{name:"submenu",mapping:"Submenu"}],idProperty:"id"});Ext.define("Vulcan.Common.ExtJS.model.TreeModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"string",mapping:"Id"},{name:"modelType",type:"string",mapping:"ModelType"},{name:"modelId",type:"int",mapping:"ModelId"},{name:"text",type:"string",mapping:"Text"},{name:"cls",type:"string",mapping:"Cls"},{name:"url",type:"string",mapping:"Url"},{name:"ctrid",type:"string",mapping:"CtrId"},{name:"ctrCfg",mapping:"CtrCfg"},{name:"tooltip",type:"string",mapping:"Tooltip"},{name:"qtitle",type:"string",mapping:"Qtitle"},{name:"icon",type:"string",mapping:"Icon"},{name:"iconCls",type:"string",mapping:"IconCls"},{name:"useCases",mapping:"UseCases"},{name:"leaf",type:"boolean",mapping:"Leaf"},{name:"loaded",type:"boolean",mapping:"Loaded"},{name:"expanded",defaultValue:false,mapping:"Expanded"},{name:"objectData",mapping:"ObjectData"},{name:"maxAccessLevel",type:"string",mapping:"MaxAccessLevel"},{name:"qtip",convert:function(){return null}}],idProperty:"id"});Ext.define("Vulcan.Common.ExtJS.model.ValdictModel",{extend:"Vulcan.Common.ExtJS.model.AbstractModel",fields:[{name:"Nazwa",type:"string"}]});Ext.define("Vulcan.Common.ExtJS.store.AbstractStore",{extend:"Ext.data.Store",canCache:true,autoLoad:false,proxyController:null,dotnetController:null,proxyControllerSelectAction:"Select",proxyControllerInsertAction:"Insert",proxyControllerUpdateAction:"Update",proxyControllerDeleteAction:"Delete",constructor:function(a){var c=this,b=(!c.getProxy());c.callParent(arguments);if(b){c.setProxyController()}},getProxyController:function(){var a=this;if(!a.proxyController&&a.dotnetController){a.proxyController=a.dotnetController}return a.proxyController},setProxyController:function(){var c=this;if(c.getProxyController()){var a=Vulcan.Common.ExtJS.utils.helpers.ParamHelper;var b={type:"ajax",reader:{type:"json",allowSingle:false,root:"data",successProperty:"success"},writer:{type:"json",allowSingle:false},api:{create:a.getActionUrl(c.getProxyController(),c.proxyControllerInsertAction),read:a.getActionUrl(c.getProxyController(),c.proxyControllerSelectAction),update:a.getActionUrl(c.getProxyController(),c.proxyControllerUpdateAction),destroy:a.getActionUrl(c.getProxyController(),c.proxyControllerDeleteAction)}};c.setProxy(b)}},insertBlank:function(a,b){var c=this;var d=c.getById(0);if(!a){a="DisplayField"}if(!b){b="(brak)"}if(!d){d=Ext.create(c.model,{Id:0});d.set(a,b);c.insert(0,[d])}return d},getAllRecords:function(){var a=this;return a.data.items},replaceModelContent:function(a){var b=this;var d;var c=-1;if(b.snapshot){c=-1;d=b.snapshot.items;Ext.Array.each(d,function(f,e){if(f.getId()==a.getId()){c=e;return false}});if(c!==-1){b.snapshot.removeAt(c);b.snapshot.insert(c,a)}}d=b.data.items;Ext.Array.each(d,function(f,e){if(f.getId()==a.getId()){c=e;return false}});if(c!==-1){b.removeAt(c);b.insert(c,a)}},loadByParams:function(e){var b=this;var a=b.getProxyController();if(Ext.isDefined(e.controller)){a=e.controller}var d=b.proxyControllerSelectAction;if(e.action){d=e.action}var c=e.data||e;b.load({url:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.getActionUrl(a,d),params:c})},getByFk:function(b,c,e){var d=this,a=0;if(e){a=e}return d.findRecord(b,c,a,false,false,true)}});Ext.define("Vulcan.Common.ExtJS.store.AbstractTreeStore",{extend:"Ext.data.TreeStore",model:"Vulcan.Common.ExtJS.model.TreeModel",autoLoad:false,rootVisible:true,proxyAction:"GetTree",getProxyAction:function(){var a=this;return a.proxyAction},proxyController:null,getProxyController:function(){var a=this;return a.proxyController},setProxyController:function(){var c=this;if(c.getProxyController()){var a=Vulcan.Common.ExtJS.utils.helpers.ParamHelper;var b={type:"ajax",url:a.getActionUrl(c.getProxyController(),c.getProxyAction()),reader:{type:"json"}};c.setProxy(b)}},listeners:{beforeload:{fn:function(b,a){var c=this;c.setProxyController();a.params={modelType:a.node.get("modelType"),modelId:a.node.get("modelId")}}},beforesync:{fn:function(){var a=this;a.setProxyController()},single:true}}});Ext.define("Vulcan.Common.ExtJS.store.ValdictStore",{extend:"Vulcan.Common.ExtJS.store.AbstractStore",model:"Vulcan.Common.ExtJS.model.ValdictModel",proxyController:"Valdict"});Ext.define("Vulcan.Common.ExtJS.view.abstract.AbstractEditView",{extend:"Ext.window.Window",resizable:false,frame:false,modal:true,width:500,height:0,layout:"border",border:0,autoSize:false,contentAutoScroll:true,contentLayout:"auto",focusOnToFront:true,additionalButtonsOnLeft:[],additionalButtonsOnRight:[],initComponent:function(){var a=this;a.initSize();a.initDefaults();a.initButtons();a.initCardPanel();a.initDialogLayout();a.on("afterrender",a.resizeToContents);a.callParent(arguments)},navigateNext:function(){var a=this;if(a.isCurrentFormValid()){a.navigate(a.cardPanel.getLayout().getNext())}},navigatePrev:function(){var a=this;a.navigate(a.cardPanel.getLayout().getPrev())},navigate:function(c){var b=this;var a=b.cardPanel.getLayout();a.setActiveItem(c);b.prevButton.setVisible(!!a.getPrev());b.nextButton.setVisible(!!a.getNext());b.saveButton.setVisible(!a.getNext())},addContentPanel:function(a,c){var b=this;if(c||!b.cardPanel.items.contains(a)){b.cardPanel.add(a);b.navigate(b.cardPanel.getLayout().getActiveItem())}},removeContentPanel:function(b){var c=this;var a=c.cardPanel.getLayout().getActiveItem();c.cardPanel.remove(b,false);if(a){c.navigate(a)}else{if(c.cardPanel.items.length>0){c.navigate(0)}}},initSize:function(){var a=this;var b=a.getBrowserWindowSize();a.maxWidth=b.width;a.maxHeight=b.height},initDefaults:function(){var a=this;Ext.applyIf(a,{contentPanel:Ext.create("Ext.panel.Panel",{layout:"border",items:[{xtype:"label",region:"center",text:"This functionality is not implemented yet."}]}),contentPanels:null})},initButtons:function(){var b=this;var a={margin:3,width:60};a.text="Wstecz";a.hidden=true;a.iconCls="icon-back";b.prevButton=Ext.create("Ext.button.Button",a);a.text="Dalej";a.hidden=true;a.iconCls="icon-foreward";b.nextButton=Ext.create("Ext.button.Button",a);a.text="Anuluj";a.hidden=false;a.iconCls="icon-cancel";b.cancelButton=Ext.create("Ext.button.Button",a);a.text="Zapisz";a.hidden=false;a.iconCls="icon-ok";b.saveButton=Ext.create("Ext.button.Button",a);a.text="Usuń";a.hidden=true;a.iconCls="icon-del";b.deleteButton=Ext.create("Ext.button.Button",a);a.text="Ok";a.hidden=true;a.iconCls="icon-ok";b.okButton=Ext.create("Ext.button.Button",a)},initCardPanel:function(){var a=this;var b=null;if(a.contentPanels&&a.contentPanels.length){b=a.contentPanels;if(a.contentPanels.length>1){a.prevButton.setVisible(false);a.nextButton.setVisible(true);a.saveButton.setVisible(false)}}else{b=[a.contentPanel]}if(b&&Ext.isArray(b)){Ext.Array.each(b,function(c){if(c.setAutoScroll){c.setAutoScroll(a.contentAutoScroll)}})}a.cardPanel=Ext.create("Ext.panel.Panel",{region:"center",frame:false,autoScroll:a.contentAutoScroll,bodyPadding:10,layout:"card",items:b})},initDialogLayout:function(){var b=this;var a=[];if(b.additionalButtonsOnLeft&&Ext.isArray(b.additionalButtonsOnLeft)){Ext.Array.push(a,b.additionalButtonsOnLeft)}Ext.Array.push(a,{xtype:"tbspacer",flex:1});if(b.additionalButtonsOnRight&&Ext.isArray(b.additionalButtonsOnRight)){Ext.Array.push(a,b.additionalButtonsOnRight)}Ext.Array.push(a,b.prevButton,b.nextButton,b.saveButton,b.deleteButton,b.cancelButton,b.okButton);b.items=[{xtype:"panel",region:"south",frame:false,height:35,layout:"hbox",bodyPadding:3,allowDepress:false,bodyStyle:"border-top-width: 0px;",items:a},b.cardPanel]},areFormsValid:function(){var d=this;var b=this.getForms();var a=true;for(var c=0;c<b.length;c++){a&=b[c].isValid()}return a},isCurrentFormValid:function(){var a=this;return a.cardPanel.getLayout().getActiveItem().getForm().isValid()},getForms:function(){var b=this;var a=[];b.cardPanel.items.each(function(c){var d=c.getForm();if(d){a.push(d)}});return a},resizeToContents:function(g,d){var f=this,c,b={width:f.width,height:90},h,e,a;if(!g.autoSize){return}if(f.cardPanel){f.cardPanel.items.each(function(k){var l=90;if(!k.items){l+=k.getHeight()+5}else{k.items.each(function(n){if(n.isXType("panel")||n.isXType("container")){var m=n.down();if(m){n=m}}l+=n.getHeight()+5})}b.height=Math.max(b.height,l)})}g.setSize(b)},getBrowserWindowSize:function(){var b=0,a=0;if(typeof(window.innerWidth)=="number"){b=window.innerWidth;a=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){b=document.documentElement.clientWidth;a=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){b=document.body.clientWidth;a=document.body.clientHeight}}}return{width:b,height:a}}});var ribbonHeight=96;var tabHeight=79;var largeBtnWidth=60;var smallBtnWidth=75;Ext.define("Vulcan.Common.ExtJS.view.abstract.AbstractRibbonView",{extend:"Ext.panel.Panel",preventHeader:true,height:ribbonHeight,minHeight:ribbonHeight,maxHeight:ribbonHeight,layout:{type:"hbox"},cls:"ribbon",defaultHidden:false,ribbonItems:[],contextTabs:[],userSectionItem:undefined,startTab:0,startButton:null,useHistory:false,historyAutoSelectOnStart:true,initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init component AbstractRibbonView");var b=this;b.title=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("user");var d=[{title:'<span class="x-btn-icon-el notifications notifications-popup-selector"></span>',id:"ribbon-user-notifications-tab",height:tabHeight,width:32,tabConfig:{titleTemplateNoNotifications:'<span class="x-btn-icon-el notifications notifications-popup-selector"></span>',titleTemplate:'<span class="x-btn-icon-el notifications notifications-popup-selector"><span class="counter">{0}</span></span>',popupItems:[],popupTemplate:Ext.create("Ext.XTemplate",['<div class="notifications-popup-container"><div class="notifications-popup-content">','<tpl for=".">','<tpl if="items">','<div class="notification-entry-with-submenu">','<div class="notification-entry notifications-submenu-icon">{text}</div>','<div class="notification-entry-submenu">','<tpl for="items">',"{[this.applyParentParams(parent, values)]}",'<tpl if="items">','<div class="notification-entry-with-submenu">','<div class="notification-entry notifications-submenu-icon">{text}</div>','<div class="notification-entry-submenu">','<tpl for="items">',"{[this.applyParentParams(parent, values)]}",'<tpl if="items">','<div class="notification-entry-with-submenu">','<div class="notification-entry notifications-submenu-icon">{text}</div>','<div class="notification-entry-submenu">','<tpl for="items">',"{[this.applyParentParams(parent, values)]}",'<div class="notification-entry notification-link {extraCls}" dataEventName="{eventName}" dataObjectData="{[this.getObjectData(values.objectData)]}">{text}</div>',"</tpl>","</div>","</div>","<tpl else>",'<div class="notification-entry notification-link {extraCls}" dataEventName="{eventName}" dataObjectData="{[this.getObjectData(values.objectData)]}">{text}</div>',"</tpl>","</tpl>","</div>","</div>","<tpl else>",'<div class="notification-entry notification-link {extraCls}" dataEventName="{eventName}" dataObjectData="{[this.getObjectData(values.objectData)]}">{text}</div>',"</tpl>","</tpl>","</div>","</div>","<tpl else>",'<div class="notification-entry notification-link {extraCls}" dataEventName="{eventName}">{text}</div>',"</tpl>","</tpl>","</div></div>",{applyParentParams:function(h,g){if(!g.hasOwnProperty("eventName")&&h.hasOwnProperty("eventName")){g.eventName=h.eventName}if(!g.hasOwnProperty("extraCls")&&h.hasOwnProperty("extraCls")){g.extraCls=h.extraCls}},getObjectData:function(g){return g?encodeURIComponent(JSON.stringify(g)):""}}]).compile(),listeners:{click:function(){var h=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("notificationsUrl");var g=b.fireEvent("beforenotificationslinkclick",h);if(!!h&&g!==false){Vulcan.Common.ExtJS.utils.Link.onLinkClick(h)}},mouseover:function(){var g=this;var k=Ext.getCmp("ribbon-user-notifications-tab");if(k.tabConfig.popupItems&&k.tabConfig.popupItems.length>0){k.tabConfig.popupTemplate.append(g.el.down(".notifications-popup-selector"),k.tabConfig.popupItems);g.el.select(".notification-link").on("click",function(p,o){var m=o.getAttribute("dataEventName");var n=o.getAttribute("dataObjectData");if(m){b.fireEvent(m,n)}},b);var h=g.el.down(".notifications-popup-container");if(h){var l=k.el.getPageBox();h.setStyle({left:(l.left-h.dom.clientWidth+35)+"px"})}}},mouseout:function(){var g=this;var h=g.el.down(".notifications-popup-container");if(h){h.remove()}}}}}];var c=[{text:"Wyloguj się",id:"ribbon-logout-btn",iconCls:"logout",iconAlign:"left",width:70,lnk:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("logoutUrl"),scale:"small"},{text:"Pomoc",id:"ribbon-help-btn",iconCls:"help",iconAlign:"left",width:70,handler:function(g){Vulcan.Common.ExtJS.utils.ContextHelp.openContextHelp();g.blur()},scale:"small"}];if(Ext.isDefined(b.userSectionItem)){c.push(b.userSectionItem)}var f=[{title:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("user"),id:"ribbon-user-tab",height:tabHeight,layout:{type:"hbox"},lnk:{url:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("userUrl"),newWindow:true,newWindowFeatures:"resizable=yes, scrollbars=yes, titlebar=yes"},items:[{xtype:"image",margin:"2 5 0 5",cls:"separator"},{xtype:"buttongroup",id:"ribbonCkvButtonGroup",columns:1,items:[Ext.create("Vulcan.Common.ExtJS.widget.VBadgesButton",{id:"ckvButton",iconCls:"ckv",text:"Przejdź do Strefy Produktów",iconAlign:"top",scale:"large",width:105,minWidth:105,maxWidth:150,hidden:true,dialog:true,style:"max-width: 105px !important; border: 0;"})]},{xtype:"buttongroup",cls:"button-group",columns:1,items:c}]}];b.setRibbonItemsVisibility(b.ribbonItems,b.defaultHidden);b.setRibbonItemsVisibility(b.contextTabs,true);b.setRibbonContextTabsProperties(b.contextTabs);var e=b.ribbonItems.concat(b.contextTabs);b.setItemsProperties(e);b.setItemsProperties(d);b.setItemsProperties(f);var a=[{xtype:"tabpanel",flex:1,cls:"ribbon-tab",id:"ribbon-view-tab",items:e},{xtype:"tabpanel",cls:"ribbon-tab user-ribbon-tab",items:f}];if(!!Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("notificationsUrl")){a.splice(1,0,{xtype:"tabpanel",cls:"ribbon-tab user-ribbon-tab",style:{zIndex:1000},items:d})}b.items=a;b.callParent(arguments);Vulcan.Common.ExtJS.utils.ContextHelp.setContextContentHelpButton(Ext.getCmp("ribbon-help-btn"));b.addEvents("beforenotificationslinkclick")},setRibbonContextTabsProperties:function(a){Ext.Array.forEach(a,function(d,b,c){d.isContextTab=true;d.tabCls="context-tab"})},setRibbonItemsVisibility:function(a,b){var c=this;Ext.Array.forEach(a,function(f,d,e){if(!Ext.isDefined(f.hidden)){f.hidden=b}})},setItemsProperties:function(a){var b=this;Ext.Array.forEach(a,function(e,c,d){b.setButtonGroupProperties(e);b.setButtonProperties(e);b.setLabelProperties(e);if(e.items){b.setItemsProperties(e.items)}})},setButtonProperties:function(a){if(Ext.isDefined(a.width)){return}if(a.scale==="large"){a.width=largeBtnWidth}else{if(a.scale==="small"||a.scale==="medium"){a.width=smallBtnWidth}}},setButtonGroupProperties:function(a){if(!Ext.isDefined(a.xtype)||a.xtype!=="buttongroup"){return}if(!Ext.isDefined(a.cls)){a.cls="button-group"}},setLabelProperties:function(a){if(!Ext.isDefined(a.xtype)||a.xtype!=="label"){return}if(!Ext.isDefined(a.height)){a.height=tabHeight}if(!Ext.isDefined(a.cls)){a.cls="ribbon-info"}}});Ext.define("Vulcan.Common.ExtJS.view.abstract.AbstractSortView",{extend:"Ext.window.Window",anchor:"100% 100%",store:null,width:800,height:300,title:null,displayField:null,valueField:null,updateAction:String.emptyFn,cancelAction:String.emptyFn,sender:null,modal:true});Ext.define("Vulcan.Common.ExtJS.view.blank.AccessDeniedView",{extend:"Ext.panel.Panel",id:"accessdeniedview",alias:"widget.accessdeniedview",bodyStyle:"padding:5px;",autoScroll:true,initComponent:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init AccessDeniedView");a.html="Brak uprawnień";a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.view.blank.BlankView",{extend:"Ext.panel.Panel",id:"blank",alias:"widget.blank",layout:{type:"fit"},initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init blank");var a=this;a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.view.blank.LogoView",{extend:"Ext.panel.Panel",id:"logo-view",alias:"widget.logo-view",bodyStyle:"padding:5px;",autoScroll:true,initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init logo");var a=this;a.html='<div style="text-align: center;"><img align="center" src="'+Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("logoFile")+'"/></div>';a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.view.master.InfoPanelView",{extend:"Ext.panel.Panel",id:"info-panel",alias:"widget.info-panel",width:350,title:"Pobieranie przygotowanych plików",autoScroll:true,cls:"info-panel",tasksContainer:undefined,initComponent:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init component InfoPanelView");a.tasksContainer=Ext.widget({xtype:"container"});a.items=[a.tasksContainer,{xtype:"vbackendtaskarchive",archiveUrl:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderArchiveUrl")}];a.callParent(arguments)},addTask:function(a,b){var d=this,c;if(a instanceof Vulcan.Common.ExtJS.widget.VBackendTask){c=a}else{c=Ext.widget({xtype:"vbackendtask",title:a,guid:b})}c.addTask(d.tasksContainer,d)}});Ext.define("Vulcan.Common.ExtJS.view.master.MainTreePanel",{extend:"Ext.tree.Panel",id:"main-tree-panel",alias:"widget.main-tree-panel",width:200,hideHeaders:true,autoTree:true,layout:"fit",autoScroll:false,onBeforeToolTipShow:Ext.emptyFn,toolTipVisible:true,initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init component MainTreePanel");var a=this;a.callParent(arguments);if(!a.toolTipVisible){return}a.getView().on("afterrender",function(b){b.tip=Ext.create("Ext.tip.ToolTip",{target:b.el,delegate:b.cellSelector,trackMouse:true,renderTo:Ext.getBody(),listeners:{beforeshow:function(e){if(a.onBeforeToolTipShow()===false){return}var f=b.getGridColumns();var d=f[e.triggerElement.cellIndex];var g="",c;if((c=b.getRecord(e.triggerElement.parentNode))){g=c.get(d.dataIndex)}if(c&&c.get("tooltip")){g=c.get("tooltip")}e.update(Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(g))}}})})},currentTreeItem:null});Ext.define("Vulcan.Common.ExtJS.view.master.StopkaView",{extend:"Ext.container.Container",id:"south-container",alias:"widget.south-container",layout:{type:"vbox"},region:"south",padding:"0 0 2 5",autoEl:"footer",listeners:{afterrender:function(){var a=this;Vulcan.Common.ExtJS.utils.ContextHelp.setDebugLabel(a.down("container").getComponent("debug-label"))}},initComponent:function(){var b=this,a=[];if(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("stopkaImgUrl")){var c=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("stopkaImgBgColor");if(!c){c="#fff"}var d=Ext.create("Ext.panel.Panel",{layout:"hbox",border:0,width:"100%",bodyStyle:{background:c},items:[{xtype:"image",height:56,src:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("stopkaImgUrl")}]});b.addCls("south-banner");a.push(d)}a.push({xtype:"container",layout:{type:"hbox"},width:"100%",items:[{xtype:"label",id:"stopka-label",cls:"stopka",html:'<a href="http://www.vulcan.edu.pl/" target="_blank">VULCAN sp. z o. o., '+Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("appName")+", wersja "+Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("version")+"</a>"},{xtype:"label",cls:"stopka",itemId:"debug-label"}]});b.items=a;b.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget",{widgetError:function(c){var b=this,a=Vulcan.Common.ExtJS.utils.Log.getLogger();a.error("["+b.$className+"] "+c)},widgetTrace:function(c){var b=this,a=Vulcan.Common.ExtJS.utils.Log.getLogger();a.trace("["+b.$className+"] "+c)},widgetDebug:function(c){var b=this,a=Vulcan.Common.ExtJS.utils.Log.getLogger();a.debug("["+b.$className+"] "+c)}});Ext.define("Vulcan.Common.ExtJS.widget.abstract.VModelAbstract",{mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget"},mapping:"default",model:null,modelInstance:null,modelClass:null,getModelClass:function(){var a=this;if(!a.modelClass){if(a.model instanceof Ext.data.Model){a.modelClass=a.model.self}else{a.modelClass=Ext.ClassManager.get(a.model)}}return a.modelClass},getModel:function(){var a=this;if(!a.modelInstance){if(a.model instanceof Ext.data.Model){a.modelInstance=a.model}else{a.modelInstance=Ext.create(a.model)}}return a.modelInstance},setModel:function(a){var b=this;b.modelInstance=a},mappingInstance:null,labelWidthValue:null,getMapping:function(){var a=this;return a.getMappingInstance(a.mappingInstance,a.mapping)},getMappingInstance:function(b,d){var e=this,c=e.getModel(),a=b;if(!a){if(d instanceof Vulcan.Common.ExtJS.model.helpers.GenericMapping){a=d}else{if(Ext.isString(d)){a=c.getGenericMapping(d)}}}return a},calculateLabelWidth:function(){var c=this,b=0,a=c.getMapping();a.fields.each(function(d){var e=false;e|=(c instanceof Vulcan.Common.ExtJS.widget.model.VModelForm)&&d.getExcludeFromEditor();e|=(c instanceof Vulcan.Common.ExtJS.widget.model.VModelSection)&&d.getExcludeFromSection();if(!e){b=Math.max(b,d.getLabel().length*5+70)}});return b},getLabelWidth:function(){var a=this;if(a.labelWidthValue===null){if(a.cfgUI&&Ext.isDefined(a.cfgUI.labelWidth)){if(a.cfgUI.labelWidth==="auto"){a.labelWidthValue=a.calculateLabelWidth()}if(Ext.isNumber(a.cfgUI.labelWidth)){a.labelWidthValue=a.cfgUI.labelWidth}}}return a.labelWidthValue}});Ext.define("Vulcan.Common.ExtJS.widget.mixin.CfgProperties",{cfgPropertyPrefix:"cfg",initCfg:function(){var b=this;for(var a in b){if(Ext.isObject(b[a])&&Ext.isString(a)&&Ext.String.startsWith(a,b.cfgPropertyPrefix,true)){b[a]=Ext.apply({},b[a])}}}});Ext.define("Vulcan.Common.ExtJS.widget.mixin.Guarded",{useCases:[]});Ext.define("Vulcan.Common.ExtJS.widget.mixin.Stateful",{initStateful:function(b,a,d){var c=this;if(Ext.isDefined(b)){if(Ext.isDefined(b.stateId)){c.stateId=b.stateId;return}if(Ext.isDefined(b.id)){c.stateId=b.id;return}}if(!Ext.isDefined(b)){b={}}c.stateId=(Ext.isFunction(d)?d(b,a,c):c.generateStateId(b,a))},generateStateId:function(b,a){var c=this,d=a;if(Ext.isDefined(b.itemId)){d+=b.itemId}return d}});Ext.define("Vulcan.Common.ExtJS.widget.mixin.VWindowController",{launchWindowController:function(b,a){var c=this;var d=App.addController(b,a);d.launch();if(Ext.isString(b)&&Ext.isDefined(d.viewInstance)&&!(d instanceof Vulcan.Common.ExtJS.controller.editor.VEditorController)){d.mon(d.viewInstance,"close",function(){d.destroy()},c)}return d}});Ext.define("Vulcan.Common.ExtJS.widget.model.VModelSection",{extend:"Ext.container.Container",alias:["widget.vmodelsection","widget.v-modelsection","widget.v-model-section"],mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget",VModelAbstract:"Vulcan.Common.ExtJS.widget.abstract.VModelAbstract",Guarded:"Vulcan.Common.ExtJS.widget.mixin.Guarded",WindowController:"Vulcan.Common.ExtJS.widget.mixin.VWindowController"},cls:"v-modelsection",layout:{type:"table",tdAttrs:{valign:"top"},columns:2},readOnly:null,destroyPolicy:"section",cfgEditButton:null,cfgUI:{},cfgGenericEditor:null,cfgEditorController:{},editorController:"Vulcan.Common.ExtJS.controller.editor.VModelEditorController",editButton:null,flexibleLayout:false,allowHtmlValue:false,buttons:[],rows:[],initComponent:function(){var a=this;a.callParent(arguments);a.initDeprecated();a.initDefaults();a.initEvents();a.initSection();a.refreshData()},initDefaults:function(){var a=this;Ext.applyIf(a.cfgUI,{labelSuffix:":",labelWidth:"auto",appendEditButton:true,getCustomLabelFn:Ext.emptyFn})},initDeprecated:function(){var a=this;if(Ext.isObject(a.cfgGenericEditor)){a.cfgEditorController=Ext.applyIf(a.cfgEditorController,a.cfgGenericEditor)}if(Ext.isBoolean(a.readOnly)){a.cfgUI.appendEditButton=!a.readOnly}},initEvents:function(){var a=this;a.addEvents("checkeditaccess","beforeedit","aftersave","afterdelete")},initSection:function(){var a=this;a.initRows();a.initControls();a.initCtrContainer()},initRows:function(){var b=this,a=b.getMapping();b.rows=[];if(a){a.fields.each(function(c){if(!c.getExcludeFromSection()){var d={fieldMapping:c};d.cmpLabel=Ext.create("Ext.form.Label",{cls:"v-modelsection-label",itemId:"label-"+c.getField(),width:b.getLabelWidth(),text:(b.cfgUI.getCustomLabelFn!==Ext.emptyFn?b.cfgUI.getCustomLabelFn(c.getField(),c.getLabel()):c.getLabel())+b.cfgUI.labelSuffix});cfgCmpValue={cls:"v-modelsection-value",itemId:"value-"+c.getField(),minHeight:c.getHeight(),cellCls:"v-modelsection-value-cell",tpl:b.allowHtmlValue?"{text:htmlDecode}":"{text}"};switch(c.getType()){case"link":cfgCmpValue.tpl='<a href="{href:htmlEncode}" target="_blank">{text:htmlEncode}</a>';break;case"email":cfgCmpValue.tpl='<a href="mailto:{text:htmlEncode}">{text:htmlEncode}</a>';break}cfgCmpValue.tpl+="&nbsp;";Ext.apply(cfgCmpValue,c.getCfgExtra());d.cmpValue=Ext.create("Ext.form.Label",cfgCmpValue);if(d.cmpValue.isHidden()){d.cmpLabel.hide()}d.cmpValue.on("hide",function(){d.cmpLabel.hide()});d.cmpValue.on("show",function(){d.cmpLabel.show()});b.rows.push(d)}})}},initControls:function(){var b=this;var a={iconCls:"icon-edit",cellCls:"v-modelsection-edit-btn-cell",text:"Zmień"};if(Ext.isObject(b.cfgEditButton)){a=Ext.apply(a,b.cfgEditButton)}b.editButton=Ext.widget("button",a);b.editButton.on({click:{fn:b.handleEditButton,scope:b}})},initCtrContainer:function(){var c=[],b=this;for(var a=0;a<b.rows.length;a++){b.add([b.rows[a].cmpLabel,b.rows[a].cmpValue])}if(Ext.isDefined(b.buttons)&&b.buttons.length>0){c=b.buttons}if(b.cfgUI.appendEditButton){c.push(b.editButton)}if(c.length>0){b.add(Ext.widget("tbspacer"));if(b.flexibleLayout===true){b.add(c)}else{b.add({xtype:"container",layout:{type:"hbox",pack:"end"},items:c})}}},handleEditButton:function(){var c=this;if(c.fireEvent("checkeditaccess",c,c.getModel())===false){return}var a=c.fireEvent("beforeedit",c,c.getModel());if(a!==false){var b={mapping:c.getMapping(),model:c.getModel(),modelClass:c.getModelClass().getName(),modelInstance:c.getModel(),saveCallback:Ext.bind(c.editControllerSaveCallback,c),deleteCallback:Ext.bind(c.editControllerDeleteCallback,c)};Ext.apply(b,c.cfgEditorController);var d=c.editorController;if(d instanceof Vulcan.Common.ExtJS.controller.VControllerBase){d=Ext.apply(d,b)}d=c.launchWindowController(d,b);d.on({aftersave:{fn:c.editControllerSaveCallback,scope:c},afterdelete:{fn:c.editControllerDeleteCallback,scope:c}})}},editControllerSaveCallback:function(b){var c=this;var a=c.fireEvent("aftersave",c,b);if(a!==false){c.setModel(b)}},editControllerDeleteCallback:function(b){var d=this;var a=d.fireEvent("afterdelete",d);if(a!==false){switch(d.destroyPolicy){case"section":var c=d.nextSibling();if(c instanceof Vulcan.Common.ExtJS.widget.VHr){c.destroy()}else{c=d.previousSibling();if(c instanceof Vulcan.Common.ExtJS.widget.VHr){c.destroy()}}d.destroy();break;case"parent":d.ownerCt.destroy();break;default:d.widgetError("Unrecognized destroyPolicy: "+d.destroyPolicy)}}},setStoreModelValue:function(f,d){var c=this,b=c.getModel(),e=b.get(d.getField()),a=d.getStoreInstance(b);Vulcan.Common.ExtJS.utils.helpers.StoreHelper.doForLoadedStore(a,function(){if(Ext.isArray(e)){var g=[];Ext.Array.each(e,function(m){var l=a.getById(m);if(l){var k=l.get(d.getStoreDisplayField());if(k){g.push(k)}}});if(g.length>0){c.setFieldValue(f,g.join(", "))}else{if(d.getStoreAllowNullLabel()){c.setFieldValue(f,d.getStoreAllowNullLabel())}else{c.setFieldValue(f,"")}}}else{var h=a.getById(e);if(h){c.setFieldValue(f,h.get(d.getStoreDisplayField()))}else{if(h===null&&d.getStoreAllowNullLabel()){c.setFieldValue(f,d.getStoreAllowNullLabel())}else{c.setFieldValue(f,"")}}}},c)},setPrimitiveModelValue:function(h,c){var b=this,a=b.getModel(),d=a.get(c.getField());switch(c.getType()){case"time":case"time24":try{var g=c.getFormat()||Vulcan.Common.ExtJS.utils.Settings.timeFormat;d=Ext.Date.format(d,g)}catch(f){d=Ext.emptyString}break;case"datetime":try{var g=c.getFormat()||Vulcan.Common.ExtJS.utils.Settings.dateTimeFormat;d=Ext.Date.format(d,g)}catch(f){d=Ext.emptyString}break;case"date":try{var g=c.getFormat()||Vulcan.Common.ExtJS.utils.Settings.dateFormat;d=Ext.Date.format(d,g)}catch(f){d=Ext.emptyString}break;case"month":try{var g=c.getFormat()||Vulcan.Common.ExtJS.utils.Settings.monthFormat;d=Ext.Date.format(d,g)}catch(f){d=Ext.emptyString}break;case"bankAccount":case"bankaccount":d=Vulcan.Common.ExtJS.utils.helpers.BankAccountHelper.getFormatedBankAccount(d);break}return b.setFieldValue(h,d)},setFieldValue:function(e,d){var a=0,c=0;if(e.el){a=e.getHeight()}var b={text:Ext.String.htmlEncode(d)};if(Ext.isString(d)&&Ext.String.trim(d)){b.href=d;if(!Ext.String.startsWith(b.href,"http",true)){b.href="http://"+b.href}}e.update(b);if(e.el){c=e.getHeight()}return(a!=c)},refreshData:function(){var c=this,d=false;c.suspendLayouts();for(var a=0;a<c.rows.length;a++){var b=c.rows[a].fieldMapping;if(b.getStore()){c.setStoreModelValue(c.rows[a].cmpValue,b)}else{d|=c.setPrimitiveModelValue(c.rows[a].cmpValue,b)}}c.resumeLayouts();if(d){c.updateLayout()}},setModel:function(a){var b=this;Ext.callback(b.mixins.VModelAbstract.setModel,b,arguments);b.refreshData()}});Ext.define("Vulcan.Common.ExtJS.widget.picker.VTimePicker",{extend:"Ext.Component",alias:"widget.vtimepicker",cls:"vtp-picker",renderSelectors:{innerEl:"table.vtp-inner",listHoursEl:"table.vtp-list.hours",listMinutesEl:"table.vtp-list.minutes",footerEl:"table.vtp-inner td.vtp-footer"},renderTpl:['<table id="{id}-inner" class="vtp-inner">',"<tbody>","<tr>",'<td class="vtp-list-container">{%this.renderHours(values, out)%}</td>','<td class="vtp-list-container">{%this.renderMinutes(values, out)%}</td>',"</tr>","<tr>",'<td colspan="2" class="vtp-footer"></td>',"</tr>","</tbody>","</table>",{renderHours:function(n,d){var h=this,m=n.$comp,c=m.hourInterval,g=m.hourBreakRow,b=parseInt(m.hourMin,10),k=parseInt(m.hourMax,10),o='<table class="vtp-list hours"><tr><td colspan="[CS]" class="vtp-header hours">'+m.locale.hrHeader+"</td></tr><tr>",a="",f=0,l=1;for(var e=0;e<24;e+=c,f+=l){if(e&&(e%g)===0){o+="</tr><tr>";l=0}a=h.prepend(e);if(e>=b&&e<=k){o+='<td class="vtp-cell hours"><a class="vtp-cell-label" href="#" data-value="h'+a+'">'+a+"</a></td>"}else{o+='<td class="vtp-cell hours disabled"><a class="vtp-cell-label" href="#">'+a+"</a></td>"}}o=o.replace("[CS]",f.toString());o+="</tr></tbody></table>";d.push(o)},renderMinutes:function(l,c){var f=this,k=l.$comp,a=k.minuteInterval,h=k.minuteBreakRow,m='<table class="vtp-list minutes"><tbody><tr><td colspan="[CS]" class="vtp-header minutes">'+k.locale.mnHeader+"</td></tr><tr>",b="",e=0,g=1;for(var d=0;d<60;d+=a,e+=g){if(d&&(d%h)===0){m+="</tr><tr>";g=0}b=f.prepend(d);m+='<td class="vtp-cell minutes"><a class="vtp-cell-label" href="#" data-value="m'+b+'">'+b+"</a></td>"}m=m.replace("[CS]",e.toString());m+="</tr></tbody></table>";c.push(m)},prepend:function(a){return("0"+a).slice(-2)}}],locale:{hrHeader:"GODZINA",mnHeader:"MINUT",buttonNow:"TERAZ",buttonOk:"OK"},internalFormat:"Y-m-d H:i:s",_value:{hr:null,mn:null,dt:null},initialTime:null,hourInterval:1,hourBreakRow:6,minuteInterval:5,minuteBreakRow:15,hourMin:0,hourMax:23,showButtonNow:true,closeOnSelect:false,initComponent:function(){var a=this;a.callParent();a.addEvents("select")},beforeRender:function(){var a=this;a.callParent()},beforeDestroy:function(){var a=this;a.callParent();if(typeof a.buttonNow!="undefined"){Ext.destroy(a.buttonNow)}if(typeof a.buttonOk!="undefined"){Ext.destroy(a.buttonOk)}},onRender:function(b,a){var c=this,d=null;c.callParent(arguments);if(c.showButtonNow){if(typeof c.buttonNow=="undefined"){c.buttonNow=Ext.create("Ext.Button",Ext.apply(c.baseButtonCfg(),{id:c.getId()+"-now-button",text:c.locale.buttonNow,handler:c.selectNow}))}}if(typeof c.buttonOk=="undefined"){c.buttonOk=Ext.create("Ext.Button",Ext.apply(c.baseButtonCfg(),{id:c.getId()+"-ok-button",text:c.locale.buttonOk,handler:c.selectOk}))}c.mon(c.innerEl,{scope:c,click:c.handleInnerClick});if(c.initialTime){if(Ext.isDate(c.initialTime)){c.setTime(c.initialTime.getHours(),c.initialTime.getMinutes())}else{if(Ext.isString(c.initialTime)&&c.initialTime.indexOf(":")>0){d=c.initialTime.split(":");c.setTime(d[0],d[1])}}}},baseButtonCfg:function(){var a=this;return{ownerCt:a,ownerLayout:a.getComponentLayout(),renderTo:a.footerEl,scope:a,cls:"vtp-button"}},setTime:function(d,b){var e=this,c=parseInt(d,10),g=parseInt(b,10),a=parseInt(e.hourMin,10),f=parseInt(e.hourMax,10);e.clearTime();if(isNaN(c)||c<a||c>f){c=null}if(isNaN(g)||g<0||g>59){g=null}if(g===null&&c!==null){g=0}e._value={hr:c,mn:g,dt:(c!==null&&g!==null)?Ext.Date.parse("1900-01-01 "+e.prepend(c)+":"+e.prepend(g)+":00",e.internalFormat):null};if(e.innerEl){if(c!==null){e.innerEl.select(".vtp-cell-label[data-value='h"+e.prepend(c)+"']").addCls("selected")}if(g!==null){e.innerEl.select(".vtp-cell-label[data-value='m"+e.prepend(g)+"']").addCls("selected")}}e.fireEvent("select",e,e.getTimeStr())},getTime:function(){var a=this;return a._value.dt},getTimeStr:function(){var b=this,a="",c="";if(b._value.hr===null&&b._value.mn===null){return""}if(Ext.isNumber(b._value.hr)){a=b.prepend(b._value.hr)}if(Ext.isNumber(b._value.mn)){c=b.prepend(b._value.mn)}return a+":"+c},clearTime:function(){var a=this;a.value={hr:null,mn:null,dt:null};if(a.innerEl){a.innerEl.select(".vtp-cell-label.selected").removeCls("selected")}},selectNow:function(){var b=this,a=new Date();b.setTime(a.getHours(),a.getMinutes());b.collapse()},selectOk:function(){var a=this;a.collapse()},handleInnerClick:function(b){var a=this,c="";if(Ext.fly(b.target).is("a.vtp-cell-label")){b.stopEvent();c=b.target.getAttribute("data-value");if(c){if(c.indexOf("h")===0){a.setTime(c.slice(-2),a._value.mn);if(typeof a.needHour!="undefined"&&a.needHour||a.closeOnSelect){a.collapse()}}else{if(c.indexOf("m")===0){a.setTime(a._value.hr,c.slice(-2));if(a._value.hr!==null||a.closeOnSelect){a.collapse()}else{a.needHour=true}}}}}},collapse:function(){var a=this;if(a.pickerField instanceof Ext.Component){a.pickerField.collapse();a.needHour=false}},prepend:function(a){return("0"+a).slice(-2)}});Ext.define("Vulcan.Common.ExtJS.widget.window.VDetails",{extend:"Ext.window.Window",alias:["widget.vdetails","widget.v-details"],mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget"},modal:true,resizable:false,border:false,autoShow:true,title:"Informacja",details:"",msg:"",msgIconCls:"x-message-box-info",initComponent:function(){var b=this;var a=new Ext.widget("textarea",{margin:"10 0 0 0",hidden:true,height:120,width:260,value:b.details});b.items=[{xtype:"panel",bodyPadding:20,width:300,items:[{xtype:"container",layout:{type:"table",columns:2},width:260,items:[{xtype:"container",cls:b.msgIconCls,height:32,width:40},{xtype:"label",text:b.msg}]},a]}];b.buttons=[{text:"OK",handler:function(){b.close()}},{text:"Szczegóły",handler:function(){a.setVisible(!a.isVisible())}}];b.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.widget.window.VEditor",{extend:"Ext.window.Window",alias:["widget.veditor","widget.v-editor"],mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget"},cls:"v-editor",layout:"border",title:"VEditor",modal:true,resizable:false,border:false,onEsc:Ext.emptyFn,centerPanel:null,contentPanel:null,southPanel:null,saveButton:null,cancelButton:null,deleteButton:null,focusFirstField:true,defaultButtonConfig:{margin:5,width:60},autoSize:true,width:500,height:0,initComponent:function(){var a=this;a.initButtons();a.initPanels();if(a.contentPanel instanceof Ext.container.Container){a.items=[a.centerPanel,a.southPanel];a.callParent(arguments)}else{a.widgetError("Content of VEditor is expected to be an instace of Ext.container.Container")}a.on({afterrender:{fn:a.handleAutoSize,scope:a}});if(a.focusFirstField===true){a.on("activate",a.doFocusFirstField,a,{single:true})}},getContentPanel:function(){var a=this;return Ext.create("Ext.panel.Panel",{width:100,height:100,items:[{xtype:"label",text:"default content"}]})},getSouthPanel:function(){var a=this;return Ext.create("Ext.panel.Panel",{region:"south",layout:"hbox",bodyStyle:{borderTop:0,borderLeft:1,borderRight:1,borderBottom:1},bodyPadding:5,items:a.getButtons()})},getButtons:function(){var a=this;return[{xtype:"tbspacer",flex:1},a.saveButton,a.deleteButton,a.cancelButton]},initPanels:function(){var a=this;a.contentPanel=a.getContentPanel();a.centerPanel=Ext.widget("container",{region:"center",layout:"fit",items:[a.contentPanel]});a.southPanel=a.getSouthPanel()},initButtons:function(){var c=this,d=Ext.clone(c.defaultButtonConfig),b=Ext.clone(c.defaultButtonConfig),a=Ext.clone(c.defaultButtonConfig);Ext.apply(d,{text:"Zapisz",iconCls:"icon-ok"});c.saveButton=Ext.widget("button",d);Ext.apply(b,{text:"Anuluj",iconCls:"icon-cancel"});c.cancelButton=Ext.widget("button",b);Ext.apply(a,{text:"Usuń",iconCls:"icon-del"});c.deleteButton=Ext.widget("button",a)},handleAutoSize:function(){var e=this,f=Ext.getBody().getViewSize(),b=false;if(e.autoSize!==false&&e.contentPanel){if(e.autoSize===true||e.autoSize==="width"){var d=e.contentPanel.getWidth();e.setWidth(Math.min(d,f.width));b|=(d>f.width)}if(e.autoSize===true||e.autoSize==="height"){var a=e.contentPanel.getHeight()+80;e.setHeight(Math.min(a,f.height));b|=(a>f.height)}if(b){var c=[e.contentPanel];if(e.contentPanel.getLayout() instanceof Ext.layout.container.Card){c=e.contentPanel.items.getRange()}Ext.each(c,function(g){Vulcan.Common.ExtJS.utils.helpers.ContainerHelper.setAutoScroll(g)})}}},isValid:function(){var c=this,a=true;var b=Vulcan.Common.ExtJS.utils.helpers.FormHelper.getForms(c);Ext.Array.forEach(b,function(d){a=a&&d.isValid()});return a},validate:function(){var a=this;a.isValid()},doFocusFirstField:function(){var c=this,a=c.contentPanel.items,b=undefined;if(a.length>0&&c.contentPanel.items.getAt(0) instanceof Vulcan.Common.ExtJS.widget.model.VModelForm){a=c.contentPanel.items.getAt(0).items}b=a.findBy(function(d){return d instanceof Ext.form.field.Base&&!d.isDisabled()&&d.readOnly!==true});if(b){b.focus(true,false)}}});Ext.define("Vulcan.Common.ExtJS.widget.window.VFilterWindow",{extend:"Vulcan.Common.ExtJS.widget.window.VEditor",cfgClearButton:{},txtButtonClear:"Wyczyść",title:"",width:400,autoSize:"height",clearButton:null,getButtons:function(){var a=this;a.clearButton=a.createClearButton();return[{xtype:"tbspacer",flex:1},a.saveButton,a.clearButton,a.cancelButton]},createClearButton:function(){var b=this,a=Ext.clone(b.defaultButtonConfig);a=Ext.apply(a,{text:b.txtButtonClear,handler:b.handleClearButton,scope:b,ord:110});Ext.apply(a,b.cfgClearButton);return Ext.widget("button",a)}});Ext.define("Vulcan.Common.ExtJS.widget.window.VGridEditor",{extend:"Vulcan.Common.ExtJS.widget.window.VEditor",alias:["widget.vgrideditor","widget.v-grid-editor"],mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget"},cls:"v-grid-editor",layout:"border",title:"",maximized:true,type:"edit",gridSource:undefined,grid:undefined,initComponent:function(){var a=this;a.grid=Ext.widget("vgrid",a.createGridCfg());a.callParent(arguments);a.deleteButton.setVisible(false)},createGridCfg:function(){var a=this,d=(a.type==="add"),c={showGridEditButton:false,showGridAddButton:false,showGroupEditButton:false,showEditButton:false,showDeleteButton:(a.type==="add"),showGoToButton:false,showAddButton:false,editable:true,disableSelection:false,showRowNumber:true,showInsertButton:d,selType:"vcellmodel",selModel:{autoAdd:d},plugins:[{ptype:"vcellediting"},{ptype:"vexcelcopypaste",autoAdd:d}],toolbarItems:[]},b={};b=Ext.apply(b,a.gridSource.cfgGridEdit);return a.gridSource.cloneConfig(Ext.applyIf(b,c))},getContentPanel:function(){var a=this;return Ext.create("Ext.panel.Panel",{width:100,height:100,layout:"fit",items:[a.grid]})},getGrid:function(){var a=this;return a.grid}});Ext.define("Vulcan.Common.ExtJS.widget.window.VWizard",{extend:"Vulcan.Common.ExtJS.widget.window.VEditor",alias:["widget.vwizard","widget.v-wizard"],mixins:{VModelAbstract:"Vulcan.Common.ExtJS.widget.abstract.VModelAbstract"},title:"VWizard",width:500,autoSize:"height",prevButton:null,nextButton:null,initComponent:function(){var a=this;a.callParent(arguments)},initButtons:function(){var c=this,a=Ext.clone(c.defaultButtonConfig),b=Ext.clone(c.defaultButtonConfig);c.callParent(arguments);Ext.apply(a,{text:"Wstecz",iconCls:"icon-back"});c.prevButton=Ext.widget("button",a);Ext.apply(b,{text:"Dalej",iconCls:"icon-foreward"});c.nextButton=Ext.widget("button",b)},getButtons:function(){var a=this;return[{xtype:"tbspacer",flex:1},a.prevButton,a.nextButton,a.saveButton,a.deleteButton,a.cancelButton]},getWizardPanels:function(){var a=this;return[{xtype:"panel",border:false,items:[{xtype:"label",text:"first page"}]},{xtype:"panel",border:false,items:[{xtype:"label",text:"second page"}]},{xtype:"panel",border:false,items:[{xtype:"label",text:"third page"}]}]},getContentPanel:function(){var a=this;return Ext.widget("panel",{bodyPadding:10,layout:"card",items:a.getWizardPanels()})}});Ext.define("Vulcan.Common.ExtJS.widget.IconLabel",{extend:"Ext.form.Label",alias:"widget.iconlabel",getHtml:function(){var a=this;return'<div class="x-information-icon" style="margin:0;float:left"></div><div style="margin-left:20px"> </div>'},getTip:function(b){var a=this;return b},constructor:function(a){var b=this;a.html=b.getHtml();a.autoEl={tag:"label","data-qtip":b.getTip(a.text)};delete a.text;b.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.widget.util.VAccordPanelTabGroupDefinition",{alias:"vaccgroup",id:"",title:"",items:[],constructor:function(a){var c=this,b=Ext.clone(a);if(!b.id){b.id=Ext.id(null,"vaccgroup-")}Ext.apply(c,b)}});Ext.define("Vulcan.Common.ExtJS.widget.util.VAccordPanelTabItemDefinition",{alias:"vacctab",id:"",title:"",image:"",controller:"",start:false,constructor:function(a){var c=this,b=Ext.clone(a);if(!b.id){b.id=Ext.id(null,"vacctab-")}Ext.apply(c,b)}});Ext.define("Vulcan.Common.ExtJS.layout.container.VAccordPanel",{extend:"Ext.layout.container.Fit",alias:"layout.vaccpanel",type:"vaccpanel",getTarget:function(){return this.owner.getTargetEl()},getContainerSize:function(){var b=this,a;a=b.getTarget().getSize();return{width:a.width,height:a.height,needed:2,got:2,gotAll:true,gotWidth:true,gotHeight:true}}});Ext.define("Vulcan.Common.ExtJS.widget.VAccordPanel",{extend:"Ext.container.Container",alias:"widget.vaccpanel",cls:"ap-main",layout:{type:"vaccpanel"},defAnimDuration:250,defIconExpandCls:"x-tool-expand",defIconCollapseCls:"x-tool-collapse",defIconCls:"",autoStart:true,accordionBehaviour:true,defAccessDeniedView:undefined,currItem:null,currGroup:null,tabs:[],renderTpl:Ext.create("Ext.XTemplate",['<div id="{id}-ap-tabs" class="ap-tabs"></div>','<div id="{id}-ap-body" class="ap-body x-container"></div>']),tabsTpl:Ext.create("Ext.XTemplate",['<tpl for=".">','<div id="{id}" class="ap-tab">','<div id="{id}-label" class="ap-tab-label x-panel-header-text">{title}','<div style="width:15px; height:15px;" class="x-box-item">','<img class="{[values.expanded ? values.iconCollapseCls : values.iconExpandCls]}" src="'+Ext.BLANK_IMAGE_URL+'" />',"</div>","</div>",'<div id="{id}-items" class="ap-tab-items" style="{[values.expanded ? \'display:block\' : \'display:none\']};">','<tpl for="items">','<table id="{id}" class="ap-tab-item"><tr>','<td><img class="{iconCls}" src="'+Ext.BLANK_IMAGE_URL+'" /></td>',"<td>{title}</td>","</tr></table>","</tpl>","</div>","</div>","</tpl>"]),renderSelectors:{tabsEl:"div.ap-tabs",bodyEl:"div.ap-body"},constructor:function(a){var d=this,c=Ext.clone(a),b=[];if(Ext.isArray(c.tabs)){Ext.Array.each(c.tabs,function(e){if(Ext.isArray(e.items)){var f=[];Ext.Array.each(e.items,function(g){f.push(Ext.create("vacctab",g))});e.items=f;b.push(Ext.create("vaccgroup",e))}})}c.tabs=b;c.layout={type:"vaccpanel"};Ext.apply(d,c);d.callParent(c)},initComponent:function(){var a=this;a.callParent(arguments);a.on("destroy",a.handleDestroy,a);a.on("afterlayout",a.handleAfterLayout,a);a.addEvents("beforetabchange","tabchange","beforegroupchange","groupchange","checkaccess")},onRender:function(){var b=this,a=b.getDefaultItem(),c=(a.group&&a.item);b.callParent(arguments);if(c){a.group.expanded=true}b.rebuild();b.tabsEl.select(".ap-tab-label").on("click",b.handleGroupHeaderClick,b);b.tabsEl.select(".ap-tab-item").on("click",b.handleTabItemClick,b).on("mouseover",b.handleTabItemMouseOver,b).on("mouseout",b.handleTabItemMouseOut,b);if(c){b.selectDefaultItem(a)}},rebuild:function(){var b=this,a=b.tabsTpl;if(!(b.el&&Ext.isArray(b.tabs))){return}b.grpClsMap={};Ext.Array.each(b.tabs,function(e,c,d){Ext.applyIf(d[c],{iconExpandCls:b.defIconExpandCls,iconCollapseCls:b.defIconCollapseCls});b.grpClsMap[d[c].id]={iconExpandCls:d[c].iconExpandCls,iconCollapseCls:d[c].iconCollapseCls};Ext.Array.each(d[c].items,function(h,f,g){Ext.applyIf(g[f],{iconCls:b.defIconCls})})});a.append(b.tabsEl,b.tabs)},beforeLayout:function(){var a=this;a.correctSize();a.callParent(arguments);if(typeof a.needLayout=="undefined"||a.needLayout===false){a.needLayout=true}else{a.needLayout=false}},handleGroupHeaderClick:function(d,a){var c=this,b=d.getTarget(".ap-tab-label",undefined,true);if(b){var f=b.next(".ap-tab-items");if(f.isVisible()){c.collapseGroup(b)}else{if(c.accordionBehaviour){c.tabsEl.select(".ap-tab-label").each(function(g){var e=this;if(g.dom!==b.dom){e.collapseGroup(g)}},c)}c.expandGroup(b)}d.stopEvent()}},handleTabItemClick:function(f,a){var d=this,b=null,c=f.getTarget(".ap-tab-item",undefined,true);if(c){b=d.getItemInfo(c.id);d.onTabChange(c,b.item,b.group);f.stopEvent()}},handleTabItemMouseOver:function(c,a){var b=c.getTarget(".ap-tab-item",undefined,true);if(b){b.addCls("over");c.stopEvent()}},handleTabItemMouseOut:function(c,a){var b=c.getTarget(".ap-tab-item",undefined,true);if(b){b.removeCls("over");c.stopEvent()}},onTabChange:function(b,h,g){var e=this,c=null,f=null,k=e.currItem,a=e.currGroup,d=true;if(k&&k.id==h.id){return}if(!a||a.id!=g.id){if(e.hasListener("beforegroupchange")&&e.fireEvent("beforegroupchange",e,a,g)===false){return}}if(e.hasListener("beforetabchange")&&e.fireEvent("beforetabchange",e,k,h)===false){return}e.currItem=h;e.currGroup=g;e.update();e.tabsEl.select(".ap-tab-item.pressed").removeCls("pressed");b.addCls("pressed");if(e.hasListener("tabchange")){e.fireEvent("tabchange",e,k,h)}if(e.hasListener("groupchange")&&(!a||a.id!=g.id)){e.fireEvent("groupchange",e,a,g)}},update:function(){var d=this,f=Ext.isDefined(d.defAccessDeniedView)?d.defAccessDeniedView:Vulcan.Common.ExtJS.utils.security.AccessGuardian.accessDeniedView,c=d.currItem,g=d.currGroup,a=true,e=null,b=null;if(c&&c.controller){if(d.hasListener("checkaccess")){a=d.fireEvent("checkaccess",d,c)}if(a===false){if(typeof f=="string"){b=Ext.create(f)}else{b=f}d.defAccessDeniedView=b}else{if(typeof c.controller=="string"){if(typeof App!="undefined"&&typeof App.addController=="function"){e=App.addController(c.controller)}else{e=Ext.create(c.controller)}c.controller=e}else{e=c.controller}}if(a===true){if(typeof c.view=="undefined"){b=e.createView({panel:d,item:c,group:g});c.view=b}else{b=c.view}}d.removeAll(false);d.add(b);if(a===true){if(typeof e.launch=="function"){e.launch(d);delete e.launch}if(typeof e.update=="function"){e.update(d)}}}},handleDestroy:function(){var a=this;Ext.Array.each(a.tabs,function(b){Ext.Array.each(b.items,function(c){if(typeof c.controller!="undefined"&&typeof c.controller.destroy=="function"){c.controller.destroy()}delete c.controller;if(typeof c.view!="undefined"&&c.view instanceof Ext.Component){c.view.destroy()}delete c.view})})},handleAfterLayout:function(a,d,b){var c=this;if(c.needLayout){c.doLayout()}},correctSize:function(){var d=this,a=d.getNearestAncestorByClass(d.getEl(),[".x-panel-body",".x-container"]),b=d.tabsEl.getWidth(),c;if(a){c=a.getSize()}else{c=d.getSize()}d.tabsEl.setLeftTop(0,0);d.tabsEl.setSize(b,c.height);d.bodyEl.setLeftTop(b,0);d.bodyEl.setSize(c.width-b,c.height)},slideOut:function(a){var b=this;a.slideOut("t",{duration:b.defAnimDuration,useDisplay:true})},slideIn:function(a){var b=this;a.slideIn("t",{duration:b.defAnimDuration,useDisplay:true})},expandGroup:function(d){if(!(d instanceof Ext.Element&&d.is(".ap-tab-label"))){return}var c=this,e=d.next(".ap-tab-items"),a=d.parent();if(e&&!e.isVisible()){c.slideIn(e);var b=d.down("img");if(b){b.removeCls(c.grpClsMap[a.id].iconExpandCls);b.addCls(c.grpClsMap[a.id].iconCollapseCls)}}},collapseGroup:function(d){if(!(d instanceof Ext.Element&&d.is(".ap-tab-label"))){return}var c=this,e=d.next(".ap-tab-items"),a=d.parent();if(e&&e.isVisible()){c.slideOut(e);var b=d.down("img");if(b){b.removeCls(c.grpClsMap[a.id].iconCollapseCls);b.addCls(c.grpClsMap[a.id].iconExpandCls)}}},getItemInfo:function(d){var b=this,c=null,a=null;Ext.Array.each(b.tabs,function(e){Ext.Array.each(e.items,function(f){if(f.id==d){c=f;return false}});if(c!==null){a=e;return false}});return{group:a,item:c}},getDefaultItem:function(){var b=this,c=null,a=null;Ext.Array.each(b.tabs,function(d){Ext.Array.each(d.items,function(e){if(e.start===true||b.autoStart){c=e;return false}});if(c!==null){a=d;return false}});return{group:a,item:c}},selectDefaultItem:function(a){var c=this,b=Ext.get(a.item.id);c.onTabChange(b,a.item,a.group)},getNearestAncestorByClass:function(d,a){var b=null,c=d.parent();while(c){Ext.Array.each(a,function(e){if(c.is(e)){b=c;return false}});if(!b){c=c.parent()}else{break}}return b},getCurrentController:function(){var b=this,a=null;if(b.currItem){a=b.currItem.controller}return a},getTargetEl:function(){return this.bodyEl||this.frameBody||this.el}});Ext.define("Vulcan.Common.ExtJS.widget.Valdict",{extend:"Ext.form.field.ComboBox",alias:"widget.valdict",autoSelect:false,queryMode:"local",clearable:false,selection:"",combo:false,beforeExpandValue:null,constructor:function(a){var b=this;if(a){if(a.combo){a.enableKeyEvents=true;a.editable=false;a.forceSelection=true}}b.callParent([a])},initComponent:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("valdict.initComponent");a.tpl=a.getTemplate(a.displayField);a.callParent(arguments);if(a.clearable){a.trigger2Cls="x-form-clear-trigger"}else{delete a.onTrigger2Click}a.addEvents("clear");a.on({afterrender:{fn:a.reassignStore,scope:a,single:true},expand:{fn:a.scrollToSelectedItem,scope:a},keypress:{fn:a.handleClosedCombo,scope:a},specialkey:{fn:a.handleSpecialKey,scope:a}})},handleClosedCombo:function(g,f){var d=this,a=d.store;if(d.combo){var c=String.fromCharCode(f.charCode||f.keyCode);var b=a.findRecord(d.displayField,c,0);if(b){d.select(b)}}},handleSpecialKey:function(c,b){var a=this;if(b.keyCode===b.ENTER||b.keyCode===b.TAB){a.triggerBlur()}if(b.isNavKeyPress()){a.getPicker().on({highlightitem:{fn:a.setHighlightedValue,scope:a,single:true}})}},setHighlightedValue:function(a,f,e){var d=this,c=d.getPicker(),b=c.getRecord(f);if(b){d.select(b)}},scrollToSelectedItem:function(){var c=this,a=c.getPicker();model=c.findRecordByValue(c.getValue());if(model){var b=a.getNode(model);a.highlightItem(b);a.focusNode(model)}},initSelection:function(){var a=this;if(a.selection==="first"){a.setValue(a.store.first())}},getTemplate:function(a){return'<ul class="x-list-plain"><tpl for="."><li role="option" class="x-boundlist-item" data-qtip="{[Ext.util.Format.htmlEncode(Ext.util.Format.stripTags(values.'+a+'))]}">{'+a+":htmlEncode}</li></tpl></ul>"},setValue:function(c,a){var b=this;b.callParent(arguments);if(c&&Ext.isArray(c)&&c.length===1&&Ext.isFunction(c[0].get)){b.altValue=c[0].get(b.displayField)}},reassignStore:function(){var a=this;Vulcan.Common.ExtJS.utils.helpers.StoreHelper.doForLoadedStore(a.store,a.initSelection,a)},onTrigger2Click:function(a){var b=this;if(!b.clearable){return}b.clearValue();b.fireEvent("clear",b)}});Ext.define("Vulcan.Common.ExtJS.widget.VBackendTask",{extend:"Ext.container.Container",alias:["widget.vbackendtask"],layout:{type:"vbox"},guid:undefined,title:"Zadanie",statusUrl:undefined,downloadUrl:undefined,removeUrl:undefined,buffer:10,interval:1,showDownloadButton:true,showOpenButton:true,showRemoveButton:true,doneItems:[],cls:"vbackendtask",constructor:function(b){var c=this,a=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderUrl");c.statusUrl=a+"Status/"+b.guid;c.downloadUrl=a+"Document/"+b.guid;c.removeUrl=a+"Remove/"+b.guid;c.buffer=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderBuffer");c.interval=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderInterval");Ext.apply(c,b);c.callParent(arguments)},addTask:function(d,b){var a=this,e="("+Ext.Date.format(new Date(),"H:i:s")+") "+a.title;var c=Ext.widget("progressbar",{text:"Rozpoczynanie...",cls:"vbackendtask-progressbar",width:332});a.add({xtype:"label",cls:"vbackendtask-label",text:e});a.add(c);d.insert(0,a);a.startTask(c,a,b,d)},expandParentContainer:function(a){if(Ext.isFunction(a.expand)){a.expand(true)}},startTask:function(e,b,d,f){var c=this,a=true;c.expandParentContainer(d);Ext.util.TaskManager.start({run:function(){var g=this.taskRunCount;if(!a){c.expandParentContainer(d);return false}Ext.data.JsonP.request({url:c.statusUrl,success:function(k,m){var l,h;if(!k||!k.code){if(a){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Błędna odpowiedź z DDS ",k);a=false;e.reset();e.updateText("Błąd komunikacji z DDS.")}return}l=k.code;switch(l){case Vulcan.Common.ExtJS.utils.StatusCodes.downloaderDone:e.reset(true);a=false;if(Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.backendTaskDone,c.guid,c.downloadUrl+"?embedded=true",l)===false){b.add({xtype:"label",text:"Zakończono"})}else{c.addDoneItems(f,b,c)}break;case Vulcan.Common.ExtJS.utils.StatusCodes.downloaderWait:h=k.message;if(h==="0"){e.wait({duration:10000,text:"Zlecenie przetwarzane..."})}else{e.updateProgress(1/h,"Liczba oczekujących: "+h)}break;case Vulcan.Common.ExtJS.utils.StatusCodes.downloaderCanceled:a=false;e.reset();e.updateText("Zadanie anulowane.");Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.backendTaskDone,c.guid,null,l);break;case Vulcan.Common.ExtJS.utils.StatusCodes.downloaderUnknown:default:if(g<c.buffer){return}a=false;e.reset();e.updateText("Błędny identyfikator zadania.");Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.backendTaskDone,c.guid,null,l);break}},failure:function(h,k){a=false;e.reset();e.updateText("Błąd odpowiedzi DDS.");Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.backendTaskError,c.guid,h)}});return a},onError:function(h,g){var k="Błąd.";if(Ext.isDefined(g)&&Ext.isDefined(g.description)){k=g.description.trim()}e.reset();e.updateText(k);Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.backendTaskError,c.guid,h,g)},interval:c.interval*1000})},addDoneItems:function(f,b,d){var e=this,a=Ext.widget({xtype:"container",layout:"hbox",items:[]});if(d.showDownloadButton){a.add({xtype:"button",tooltip:"Pobierz",iconCls:"pobierz",handler:function(){Vulcan.Common.ExtJS.utils.Link.onLinkClick(d.downloadUrl)}})}if(d.showOpenButton){a.add({xtype:"button",tooltip:"Otwórz",iconCls:"podglad",handler:function(){Vulcan.Common.ExtJS.utils.Link.onLinkClick(Ext.create("Vulcan.Common.ExtJS.utils.Link",{url:d.downloadUrl+"?embedded=true",newTab:true}))}})}if(d.showRemoveButton){a.add({xtype:"button",tooltip:"Usuń",iconCls:"icon-usun-dok",handler:function(){Ext.data.JsonP.request({url:d.removeUrl,success:function(){f.remove(e)}})}})}for(var c=0;c<d.doneItems.length;c++){a.add(d.doneItems[c])}b.add(a)}});Ext.define("Vulcan.Common.ExtJS.widget.VBackendTaskArchive",{extend:"Ext.container.Container",alias:["widget.vbackendtaskarchive"],archiveUrl:undefined,cls:"vbackendtaskarchive",constructor:function(a){var b=this;Ext.apply(b,a);b.callParent(arguments)},initComponent:function(){var a=this;a.callParent(arguments);if(a.archiveUrl){a.generateArchivePanel(a)}},generateArchivePanel:function(a){var b=this;b.removeAll();Ext.Ajax.request({url:b.archiveUrl,success:function(c){var e=Ext.decode(c.responseText),d=e.data;if(!d||d.length===0){return}a.add([{xtype:"vhr"},{xtype:"label",html:"<b>Archiwum:</b>",margin:"0 0 0 2"},{xtype:"vimgbtn",tooltip:"Odśwież",cls:"odswiez",margin:"0 5 0 2",handler:function(){b.generateArchivePanel(b)}},{xtype:"vimgbtn",tooltip:"Usuń wszystkie",cls:"icon-usun-wszystkie",handler:function(){b.clearArchive(a)}}]);a.add(b.generateArchiveItemsCnt(d))}})},generateArchiveItemsCnt:function(d){var b,c,a=Ext.widget({xtype:"container"});for(b=0;b<d.length;b++){c=d[b];a.add(Ext.widget("vbackendtaskitem",{item:c}))}return a},clearArchive:function(c){var a=c.query("vbackendtaskitem"),b,d;for(b=0;b<a.length;b++){d=a[b];d.removeDocument(d)}}});Ext.define("Vulcan.Common.ExtJS.widget.VBackendTaskItem",{extend:"Ext.container.Container",alias:["widget.vbackendtaskitem"],layout:{type:"table",columns:2,tdAttrs:{valign:"top"}},margin:"0 0 5 0",cls:"vbackendtaskitem",item:undefined,showDownloadButton:true,initComponent:function(){var b=this,a=Ext.widget("container",{layout:"hbox",width:70,items:[],rowspan:2});if(b.item.showDownloadButton!==false){a.add({xtype:"button",tooltip:"Pobierz",iconCls:"pobierz",handler:function(){Vulcan.Common.ExtJS.utils.Link.onLinkClick(b.item.DownloadUri)}})}if(b.item.showOpenButton!==false){a.add({xtype:"button",tooltip:"Otwórz",iconCls:"podglad",handler:function(){Vulcan.Common.ExtJS.utils.Link.onLinkClick(Ext.create("Vulcan.Common.ExtJS.utils.Link",{url:b.item.DownloadUri+"?embedded=true",newTab:true}))}})}if(b.item.showRemoveBu!==false){a.add({xtype:"button",tooltip:"Usuń",iconCls:"icon-usun-dok",handler:function(){b.removeDocument(b)}})}b.items=[a,{xtype:"label",html:"("+(b.item.DateOfCompletion?Ext.String.escape(b.item.DateOfCompletion):"???")+") <br/>"+(b.item.HttpFriendlyName?Ext.String.escape(b.item.HttpFriendlyName):"???")}];b.callParent(arguments)},removeDocument:function(b){var a=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderUrl");Ext.data.JsonP.request({url:a+"Remove/"+b.item.Guid,success:function(){var c=b.up("vbackendtaskarchive").down("container");c.remove(b)}})}});Ext.define("Vulcan.Common.ExtJS.widget.VBadgesButton",{extend:"Ext.button.Button",alias:["widget.vBadgesbutton"],getTemplateArgs:function(){var c=this;var b=c.callParent(arguments);var a=c.getBadges();if(a){Ext.apply(b,{badges:a})}return b},getBadges:function(){return[]},refreshBadges:function(a){var b=this;var c="";if(a){Ext.Array.each(a,function(f,d,e){c+='<div style="'+f.style+'" title="'+f.title+'">'+f.value+"</div>\r\n"})}this.getEl().down(".badges").update(c)},renderTpl:['<span id="{id}-btnWrap" role="presentation" class="{baseCls}-wrap','<tpl if="splitCls"> {splitCls}</tpl>','{childElCls}" unselectable="on">','<span id="{id}-btnEl" class="{baseCls}-button" role="presentation">','<span id="{id}-btnInnerEl" class="{baseCls}-inner {innerCls}','{childElCls}" unselectable="on">',"{text}","</span>",'<span role="presentation" id="{id}-btnIconEl" class="{baseCls}-icon-el {iconCls}','{childElCls} {glyphCls}" unselectable="on" style="','<tpl if="iconUrl">background-image:url({iconUrl});</tpl>','<tpl if="glyph && glyphFontFamily">font-family:{glyphFontFamily};</tpl>">','<tpl if="glyph">&#{glyph};</tpl><tpl if="iconCls || iconUrl">&#160;</tpl>',"</span>","</span>","</span>",'<tpl if="closable">','<span id="{id}-closeEl" role="presentation"',' class="{baseCls}-close-btn"','<tpl if="closeText">',' title="{closeText}" aria-label="{closeText}"',"</tpl>",">","</span>","</tpl>",'<div class="badges">','<tpl for="badges">','<div style="{style}" title="{title}">{value}</div>',"</tpl>","</div>"],showWithBadges:function(a){var b=this;b.getBadges=function(){return a};b.show()}});Ext.define("Vulcan.Common.ExtJS.widget.VClipboardButton",{extend:"Ext.button.Button",alias:["widget.vclipboardbutton","widget.vclipbutton","widget.vclipboardbtn","widget.vclipbtn"],cls:"vclipboardbuttonn",clipboard:undefined,setClipboardData:Ext.emptyFn,initComponent:function(){var a=this;a.callParent(arguments);a.on("render",function(c){var b=arguments;a.clipboard=new ZeroClipboard(c.el.dom);a.clipboard.on("copy",function(e){var d=e.clipboardData;a.addAliasFunc(d);a.setClipboardData(d,a,b)})});a.on("destroy",function(){a.clipboard.destroy()})},addAliasFunc:function(a){a.setText=function(b){a.setData("text/plain",b)};a.setHtml=function(b){a.setData("text/html",b)};a.setRichText=function(b){a.setData("application/rtf",b)}}});Ext.define("Vulcan.Common.ExtJS.widget.VFileField",{extend:"Ext.form.field.File",alias:["widget.vfilefield","widget.vfileuploadfield"],filter:undefined,initComponent:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init VFileField");a.callParent(arguments);a.addEvents("beforechange")},onRender:function(){var a=this;a.callParent(arguments);if(Ext.isDefined(a.filter)){a.fileInputEl.set({accept:a.filter})}a.mon(a.button.el,"click",function(b){if(a.fireEvent("beforechange",a)===false){b.preventDefault()}})}});Ext.define("Vulcan.Common.ExtJS.widget.VHr",{extend:"Ext.Component",alias:"widget.vhr",autoEl:{tag:"hr",cls:"vhr"}});Ext.define("Vulcan.Common.ExtJS.widget.VImageButton",{extend:"Ext.Img",alias:["widget.vimagebutton","widget.vimgbutton","widget.vimgbtn"],cls:"vimgbtn",style:"cursor: pointer;",link:undefined,handler:Ext.emptyFn,initComponent:function(){var a=this;a.callParent(arguments);a.addEvents("click");a.listeners={click:{element:"el",fn:function(){var b=this;if(Ext.isDefined(b.link)){Vulcan.Common.ExtJS.utils.Link.onLinkClick(b.link)}else{b.handler(b)}},scope:a}}}});Ext.define("Vulcan.Common.ExtJS.widget.VImgFileField",{extend:"Ext.container.Container",requires:["Vulcan.Common.ExtJS.widget.VFileField"],alias:["widget.vimgfilefield"],autoEl:{tag:"div",cls:"vimgfilefield"},addButtonCls:"vimgfilefield-addbtn",filter:"image/*",src:Ext.BLANK_IMAGE_URL,cfgImage:{},types:undefined,emptySrc:undefined,loadedSrc:undefined,addButton:undefined,image:undefined,initComponent:function(){var a=this;a.initImg();a.initAddButton();a.initTypes();a.initEvents();if(a.src===Ext.BLANK_IMAGE_URL){if(Ext.isDefined(a.emptySrc)){a.setSrc(a.emptySrc)}else{a.setType()}}a.items=[a.image,a.addButton];a.callParent(arguments)},initEvents:function(){var a=this;a.addEvents("change")},initImg:function(){var b=this;var a={xtype:"image",src:b.src,listeners:{afterrender:function(c){c.el.on({error:function(d,f,e){b.setSrc("")}},b.image,{single:true});c.el.on({load:function(d,f,e){b.doLayout()}},b.image)}}};Ext.applyIf(b.cfgImage,a);b.image=new Ext.Img(b.cfgImage)},initAddButton:function(){var a=this;a.addButton=new Vulcan.Common.ExtJS.widget.VFileField({xtype:"vfilefield",buttonOnly:true,buttonText:"+",filter:a.filter,cls:a.addButtonCls,width:26});a.mon(a.addButton,"change",function(d,c){if(a.fireEvent("change",a,c)===false){return}if(Ext.isDefined(a.loadedSrc)){a.setSrc(a.loadedSrc);return}var b=c.split(".").pop();a.setType(b,true)},a)},initTypes:function(){var a=this;a.types=new Ext.util.HashMap();a.types.add("pdf",{empty:"vdocPdf",loaded:"vdocPdfLoaded"});a.types.add("png",{empty:"vdocPng",loaded:"vdocPngLoaded"});a.types.add("rtf",{empty:"vdocRtf",loaded:"vdocRtfLoaded"});a.types.add("",{empty:"vdocEmpty",loaded:"vdocEmptyLoaded"})},setSrc:function(b){var a=this;a.removeTypeCls();a.addButton.removeCls(a.addButtonCls);if(b){a.image.setSrc(b)}else{a.image.setSrc(a.emptySrc)}if(a.image.src){a.addButton.addCls(a.addButtonCls)}},setType:function(d,b){var e=this;var c=Ext.isDefined(d)?d.toLowerCase():d;var a=e.types.containsKey(c)?e.types.get(c):e.types.get("");a=b===true?a.loaded:a.empty;e.setSrc(Ext.BLANK_IMAGE_URL);e.removeTypeCls();e.image.addCls(a)},removeTypeCls:function(){var a=this;Ext.Array.forEach(a.types.getValues(),function(b){a.image.removeCls(b.loaded);a.image.removeCls(b.empty)})}});Ext.define("Vulcan.Common.ExtJS.widget.VMonthPicker",{extend:"Ext.form.field.Date",alias:"widget.monthpicker",requires:["Ext.picker.Month"],selectMonth:null,format:"F, Y",createPicker:function(){var a=this,b=Ext.String.format;return Ext.create("Ext.picker.Month",{pickerField:a,ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,minDate:a.minValue,maxDate:a.maxValue,disabledDatesRE:a.disabledDatesRE,disabledDatesText:a.disabledDatesText,disabledDays:a.disabledDays,disabledDaysText:a.disabledDaysText,format:a.format,showToday:a.showToday,startDay:a.startDay,minText:b(a.minText,a.formatDate(a.minValue)),maxText:b(a.maxText,a.formatDate(a.maxValue)),listeners:{select:{scope:a,fn:a.onSelect},monthdblclick:{scope:a,fn:a.onOKClick},yeardblclick:{scope:a,fn:a.onOKClick},OkClick:{scope:a,fn:a.onOKClick},CancelClick:{scope:a,fn:a.onCancelClick}},keyNavConfig:{esc:function(){a.collapse()}}})},onCancelClick:function(){var a=this;a.selectMonth=null;a.collapse()},onOKClick:function(){var a=this;if(a.selectMonth===null){a.selectMonth=new Date()}a.setValue(a.selectMonth);a.fireEvent("select",a,a.selectMonth);a.collapse()},onSelect:function(a,c){var b=this;b.selectMonth=new Date((c[0]+1)+"/1/"+c[1])},getValue:function(){var a=this;try{if(a.value){return new Date(a.value.getUTCFullYear(),a.value.getMonth(),1)}}catch(b){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("Nie udało się sparsować daty miesięcznej z wartości: "+a.value)}return a.callParent()}});Ext.define("Vulcan.Common.ExtJS.widget.util.VOrgPanelDragDrop",{extend:"Ext.dd.DD",getDragEl:function(){var c=this,a=document.body,b=c.getEl(),d;if(!Ext.fly(b).parent()){setTimeout(function(){c.getDragEl()},50);return}c.dragElId="dd-"+b.id;d=Ext.getDom(c.dragElId);if(!d){d=b.cloneNode(true);d.id=c.dragElId;Ext.fly(d).addCls("drag-move");Ext.fly(d).setOpacity(0.6);Ext.fly(b).parent().appendChild(d)}return d},onDragDrop:function(f,d){var k=this,h=Ext.DomHelper,a=Ext.get(k.getEl()),c=Ext.get(d),b=a.ownerPanel;if(a&&c&&b){var l=a.getAttribute("data-void"),g=c.getAttribute("data-void");b.updateParentship(g,l);b.build();if(b.hasListener("drop")){b.fireEvent("drop",b,k,true,l,g)}}},onInvalidDrop:function(d,f){var c=this,b=c.getDragEl(),a=Ext.get(c.getEl()).ownerPanel;Ext.fly(b).animate({to:{x:c.initialX,y:c.initialY},duration:150,listeners:{afterAnimate:function(){Ext.fly(b).remove()}}});if(a.hasListener("drop")){a.fireEvent("drop",a,c,false,null,null)}},onDragOver:function(b,c){var a=this;Ext.fly(c).addCls("drop-hover")},onDragOut:function(b,c){var a=this;Ext.fly(c).removeCls("drop-hover")},startDrag:function(){var c=this,b=Ext.get(c.getEl()),a=null;c.initialX=b.getX();c.initialY=b.getY();b.ownerPanel.getEl().select(".node").addCls("drag-active");a=b.up(".voptable").query(".node");Ext.Array.each(a,function(f){var g=Ext.get(f);g.removeCls("drag-active");if(b!==g){g.ddEl.lock()}});c.callParent(arguments);if(b.ownerPanel.hasListener("begindrag")){b.ownerPanel.fireEvent("begindrag",b.ownerPanel,c)}},endDrag:function(){var c=this,b=Ext.get(c.getEl()),a=b.ownerPanel.getEl().query(".node");Ext.Array.each(a,function(f){var g=Ext.get(f);g.removeCls("drag-active drop-hover");if(typeof g.ddEl!="undefined"){g.ddEl.unlock()}});c.callParent(arguments);if(b.ownerPanel.hasListener("enddrag")){b.ownerPanel.fireEvent("enddrag",b.ownerPanel,c)}}});Ext.define("Vulcan.Common.ExtJS.widget.VOrgPanel",{extend:"Ext.Component",alias:"widget.vorgpanel",cls:["vorgpanel"],store:null,rootLabel:"&nbsp;",rootId:"root",defLabelProperty:"Nazwa",defOrdProperty:"Ord",defParentProperty:"RodzicId",defLevelProperty:"Poziom",autoSync:false,canEdit:false,cfgSync:{},initComponent:function(){var a=this;a.callParent(arguments);if(typeof a.sourceEl=="string"){a.sourceEl=Ext.get(a.sourceEl)}a.addEvents("begindrag","enddrag","drop","contextmenu")},onRender:function(){var a=this;a.callParent(arguments);a.build()},build:function(){var d=this,c={depth:-1},b=d.getEl().child("table"),a=d.getModelChildren(null);if(b){b.remove()}if(Ext.isEmpty(d.store)){return}d.buildNode(null,d.getEl(),0,c)},buildNode:function(f,m,b,d){var v=this,t=Ext.DomHelper,r=Ext.isEmpty(f);var u=t.append(m,{tag:"table",cellpadding:0,cellspacing:0,border:0},true).addCls("voptable"),a=t.append(u,{tag:"tbody"},true),c=t.append(a,{tag:"tr"},true).addCls("node-cells"),k=t.append(c,{tag:"td"},true).addCls("node-cell").set({colspan:2}),g=v.getModelChildren(f),e=g.length;if(e>1){k.set({colspan:e*2})}var p=t.append(k,{tag:"div","data-void":r?v.rootId:f.getId()},true).addCls("node"),o=null;p.ownerPanel=v;if(v.canEdit){o=new Vulcan.Common.ExtJS.widget.util.VOrgPanelDragDrop(p.getAttribute("id"),"dd-"+v.getId());p.ddEl=o;p.on("contextmenu",v.onContextMenu,v)}p.setHTML(r?v.rootLabel:f.get(v.defLabelProperty));if(e>0){p.setStyle("cursor","n-resize");p.on("click",function(y,w){var z=Ext.get(w),x=z.up("tr");if(x.is(".contracted")){v.expandNode(z)}else{v.contractNode(z)}y.stopEvent()});if(d.depth==-1||(b+1<d.depth)){var l=t.append(a,{tag:"tr"},true),q=t.append(l,{tag:"td"},true).set({colspan:e*2}),n=t.append(q,{tag:"div"},true).addCls("line down");var s=t.append(a,{tag:"tr"},true);Ext.Array.each(g,function(){t.append(s,{tag:"td",html:"&nbsp;"},true).addCls("line left top");t.append(s,{tag:"td",html:"&nbsp;"},true).addCls("line right top")});s.select("td:first, td:last").removeCls("top");var h=t.append(a,{tag:"tr"},true);g.each(function(x){var w=t.append(h,{tag:"td"},true).addCls("node-container").set({colspan:2});v.buildNode(x,w,b+1,d)})}}},getModelChildren:function(b){var c=this,a=Ext.isEmpty(b)?null:b.getId();return c.store.queryBy(function(e,f){var d=e.get(c.defParentProperty);return(d===a||d===0&&a===null)})},updateParentship:function(h,g,e){var f=this,d=null,b=null;if(h===f.rootId||Ext.isDefined(h.getId)&&h.getId()===f.rootId){d=f.getRootStub()}else{if(h instanceof Ext.data.Model){d=h}else{if(typeof h=="number"){d=f.store.getById(h)}else{d=f.store.getById(parseInt(h,10))}}}if(g instanceof Ext.data.Model){b=g}else{if(typeof g=="number"){b=f.store.getById(g)}else{b=f.store.getById(parseInt(g,10))}}if(d&&b&&d!==b){var a=d.getId();if(a===f.rootId){a=null}b.set(f.defParentProperty,a);b.set(f.defLevelProperty,f.getModelLevel(b));var c=f.getModelChildren(b);c.each(function(k){f.updateParentship(b,k,true)});if(f.autoSync&&Ext.isEmpty(e)){f.syncStore()}}},getModelLevel:function(d){var e=this,a=d,b=0,c=1;do{b=a.get(e.defParentProperty);if(Ext.isEmpty(b)||b===0){a=null}else{a=e.store.getById(b);c++}}while(a);return c},getNewId:function(){var a=this;if(typeof a.__newid=="undefined"){a.__newid=-1}return a.__newid--},contractNode:function(c){var a=this,b=null;if(c instanceof Ext.CompositeElement){c.each(function(d){a.contractNode(Ext.get(d))})}else{if(c instanceof Ext.Element){b=c.up("tr");if(b){c.setStyle("cursor","s-resize");b.removeCls("expanded").addCls("contracted");while((b=b.next("tr"))){b.setStyle("visibility","hidden")}}}}},expandNode:function(c){var a=this,b=null;if(c instanceof Ext.CompositeElement){c.each(function(d){a.contractNode(Ext.get(d))})}else{if(c instanceof Ext.Element){b=c.up("tr");if(b){c.setStyle("cursor","n-resize");b.removeCls("contracted").addCls("expanded");while((b=b.next("tr"))){b.setStyle("visibility","")}}}}},appendNode:function(b,d){var c=this,a=(d instanceof Ext.data.Model)?d.get(c.defLabelProperty):d;if(typeof d=="string"){d=c.store.add({})[0];d.set(c.defLabelProperty,a)}else{c.store.add(d)}if(!c.autoSync){d.setId(c.getNewId())}c.updateParentship(b,d);if(!c.autoSync){c.build()}},removeNode:function(d,b){var c=this;if(typeof d.getId!="undefined"&&d.getId()==c.rootId){c.store.removeAll()}else{var a=c.getModelChildren(d);a.each(function(e){c.removeNode(e,d)});c.store.remove(d)}if(Ext.isEmpty(b)){if(c.autoSync){c.syncStore()}else{c.build()}}},updateNode:function(d,c){var b=this,a=d.self.getFields();Ext.Array.each(a,function(e){d.set(e.name,c.get(e.name))});if(b.autoSync){b.syncStore()}else{b.build()}},onContextMenu:function(f,a){var c=this,b=f.getTarget(".node",undefined,true),d=null;if(b){var g=b.getAttribute("data-void");if(g===c.rootId){d=c.getRootStub()}else{d=c.store.getById(parseInt(b.getAttribute("data-void"),10))}f.stopEvent();if(c.hasListener("contextmenu")){c.fireEvent("contextmenu",c,d,f)}}},getRootStub:function(){var b=this,a={get:function(){return b.rootLabel},getId:function(){return b.rootId}};a[b.defLabelProperty]=b.rootLabel;return a},syncStore:function(){var a=this;a.store.sync(a.cfgSync)}});Ext.define("Vulcan.Common.ExtJS.widget.VPivotGrid",{extend:"Ext.grid.Panel",alias:"widget.vpivotgrid",pivotHeaderColumnWidth:300,pivotHeaderCellWidth:50,excludedFields:null,showAddButton:false,showEditButton:false,editButtonText:"Zmień",editButtonHandler:null,columns:[],columnLines:true,selType:"cellmodel",viewConfig:{stripeRows:false,trackOver:false},initialStore:null,initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init component pivot.Panel");var b=this;b.callParent(arguments);if(b.store){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("binded (on initComponent) pivot to onLoad");b.initialStore=b.store;b.mon(b.initialStore,"load",b.assignPivotGrid,b);b.assignPivotGrid(b.initialStore,b.initialStore.getRange())}if(b.showAddButton||b.showEditButton){var a=Ext.create("Ext.Toolbar",{xtype:"toolbar",cls:"vgrid-btn"});b.addDocked(a)}if(b.showEditButton){var c=Ext.create("Ext.Button",{text:b.editButtonText,iconCls:"icon-edit",cls:"x_over x-btn-over x-btn-default-toolbar-small-over over",overCls:"x_over x-btn-over x-btn-default-toolbar-small-over over",handler:function(){if(b.editButtonHandler){b.editButtonHandler()}}});if(a){a.items.add(c)}}},reconfigure:function(a,d){var c=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("pivot grid reconfiguration started");var b=(a&&a.$className&&a.$className==="Ext.data.ArrayStore");if(!b){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("unbinded (on reconfigure) pivot from onLoad");c.mun(c.initialStore,"load",c.assignPivotGrid,c)}c.callParent(arguments);if(!b){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("binded (on reconfigure) pivot to onLoad");c.initialStore=c.store;c.mon(c.initialStore,"load",c.assignPivotGrid,c);c.assignPivotGrid(c.initialStore,c.initialStore.getRange())}Vulcan.Common.ExtJS.utils.Log.getLogger().trace("pivot grid reconfiguration ended")},assignPivotGrid:function(k,a){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("pivotGrid's onLoad");var g=this;g.initialStore.addEvents("pivotmonitor");g.initialStore.on("pivotmonitor",function(l,n){var m=this;m.pivotGridStore.data.each(function(o){var p=o.get("mapping");if(p.rendererTriggers&&Ext.Array.contains(p.rendererTriggers,n)){o.set("rec"+l.getId(),l.get(o.getId()))}})},g);var d=Ext.create(k.model);var b=[{disabled:true,locked:true,width:g.pivotHeaderColumnWidth,sortable:false,dataIndex:"pivotHeader",resizable:false,tdCls:"x-pivot-header"}];var e=[{name:"field",type:"string"},{name:"pivotHeader",type:"string",defaultValue:""},{name:"mapping",type:"Vulcan.Common.ExtJS.model.helpers.GenericMappingField",defaultValue:null},{name:"initialStore",type:"Ext.data.Store",defaultValue:null}];var c=[];Ext.each(a,function(l){e.push({name:"rec"+l.getId(),type:"string"});b.push({text:l.toString(),width:g.pivotHeaderCellWidth,sortable:false,dataIndex:"rec"+l.getId()})});var h=Vulcan.Common.ExtJS.utils.helpers.MathHelper.getGuid();Ext.define("Vulcan.Common.ExtJS.model.PivotGridDataModel"+h,{extend:"Ext.data.Model",fields:e,idProperty:"field",set:function(r,q){var p=this;if(arguments.length==2){var l=p.get("mapping");var t=new RegExp("^rec([0-9]+)$");if(t.test(r)){var m=t.exec(r);var o=parseInt(m[1],10);var s=p.get("initialStore");var n=null;if(s){var n=s.getById(o)}if(n){if(n&&n.get(l.field)!=q){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("propagating value to initial store");n.set(l.field,q);s.fireEvent("pivotmonitor",n,l.field)}}if(l&&l.renderer){if(n){q=l.renderer(q,n)}else{q=l.renderer(q)}}}p.callParent([r,q])}else{p.callParent(arguments)}}});Ext.each(d.genericMappings.getFields(),function(l){if(!g.excludedFields||!Ext.Array.contains(g.excludedFields,l.field)){var m=Ext.create("Vulcan.Common.ExtJS.model.PivotGridDataModel"+h);m.set("field",l.field);m.set("pivotHeader",l.label);m.set("mapping",l);m.set("initialStore",g.initialStore);Ext.each(a,function(n){m.set("rec"+n.getId(),n.get(l.field))});m.commit();c.push(m)}});g.pivotGridStore=Ext.create("Ext.data.ArrayStore",{model:"Vulcan.Common.ExtJS.model.PivotGridDataModel"+h});g.pivotGridStore.loadData(c);var f=[];Ext.each(b,function(m){var l=Ext.create("Ext.grid.column.Column",m);if(!m.locked){l.getEditor=g.getEditor}f.push(l)});g.reconfigure(g.pivotGridStore,f)},getEditor:function(a,b){var d=this;var c=a.get("mapping");var e=null;if(c.canEdit){switch(c.type){case"time24":e=Ext.create("Vulcan.Common.ExtJS.widget.VTime",{format:Vulcan.Common.ExtJS.utils.Settings.timeFormat,submitFormat:Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"time24",invalidText:""});break;case"int":e=Ext.create("Ext.form.field.Number",{allowDecimals:false});break;case"float":e=Ext.create("Ext.form.field.Number",{allowDecimals:true});break;default:e=Ext.create("Ext.form.field.Text");break}}d.setEditor(e);return e}});Ext.define("Vulcan.Common.ExtJS.widget.VPropertyGrid",{extend:"Ext.Component",alias:"widget.vpropertygrid",store:null,autoEl:"table",cls:"vpg-table",border:1,readOnly:false,hihglightOnClick:false,defIdField:"Id",defHeaderLabelField:"Id",excludedFields:["Id"],invCls:"x-form-invalid-field",defRowConfig:{tag:"tr",cls:"vpg-row"},defCellHeaderConfig:{tag:"td",cls:"vpg-cell-header x-grid-header-ct vpg-padding"},defCellInnerConfig:{tag:"td",cls:"vpg-cell-inner vpg-align-left vpg-padding vpg-cell-editable"},defCellReadOnlyConfig:{tag:"td",cls:"vpg-cell-inner vpg-align-left vpg-padding"},mapping:"default",defTooltipCfg:{minWidth:100,showDelay:250},initComponent:function(){var b=this,a="";b.callParent(arguments);Ext.tip.QuickTipManager.init();Ext.apply(Ext.tip.QuickTipManager.getQuickTip(),b.defTooltipCfg);b.addEvents("headerclick","headerdblclick","cellclick","celldblclick");if(!b.store){throw {msg:b.$className+" requires a store"}}if(typeof b.store=="string"){a=b.store;b.store=Ext.getStore(a);if(!b.store){b.store=Ext.create(a);b.store=Ext.regStore(b.store)}}if(!b.store||!b.store.model){throw {msg:b.$className+" requires a store definition with model"}}b.mon(b.store,"datachanged",b.storeChanged,b);b.buildInfo()},onRender:function(b,a){var c=this;c.callParent(arguments);c.buildComponent(b);return c},buildComponent:function(a){var b=this;if(!b.el){return}b.rebuild()},rebuild:function(){var k=this,a=null,h=Ext.DomHelper,g=0,c=[],e=0,d=0,l=null;if(!k.el){return}k.closeEditor(true);a=k.el.first("tbody");if(a){a.destroy()}a=k.tbody=h.append(k.el,{tag:"tbody"},true);k.store.each(function(m){c.push({id:m.get(k.defIdField),label:m.get(k.defHeaderLabelField)})});g=c.length;l=h.append(a,Ext.apply({"data-rowid":"header"},k.defRowConfig),true);h.append(l,k.defCellHeaderConfig);for(e=0;e<g;++e){var b=c[e],f=(e<g-1)?k.defCellHeaderConfig:k.appendStylesToCfg(k.defCellHeaderConfig,["vpg-border-no-r"]);h.append(l,Ext.apply({"data-colid":b.id,html:b.label},f))}k.fields.each(function(o,m){var n=k.defCellInnerConfig,p=m;if(o.display){if(!o.canEdit){n=k.defCellReadOnlyConfig}l=h.append(a,Ext.apply({"data-rowid":p},k.defRowConfig),true);h.append(l,Ext.apply({html:o.label},k.defCellHeaderConfig));Ext.Array.each(c,function(r,q){h.append(l,Ext.apply({"data-rowid":p,"data-colid":r.id},(q<g-1)?n:k.appendStylesToCfg(n,["vpg-border-no-r"])))})}});if(!k.readOnly){k.appendHandlers()}k.fillCells()},fillColumn:function(d){var c=this,b=d.get(c.defIdField),a=c.el.query("td[data-colid="+b+"][data-rowid]");Ext.Array.each(a,function(e){var g=e.getAttribute("data-rowid"),f=c.fields.getAt(g);if(f){c.setCellValue(e,f,d)}})},fillCells:function(){var a=this;a.store.each(function(b){a.fillColumn(b)})},getCellValue:function(d,f){var a=this,b=Ext.Date.format,e=null,c="";if(f){e=f.get(d.name)}if(!(e===null||typeof e=="undefined")){if(d.store){c=a.getValueFromStore(e,d,f)}else{switch(d.type){case"date":c=b(e,Vulcan.Common.ExtJS.utils.Settings.dateFormat);break;case"time24":c=b(e,Vulcan.Common.ExtJS.utils.Settings.timeFormat);break;case"int":case"float":case"number":case"numeric":c=a.ftos(e);break;default:c=e.toString()}}}return c},setCellValue:function(a,e,f){var c=this,d=c.getCellValue(e,f),b=null;if(a instanceof Ext.Element){a=a.dom}b=c.getTipText(a,e,f);a.innerHTML=d;if(b){a.setAttribute("data-qtip",b)}else{a.removeAttribute("data-qtip")}},getValueFromStore:function(g,d,f){var e=null,b=null,a=-1,c="";b=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(d.store,true);if(b){a=b.findExact(d.storeValue,g);if(a>=0){e=b.getAt(a);c=e.get(d.storeDisplay)}}return c},getTipText:function(a,b,c){return null},validate:function(d){var b=this,e=d.validate(),a=d.get(b.defIdField),c=b.el.query("td.vpg-cell-editable."+b.invCls+"[data-colid="+a+"]");Ext.Array.each(c,function(f){b.clearCellError(f)});if(!e.isValid()){e.each(function(k){var g=k.field,l=k.message,h=b.fields.indexOfKey(g),f=null;if(h>=0){f=b.el.down("td.vpg-cell-editable[data-colid="+a+"][data-rowid="+h+"]");if(f){b.setCellError(f,l)}}})}},appendStylesToCfg:function(b,a){var c=Ext.clone(b);if(a&&typeof a=="string"){c.cls+=" "+a}else{if(a&&typeof a.join=="function"){c.cls+=" "+a.join(" ")}}return c},appendHandlers:function(){var c=this,b=c.tbody,a=b.query("td.vpg-cell-editable");Ext.Array.each(a,function(d){var e=Ext.get(d);e.on("click",c.handleCellClick,c);e.on("dblclick",c.handleCellDblClick,c);e.unselectable()});a=b.query("tr[data-rowid=header] > td[data-colid]");Ext.Array.each(a,function(d){var e=Ext.get(d);e.on("click",c.handleHeaderClick,c);e.on("dblclick",c.handleHeaderDblClick,c);e.unselectable()})},handleHeaderClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(!a){return}if(c.hasListener("headerdblclick")){return}if(c.hasListener("headerclick")){b=c.getCellInfo(a);c.fireEvent("headerclick",c,b.rec)}},handleHeaderDblClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(!a){return}f.stopEvent();if(c.hasListener("headerdblclick")){b=c.getCellInfo(a);c.fireEvent("headerdblclick",c,b.rec)}},handleCellClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(c.highlightOnClick){c.highlightCell(a)}if(!a){return}if(c.hasListener("celldblclick")){return}if(c.hasListener("cellclick")){b=c.getCellInfo(a);if(c.fireEvent("cellclick",c,b.rec,b.fld,c.getCellValue(b.fld,b.rec))!==false){return}}c.handleCellEnter(f,a)},handleCellDblClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(!a){return}f.stopEvent();if(c.hasListener("celldblclick")){b=c.getCellInfo(a);c.fireEvent("celldblclick",c,b.rec,b.fld,c.getCellValue(b.fld,b.rec))}},handleCellEnter:function(d,a){var c=this,b=null;d.stopEvent();if(d.type!="keyup"&&c.editorInstance&&c.editorInstance.container&&d.within(c.editorInstance.container)){return}c.closeEditor();c.editorInstance=c.getEditor(a);if(c.editorInstance){c.editorInstance.focus()}},getCellInfo:function(a){var c=this,b={rowid:null,colid:null,rec:null,fld:null};if(a&&a instanceof Ext.Element){a=a.dom}if(a){b.rowid=parseInt(a.getAttribute("data-rowid"),10);b.colid=parseInt(a.getAttribute("data-colid"),10);if(!isNaN(b.rowid)){b.fld=c.fields.getAt(b.rowid)}if(!isNaN(b.colid)){b.rec=c.store.getById(b.colid)}}return b},getEditor:function(h){var e=this,a=(h instanceof Ext.Element)?h:Ext.get(h),c=null,g=null,b=null,k=null,d=null,f=null;if(h){c=e.getCellInfo(h);if(c.fld&&c.rec){g=c.rec.get(c.fld.name);b={id:"inp-"+c.rowid+"-"+c.colid,container:a,field:c.fld,record:c.rec,value:g,orignalValue:g,renderTo:a,width:a.getWidth()-1,height:a.getHeight()-2,enableKeyEvents:true,selectOnFocus:true,margin:0,padding:0,border:1,getCaretPos:function(){var o=this,n=this.el.down("input",true),l,m=-1;if(typeof n.selectionStart=="number"){m=n.selectionStart}else{if(document.selection&&n.createTextRange){l=document.selection.createRange();l.collapse(true);l.moveStart("character",-n.value.length);m=l.text.length}}return m},listeners:{keyup:{fn:e.editorKeyUpHandler,scope:e},keydown:{fn:e.editorKeyDownHandler,scope:e},blur:{fn:e.editorBlurHandler,scope:e}}};if(c.fld.store){k="Ext.form.field.ComboBox";f=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(c.fld.store,true);Ext.merge(b,{store:f,queryMode:"local",displayField:c.fld.storeDisplay,valueField:c.fld.storeValue,forceSelection:true})}else{switch(c.fld.type){case"object":break;case"date":k="Ext.form.field.Date";Ext.merge(b,{format:Vulcan.Common.ExtJS.utils.Settings.dateFormat});break;case"time24":k="Ext.form.field.Time";Ext.merge(b,{format:Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"time24",invalidText:""});break;case"int":case"float":case"number":case"numeric":k="Ext.form.field.Number";Ext.merge(b,{allowDecimals:(c.fld.type=="int")?false:true,decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator,spinUpEnabled:false,spinDownEnabled:false,hideTrigger:true,step:0});break;default:k="Ext.form.field.Text"}}if(k){a.dom.innerHTML="";a.addCls("vpg-focus");a.removeCls("vpg-padding");d=Ext.create(k,b)}}}return d},closeEditor:function(c){var e=this,b=e.editorInstance,a=null,d=null,g=null,f=null;if(b){a=b.container;d=b.field;g=b.record;f=b.getValue();b.destroy();a.removeCls("vpg-focus");a.addCls("vpg-padding");if(c!==true){e.store.suspendEvents();g.set(d.name,f);e.validate(g);e.store.resumeEvents()}e.fillColumn(g);e.editorInstance=null}},setCellError:function(a,c){var b=this;if(!(a instanceof Ext.Element)){a=Ext.get(a)}if(a.tip){a.tip.destroy()}a.tip=Ext.create("Ext.tip.ToolTip",{target:a,html:c,cls:"x-form-invalid-tip",bodyCls:"x-form-invalid-tip-body",trackMouse:true,renderTo:Ext.getBody()});a.addCls(b.invCls)},clearCellError:function(a){var b=this;if(!(a instanceof Ext.Element)){a=Ext.get(a)}if(a.tip){a.tip.destroy()}a.removeCls(b.invCls)},hasCellError:function(a){var b=this;return(a&&a instanceof Ext.Element&&a.hasCls(b.invCls))},editorBlurHandler:function(a,c){var b=this;if(typeof c!="undefined"){b.closeEditor()}},editorKeyDownHandler:function(a,f){var d=this,c=f.getKey(),b=d.editorInstance;if(b instanceof Ext.form.field.ComboBox&&(c==f.UP||c==f.DOWN)){return}if(c==f.TAB||c==f.ESC||c==f.UP||c==f.DOWN){f.stopEvent()}},editorKeyUpHandler:function(b,h){var g=this,d=h.getKey(),c=g.editorInstance,f=null,k=c.getCaretPos(),a=c.getRawValue().length;if(c instanceof Ext.form.field.ComboBox&&(d==h.UP||d==h.DOWN)){return}if(d==h.ENTER){f=g.findNextCellByColumn(c.container);if(!f){g.closeEditor()}}else{if(d==h.ESC){g.closeEditor(true)}else{if(d==h.TAB){f=h.shiftKey?g.findPrevCell(c.container):g.findNextCell(c.container)}else{if(d==h.UP){f=g.findUpperCell(c.container)}else{if(d==h.DOWN){f=g.findLowerCell(c.container)}else{if(d==h.LEFT){if(k===0&&(typeof c.lastPos!="undefined"&&c.lastPos===0||a===0)){f=c.container.prev("td.vpg-cell-editable")}else{c.lastPos=k}}else{if(d==h.RIGHT){if(k==a&&(typeof c.lastPos!="undefined"&&c.lastPos===a||a===0)){f=c.container.next("td.vpg-cell-editable")}else{c.lastPos=k}}else{c.lastPos=k}}}}}}}if(f){g.handleCellEnter(h,f.dom)}},findNextCell:function(d){var b=this,c=d.up("tr"),a=null;a=d.next(".vpg-cell-editable");while(!a){c=c.next();if(!c){c=b.tbody.down("tr")}a=c.down(".vpg-cell-editable")}return a},findPrevCell:function(d){var b=this,c=d.up("tr"),a=null;a=d.prev(".vpg-cell-editable");while(!a){c=c.prev();if(!c){c=b.tbody.last("tr")}a=c.last(".vpg-cell-editable")}return a},findUpperCell:function(e){var c=this,d=e.up("tr"),b=e.dom.getAttribute("data-colid"),a=null;d=d.prev();while(d&&!a){a=d.first("td.vpg-cell-editable[data-colid="+b+"]");if(!a){d=d.prev()}}return a},findLowerCell:function(e){var c=this,d=e.up("tr"),b=e.dom.getAttribute("data-colid"),a=null;d=d.next();while(d&&!a){a=d.first("td.vpg-cell-editable[data-colid="+b+"]");if(!a){d=d.next()}}return a},findNextCellByColumn:function(e){var c=this,d=e.up("tr"),b=e.dom.getAttribute("data-colid"),a=null;d=d.next();while(true){while(d&&!a){a=d.first("td.vpg-cell-editable[data-colid="+b+"]");if(!a){d=d.next()}}if(!d){e=e.next("td.vpg-cell-editable");if(!e){break}b=e.dom.getAttribute("data-colid");d=c.tbody.down("tr")}else{break}}return a},getCellEventTarget:function(a){var c=this,b=null;if(!a){return null}if(a instanceof Ext.Element){a=a.dom}if(a.hasAttribute("data-colid")){b=a}else{a=Ext.get(a);b=a.up("td[data-colid]")}return b},highlightCell:function(a){var c=this,b=c.el.query("td.vpg-highlight");if(b){Ext.Array.each(b,function(d){d=Ext.get(d);d.removeCls("vpg-highlight")})}if(a){if(!(a instanceof Ext.Element)){a=Ext.get(a)}a.addCls("vpg-highlight")}},isExcludedField:function(c){var b=this,a=false;if(b.excludedFields&&b.excludedFields.length>0){Ext.Array.each(b.excludedFields,function(d){if(d==c){a=true;return false}return true})}return a},buildInfo:function(){var c=this,b=Ext.ClassManager.get(c.store.self.prototype.model),e=c.store.model.getGenericMapping(c.mapping),a=e.fields.items,d=["type","label","store","storeDisplay","storeValue"];c.fields=new Ext.util.MixedCollection();c.info={fields:a,mappings:e};if(a){Ext.Array.each(a,function(h){var g=null,f=c.fields.add(h.field,{name:h.field,display:!c.isExcludedField(h.field),canEdit:(typeof h.canEdit!="undefined"?h.canEdit:true)});Ext.Array.each(d,function(k){if(typeof h[k]!="undefined"){f[k]=h[k]}});if(typeof f.type=="undefined"){g=a.get(f.name);if(g&&g.type){f.type=g.type.type}}})}},hasErrors:function(){var b=this,a=[];if(b.el){a=Ext.query("."+b.invCls,b.el.dom)}return(a!==null&&a.length>0)},find:function(a,c){var b=null;if(typeof c=="function"){Ext.Array.each(a,function(d){if(c(d)){b=d;return false}})}return b},storeChanged:function(){var a=this;a.rebuild()},stof:function(a){var b=typeof a;if(b=="string"){return parseFloat(a.replace(",","."))}if(b=="number"){return a}return NaN},ftos:function(b){var a=(typeof b=="number")?b.toString():"";return a.replace(".",",")}});Ext.define("Vulcan.Common.ExtJS.widget.VPropertyGrid2",{extend:"Ext.Component",alias:"widget.vpropertygrid2",store:null,autoEl:"div",cls:"vpg-container",border:1,readOnly:false,hihglightOnClick:false,defIdField:"Id",defHeaderLabelField:"Id",excludedFields:["Id"],invCls:"x-form-invalid-field",mapping:"default",defTooltipCfg:{minWidth:100,showDelay:250},defRowConfig:{tag:"tr",cls:"vpg-row"},defCellHeaderConfig:{tag:"td",cls:"vpg-cell-header x-grid-header-ct vpg-padding"},defCellInnerConfig:{tag:"td",cls:"vpg-cell-inner vpg-align-left vpg-padding vpg-cell-editable"},defCellReadOnlyConfig:{tag:"td",cls:"vpg-cell-inner vpg-align-left vpg-padding"},defHeaderHeight:24,defWidthMargin:12,defVScrollBarCompensation:17,defCellMinWidth:120,renderTpl:Ext.create("Ext.XTemplate",'<div id="{id}-header-left-container" class="vpg-header-container left v-unselectable vpg-br-border">',"<table>",'<tbody><td class="vpg-cell-header x-grid-header-ct">&nbsp;</td></tbody>',"</table>","</div>",'<div id="{id}-header-center-container" class="vpg-header-container center v-unselectable vpg-br-border">',"<table>","<tbody></tbody>","</table>","</div>",'<div id="{id}-list-left-container" class="vpg-list-container left v-unselectable vpg-br-border">',"<table>","<tbody></tbody>","</table>","</div>",'<div id="{id}-body-container" class="vpg-body-container v-unselectable vpg-br-border">',"<table>","<tbody></tbody>","</table>","</div>"),renderSelectors:{headerLeftEl:"div.vpg-header-container.left",headerCenterEl:"div.vpg-header-container.center",listLeftEl:"div.vpg-list-container.left",bodyEl:"div.vpg-body-container"},initComponent:function(){var b=this,a="";b.callParent(arguments);Ext.tip.QuickTipManager.init();Ext.apply(Ext.tip.QuickTipManager.getQuickTip(),b.defTooltipCfg);b.addEvents("headerclick","headerdblclick","cellclick","celldblclick");if(!b.store){throw {msg:b.$className+" requires a store"}}if(typeof b.store=="string"){a=b.store;b.store=Ext.getStore(a);if(!b.store){b.store=Ext.create(a);b.store=Ext.regStore(b.store)}}if(!b.store||!b.store.model){throw {msg:b.$className+" requires a store definition with model"}}b.mon(b.store,"datachanged",b.storeChanged,b);b.on("resize",b.correctSize);b.buildInfo()},onRender:function(b,a){var c=this;c.callParent(arguments);c.buildComponent(b);return c},buildComponent:function(a){var b=this;if(!b.el){return}b.rebuild()},rebuild:function(){var h=this,g=Ext.DomHelper,f=0,b=[],m=null,e=0,d=0,k=null,l=null,c=null;if(!h.el){return}h.closeEditor(true);h.destroyContents();k=h.headerCenterEl.down(">table>tbody");l=h.listLeftEl.down(">table>tbody");c=h.bodyEl.down(">table>tbody");h.store.each(function(n){b.push({id:n.get(h.defIdField),label:n.get(h.defHeaderLabelField)})});f=b.length;m=g.append(k,Ext.apply({"data-rowid":"header"},h.defRowConfig),true);for(e=0;e<f;++e){var a=b[e];h.innerMap.headers.push(g.append(m,Ext.apply({"data-colid":a.id,html:a.label},h.defCellHeaderConfig)))}h.fields.each(function(p,n){var o=h.defCellInnerConfig,q=n;if(p.display){if(!p.canEdit){o=h.defCellReadOnlyConfig}m=g.append(l,Ext.apply({"data-rowid":q},h.defRowConfig),true);h.innerMap.props.push(g.append(m,Ext.apply({html:p.label},h.defCellHeaderConfig)));m=g.append(c,Ext.apply({"data-rowid":q},h.defRowConfig),true);h.innerMap.rows.push(m);Ext.Array.each(b,function(s,r){g.append(m,Ext.apply({"data-rowid":q,"data-colid":s.id},o))})}});if(!h.readOnly){h.appendHandlers()}h.appendScrollHandler();h.fillCells()},destroyContents:function(){var a=this;a.headerCenterEl.select(">table tr").clear(true);a.listLeftEl.select(">table tr").clear(true);a.bodyEl.select(">table tr").clear(true);a.innerMap={headers:[],props:[],rows:[]}},correctSize:function(m){var l=this,b=1,n=1,o=1,f=1,a=1,e=1,h=null,g;if(!(Ext.isDefined(m)&&m===true)){l.correctPropertyListCells();l.correctHeaderCells()}b=l.getWidth();n=l.getHeight();o=l.listLeftEl.down(">table>tbody").getWidth();f=l.bodyEl.down(">table>tbody").getWidth()+l.defVScrollBarCompensation;a=l.bodyEl.down(">table>tbody").getHeight();e=l.defHeaderHeight;f=Math.min(f,b-o);a=Math.min(a,n-e);g={headerLeftEl:{top:0,left:0,width:o,height:e},headerCenterEl:{top:0,left:o,width:f,height:e},listLeftEl:{top:e,left:0,width:o,height:a},bodyEl:{top:e,left:o,width:f,height:a}};for(h in g){if(g.hasOwnProperty(h)){var d=l[h],k=g[h];d.setLeftTop(k.left,k.top);d.setSize(k.width,k.height)}}l.headerLeftEl.select(">table").setSize(o,e)},correctPropertyListCells:function(){var b=this,d=0,a=b.innerMap.props,c=Ext.create("Ext.CompositeElement");Ext.each(a,function(e){var f=Ext.fly(e).getTextWidth()+b.defWidthMargin;if(f>d){d=f}c.add(e)});c.setWidth(d).setHeight(b.defHeaderHeight)},correctHeaderCells:function(){var a=this,b=a.innerMap.headers;Ext.each(b,function(d,c){var f=Math.max(Ext.fly(d).getTextWidth()+a.defWidthMargin,d.offsetWidth,a.defCellMinWidth),e=Ext.create("Ext.CompositeElement").add(a.getColumnCellsByIndex(c));e.each(function(h){var g=Math.max(10+a.defWidthMargin,h.dom.offsetWidth,a.defCellMinWidth);if(g>f){f=g}});Ext.fly(d).setWidth(f).setHeight(a.defHeaderHeight);e.setWidth(f).setHeight(a.defHeaderHeight)})},correctBodyCells:function(){var d=this,c=[],f=[],e=d.innerMap.headers,a=d.innerMap.props,b=d.innerMap.rows;Ext.each(e,function(g){c.push(g.offsetWidth)});Ext.each(a,function(g){f.push(g.offsetHeight)});Ext.each(b,function(k,h){var g=k.query(">td");Ext.each(g,function(l,m){Ext.fly(l).setSize(c[m],f[h])})})},correctColumn:function(b){var d=this,a=b.up("tr").select(">td").indexOf(b),e=(a>=0)?d.innerMap.headers[a]:null,c=(a>=0)?Ext.create("Ext.CompositeElement").add(d.getColumnCellsByIndex(a)):null,f=0;if(e&&c){f=Math.max(Ext.fly(e).getTextWidth()+d.defWidthMargin,e.offsetWidth,d.defCellMinWidth);c.each(function(h){var g=Math.max(h.getTextWidth()+d.defWidthMargin,h.dom.offsetWidth,d.defCellMinWidth);if(g>f){f=g}});Ext.fly(e).setWidth(f).setHeight(d.defHeaderHeight);c.setWidth(f).setHeight(d.defHeaderHeight)}},handleBodyScroll:function(){var c=this,b=c.headerCenterEl.down(">table"),d=c.listLeftEl.down(">table"),a=c.bodyEl.getScroll();b.setLeft(-a.left);d.setTop(-a.top)},appendScrollHandler:function(){var a=this;a.bodyEl.un("scroll",a.handleBodyScroll,a);a.bodyEl.on("scroll",a.handleBodyScroll,a)},fillColumn:function(d){var c=this,b=d.get(c.defIdField),a=c.getColumnCellsByColumnId(b);Ext.Array.each(a,function(e){var g=e.getAttribute("data-rowid"),f=c.fields.getAt(g);if(f){c.setCellValue(e,f,d)}})},fillCells:function(){var a=this;a.store.each(function(b){a.fillColumn(b)})},getCellValue:function(d,f){var a=this,b=Ext.Date.format,e=null,c="";if(f){e=f.get(d.name)}if(!(e===null||typeof e=="undefined")){if(d.store){c=a.getValueFromStore(e,d,f)}else{switch(d.type){case"date":c=b(e,Vulcan.Common.ExtJS.utils.Settings.dateFormat);break;case"time24":c=b(e,Vulcan.Common.ExtJS.utils.Settings.timeFormat);break;case"int":case"float":case"number":case"numeric":c=a.ftos(e);break;default:c=e.toString()}}}return c},setCellValue:function(a,e,f){var c=this,d=c.getCellValue(e,f),b=null;if(a instanceof Ext.Element){a=a.dom}b=c.getTipText(a,e,f);a.innerHTML=d;if(b){a.setAttribute("data-qtip",b)}else{a.removeAttribute("data-qtip")}},getValueFromStore:function(a,b,c){var g=this,d=null,h=null,k=-1,f="",e=Ext.isDefined(b.store.displayField)?b.store.displayField:b.storeDisplay,l=Ext.isDefined(b.store.valueField)?b.store.valueField:b.storeValue,h=g.getFieldStore(b);if(h){k=h.findExact(l,a);if(k>=0){d=h.getAt(k);f=d.get(e)}}return f},getTipText:function(a,b,c){return null},validate:function(d){var b=this,e=d.validate(),a=d.get(b.defIdField),c=b.el.query("td.vpg-cell-editable."+b.invCls+"[data-colid="+a+"]");Ext.Array.each(c,function(f){b.clearCellError(f)});if(!e.isValid()){e.each(function(k){var g=k.field,l=k.message,h=b.fields.indexOfKey(g),f=null;if(h>=0){f=b.el.down("td.vpg-cell-editable[data-colid="+a+"][data-rowid="+h+"]");if(f){b.setCellError(f,l)}}})}},appendStylesToCfg:function(b,a){var c=Ext.clone(b);if(a&&typeof a=="string"){c.cls+=" "+a}else{if(a&&typeof a.join=="function"){c.cls+=" "+a.join(" ")}}return c},appendHandlers:function(){var b=this,a=b.bodyEl.query(">table td.vpg-cell-editable");Ext.Array.each(a,function(d){var e=Ext.get(d);e.on("click",b.handleCellClick,b);e.on("dblclick",b.handleCellDblClick,b);e.unselectable()});a=b.headerCenterEl.query(">table td[data-colid]");Ext.Array.each(a,function(d){var e=Ext.get(d);e.on("click",b.handleHeaderClick,b);e.on("dblclick",b.handleHeaderDblClick,b);e.unselectable()})},handleHeaderClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(!a){return}if(c.hasListener("headerdblclick")){return}if(c.hasListener("headerclick")){b=c.getCellInfo(a);c.fireEvent("headerclick",c,b.rec)}},handleHeaderDblClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(!a){return}f.stopEvent();if(c.hasListener("headerdblclick")){b=c.getCellInfo(a);c.fireEvent("headerdblclick",c,b.rec)}},handleCellClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(c.highlightOnClick){c.highlightCell(a)}if(!a){return}if(c.hasListener("celldblclick")){return}if(c.hasListener("cellclick")){b=c.getCellInfo(a);if(c.fireEvent("cellclick",c,b.rec,b.fld,c.getCellValue(b.fld,b.rec))!==false){return}}c.handleCellEnter(f,a)},handleCellDblClick:function(f,d){var c=this,b=null,a=c.getCellEventTarget(d);if(!a){return}f.stopEvent();if(c.hasListener("celldblclick")){b=c.getCellInfo(a);c.fireEvent("celldblclick",c,b.rec,b.fld,c.getCellValue(b.fld,b.rec))}},handleCellEnter:function(d,a){var c=this,b=null;d.stopEvent();if(d.type!="keyup"&&c.editorInstance&&c.editorInstance.container&&d.within(c.editorInstance.container)){return}c.closeEditor();c.editorInstance=c.getEditor(a);if(c.editorInstance){c.editorInstance.focus()}},getCellInfo:function(a){var c=this,b={rowid:null,colid:null,rec:null,fld:null};if(a&&a instanceof Ext.Element){a=a.dom}if(a){b.rowid=parseInt(a.getAttribute("data-rowid"),10);b.colid=parseInt(a.getAttribute("data-colid"),10);if(!isNaN(b.rowid)){b.fld=c.fields.getAt(b.rowid)}if(!isNaN(b.colid)){b.rec=c.store.getById(b.colid)}}return b},getEditor:function(h){var e=this,a=(h instanceof Ext.Element)?h:Ext.get(h),c=null,g=null,b=null,k=null,d=null,f=null;if(h){c=e.getCellInfo(h);if(c.fld&&c.rec){g=c.rec.get(c.fld.name);b={id:"inp-"+c.rowid+"-"+c.colid,container:a,field:c.fld,record:c.rec,value:g,orignalValue:g,renderTo:a,width:a.getWidth(),height:a.getHeight()-1,enableKeyEvents:true,selectOnFocus:true,margin:0,padding:0,border:1,getCaretPos:function(){var o=this,n=this.el.down("input",true),l,m=-1;if(typeof n.selectionStart=="number"){m=n.selectionStart}else{if(document.selection&&n.createTextRange){l=document.selection.createRange();l.collapse(true);l.moveStart("character",-n.value.length);m=l.text.length}}return m},listeners:{keyup:{fn:e.editorKeyUpHandler,scope:e},keydown:{fn:e.editorKeyDownHandler,scope:e},blur:{fn:e.editorBlurHandler,scope:e}}};if(c.fld.store){k="Vulcan.Common.ExtJS.widget.Valdict";f=e.getFieldStore(c.fld);Ext.merge(b,{store:f,queryMode:"local",displayField:Ext.isDefined(c.fld.store.displayField)?c.fld.store.displayField:c.fld.storeDisplay,valueField:Ext.isDefined(c.fld.store.valueField)?c.fld.store.valueField:c.fld.storeValue,forceSelection:true,combo:(c.fld.type=="combo")})}else{switch(c.fld.type){case"object":break;case"date":k="Ext.form.field.Date";Ext.merge(b,{format:Vulcan.Common.ExtJS.utils.Settings.dateFormat});break;case"time24":k="Vulcan.Common.ExtJS.widget.VTime";Ext.merge(b,{format:Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"time24",invalidText:""});break;case"int":case"float":case"number":case"numeric":k="Ext.form.field.Number";Ext.merge(b,{allowDecimals:(c.fld.type=="int")?false:true,decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator,spinUpEnabled:false,spinDownEnabled:false,hideTrigger:true,step:0});break;default:k="Ext.form.field.Text"}}if(k){a.dom.innerHTML="";a.addCls("vpg-focus vpg-relative");a.removeCls("vpg-padding x-form-invalid-field");d=Ext.create(k,b)}}}return d},closeEditor:function(c){var e=this,b=e.editorInstance,a=null,d=null,g=null,f=null;if(b){a=b.container;d=b.field;g=b.record;f=b.getValue();b.destroy();a.removeCls("vpg-focus vpg-relative");a.addCls("vpg-padding");if(c!==true){e.store.suspendEvents();g.set(d.name,f);e.validate(g);e.store.resumeEvents()}e.fillColumn(g);e.editorInstance=null;e.correctColumn(a);e.correctSize(true)}},getFieldStore:function(f){var e=this,c=null,a=null,b=null,d=null;a=Ext.isString(f.store)?f.store:f.store.source;b=Ext.isObject(f.store)?f.store.params:{};d=Ext.isObject(f.store)?f.store.config:{};c=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(a,true,false,b,d);return c},setCellError:function(a,c){var b=this;if(!(a instanceof Ext.Element)){a=Ext.get(a)}if(a.tip){a.tip.destroy()}a.tip=Ext.create("Ext.tip.ToolTip",{target:a,html:c,cls:"x-form-invalid-tip",bodyCls:"x-form-invalid-tip-body",trackMouse:true,renderTo:Ext.getBody()});a.addCls(b.invCls)},clearCellError:function(a){var b=this;if(!(a instanceof Ext.Element)){a=Ext.get(a)}if(a.tip){a.tip.destroy()}a.removeCls(b.invCls)},hasCellError:function(a){var b=this;return(a&&a instanceof Ext.Element&&a.hasCls(b.invCls))},editorBlurHandler:function(a,c){var b=this;if(typeof c!="undefined"){b.closeEditor()}},editorKeyDownHandler:function(a,f){var d=this,c=f.getKey(),b=d.editorInstance;if(b instanceof Ext.form.field.ComboBox&&(c==f.UP||c==f.DOWN)){return}if(c==f.TAB||c==f.ESC||c==f.UP||c==f.DOWN){f.stopEvent()}},editorKeyUpHandler:function(b,h){var g=this,d=h.getKey(),c=g.editorInstance,f=null,k=c.getCaretPos(),a=c.getRawValue().length;if(c instanceof Ext.form.field.ComboBox&&(d==h.UP||d==h.DOWN)){return}if(d==h.ENTER){f=g.findNextCellByColumn(c.container);if(!f){g.closeEditor()}}else{if(d==h.ESC){g.closeEditor(true)}else{if(d==h.TAB){f=h.shiftKey?g.findPrevCell(c.container):g.findNextCell(c.container)}else{if(d==h.UP){f=g.findUpperCell(c.container)}else{if(d==h.DOWN){f=g.findLowerCell(c.container)}else{if(d==h.LEFT){if(k===0&&(typeof c.lastPos!="undefined"&&c.lastPos===0||a===0)){f=c.container.prev("td.vpg-cell-editable")}else{c.lastPos=k}}else{if(d==h.RIGHT){if(k==a&&(typeof c.lastPos!="undefined"&&c.lastPos===a||a===0)){f=c.container.next("td.vpg-cell-editable")}else{c.lastPos=k}}else{c.lastPos=k}}}}}}}if(f){g.handleCellEnter(h,f.dom)}},findNextCell:function(d){var b=this,c=d.up("tr"),a=null;a=d.next(".vpg-cell-editable");while(!a){c=c.next();if(!c){c=b.tbody.down("tr")}a=c.down(".vpg-cell-editable")}return a},findPrevCell:function(d){var b=this,c=d.up("tr"),a=null;a=d.prev(".vpg-cell-editable");while(!a){c=c.prev();if(!c){c=b.tbody.last("tr")}a=c.last(".vpg-cell-editable")}return a},findUpperCell:function(e){var c=this,d=e.up("tr"),b=e.dom.getAttribute("data-colid"),a=null;d=d.prev();while(d&&!a){a=d.first("td.vpg-cell-editable[data-colid="+b+"]");if(!a){d=d.prev()}}return a},findLowerCell:function(e){var c=this,d=e.up("tr"),b=e.dom.getAttribute("data-colid"),a=null;d=d.next();while(d&&!a){a=d.first("td.vpg-cell-editable[data-colid="+b+"]");if(!a){d=d.next()}}return a},findNextCellByColumn:function(e){var c=this,d=e.up("tr"),b=e.dom.getAttribute("data-colid"),a=null;d=d.next();while(true){while(d&&!a){a=d.first("td.vpg-cell-editable[data-colid="+b+"]");if(!a){d=d.next()}}if(!d){e=e.next("td.vpg-cell-editable");if(!e){break}b=e.dom.getAttribute("data-colid");d=c.tbody.down("tr")}else{break}}return a},getCellEventTarget:function(a){var c=this,b=null;if(!a){return null}if(a instanceof Ext.Element){a=a.dom}if(a.hasAttribute("data-colid")){b=a}else{a=Ext.get(a);b=a.up("td[data-colid]")}return b},highlightCell:function(a){var c=this,b=c.el.query("td.vpg-highlight");if(b){Ext.Array.each(b,function(d){d=Ext.get(d);d.removeCls("vpg-highlight")})}if(a){if(!(a instanceof Ext.Element)){a=Ext.get(a)}a.addCls("vpg-highlight")}},isExcludedField:function(c){var b=this,a=false;if(b.excludedFields&&b.excludedFields.length>0){Ext.Array.each(b.excludedFields,function(d){if(d==c){a=true;return false}return true})}return a},buildInfo:function(){var c=this,b=Ext.ClassManager.get(c.store.self.prototype.model),e=c.store.model.getGenericMapping(c.mapping),a=e.fields.items,d=["type","label","store","storeDisplay","storeValue"];c.fields=new Ext.util.MixedCollection();c.info={fields:a,mappings:e};if(a){Ext.Array.each(a,function(h){var g=null,f=c.fields.add(h.field,{name:h.field,display:!c.isExcludedField(h.field),canEdit:(typeof h.canEdit!="undefined"?h.canEdit:true)});Ext.Array.each(d,function(k){if(typeof h[k]!="undefined"){f[k]=h[k]}});if(typeof f.type=="undefined"){g=a.get(f.name);if(g&&g.type){f.type=g.type.type}}})}},hasErrors:function(){var b=this,a=[];if(b.el){a=Ext.query("."+b.invCls,b.el.dom)}return(a!==null&&a.length>0)},find:function(a,c){var b=null;if(typeof c=="function"){Ext.Array.each(a,function(d){if(c(d)){b=d;return false}})}return b},storeChanged:function(){var a=this;a.rebuild();a.correctSize()},stof:function(a){var b=typeof a;if(b=="string"){return parseFloat(a.replace(",","."))}if(b=="number"){return a}return NaN},ftos:function(b){var a=(typeof b=="number")?b.toString():"";return a.replace(".",",")},getColumnCellsByIndex:function(a){var c=this,b=[];Ext.each(c.innerMap.rows,function(d){b.push(d.dom.cells[a])});return b},getColumnIndexByColumnId:function(b){var c=this,a=-1;Ext.each(c.innerMap.headers,function(e,d){if(e.getAttribute("data-colid")==b){a=d;return false}});return a},getColumnCellsByColumnId:function(c){var d=this,b=[],a=d.getColumnIndexByColumnId(c);if(a>=0){b=d.getColumnCellsByIndex(a)}return b}});Ext.define("Vulcan.Common.ExtJS.widget.VSwitchPanel",{extend:"Ext.container.Container",alias:["widget.vswitchpanel","widget.v-switchpanel","widget.v-switch-panel"],mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget"},cls:"v-switchpanel",layout:{type:"hbox",align:"stretch"},cfgGrids:{},defGrids:{showPrintButton:false,showSearchBox:false,multiselect:true,flex:1},cfgLeftGrid:{},defLeftGrid:{},cfgRightGrid:{},defRightGrid:{orderable:true},cfgSwitchButton:{},defSwitchButton:{width:30,height:30,margin:10,leftToRightText:">",rightToLeftText:"<"},cfgSwitchAllButton:{},defSwitchAllButton:{width:30,height:30,margin:10,leftToRightText:">>",rightToLeftText:"<<"},showMoveAll:false,switchInProgress:false,leftToRight:true,cloning:false,readOnly:false,initComponent:function(){var a=this;a.callParent(arguments);a.initDeprecated();a.initDefaults();a.initEvents();a.initControls()},initDefaults:function(){var a=this},initDeprecated:function(){var a=this},initEvents:function(){var a=this;a.addEvents("beforeswitch","afterswitch","beforeitemswitch","afteritemswitch")},refreshDirection:function(){var a=this;if(a.leftToRight){a.rightGrid.getSelectionModel().deselectAll();a.switchButton.setText(a.switchButton.leftToRightText);if(a.showMoveAll===true){a.switchAllButton.setText(a.switchAllButton.leftToRightText)}}else{a.leftGrid.getSelectionModel().deselectAll();a.switchButton.setText(a.switchButton.rightToLeftText);if(a.showMoveAll===true){a.switchAllButton.setText(a.switchAllButton.rightToLeftText)}}},initLeftGrid:function(){var b=this,a={};Ext.apply(a,b.defGrids);Ext.apply(a,b.defLeftGrid);Ext.apply(a,b.cfgGrids);Ext.apply(a,b.cfgLeftGrid);b.leftGrid=Ext.widget("vgrid",a);b.leftGrid.on({click:{element:"body",fn:function(){b.leftToRight=true;b.refreshDirection()},scope:b},celldblclick:{fn:b.switchSingleFn,scope:b}});b.add(b.leftGrid)},initRightGrid:function(){var b=this,a={};Ext.apply(a,b.defGrids);Ext.apply(a,b.defRightGrid);Ext.apply(a,b.cfgGrids);Ext.apply(a,b.cfgRightGrid);b.rightGrid=Ext.widget("vgrid",a);b.rightGrid.on({click:{element:"body",fn:function(){b.leftToRight=false;b.refreshDirection()},scope:b},celldblclick:{fn:b.switchSingleFn,scope:b}});b.add(b.rightGrid)},initSwitchButton:function(){var b=this,a={};Ext.apply(a,b.defSwitchButton);Ext.apply(a,b.cfgSwitchButton);b.switchButton=Ext.widget("button",a);b.switchButton.on({click:{fn:b.switchSingleFn,scope:b}});b.manipulatorsContainer.add(b.switchButton)},initSwitchAllButton:function(){var b=this,a={};Ext.apply(a,b.defSwitchAllButton);Ext.apply(a,b.cfgSwitchAllButton);b.switchAllButton=Ext.widget("button",a);b.switchAllButton.on({click:{fn:b.switchAllFn,scope:b}});b.manipulatorsContainer.add(b.switchAllButton)},initManipulatorsContainer:function(){var b=this,a={};b.manipulatorsContainer=Ext.widget("container",{layout:{type:"vbox",align:"stretch",pack:"center"}});b.initSwitchButton();if(b.showMoveAll){b.initSwitchAllButton()}b.add(b.manipulatorsContainer)},initControls:function(){var a=this;a.initLeftGrid();a.initManipulatorsContainer();a.initRightGrid();a.refreshDirection()},mapping:[],idPropertyCounter:-1,idPropertyFn:function(a){var b=this;return b.idPropertyCounter--},mappingFn:function(b){var c=this,a=(c.leftToRight)?Ext.create(c.rightGrid.getStore().model):Ext.create(c.leftGrid.getStore().model);a.set(b.getData());a.set(a.idProperty,c.idPropertyFn(a));Ext.each(c.mapping,function(d){if(d.left&&d.right){if(c.leftToRight){a.set(d.right,b.get(d.left))}else{a.set(d.left,b.get(d.right))}}});return a},switchFn:function(n,d){var k=this,a=k.leftGrid.getStore(),e=k.rightGrid.getStore(),f=k.leftToRight?n:d,l=k.leftToRight?d:n,b=k.leftToRight?a:e,g=k.leftToRight?e:a,h=k.cloning===true||k.cloning===(k.leftToRight?"left":"right"),m=k.readOnly===(k.leftToRight?"right":"left");if(k.switchInProgress){return}k.switchInProgress=true;if(k.fireEvent("beforeswitch",k,f,l)!==false){var o=[],c=[];Ext.each(f,function(q){var p=k.mappingFn(q);if(p){if(k.fireEvent("beforeitemswitch",k,q,p)!==false){if(!m&&!g.data.containsKey(p.getId())){o.push(p)}if(!h){c.push(q)}k.fireEvent("afteritemswitch",k,q,p)}}});b.suspendEvents(true);g.suspendEvents(true);b.remove(c);g.add(o);b.resumeEvents();g.resumeEvents();k.leftGrid.getView().refresh();k.rightGrid.getView().refresh();k.fireEvent("afterswitch",k)}k.switchInProgress=false},switchAllFn:function(){var a=this,b=a.leftGrid.getStore().getRange(),c=a.rightGrid.getStore().getRange();a.switchFn(b,c)},switchSingleFn:function(){var a=this,b=a.leftGrid.getSelectionModel().getSelection(),c=a.rightGrid.getSelectionModel().getSelection();a.switchFn(b,c)}});Ext.define("Vulcan.Common.ExtJS.widget.VTime",{extend:"Ext.form.field.Picker",alias:"widget.vtimefield",requires:["Vulcan.Common.ExtJS.widget.picker.VTimePicker"],cls:"vtp-field",enableKeyEvents:true,matchFieldWidth:false,maxLength:5,enforceMaxLength:true,stripCharsReEx:/[^0-9:]/g,locale:{invalidValue:"Prawidłowy format godziny to: GG:MM",outOfRange:"Wartość spoza dopuszczalnego zakresu"},hourMin:0,hourMax:23,showButtonNow:true,closeOnSelect:false,showButtonClear:true,dateFormat:"Y-m-d H:i:s",initComponent:function(){var a=this;if(a.showButtonClear){a.trigger2Cls="x-form-clear-trigger"}a.callParent();a.addEvents("select");a.on({keyup:{scope:a,fn:a.handleKey},keypress:{scope:a,fn:a.handleKey}})},setValue:function(d,a){var c=this,b=null;if(typeof a=="undefined"){a=false}if(Ext.isString(d)){b=c.parse(d);if(b!==null){b=c.clearDateParts(b);d=c.ggmm(b)}else{d=""}}else{if(Ext.isDate(d)){d=c.clearDateParts(d);d=c.ggmm(d)}}c.setRawValue(d);if(c.isExpanded&&a){c.onExpand()}c.checkChange();return c},getValue:function(){var b=this,c=b.getRawValue(),a=null;if(c!==null&&c.length>0){a=Ext.Date.parse(c,"H:i");if(Ext.isDate(a)){a=b.clearDateParts(a)}else{a=null}}return a},handleKey:function(a,d){var c=this,b=Ext.EventObject;if(d.getKey()==b.T&&c.showButtonNow){c.setValue(new Date());d.stopEvent()}else{c.stripChars(a,d);if(c.isExpanded){c.onExpand()}}},stripChars:function(a,d){var c=this,f=c.getRawValue(),b=null;if(f!==null&&f.length>0){b=f.replace(c.stripCharsReEx,"");if(f!=b){c.setRawValue(b)}}},createPicker:function(){var a=this;return Ext.create("Vulcan.Common.ExtJS.widget.picker.VTimePicker",a.getPickerConfig())},onDownArrow:function(b){var a=this;a.callParent(arguments);if(a.isExpanded){a.getPicker().focus()}},onSelect:function(a,c){var b=this;b.setValue(c,false);b.fireEvent("select",b,b.getValue())},onExpand:function(){var a=this,c=a.getRawValue(),b=Ext.isString(c)?c.split(":"):[];a.picker.suspendEvent("select");a.picker.setTime(b[0],b[1]);a.picker.resumeEvent("select")},onCollapse:function(){var a=this;a.focus(false,60)},onTrigger2Click:function(){var a=this;if(a.isExpanded){a.picker.setTime(null,null)}else{a.setValue("")}},getPickerConfig:function(){var c=this,b={pickerField:c,ownerCt:c.ownerCt,renderTo:document.body,hidden:true,floating:true,focusOnShow:true,listeners:{scope:c,select:c.onSelect},keyNavConfig:{esc:function(){c.collapse()}}},a=["hourMin","hourMax","hourInterval","hourBreakRow","minuteInterval","minuteBreakRow","showButtonNow","closeOnSelect"];Ext.each(a,function(d){if(c.hasOwnProperty(d)){b[d]=c[d]}});return b},getErrors:function(e){var c=this,b=parseInt(c.hourMin,10),a=parseInt(c.hourMax,10),g=c.getRawValue(),h=c.callParent(arguments),f=null,d=/^[0-9]{2}:[0-9]{2}$/;if(g===null||g.length<1){return h}if(!d.test(g)){h.push(c.locale.invalidValue)}else{f=g.split(":");f[0]=parseInt(f[0],10);f[1]=parseInt(f[1],10);if(f[0]<b||f[0]>a||f[1]<0||f[1]>59){h.push(c.locale.outOfRange)}}return h},prepend:function(a){return("0"+a).slice(-2)},ggmm:function(a){return this.prepend(a.getHours())+":"+this.prepend(a.getMinutes())},parse:function(f){var g=this,c=null,h="",b=[{rex:null,fm:"H:i"},{rex:null,fm:"G:i"},{rex:null,fm:":i"},{rex:null,fm:g.dateFormat},{rex:null,fm:"Y-m-d H:i:s"},{rex:/\s\([\s\S]*$/g,fm:"D M d Y H:i:s TO"}];for(var e=0,a=b.length,d=b[e];d!==null;++e,c=null,d=(e<a)?b[e]:null){if(d.rex!==null){h=f.replace(d.rex,"")}else{h=f}c=Ext.Date.parse(h,d.fm);if(Ext.isDate(c)){break}}return c},clearDateParts:function(a){a.setFullYear(1900);a.setMonth(0);a.setDate(1);a.setSeconds(0);a.setMilliseconds(0);return a}});Ext.define("Vulcan.Common.ExtJS.plugin.combobox.FilterExtension",{alias:"plugin.filterextension"});Ext.define("Vulcan.Common.ExtJS.plugin.grid.CheckboxExtension",{alias:"plugin.checkboxextension",grid:null,menu:null,init:function(a){var b=this,c;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init CheckboxExtension");b.grid=(a.lockedGrid?a.lockedGrid:a);c=a.getSelectionModel();if(c&&c instanceof Ext.selection.CheckboxModel){c.onHeaderClick=Ext.emptyFn;a.on({afterlayout:{fn:b.renderButton,scope:b,single:true}})}},selectIds:function(c,b){var d=b||this,a=[],e=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(d.grid);if(c){Ext.Array.each(e,function(f){if(Ext.Array.contains(c,f.getId())){a.push(f)}})}d.bugfixedSelect(d.grid.getSelectionModel(),a)},bugfixedSelect:function(a,b){var c=this;a.preventUpdateHeaderState=true;a.select(b,false,true);delete a.preventUpdateHeaderState;if(c.grid.disableUpdateHeaderStateAfterSelect!==true){a.updateHeaderState()}c.grid.fireEvent("checkchange",b,c.grid)},renderButton:function(){var k=this;var e=k.grid.getSelectionModel();var g=e.injectCheckbox;if(!Ext.isNumber(g)){if(g==="first"){g=0}else{if(g==="last"){g=k.grid.headerCt.length-1}else{Vulcan.Common.ExtJS.utils.Log.getLogger().warn("injectCheckbox value is unkown")}}}var h=k.grid.headerCt||k.grid.lockedGrid.headerCt;var d=h.items.getAt(g);var b=d.getEl();h.suspendEvents();d.setWidth(27);h.resumeEvents();k.menu=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",items:[{iconCls:"icon-zaznacz-wszystkie",text:"Zaznacz wszystkie",handler:function(){var l=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(k.grid);k.bugfixedSelect(e,l);k.grid.fireEvent("selectall",k.grid,l)}},{iconCls:"icon-przelacz-zaznaczenie",text:"Odwróć zaznaczenie",handler:function(){var l=[];var m=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(k.grid);Ext.Array.each(m,function(n){if(!e.isSelected(n)){l.push(n)}});k.bugfixedSelect(e,l);k.grid.fireEvent("reverseselect",k.grid,l)}},{iconCls:"icon-odznacz-wszystkie",text:"Odznacz wszystkie",handler:function(){e.deselectAll(true);k.grid.fireEvent("deselectall",k.grid,[])}}]});var c=Ext.create("Ext.button.Button",{iconCls:"icon-opcje-zaznaczania",width:22,height:22,margin:2});c.on("click",function(l){k.menu.showBy(c)});b.update("");c.render(b);var f=Vulcan.Common.ExtJS.utils.FilterManager.getAdvancedFilter(k.grid);if(!f){Vulcan.Common.ExtJS.utils.helpers.FilterHelper.addAdvancedFilters(k.menu,k.grid,k.selectIds,k)}else{var a=Ext.widget("menuitem",{text:"Zaawansowane"});k.menu.add(a);Vulcan.Common.ExtJS.utils.FilterManager.configureAdvFilterButton(a,k.grid,f,Vulcan.Common.ExtJS.utils.FilterManager.filterTypeSelect)}}});Ext.define("Vulcan.Common.ExtJS.plugin.grid.GroupedCheckboxExtension",{extend:"Ext.AbstractPlugin",alias:"plugin.groupedcheckboxextension",grid:null,menu:null,groupCount:1000,init:function(a){var b=this,c;b.grid=(a.lockedGrid?a.lockedGrid:a);c=a.getSelectionModel();if(c&&c instanceof Ext.selection.CheckboxModel){c.onHeaderClick=Ext.emptyFn;a.on({afterlayout:{fn:b.renderButton,scope:b,single:true}});if(a.store){a.store.on({load:{fn:b.renderButton,scope:b,single:true}})}}},selectIds:function(c,b){var d=b||this,a=[],e=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(d.grid);if(c){Ext.Array.each(e,function(f){if(Ext.Array.contains(c,f.getId())){a.push(f)}})}d.bugfixedSelect(d.grid.getSelectionModel(),a)},selectIdx:function(g,a,c){var d=c||this,b=[],e=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(d.grid);if(Ext.isDefined(g)&&Ext.isDefined(a)){var f=0;Ext.Array.each(e,function(h){if(f>=g&&f<=a){b.push(h)}f++})}d.bugfixedSelect(d.grid.getSelectionModel(),b)},bugfixedSelect:function(a,b){var c=this;a.preventUpdateHeaderState=true;a.select(b,false,true);delete a.preventUpdateHeaderState;if(c.grid.disableUpdateHeaderStateAfterSelect!==true){a.updateHeaderState()}c.grid.fireEvent("checkchange",b,c.grid)},renderButton:function(){var p=this;var h=p.grid.getSelectionModel();var k=h.injectCheckbox;if(!Ext.isNumber(k)){if(k==="first"){k=0}else{if(k==="last"){k=p.grid.headerCt.length-1}else{Vulcan.Common.ExtJS.utils.Log.getLogger().warn("injectCheckbox value is unkown")}}}var n=p.grid.headerCt||p.grid.lockedGrid.headerCt;var f=n.items.getAt(k);var d=f.getEl();n.suspendEvents();f.setWidth(27);n.resumeEvents();var o=p.grid.store.getCount();var b=[];if(p.grid.store.getCount()>0){var e=Math.floor(o/p.groupCount)+(o%p.groupCount!==0?1:0);for(var l=1;l<=e;l++){var q=(l-1)*p.groupCount;var m=Math.min(l*p.groupCount,o)-1;b.push({iconCls:"icon-zaznacz-wszystkie",text:"Zaznacz wiersze od "+(q+1)+" do "+(m+1),startIndex:q,endIndex:m,handler:function(r){p.selectIdx(r.startIndex,r.endIndex,p)}})}}b.push({iconCls:"icon-odznacz-wszystkie",text:"Odznacz wszystkie",handler:function(){h.deselectAll(true);p.grid.fireEvent("deselectall",p.grid,[])}});p.menu=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",items:b});var c=Ext.create("Ext.button.Button",{iconCls:"icon-opcje-zaznaczania",width:22,height:22,margin:2});c.on("click",function(r){p.menu.showBy(c)});d.update("");c.render(d);var g=Vulcan.Common.ExtJS.utils.FilterManager.getAdvancedFilter(p.grid);if(!g){Vulcan.Common.ExtJS.utils.helpers.FilterHelper.addAdvancedFilters(p.menu,p.grid,p.selectIds,p)}else{var a=Ext.widget("menuitem",{text:"Zaawansowane"});p.menu.add(a);Vulcan.Common.ExtJS.utils.FilterManager.configureAdvFilterButton(a,p.grid,g,Vulcan.Common.ExtJS.utils.FilterManager.filterTypeSelect)}}});Ext.define("Vulcan.Common.ExtJS.plugin.grid.VCellEditing",{extend:"Ext.grid.plugin.CellEditing",alias:"plugin.vcellediting",editPolicy:-1,triggerEvent:"keydown",init:function(a){var b=this;b.callParent(arguments)},initEditTriggers:function(){var b=this,a=b.view;if(b.isKeyDownTrigger()){b.mon(b.grid,"cellkeydown",b.onStartTyping,b)}b.callParent(arguments);if(b.isKeyDownTrigger()){b.mun(a,b.triggerEvent||("cell"+(b.clicksToEdit===1?"click":"dblclick")),b.onCellClick);b.mon(a,("cell"+(b.clicksToEdit===1?"click":"dblclick")),b.onCellClick,b)}},isKeyDownTrigger:function(){var a=this;return a.triggerEvent=="keydown"||a.triggerEvent=="cellkeydown"},showEditor:function(b,c,e){var d=this,a;switch(d.editPolicy){case Ext.EventObject.ENTER:case Ext.EventObject.TAB:case 0:if(b.field){b.field.selectOnFocus=true}if(Ext.isGecko){a=function(){Ext.defer(function(){b.field.selectText();b.field.un("focus",a)},1)};b.field.on("focus",a)}break;case Ext.EventObject.F2:if(b.field){b.field.selectOnFocus=false}break;default:if(b.field){b.field.selectOnFocus=false}e="";break}d.callParent([b,c,e]);if(b.field instanceof Ext.form.field.ComboBox){b.field.expand()}},onStartTyping:function(m,a,h,b,g,l,c,d){var f=this,k;if(((Ext.EventObject.isNavKeyPress()||Ext.EventObject.isSpecialKey())&&c.getKey()!=c.ENTER)||c.ctrlKey||(c.getKey()>=c.F1&&c.getKey()<=c.F12&&c.getKey()!==c.F2)){return}f.onEnterKey(c)},onCellClick:function(c,a,k,b,h,f,g){var d=this;if(d.grid.isLocked===true){return false}d.editPolicy=0;d.callParent(arguments)},onEnterKey:function(b){var a=this;a.editPolicy=b.getKey();a.callParent(arguments)},onSpecialKey:function(a,d,c){var b=this,f;if(d instanceof Ext.form.field.ComboBox){b.callParent(arguments);return}switch(c.getKey()){case c.DOWN:case c.UP:c.stopEvent();f=a.up("tablepanel").getSelectionModel();if(f.onEditorArrow){return f.onEditorArrow(a.editingPlugin,c)}break;default:b.editPolicy=c.getKey();b.callParent(arguments)}},getEditor:function(a,c){var d=this,b=d.callParent(arguments);b.on({render:function(){var e=this;e.el.on("keydown",function(h){var l=e.field.inputEl.dom.selectionStart,g=e.field.inputEl.dom.selectionEnd,f=e.field.getRawValue().length,k;if(l!==g||(l!==0&&g!==f)){return}k=e.up("tablepanel").getSelectionModel();switch(h.getKey()){case h.RIGHT:if(g===f){k.onEditorArrow(e.editingPlugin,h)}break;case h.LEFT:if(l===0){k.onEditorArrow(e.editingPlugin,h)}break}})}});return b}});Ext.define("Vulcan.Common.ExtJS.plugin.grid.VExcelCopyPaste",{extend:"Ext.AbstractPlugin",alias:"plugin.vexcelcopypaste",grid:null,autoAdd:true,hiddenTextArea:undefined,specialCharacter:"\u058D",init:function(a){var b=this;b.grid=a;b.initExcel();Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init ExcelCopyPaste");b.callParent(arguments)},destroy:function(){var a=this;a.grid=null;if(a.hiddenTextArea){a.hiddenTextArea.destroy()}a.hiddenTextArea=undefined},initExcel:function(){var b=this,a=b.grid.getNormalGrid();b.grid.addEvents("recordPasted");a.on("render",function(){new Ext.KeyMap(a.getEl(),[{key:Ext.EventObject.C,ctrl:true,alt:false,fn:function(){var c;if(b.disabled===true){return}c=b.grid.getSelectionModel().getSelectedCellRange();if(!c){return}b.copyToClipBoard(c)}},{key:Ext.EventObject.V,ctrl:true,alt:false,fn:function(c,d){if(!b.grid.editable||b.disabled===true){return}b.pasteFromClipBoard(d)}}])})},pasteFromClipBoard:function(){var c=this,a=c.getHiddenTextArea(),b=Ext.get(Ext.Element.getActiveElement());a.dom.value="";a.focus();setTimeout(function(){b.focus()},300)},copyToClipBoard:function(e){var d=this,a,b=d.getSelectedData(e),c=Ext.get(Ext.Element.getActiveElement());if(window.clipboardData&&clipboardData.setData){clipboardData.setData("text",b)}else{a=d.getHiddenTextArea();a.dom.value=b;a.focus();a.dom.setSelectionRange(0,a.dom.value.length);setTimeout(function(){c.focus()},100)}},getSelectedData:function(d){var k=this,b=k.grid.getNormalGrid(),n=d[0],g=d[1],m=d[2],f=d[3],e="",l="",o=b.view.bufferRender(k.grid.getStore().getRange());for(var a=n;a<=m;a++){if(l!==""){l+="\n"}e="";for(var h=g;h<=f;h++){if(e!==""){e+="\t"}e+=o[a].cells.item(h).textContent}l+=e}return l},getHiddenTextArea:function(){var a=this;if(!Ext.isDefined(a.hiddenTextArea)){a.hiddenTextArea=new Ext.Element(document.createElement("textarea"));a.hiddenTextArea.setStyle("left","-1000px");a.hiddenTextArea.setStyle("top","-1000px");a.hiddenTextArea.setStyle("border","2px solid #ff0000");a.hiddenTextArea.setStyle("position","absolute");a.hiddenTextArea.setStyle("z-index","-1");a.hiddenTextArea.setStyle("width","100px");a.hiddenTextArea.setStyle("height","50px");if(a.grid.editable){a.hiddenTextArea.addListener("keyup",function(b){try{a.grid.getStore().suspendEvents();a.pasteFromHiddenTextArea(b)}finally{a.grid.getStore().resumeEvents();a.grid.refresh();a.grid.getNormalGrid().getView().focus()}},a)}Ext.get(a.grid.getEl().dom.firstChild).appendChild(a.hiddenTextArea.dom)}return a.hiddenTextArea},bugFixQuota:function(a){a=a.replace(/"/g,this.specialCharacter);return a},pasteFromHiddenTextArea:function(x){var C=this,a=C.grid.getNormalGrid(),m=a.columns,f=C.grid.getStore(),k=f.getCount(),b=C.grid.getStore().getProxy().getModel(),u,s,h=a.getSelectionModel().getSelectedCellRange(),w,z,v,y,o,q=Papa.parse(C.bugFixQuota(C.hiddenTextArea.getValue()),{dynamicTyping:true,delimiter:"\t"}),d,g,t;if(!h||C.disabled===true){return}if(Ext.isDefined(q.errors)&&q.errors.length>0){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("[vexcelcopypaste] wystąpiły błędy podczas parsowania tekstu do wklejenia:");Ext.Array.forEach(q.errors,function(c){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("[vexcelcopypaste] "+c)})}q=q.data;w=h[0];z=h[1];v=h[2];y=h[3];o=w;if(x.getKey()!==x.V||!x.ctrlKey||!Ext.isDefined(q)){return}if(q[q.length-1].length===1&&q[q.length-1][0].trim&&q[q.length-1][0].trim()===""){q.pop()}if(q[0].length===1&&q.length===1){for(var n=w;n<=v;n++){g=f.getAt(n);for(var A=z;A<=y;A++){d=m[A];t=C.renderBack(g,d,q[0]);if(Ext.isString(t)){var p=new RegExp(this.specialCharacter,"g");t=t.replace(p,'"')}if(C.grid.fireEvent("recordPasted",g,d.dataIndex,d,t,C.grid)!==false){g.set(d.dataIndex,t)}}}}else{for(var l=0;l<q.length;l++){if(o>k-1){if(C.autoAdd!==true){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("[vexcelcopypaste] automatyczne wstawianie jest wylaczone - nie wklejamy nadmiarowych wierszy.");return}f.insert(o,C.grid.createNewRecord())}s=q[l];u=z;g=f.getAt(o);for(var B=0;B<s.length;B++){d=m[u];t=C.renderBack(g,d,s[B]);if(Ext.isString(t)){var p=new RegExp(this.specialCharacter,"g");t=t.replace(p,'"')}if(C.grid.fireEvent("recordPasted",g,d.dataIndex,d,t,C.grid)!==false){g.set(d.dataIndex,t)}u++}o++}}C.hiddenTextArea.blur()},renderBack:function(b,c,f){var e=this,g=b.getGenericMapping(e.grid.mappingName),d=Vulcan.Common.ExtJS.utils.helpers.ModelHelper.getName(c);if(Ext.isDefined(f)&&Ext.isFunction(f.trim)){f=f.trim()}var a=Ext.ClassManager.get("Vulcan.Common.ExtJS.utils.derendering."+d+"ColumnDerenderer");if(a!==null){return a.renderBack(b,c,f,g)}return f}});Ext.define("Vulcan.Common.ExtJS.utils.cache.CacheItem",{extend:"Ext.util.Observable",constructor:function(a){this.value=a.value;this.addEvents({updated:true,expired:true,removed:true});this.listeners=a.listeners;this.callParent(arguments)},isFunc:function(a){return(typeof a=="function")}});Ext.define("Vulcan.Common.ExtJS.utils.derendering.BooleanColumnDerenderer",{singleton:true,renderBack:function(a,b,e,d){var c=this;if(!(b instanceof Ext.grid.column.Boolean)){Vulcan.Common.ExtJS.utils.Log.getLogger().error("["+c.$className+"] Typ kolumny jest nieobsługiwany: "+(b?b.$className:b))}switch(e){case b.falseText:return false;case b.trueText:return true;case b.undefinedText:return undefined}Vulcan.Common.ExtJS.utils.Log.getLogger().warn("["+c.$className+"] Nie ustalono źródłowej wartości dla: "+e);return e}});Ext.define("Vulcan.Common.ExtJS.utils.derendering.DateColumnDerenderer",{singleton:true,renderBack:function(b,c,f,e){var d=this,a;if(!(c instanceof Ext.grid.column.Date)){Vulcan.Common.ExtJS.utils.Log.getLogger().error("["+d.$className+"] Typ kolumny jest nieobsługiwany: "+(c?c.$className:c))}a=Ext.Date.parse(f,Vulcan.Common.ExtJS.utils.Settings.dateFormat);if(!a){a=Ext.Date.parse(f,Vulcan.Common.ExtJS.utils.Settings.timeFormat)}return a||f}});Ext.define("Vulcan.Common.ExtJS.utils.derendering.StoreColumnColumnDerenderer",{singleton:true,renderBack:function(c,d,g,f){var e=this,b,a;if(!(d instanceof Ext.ux.grid.column.StoreColumn)){Vulcan.Common.ExtJS.utils.Log.getLogger().error("["+e.$className+"] Typ kolumny jest nieobsługiwany: "+(d?d.$className:d))}b=Ext.Array.findBy(f.config.fields,function(h){return h.field===d.dataIndex});if(!b||!b.store){return g}if(!Ext.isDefined(b.store.displayField)){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("["+e.$className+"] Brak zdefiniowanego displayField dla store w genericMappingu")}a=d.store.findRecord(b.store.displayField,g,0,false,false,true);if(a){return(a.get(b.store.valueField)||a.getId())}Vulcan.Common.ExtJS.utils.Log.getLogger().warn("["+e.$className+"] Nie ustalono źródłowej wartości dla: "+g);return g}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper",{singleton:true,hasAccess:function(a,b){return b>=a},assertAccessLevel:function(c,d,b){var a=Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.hasAccess(c,d);if(!a){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedMsg(b)}return a},assertAccessLevelEdit:function(c,d,b){var a=Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.hasAccess(c,d);if(!a){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedEditMsg(b)}return a},assertAccessLevelAdd:function(c,d,b){var a=Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.hasAccess(c,d);if(!a){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedAddMsg(b)}return a},showAccessDeniedMsg:function(a){a=(Ext.isDefined(a)?a:"Brak uprawnień do wykonania tej operacji.");Ext.MessageBox.show({title:"Brak uprawnień",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK,msg:a})},showAccessDeniedEditMsg:function(a){a=(Ext.isDefined(a)?a:"Brak uprawnień do edycji elementu.");Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedMsg(a)},showAccessDeniedAddMsg:function(a){a=(Ext.isDefined(a)?a:"Brak uprawnień do dodawania elementu.");Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedMsg(a)}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.BankAccountHelper",{singleton:true,getRawNumber:function(a){return a.replace(/[^\d]+/g,"")},getFormatedBankAccount:function(c){var e,d=4,a,b;c=Vulcan.Common.ExtJS.utils.helpers.BankAccountHelper.getRawNumber(c);e=c.substring(0,2);c=c.substring(2);b=new RegExp(".{"+d+"}","g");c=c.replace(b,function(f){return f+" "});return(e+" "+c).trim()}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.Base64Helper",{singleton:true,_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var l,h,f,k,g,e,d;var b=0;c=Vulcan.Common.ExtJS.utils.helpers.Base64Helper._utf8_encode(c);while(b<c.length){l=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);k=l>>2;g=((l&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyStr.charAt(k)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d)}return a},decode:function(c){var a="";var l,h,f;var k,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){k=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));l=(k<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(l);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}a=Vulcan.Common.ExtJS.utils.helpers.Base64Helper._utf8_decode(a);return a},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a},_utf8_decode:function(a){var b="";var d=0;var e=c1=c2=0;while(d<a.length){e=a.charCodeAt(d);if(e<128){b+=String.fromCharCode(e);d++}else{if((e>191)&&(e<224)){c2=a.charCodeAt(d+1);b+=String.fromCharCode(((e&31)<<6)|(c2&63));d+=2}else{c2=a.charCodeAt(d+1);c3=a.charCodeAt(d+2);b+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));d+=3}}}return b}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.ContainerHelper",{singleton:true,getComponents:function(a){var b={};function c(d){if(Ext.isDefined(d.items)){for(var e=0;e<d.items.length;e++){var f=d.items.getAt(e);if(Ext.isObject(f)){if(Ext.isFunction(f.getItemId)&&Ext.isFunction(f.on)){b[f.getItemId()]=f}c(f)}}}}c(a);return b},setAutoScroll:function(a){if(a instanceof Ext.container.Container){try{a.setAutoScroll(true)}catch(b){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("Cannot set autoScroll in container ("+b+")")}}else{if(Ext.isObject(a)){a.autoScroll=true}else{Vulcan.Common.ExtJS.utils.Log.getLogger().error("Container is not an object, so there is nothing to set autoScroll property on")}}}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.DateHelper",{singleton:true,getWeekBlock:function(c){var d=this,b,e,a;b=c.getDay()-1;if(b<0){b=6}a=Ext.Date.add(c,Ext.Date.DAY,-b);e=Ext.Date.add(a,Ext.Date.DAY,6);return{weekStart:a,weekEnd:e,date:c}},getDateFromPesel:function(b){var c=b.toString();var d=c[0]+c[1];var e=c[2]+c[3];var a=c[4]+c[5];if(e>=80){d="18"+d}else{if(e>=60){d="22"+d}else{if(e>=40){d="21"+d}else{if(e>=20){d="20"+d}}}}return new Date(d,(e%20)-1,a)}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.FilterHelper",{singleton:true,loadFilters:function(c){var a,b;for(a in Ext.ClassManager.classes){if(Ext.ClassManager.classes.hasOwnProperty(a)){if(Ext.Array.some(c,function(d){return a.indexOf(d)===0})&&Ext.ClassManager.classes[a].superclass.$className==="Vulcan.Common.ExtJS.store.AbstractFilterStore"){b=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(a,true)}}}},addAdvancedFilters:function(f,b,a,d){var e=this,c=Ext.StoreManager.filterBy(function(g){return g.superclass.$className==="Vulcan.Common.ExtJS.store.AbstractFilterStore"});Ext.Array.forEach(c.items,function(g){g.each(function(k){var h=b.getStore().model.$className;if(!(k instanceof Vulcan.Common.ExtJS.model.FilterModel)){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Niepoprawny model filtra: "+k.$className);return}if(k.get("model")!==h){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Filtry grida - filtr "+k.get("name")+" ("+k.get("model")+") nie pasuje do grida (model "+h+")");return}f.add(Vulcan.Common.ExtJS.utils.helpers.FilterHelper.createAdvancedFilterMenuItem(k,b,a,d))})});Ext.Array.forEach(f.query("component"),function(g){g.on("filter",function(k,h){f.hide();a(k,d,h)})})},createAdvancedFilterMenuItem:function(g,d,b,f){var h=this,a={text:g.get("name"),filter:g,handler:function(k){return Vulcan.Common.ExtJS.utils.helpers.FilterHelper.advancedFilterHandler(k,d,b,f)}},c=g.get("submenu"),e;if(c){a.hideOnClick=g.get("filterFn")!=="";if(Ext.isObject(c)){Ext.applyIf(c,{enableKeyNav:false});a.menu=Ext.clone(c);Ext.Array.each(a.menu.items,function(k){k.canActivate=false});a.hideOnClick=false}else{if(Ext.isArray(c)){e=[];Ext.Array.forEach(c,function(k){if(!(k instanceof Vulcan.Common.ExtJS.model.FilterModel)){k=Ext.create("Vulcan.Common.ExtJS.model.FilterModel",k)}e.push(h.createAdvancedFilterMenuItem(k,d,b,f))});a.menu={items:e};a.hideOnClick=false}}}return a},advancedFilterHandler:function(c,b,a,e){var f=this,g,d=c.filter,h=d.get("filterFn");if(Ext.isFunction(h)){g=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(b,[b.advFilterId]);a(h(g,c),e,d)}else{if(h){Ext.Ajax.request({url:h,params:{filterId:d.getId()},success:function(k){var l=Ext.decode(k.responseText),m=l.data;a(m,e,d)}})}}},getRecords:function(c,g){var f=c.getSelectionModel(),b=c.getStore(),d=b.filters,e=[],a;g=g||[];b.suspendEvents();if(d&&d.length>0){Ext.Array.forEach(g,function(h){var k=d.get(h);e.push(k);Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(b,h)})}a=(Ext.isFunction(f.getStore().getAllRecords))?f.getStore().getAllRecords():f.getStore().getRange();Ext.Array.forEach(e,function(h){b.addFilter(h)});b.resumeEvents(true);return a},filterIds:function(b,c,a){Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(b,a);if(!c){return}b.addFilter(Ext.create("Ext.util.Filter",{id:a,filterFn:function(d){return Ext.Array.contains(c,d.getId())}}));b.filter()},clearFilter:function(a,b){a.removeFilter(b)}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.FormHelper",{singleton:true,getForms:function(a){var c=this;if(a instanceof Ext.form.Panel){return[a]}else{if(a instanceof Ext.container.Container){var b=[];a.items.each(function(d){b=b.concat(c.getForms(d))});return b}else{return[]}}},getFields:function(a){var c=this;var b=[];a.items.each(function(d){if(d instanceof Ext.form.field.Base){b.push(d)}else{if(d instanceof Ext.form.FieldContainer&&d.use===true){b.push(d)}else{if(d instanceof Ext.container.Container){b=b.concat(c.getFields(d))}}}});return b}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.GridHelper",{singleton:true,getGroupingFeatureFn:function(a){return(a instanceof Ext.grid.feature.Grouping||a instanceof Ext.grid.feature.GroupingSummary||a.ftype==="grouping"||a.ftype==="groupingsummary")},getGroupingFeature:function(a){var b=this;if(a instanceof Vulcan.Common.ExtJS.widget.VGrid){a=a.getNormalGrid()}return Ext.Array.findBy(a.getView().features,b.getGroupingFeatureFn)},isGroupingDisabled:function(a){var b=this;if(a instanceof Vulcan.Common.ExtJS.widget.VGrid){a=a.getNormalGrid()}return(!a.features||!Ext.Array.some(a.features,b.getGroupingFeatureFn))},isGroupingEnabled:function(a){var b=this;return !b.isGroupingDisabled(a)}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.LocalizationHelper",{singleton:true,constructor:function(){var a=this;a.addResources(LocalizationResources)},defaultLocalizationCode:"default",resources:{},addResources:function(b){var a=this;Ext.Object.each(b,function(c,e){var d;if(a.resources[c]){d=a.resources[c]}else{d={}}a.resources[c]=Ext.apply(d,e)})},get:function(a){var c=this;var b;b="en";try{if(Ext.isDefined(c.resources[b])&&Ext.isDefined(c.resources[b][a])){return c.resources[b][a]}else{if(Ext.isDefined(c.resources[c.defaultLocalizationCode][a])){return c.resources[c.defaultLocalizationCode][a]}else{return a}}}catch(d){return a}}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.MathHelper",{singleton:true,getGuid:function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1)};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.ModelHelper",{singleton:true,getModelsFromRawData:function(a,c){var b=[];Ext.Array.each(c,function(d){b.push(Ext.create(a,d))});return b},getName:function(a){return a.$className.substring(a.$className.lastIndexOf(".")+1)}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.ParamHelper",{singleton:true,controllerExtension:".mvc",get:function(d,c){var b=this;if(!d){return undefined}if(!c){c="VParam"}if(!Ext.isDefined(window[c])){b.logWarn("Nie można znaleźć globalnego obiektu "+c);return undefined}var a=window[c][d];if(!Ext.isDefined(a)){b.logWarn("Globalny obiekt "+c+" nie posiada propercji (ani funkcji) "+d)}return a},getActionUrl:function(a,e,d){var c=this;var b=c.get("rooturlWithInstance",d);if(!b){return""}return Ext.String.format("{0}/{1}{2}/{3}",b,a,c.controllerExtension,e)},logWarn:function(b){var a=Vulcan.Common.ExtJS.utils.Log.loggerInstance?Vulcan.Common.ExtJS.utils.Log.getLogger():null;if(a){a.warn(b)}else{alert(b)}}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.RenderHelper",{singleton:true,storeRenderer:function(b,a){return function(f){try{var d=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(b,true);var c="";if(a){c=d.getById(f).get(a)}else{c=d.getById(f).toString()}return c}catch(g){return""}}},time24:function(a){if(!a){a=new Date(1970,0,1,0,0,0)}try{return Ext.Date.format(a,Vulcan.Common.ExtJS.utils.Settings.timeFormat)}catch(b){Vulcan.Common.ExtJS.utils.Log.getLogger().error("failed during date conversion (time24 renderer)");return Ext.Date.format(new Date(1970,0,1,0,0,0),Vulcan.Common.ExtJS.utils.Settings.timeFormat)}},comboRenderer:function(a){return function(c){if(a.store){var b=a.store.findRecord(a.valueField,c);return b?b.get(a.displayField):a.valueNotFoundText?a.valueNotFoundText:""}return a.valueNotFoundText?a.valueNotFoundText:""}},yesNoRenderer:function(a){return a?"Tak":"Nie"},yesNoShortRenderer:function(a){return a?"Tak":"Nie"},checkMarkRenderer:function(a){return a===true?"&#x2713;":""},trailingZeroesRenderer:function(a){return a?a.toString().replace(/(\.[1-9]*)0+$/,"$1").replace(/\.$/,""):a}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.SecurityHelper",{requires:["Ext.util.Format"],singleton:true,encode:function(b){var a=Ext.util.Format.htmlEncode(b);if(Ext.isString(a)){a=a.replace(/\n/g,"<br/>")}return a},encodeTooltip:function(a){return Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(a))}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.ValidationHelper",{singleton:true,defaultMessage:"Wpisana wartość jest niepoprawna",getValidator:function(c){var b=this,f;try{var f=c.toString().trim();f=Ext.String.capitalize(f)}catch(d){Vulcan.Common.ExtJS.utils.Log.getLogger().error("Cannot parse validator type: "+c)}var a=Ext.ClassManager.get("Vulcan.Common.ExtJS.utils.validation."+f+"Validator");if(a===null){Vulcan.Common.ExtJS.utils.Log.getLogger().error("Cannot retrieve validator for type: "+c)}else{return a}}});Ext.define("Vulcan.Common.ExtJS.utils.mixin.ControlMixin",{control:function(a){var b=this,c=App.getController("Vulcan.Common.ExtJS.controller.VMasterController");Ext.app.EventBus.control(a,c)}});Ext.define("Vulcan.Common.ExtJS.utils.security.AccessGuardian",{extend:"Ext.Base",mixins:["Vulcan.Common.ExtJS.utils.mixin.ControlMixin"],statics:{accessDeniedView:"Vulcan.Common.ExtJS.view.blank.AccessDeniedView"},contextAccessLevels:[],defaultAccess:false,enableTreeGuardian:true,enableAccPanelGuardian:true,accessDeniedView:"Vulcan.Common.ExtJS.view.blank.AccessDeniedView",accessLevels:[],getContextFn:Ext.emptyFn,constructor:function(a){Ext.apply(this,a);var b=this;Vulcan.Common.ExtJS.utils.security.AccessGuardian.accessDeniedView=b.accessDeniedView;b.callParent(arguments);b.initAccessLevels();b.initCheckAccessEvents();b.processRibbonItems()},initCheckAccessEvents:function(){var b=this,a=App.getController("Vulcan.Common.ExtJS.controller.MainTreeController");if(b.enableTreeGuardian===true){a.on("checknodeaccess",function(e,d,c){return b.hasAccess(d,Vulcan.Common.ExtJS.utils.security.AccessLevel.read,function(f){return f.get("useCases")})});a.on("checknodeexpandaccess",function(e,d,c){if(d.get("id")==="root"){return true}return b.checkReadAccess(d,function(f){return f.get("useCases")})})}b.control({button:{beforeclick:{fn:b.checkButtonAccess,scope:b}},vmodelsection:{checkeditaccess:{fn:b.checkEditAccess,scope:b}},modelpanel:{beforeedit:{fn:b.checkEditAccess,scope:b}},vmodelsectionpanel:{addButtonClick:function(d,c){return b.checkAddAccess(c)}},vvrbmodelsection:{addButtonClick:function(d,c){return b.checkAddAccess(c)}},vgrid:{addButtonClick:function(d,c){return b.checkAddAccess(c)},editButtonClick:function(c,e,d){return b.checkEditAccess(d)},groupEditButtonClick:function(d,c){return b.checkEditAccess(c)},gridEditButtonClick:function(d,c){return b.checkEditAccess(c)},gridAddButtonClick:function(d,c){return b.checkAddAccess(c)}},"vgrid button":{click:function(c){return b.checkButtonAccess(c)}},vfilefield:{beforechange:{fn:b.checkEditAccess,scope:b}},vaccpanel:{checkaccess:{fn:function(c,d){return b.enableAccPanelGuardian===true?b.checkAccPanelTabAccess(d):true},scope:b}}})},checkAccPanelTabAccess:function(a){var b=this;return b.hasAccess(a,Vulcan.Common.ExtJS.utils.security.AccessLevel.read)},checkRibbonButtonAccess:function(a){var b=this;if(b.isUserSectionButton(a)||b.isToolbarMoreButton(a)){return true}return b.checkReadAccess(a)},checkButtonAccess:function(c){var d=this;if(d.isVControlButton(c)){return true}if(d.isEditButton(c)){return d.checkEditAccess(c)}else{if(d.isAddButton(c)){return d.checkAddAccess(c)}else{if(d.isRibbonButton(c)){if(d.isContextTabButton(c)){return d.checkRibbonButtonAccess(c)}else{var b=d.getContextFn;d.getContextFn=Ext.emptyFn;var a=d.checkRibbonButtonAccess(c);d.getContextFn=b;return a}}else{if(Ext.isDefined(c.useCases)){return d.checkAccess(c)}}}}},checkAccess:function(b,d){var a=this,c=Vulcan.Common.ExtJS.utils.security.AccessLevel.read;if(Ext.isDefined(b.accessLevel)){c=b.accessLevel}if(!a.hasAccess(b,c,d)){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedMsg();return false}return true},checkReadAccess:function(b,c){var a=this;if(!a.hasAccess(b,Vulcan.Common.ExtJS.utils.security.AccessLevel.read,c)){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedMsg();return false}return true},checkAddAccess:function(b,c){var a=this;if(!a.hasAccess(b,Vulcan.Common.ExtJS.utils.security.AccessLevel.readwrite,c)){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedAddMsg();return false}return true},checkEditAccess:function(b,c){var a=this;if(!a.hasAccess(b,Vulcan.Common.ExtJS.utils.security.AccessLevel.readwrite,c)){Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.showAccessDeniedEditMsg();return false}return true},isToolbarMoreButton:function(a){return a.iconCls==="x-toolbar-more-icon"},isUserSectionButton:function(a){return a.ownerCt&&a.ownerCt.ownerCt&&a.ownerCt.ownerCt.getId()==="ribbon-user-tab"},isContextTabButton:function(a){return a.ownerCt&&a.ownerCt.ownerCt&&a.ownerCt.ownerCt.isContextTab===true},isVControlButton:function(a){return(!Ext.isDefined(a.useCases)&&(a.ownerCt instanceof Vulcan.Common.ExtJS.widget.model.VModelSectionPanel||a.ownerCt instanceof Vulcan.Common.ExtJS.widget.model.VVariableModelSection||a.ownerCt instanceof Vulcan.Common.ExtJS.ux.panel.ModelPanel||a.ownerCt instanceof Vulcan.Common.ExtJS.widget.VFileField||(a.ownerCt instanceof Vulcan.Common.ExtJS.widget.model.VModelSection)||(a.ownerCt&&a.ownerCt instanceof Ext.container.Container&&a.ownerCt.ownerCt instanceof Vulcan.Common.ExtJS.widget.model.VModelSection)||(a.ownerCt&&a.ownerCt instanceof Ext.toolbar.Toolbar&&a.ownerCt.ownerCt instanceof Vulcan.Common.ExtJS.widget.VGrid)))},isRibbonButton:function(a){return a.ownerCt&&a.ownerCt.ownerCt&&a.ownerCt.ownerCt.ownerCt&&a.ownerCt.ownerCt.ownerCt.ownerCt&&a.ownerCt.ownerCt.ownerCt.ownerCt.isXType("ribbon-view")},isEditButton:function(a){return a.iconCls&&a.iconCls==="icon-edit"},isAddButton:function(a){return a.iconCls&&a.iconCls==="icon-add"},initAccessLevels:function(){var a=this;a.accessLevels=[];Ext.Array.forEach(a.contextAccessLevels,function(b){Ext.Array.forEach(b.Przypadki,function(d){var c=Ext.Array.findBy(a.accessLevels,function(e){return e.IdPrzypadkuUzycia===d.IdPrzypadkuUzycia});if(!c){a.accessLevels.push({IdPrzypadkuUzycia:d.IdPrzypadkuUzycia,MaxLevel:d.MaxLevel})}else{if(c.MaxLevel<d.MaxLevel){c.MaxLevel=d.MaxLevel}}})})},processRibbonItems:function(){var b=this;var c=Ext.getCmp("ribbon-view-tab");Ext.Array.forEach(c.items.items,function(e){if(e.isContextTab===true){e.tab.hide()}else{if(b.hasAccess(e,Vulcan.Common.ExtJS.utils.security.AccessLevel.read)){e.tab.show()}else{e.tab.hide()}}},b);if(c.getActiveTab().tab.isHidden()){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("AccessGuardian: startowy tab nie jest dostępny dla aktualnego usera.");var a=Ext.Array.filter(c.items.items,function(e){return !e.tab.isHidden()});if(a&&a.length>0){var d=a[0];Vulcan.Common.ExtJS.utils.Log.getLogger().trace("AccessGuardian: wybieranie pierwszego widoczengo taba: "+((d&&d.tab)?d.tab.text:""));Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.selectRibbonItem,d,null)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().warn("AccessGuardian: bieżący użytkownik nie ma praw do żadnego taba na ribbonie")}}},setGetContext:function(b,a){var d=this;d.getContextFn=b;if(!a){return}var c=function(){d.clearContextFn();a.un("beforedestroy",c)};a.on("beforedestroy",c)},clearContextFn:function(){var a=this;a.getContextFn=Ext.emptyFn;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("AccessGuardian: wyczyszczono funkcję określającą kontekst dla uprawnień.")},hasAccess:function(e,g,h){var d=this,b=d.getContextFn(e),c=e.useCases;if(Ext.isDefined(e.guarded)&&e.guarded===false){return true}if(Ext.isDefined(h)&&Ext.isFunction(h)){c=h(e)}if(!c||c.length===0){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("AccessGuardian: nie określono poziomu uprawnień dla elementu - zwracam domyślny poziom "+d.defaultAccess,e);return d.defaultAccess}var f=d.accessLevels;if(b){var a=Ext.Array.findBy(d.contextAccessLevels,function(k){return k.IdContext===b});f=a?a.Przypadki:undefined}if(!f){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("AccessGuardian: nie określono poziomu uprawnień dla elementu (dla kontekstu "+b+") - zwracam domyślny poziom "+d.defaultAccess,e);return d.defaultAccess}return Ext.Array.some(c,function(k){var l=Ext.Array.findBy(f,function(m){return m.IdPrzypadkuUzycia==k});return l&&Vulcan.Common.ExtJS.utils.helpers.AccessLevelHelper.hasAccess(g,l.MaxLevel)})}});Ext.define("Vulcan.Common.ExtJS.utils.security.AccessLevel",{singleton:true,deny:0,read:10,readwrite:20});Ext.define("Vulcan.Common.ExtJS.utils.validation.BankAccountValidator",{singleton:true,messages:{message:"Numer rachunku jest niepoprawny"},validate:function(d,a){var c=this,b=c.messages,g;if(!Ext.isDefined(a.allowEmpty)){a.allowEmpty=a.acceptEmpty}Ext.apply(b,a);try{g=d.toString().trim()}catch(f){g=""}if(a.allowEmpty===true&&g.length===0){return true}if(c.validateIBAN(g)){return true}else{return b.message}},validateIBAN:function(b){var d=this,c="2521",a=Vulcan.Common.ExtJS.utils.helpers.BankAccountHelper.getRawNumber(b);if(a.length!=26){return false}a=a.substring(2)+c+a.substring(0,2);return parseInt(d.modulo(a,97),10)===1},modulo:function(c,d){var b="";var a="";Ext.Array.forEach(c.split(""),function(e){var f=a+""+b+""+e;if(f<parseInt(d,10)){b+=""+e}else{a=f%d;if(a===0){a=""}b=""}});a+=""+b;if(a===""){a=0}return a}});Ext.define("Vulcan.Common.ExtJS.utils.validation.EmailValidator",{singleton:true,messages:{message:"Wpisany adres e-mail jest niepoprawny"},validate:function(f,a){var d=this,c=d.messages,h;Ext.apply(c,a);try{h=f.toString().trim()}catch(g){h=""}if(a.allowEmpty===true&&h.length===0){return true}var b=/^(")?(?:[^\."])(?:(?:[\.])?(?:[\w\-!#$%&'*+\/=?\^_`{|}~]))*\1@(\w[\-\w]*\.){1,5}([A-Za-z]){2,}$/;if(b.test(h)){return true}else{return c.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.FormatValidator",{singleton:true,messages:{message:"To pole ma niepoprawny format"},validate:function(d,a){var c=this,b=c.messages,g;Ext.apply(b,a);try{g=d.toString().trim()}catch(f){g=""}if(a.matcher&&a.matcher.test(g)){return true}else{return b.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.LengthValidator",{singleton:true,messages:{required:"To pole jest wymagane",tooShort:"Wpisana wartość nie może być krótsza niż {0} {1}",tooLong:"Wpisana wartość nie może być dłuższa niż {0} {1}"},validate:function(d,a){var c=this,b=c.messages,g;Ext.apply(b,a);try{g=d.toString().trim()}catch(f){g=""}if(Ext.isNumber(a.min)&&g.length<a.min){if(a.min===1){return b.required}else{return Ext.String.format(b.tooShort,a.min,c.getForm(a.min))}}if(Ext.isNumber(a.max)&&g.length>a.max){return Ext.String.format(b.tooLong,a.max,c.getForm(a.max))}return true},getForm:function(c){var b=this,a=parseInt(c.toString().slice(-1),10);if(c===12||c===13||c===14){return"znaków"}else{if(a===2||a===3||a===4){return"znaki"}}return"znaków"}});Ext.define("Vulcan.Common.ExtJS.utils.validation.NipValidator",{singleton:true,messages:{message:"Wpisany nr NIP jest niepoprawny"},validate:function(l,a){var h=this,g,d,c,m=0,k=[6,5,7,2,3,4,5,6,7];var b=h.messages;if(!Ext.isDefined(a.allowEmpty)){a.allowEmpty=a.acceptEmpty}Ext.apply(b,a);try{g=l.toString().trim()}catch(f){g=""}if(g===""){return true}g=g.replace(/-/g,"");if(g.length===10){m=0;for(d=0;d<=8;d++){m+=g.charAt(d)*k[d]}c=m%11;if(c===Number(g.charAt(9))){return true}else{return b.message}}else{return b.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.PeselValidator",{singleton:true,messages:{message:"Wpisany nr PESEL jest niepoprawny"},validate:function(l,a){var k=this,b=k.messages,h;if(!Ext.isDefined(a.allowEmpty)){a.allowEmpty=a.acceptEmpty}Ext.apply(b,a);try{h=l.toString().trim()}catch(d){h=""}if(a.allowEmpty===true&&h.length===0){return true}if(a.simple){var f=/^\d{11}$/;if(h.match(f)){return true}else{return b.message}}else{var c,n,m=0,g=[1,3,7,9,1,3,7,9,1,3];if(h.length===11){m=0;for(c=0;c<=9;c++){m+=h.charAt(c)*g[c]}n=(10-m%10)%10;if(n===Number(h.charAt(10))){return true}else{return b.message}}else{return b.message}}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.PostCodeValidator",{singleton:true,messages:{message:"Wpisany kod pocztowy jest niepoprawny"},validate:function(f,a){var d=this,c=d.messages,h;Ext.apply(c,a);try{h=f.toString().trim()}catch(g){h=""}if(a.allowEmpty===true&&h.length===0){return true}var b=new RegExp("^[0-9]{2}-[0-9]{3}$");if(b.test(h)){return true}else{return c.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.PresenceValidator",{singleton:true,messages:{message:"To pole jest wymagane"},validate:function(d,a){var c=this,b=c.messages;Ext.apply(b,a);if(d){return true}else{return b.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.RangeValidator",{singleton:true,messages:{required:"To pole jest wymagane",tooLow:"Wpisana wartość nie może być mniejsza niż {0}",tooHigh:"Wpisana wartość nie może być większa niż {0}"},validate:function(d,a){var c=this,b=c.messages,g;Ext.apply(b,a);try{g=d.toString().trim();g=(g&&Ext.isFunction(g.replace))?g.replace(Ext.util.Format.decimalSeparator,"."):g}catch(f){g=""}if(a.allowEmpty===true&&g===""){return true}else{if(g===""){return b.required}else{if(Ext.isNumber(a.min)&&g<a.min){return Ext.String.format(b.tooLow,a.min)}if(Ext.isNumber(a.max)&&g>a.max){return Ext.String.format(b.tooHigh,a.max)}}}return true}});Ext.define("Vulcan.Common.ExtJS.utils.validation.RegonValidator",{singleton:true,messages:{message:"Wpisany nr REGON jest niepoprawny"},validate:function(p,a){var k=this,c=k.messages,h;if(!Ext.isDefined(a.allowEmpty)){a.allowEmpty=a.acceptEmpty}Ext.apply(c,a);try{h=p.toString().trim()}catch(g){h=""}if(a.allowEmpty===true&&h.length===0){return true}var l=[8,9,2,3,4,5,6,7];var f=[2,4,8,5,0,9,7,3,6,1,2,4,8];var m=false;var b=0;if(h.length==9||h.length==14){for(var d=0;d<h.length-1;d++){b+=((h.length==9)?l[d]:f[d])*h[d]}var o=b%11;var n=o==10?0:o;m=n==((h.length==9)?h[8]:h[13])}if(m){return true}else{return c.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.SelectedValidator",{singleton:true,messages:{message:"To pole jest wymagane"},validate:function(d,a){var c=this,b=c.messages;Ext.apply(b,a);if(d){return true}else{return b.message}}});Ext.define("Vulcan.Common.ExtJS.utils.validation.UniqueValidator",{singleton:true,messages:{message:"Wartość musi być unikalna"},validate:function(m,a){var k=this,b=k.messages,h;if(a.store&&a.store instanceof Ext.data.Store){var l=false;var d=false;var c=false;if(Ext.isDefined(a.caseSensitive)){l=a.caseSensitive}try{h=m.toString().trim()}catch(f){h=""}if(Ext.isString(h)&&!l){h=h.toUpperCase()}var g=a.store.findBy(function(o){var e=o.get(a.field);var n=false;if(Ext.isString(e)){if(!l){e=e.toUpperCase()}n=(e==h)}else{n=(e===m)}if(a.model&&a.model instanceof Ext.data.Model){n=n&&(o.getId()!=a.model.getId())}return n});if(g==-1){return true}else{return b.message}}else{return b.message}}});Ext.define("Vulcan.Common.ExtJS.utils.ClipboardManager",{extend:"Ext.Base",singleton:true,init:function(){ZeroClipboard.config({swfPath:Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("zeroClipboardPath")})}});Ext.define("Vulcan.Common.ExtJS.utils.ContextHelp",{extend:"Ext.Base",singleton:true,app:null,client:null,project:null,currentDialogTags:[],currentContentTags:[],contextContentHelpButton:undefined,debugCnt:0,isDebugActive:false,debugLabel:null,init:function(d,a,c){var b=this;b.app=d;b.client=a;b.project=c},setDebugLabel:function(a){Vulcan.Common.ExtJS.utils.ContextHelp.debugLabel=a;Vulcan.Common.ExtJS.utils.ContextHelp.initDebugModeListener()},initDebugModeListener:function(){var b=this,a=Ext.getCmp("stopka-label");if(!b.debugLabel){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Pomoc kontekstowa - brak labela debug");return}a.getEl().on("click",Vulcan.Common.ExtJS.utils.ContextHelp.activateDebugMode)},activateDebugMode:function(){Vulcan.Common.ExtJS.utils.ContextHelp.debugCnt=(Vulcan.Common.ExtJS.utils.ContextHelp.debugCnt+1)%8;if(Vulcan.Common.ExtJS.utils.ContextHelp.debugCnt===0){Vulcan.Common.ExtJS.utils.ContextHelp.isDebugActive=true;Vulcan.Common.ExtJS.utils.ContextHelp.showDebugInfo()}},setContentHelp:function(a){var b=this;b.setCurrentContentTags(a)},setDialogHelp:function(a,b){var c=this;c.setCurrentDialogTags(a,b)},clearContentContextHelp:function(){Vulcan.Common.ExtJS.utils.ContextHelp.currentContentTags=[];Vulcan.Common.ExtJS.utils.ContextHelp.hideContentContextHelp();if(Vulcan.Common.ExtJS.utils.ContextHelp.debugLabel){Vulcan.Common.ExtJS.utils.ContextHelp.debugLabel.setText("")}},clearDialogContextHelp:function(){Vulcan.Common.ExtJS.utils.ContextHelp.currentDialogTags=[];Vulcan.Common.ExtJS.utils.ContextHelp.hideDialogContextHelp()},clearContextHelp:function(){var a=this;a.clearContentContextHelp();a.clearDialogContextHelp()},setCurrentContentTags:function(a){var b=this;if(!Ext.isDefined(a)){b.hideContentContextHelp();b.currentContentTags=[];return}b.currentContentTags=Ext.isArray(a)?a:[a];b.showContentContextHelp()},setCurrentDialogTags:function(a,b){var c=this;if(!Ext.isDefined(a)){c.hideDialogContextHelp();c.currentDialogTags=[];return}c.currentDialogTags=Ext.isArray(a)?a:[a];c.showDialogContextHelp(b)},showContentContextHelp:function(){var a=this;if(a.contextContentHelpButton){a.contextContentHelpButton.show();a.showDebugInfo()}},showDebugInfo:function(){var b=this,a=b.currentContentTags;if(b.debugLabel){b.debugLabel.setText("");if(b.isDebugActive!==true||!a){return}b.debugLabel.setText("- Pomoc kontekstowa: "+a.join(", ")+" -")}},getDialog:function(){var a;Ext.WindowMgr.eachTopDown(function(b){if(b instanceof Ext.LoadMask){return true}a=b;return false});return a},showDialogContextHelp:function(b){var c=this,a={type:"help",callback:function(d,e,f){c.openContextHelp()}};if(!b){return}b.addTool(a);c.showDialogDebugInfo(b);b.on("close",Vulcan.Common.ExtJS.utils.ContextHelp.clearDialogContextHelp)},showDialogDebugInfo:function(a){var c=this,b=c.currentDialogTags;if(c.isDebugActive!==true||!b){return}a.setTitle(a.title+"- Pomoc: "+b.join(", ")+" -")},hideContentContextHelp:function(){var a=this;a.contextContentHelpButton.hide()},hideDialogContextHelp:function(){},openContextHelp:function(){var c=this,a=c.currentDialogTags.join(",")||c.currentContentTags.join(",");var b=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("pomocKontekstowaUrl")+"?klient="+c.client+"&projekt="+c.project+"&aplikacja="+c.app+"&IDFrame="+a;Vulcan.Common.ExtJS.utils.Link.onLinkClick(Ext.create("Vulcan.Common.ExtJS.utils.Link",{url:b,newTab:true}))},setContextContentHelpButton:function(a){var b=this;b.contextContentHelpButton=a}});Ext.define("Vulcan.Common.ExtJS.utils.FilterManager",{extend:"Ext.Base",requires:["Vulcan.Common.ExtJS.utils.helpers.FilterHelper"],singleton:true,filterTypeFilter:"FILTER",filterTypeSelect:"SELECT",filters:null,filtersCache:null,advFilterId:"advfilterids",advFilterSelMenuItemId:"advFilterSelMenuItemId",init:function(d){if(Vulcan.Common.ExtJS.utils.FilterManager.filters){return}var c=Vulcan.Common.ExtJS.utils.FilterManager.filters=new Ext.util.HashMap(),a;Vulcan.Common.ExtJS.utils.FilterManager.filtersCache=new Ext.util.HashMap();for(a in Ext.ClassManager.classes){if(Ext.ClassManager.classes.hasOwnProperty(a)){if(Ext.Array.some(d,function(e){return a.indexOf(e)===0})){var b=Ext.create(a);if(!b.model||!Ext.isString(b.model)){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Widok filtra "+a+" nie ma okreslonego modelu");continue}c.add(b.model.toUpperCase(),a)}}}},refreshAdvFilters:function(a){var b=Vulcan.Common.ExtJS.utils.FilterManager.getAdvancedFilter(a);Vulcan.Common.ExtJS.utils.FilterManager.refreshAdvFilterButton(a,b);Vulcan.Common.ExtJS.utils.FilterManager.refreshAdvFilterSelectionModel(a,b)},refreshAdvFilterSelectionModel:function(b,d){var a=b.getSelectionModel(),e,c;if(!(a instanceof Vulcan.Common2015.selection.grid.VCheckboxModel)){return}e=a.menu;c=e.getComponent(Vulcan.Common.ExtJS.utils.FilterManager.advFilterSelMenuItemId);if(!c){c=Ext.widget("menuitem",{text:"Zaawansowane"});e.add(c)}Vulcan.Common.ExtJS.utils.FilterManager.configureAdvFilterButton(c,b,d,Vulcan.Common.ExtJS.utils.FilterManager.filterTypeSelect)},refreshAdvFilterButton:function(b,c){var a=b.advFilterButton;if(!a){return}Vulcan.Common.ExtJS.utils.FilterManager.configureAdvFilterButton(a,b,c,Vulcan.Common.ExtJS.utils.FilterManager.filterTypeFilter)},configureAdvFilterButton:function(b,a,e,d){var c=Ext.emptyFn,f=Ext.isEmpty(e);if(e){c=Vulcan.Common.ExtJS.utils.FilterManager.advancedFilterHandler;f=false}b.setHandler(function(g){return c(g,a,e,d)},a);if(f===true){b.hide()}else{b.show()}},advancedFilterHandler:function(b,a,g,c){var f=Vulcan.Common.ExtJS.utils.helpers.FilterHelper.getRecords(a,[Vulcan.Common.ExtJS.utils.FilterManager.advFilterId]),e=App.getController(g),d;if(a.fireEvent("advfilterbuttonclick",b,a,g)===false){return}d=e.addAndLaunchController(g,a);d.grid=a;d.records=f;d.filterType=c;if(c===Vulcan.Common.ExtJS.utils.FilterManager.filterTypeFilter){Vulcan.Common.ExtJS.utils.FilterManager.restoreFromFilterCache(a,d)}d.on("filter",Vulcan.Common.ExtJS.utils.FilterManager.onFilter)},getSelPlugin:function(b){var a=null;Ext.Array.forEach(b.plugins,function(c){if(c instanceof Vulcan.Common.ExtJS.plugin.grid.CheckboxExtension){a=c;return false}else{if(c instanceof Vulcan.Common.ExtJS.plugin.grid.GroupedCheckboxExtension){a=c;return false}}});return a},onFilter:function(a,c,d){var f=a.filterType,e=Vulcan.Common.ExtJS.utils.FilterManager.getSelPlugin(d),b=Vulcan.Common.ExtJS.utils.FilterManager.advFilterId;switch(f){case Vulcan.Common.ExtJS.utils.FilterManager.filterTypeSelect:Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(d.getStore(),b);Vulcan.Common.ExtJS.utils.FilterManager.removeFromFilterCache(d);e.selectIds(c,e);break;case Vulcan.Common.ExtJS.utils.FilterManager.filterTypeFilter:if(e&&Ext.isFunction(e.selectIds)){e.selectIds([],e)}Vulcan.Common.ExtJS.utils.FilterManager.saveFilterCache(d,a);Vulcan.Common.ExtJS.utils.helpers.FilterHelper.filterIds(d.getStore(),c,b);break;default:Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Nieznany typ zaawansowanego filtra: "+f);break}d.on("destroy",Vulcan.Common.ExtJS.utils.FilterManager.removeFilters,d);a.viewInstance.close()},removeFilters:function(a){Vulcan.Common.ExtJS.utils.FilterManager.removeFromFilterCache(a);Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(a.getStore(),Vulcan.Common.ExtJS.utils.FilterManager.advFilterId)},restoreFromFilterCache:function(e,b){var a=b.viewInstance.query("field"),c=Vulcan.Common.ExtJS.utils.FilterManager.filtersCache.get(e.getId());if(b.restoreValues(e,c)===false||!c){return}for(var d=0;d<a.length;d++){a[d].setValue(c[d])}},saveFilterCache:function(e,b){var a=b.viewInstance.query("field"),c=[];if(b.saveValues(e,b)===false||!a){return}for(var d=0;d<a.length;d++){c.push(a[d].getValue())}Vulcan.Common.ExtJS.utils.FilterManager.filtersCache.add(e.getId(),c)},removeFromFilterCache:function(a){a=a||this;Vulcan.Common.ExtJS.utils.FilterManager.filtersCache.removeAtKey(a.getId())},getAdvancedFilter:function(b){var d=this,a=b.getStore()?b.getStore().model.$className:null,c;if(!a){return}c=Vulcan.Common.ExtJS.utils.FilterManager.filters.get(a.toUpperCase());if(!c){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Brak zaawansowanego filtra dla modelu "+a)}return c}});Ext.define("Vulcan.Common.ExtJS.utils.Link",{extend:"Ext.Base",alternateClassName:["VLink"],statics:{onLinkClick:function(a){if(a){if(Ext.isString(a)){window.location=a;return}else{if(a.url){if(a.newTab){window.open(a.url,Vulcan.Common.ExtJS.utils.Link.getNewWindowTitle(a))}else{if(a.newWindow){window.open(a.url,Vulcan.Common.ExtJS.utils.Link.getNewWindowTitle(a),a.newWindowFeatures)}else{window.location=a.url}}return}}}},getNewWindowTitle:function(a){var b=Ext.isDefined(a.title)?a.title:"Vulcan";if(Ext.isIE){b=b.replace(/ /g,"")}return b}},url:"",newTab:false,newWindow:false,title:"Vulcan",newWindowFeatures:"resizable=yes, scrollbars=yes, titlebar=yes",constructor:function(a){Ext.apply(this,a);var b=this;b.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.utils.Log",{singleton:true,loggerInstance:null,newLine:"\r\n",defaultLayout:"%d{HH:mm:ss,SSS} %-5p: %m",getLogger:function(){var a=this;if(!a.loggerInstance){a.loggerInstance=a.createLogger()}return a.loggerInstance},createLogger:function(){var c=this;var a=log4javascript.getLogger();a.log=function(n,m){if(log4javascript.isEnabled&&n.isGreaterOrEqual(this.getEffectiveLevel())){var f;var h=m.length-1;var g=m[h];if(m.length>1&&(g instanceof Error)){f=g;h--}var k=[];for(var e=0;e<=h;e++){k[e]=c.getLogMessage(m[e])}var l=new log4javascript.LoggingEvent(this,new Date(),n,k,f);a.callAppenders(l)}};var d=new log4javascript.BrowserConsoleAppender();d.setThreshold(Vulcan.Common.ExtJS.utils.LogLevel.trace);var b=new log4javascript.PatternLayout(c.defaultLayout);d.setLayout(b);a.addAppender(d);c.setLevel(a,Vulcan.Common.ExtJS.utils.LogLevel.parse(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("logLevel")));return a},setLevel:function(a,b){a.setLevel(b)},getLogMessage:function(c){var b=this;if(c){if(c.$className){var a="["+c.$className+"]";if(c instanceof Ext.data.Store){a+=b.getStoreData(c)}else{if(c instanceof Ext.data.Model){a+=b.getModelData(c)}}return a}else{if(Ext.isString(c)){return c}return"["+typeof c+"]["+c+"]"}}else{return c}},getStoreData:function(a){var c=this;var b="["+a.getCount()+"]"+c.newLine+"[";var d=true;a.each(function(e){if(!d){b+=", "+c.newLine}else{d=false}b+="{";d=true;e.fields.each(function(g){if(!d){b+=", "}else{d=false}var f=e.get(g.name);b+='"'+g.name+'": '+f+""});b+="}"},this);b+="]";return b},getModelData:function(a){var b=this;return b.newLine+Ext.encode(a.data)}});Ext.define("Vulcan.Common.ExtJS.utils.LogLevel",{singleton:true,all:log4javascript.Level.ALL,trace:log4javascript.Level.TRACE,debug:log4javascript.Level.DEBUG,info:log4javascript.Level.INFO,warn:log4javascript.Level.WARN,error:log4javascript.Level.ERROR,fatal:log4javascript.Level.FATAL,off:log4javascript.Level.OFF,parse:function(c){var b=this;var a=c?c.toLowerCase():null;switch(a){case"trace":return b.trace;case"debug":return b.debug;case"info":return b.info;case"warn":return b.warn;case"error":return b.error;case"fatal":return b.fatal;case"off":return b.off;default:return b.all}}});Ext.define("Vulcan.Common.ExtJS.utils.MessageBus",{extend:"Ext.util.Observable",alternateClassName:["VMessageBus","VMsgBus"],singleton:true,init:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init MessageBus");var a=this;a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.utils.MessageBusEvents",{extend:"Ext.Base",alternateClassName:["VMessageBusEvents","VMsgBusEvents"],singleton:true,selectRibbonItem:"selectRibbonItem",toggleRibbonContextTab:"toggleRibbonContextTab",changeNumberOfNotifications:"changeNumberOfNotifications",setNotificationsPopupContent:"setNotificationsPopupContent",updateNotificationsPopupContent:"updateNotificationsPopupContent",addBackendTask:"addBackendTask",backendTaskDone:"backendTaskDone",backendTaskError:"backendTaskError",beforeribbonbuttonclick:"beforeribbonbuttonclick",beforeribbontabchange:"beforeribbontabchange",aftershowlogoview:"aftershowlogoview",afterribbontabchange:"afterribbontabchange",confirmationdialogclose:"confirmationdialogclose",historySelectRibbonItem:"historyselectribbonitem",aftershowlogoview:"aftershowlogoview"});Ext.define("Vulcan.Common.ExtJS.utils.RolesManager",{extend:"Ext.Base",roles:[],config:{roles:null},constructor:function(a){Ext.apply(this,a);var b=this;b.callParent(arguments);b.initRoles();b.processRibbonItems()},initRoles:function(){var a=this;if(!a.roles){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("RolesManager: lista ról użytkownika jest pusta.");return}Ext.Array.forEach(a.roles,function(b){Ext.Array.forEach(b.roles,function(c){if(Ext.Array.contains(a.roles,c)){return}a.roles.push(c)})})},processComponents:function(b){var a=this;Ext.Array.forEach(b,function(e){var d=Ext.ComponentQuery.query(e.selector),c;if(!d||d.length===0){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("RolesManager: brak przycisku dla selektora "+e.selector);return}c=d[0];if(a.hasAccess(e)){c.enable()}else{c.disable();if(Ext.isFunction(c.setTooltip)){c.setTooltip(Ext.isDefined(e.tooltip)?e.tooltip:"Brak uprawnień!")}}},a)},processRibbonItems:function(){var b=this;var c=Ext.getCmp("ribbon-view-tab");Ext.Array.forEach(c.items.items,function(e){if(e.isContextTab===true){e.tab.hide()}else{if(b.hasAccess(e)){e.tab.show()}else{e.tab.hide()}}},b);if(c.getActiveTab().tab.isHidden()){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("RolesManager: startowy tab nie jest dostępny dla aktualnego usera.");var a=Ext.Array.filter(c.items.items,function(e){return !e.tab.isHidden()});if(a&&a.length>0){var d=a[0];Vulcan.Common.ExtJS.utils.Log.getLogger().trace("RolesManager: wybieranie pierwszego widoczengo taba: "+((d&&d.tab)?d.tab.text:""));Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.selectRibbonItem,d,null)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().warn("RolesManager: bieżący użytkownik nie ma praw do żadnego taba na ribbonie")}}},hasAccess:function(b){var a=this;if(!b.roles||b.roles.length===0){return true}return Ext.Array.some(b.roles,function(c){return a.isInRole(c)})},isInRole:function(b){var a=this;return a.roles&&Ext.Array.contains(a.roles,b)},getJednostkiInRole:function(a){return Ext.Array.filter(me.roles,function(b){return Ext.Array.some(b.roles,function(c){return(c===a)})})}});Ext.define("Vulcan.Common.ExtJS.utils.Settings",{alternateClassName:["VSettings"],singleton:true,dateTimeFormat:"d.m.Y H:i",dateFormat:"d.m.Y",monthFormat:"m.Y",timeFormat:"H:i",incomingTimeFormat:"H:i:s",incomingDateFormat:"Y-m-d 00:00:00",incomingDateTimeFormat:"Y-m-d H:i:s",thousandSeparator:" ",decimalSeparator:","});Ext.define("Vulcan.Common.ExtJS.utils.StatusCodes",{alternateClassName:["VStatusCodes"],singleton:true,error:428,redirect:429,downloaderWait:204,downloaderDone:200,downloaderUnknown:404,downloaderCanceled:410});Ext.define("Ext.ux.grid.HeaderToolTip",{alias:"plugin.headertooltip",init:function(a){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("HeaderToolTip");var b=a.headerCt;b.on("afterrender",function(c){Ext.create("Ext.tip.ToolTip",{target:b.el,delegate:".x-column-header",trackMouse:true,renderTo:Ext.getBody(),listeners:{beforeshow:function(d){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("header tooltip");var e=b.down("gridcolumn[id="+d.triggerElement.id+"]");if(e&&e.tooltip){d.update(e.tooltip)}else{return false}}}})})}});Ext.define("Ext.ux.grid.CellToolTip",{alias:"plugin.celltooltip",tip:null,onBeforeShow:function(g){var e=this;var a=e.grid;var c=e.grid.getView().getGridColumns();if(a&&a.getView()&&a.getView().isVisible()){var k;var f=g.triggerElement.cellIndex;var b=c[f];var k=null;if(g.triggerElement.textContent){k=g.triggerElement.textContent.trim()}else{if(g.triggerElement.text){k=g.triggerElement.text.trim()}}var d=b&&!b.dataIndex;var h=!d&&(k||k===0);if(h){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Pokazuje toolTipa");g.update(g.triggerElement.innerHTML)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Nie pokazuje toolTipa");e.reassign();return false}}},reassign:function(){var a=this;if(a.tip instanceof Ext.tip.ToolTip){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("usuwanie starej instancji CellToolTipa dla grida");a.tip.un("beforeshow",a.onBeforeShow,a);a.tip.destroy()}a.tip=Ext.create("Ext.tip.ToolTip",{target:a.grid.el,delegate:a.grid.view.cellSelector,trackMouse:true,renderTo:Ext.getBody()});a.tip.on({beforeshow:{fn:a.onBeforeShow,scope:a}})},init:function(a){var b=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("CellToolTip");b.grid=a;b.grid.headerCt.on({afterrender:{fn:b.reassign,scope:b}})}});Ext.define("Vulcan.Common.ExtJS.ux.form.ModelValidatedPanel",{extend:"Ext.form.Panel",defaults:{anchor:"100%"},modelValidations:null,model:null,modelClass:null,bodyStyle:"border-width: 0px",validationConfig:{},initComponent:function(){var a=this;a.on("afterrender",a.assignValidations,a);a.callParent(arguments)},assignValidations:function(){var c=this;if(!c.disableValidation){var a=Vulcan.Common.ExtJS.utils.helpers.FormHelper.getFields(c);for(var b=0;b<a.length;b++){c.assignExtrasToField(a[b])}}},setTips:function(h){var e=this,b=[];if(h&&h.inputEl){var a=h.inputEl.parent();Ext.Array.each(e.modelClass.getTips(h.name),function(k){b.push(k.message)});if(b.length>0){var d='<table><tr><td><div class="x-information-icon"></div></td><td><ul style="padding-left: 10px">';Ext.Array.each(b,function(k){d+="<li>"+k+"</li>"});d+="</ul></td></tr></table>";var g=a.parent();var f=Ext.DomHelper.append(g,{tag:"td",cls:"x-form-information-cell"},true);var c=Ext.DomHelper.append(f,{tag:"div",cls:"x-information-icon"},true);Ext.create("Ext.tip.ToolTip",{target:f,trackMouse:true,renderTo:Ext.getBody(),cls:"x-form-information-tip",html:d})}}},testWarnings:function(h,g,b){var e=this,f=h.inputEl,c=e.modelClass.getWarnings(h.name);if(c.length>0&&h&&h.inputEl){var a=[];Ext.Array.each(c,function(l){var k=Ext.data.validations[l.type](l,g);if(!k){a.push(l.message)}});if(a.length>0){var d='<table><tr><td><div class="x-warning-icon"></div></td><td><ul style="padding-left: 10px">';Ext.Array.each(a,function(k){d+="<li>"+k+"</li>"});d+="</ul></td></tr></table>";if(!h.tip){h.tip=Ext.create("Ext.tip.ToolTip",{target:f,trackMouse:true,renderTo:Ext.getBody(),cls:"x-form-warning-tip"})}h.tip.update(d);f.addCls("x-form-warning-field")}else{if(h.tip){h.tip.destroy();h.tip=null}f.removeCls("x-form-warning-field")}}},exGetErrors:function(){var f=this,d=f.parent,b,c,a=Ext.bind(f._getErrors,f,arguments)(),e=f.getValue();if(!d.model){d.model=Ext.create(d.modelValidations)}else{d.model.reject(true)}if(f.disabled){f.clearInvalid()}else{d.model.set(f.name,e);c=d.model.validate(d.validationConfig).getByField(f.name);if(c){for(b=0;b<c.length;b++){a.push(c[b].message)}}}if(a.length===0){d.testWarnings(f,e)}return a},assignExtrasToField:function(b){var a=this;b.parent=a;if(a.modelValidations){if(!a.modelClass){a.modelClass=Ext.ClassManager.get(a.modelValidations)}if(a.modelClass.getTips(b.name).length>0){b.on({render:{fn:a.setTips,scope:a}})}b._getErrors=b.getErrors;b.getErrors=a.exGetErrors}}});Ext.define("Ext.ux.grid.column.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",constructor:function(){this.addEvents("checkchange");this.callParent(arguments)},processEvent:function(d,g,l,a,f,c){if(d=="mousedown"||(d=="keydown"&&(c.getKey()==c.ENTER||c.getKey()==c.SPACE))){var b=g.panel.store.getAt(a),h=this.dataIndex,k=!b.get(h);b.set(h,k);this.fireEvent("checkchange",this,a,k);return false}else{return this.callParent(arguments)}},renderer:function(b){var c=Ext.baseCSSPrefix,a=[c+"grid-checkheader"];if(b){a.push(c+"grid-checkheader-checked")}return'<div class="'+a.join(" ")+'">X&#160;</div>'}});Ext.define("Ext.ux.grid.column.ButtonColumn",{extend:"Ext.grid.column.Column",alias:["widget.buttoncolumn"],alternateClassName:"Ext.grid.ButtonColumn",actionIdRe:new RegExp(Ext.baseCSSPrefix+"button-col-(\\d+)"),showButtons:true,altText:"",sortable:true,constructor:function(d){var g=this,b=Ext.apply({},d),c=b.items||[g],a=c.length,e,f;delete b.items;g.callParent([b]);g.items=c;g.renderer=function(h,l){var k=String.Empty;if(Array.isArray(h)){if(g.showButtons){k='<div style="padding-left: 20px; width: auto; margin-left: 15px;"><ol>'}else{k='<div style="padding-left: 5px; width: auto; margin-left: 10px;"><ol>'}for(j=0;j<h.length;j++){k+="<li>"+h[j]+"</li>"}k+="</ol></div>"}else{k=h}h=Ext.isFunction(b.renderer)?b.renderer.apply(this,arguments)||"":"";if(l){l.tdCls+=" "+Ext.baseCSSPrefix+"button-col-cell"}for(e=0;e<a;e++){f=c[e];f.disable=Ext.Function.bind(g.disableAction,g,[e]);f.enable=Ext.Function.bind(g.enableAction,g,[e]);if(g.showButtons){h+=' <div style=" float: left; width:10; "><img alt="'+(f.altText||g.altText)+'" src="'+(f.icon||Ext.BLANK_IMAGE_URL)+'" class="'+Ext.baseCSSPrefix+"button-col-icon "+Ext.baseCSSPrefix+"button-col-"+String(e)+" "+(f.disabled?Ext.baseCSSPrefix+"item-disabled":" ")+(f.iconCls||"")+" "+(Ext.isFunction(f.getClass)?f.getClass.apply(f.scope||g.scope||g,arguments):(g.iconCls||""))+'"'+((f.tooltip)?' data-qtip="'+f.tooltip+'"':"")+" /></div>"}h+=k}return h}},enableAction:function(a){var b=this;if(!a){a=0}else{if(!Ext.isNumber(a)){a=Ext.Array.indexOf(b.items,a)}}b.items[a].disabled=false;b.up("tablepanel").el.select("."+Ext.baseCSSPrefix+"button-col-"+a).removeCls(b.disabledCls)},disableAction:function(a){var b=this;if(!a){a=0}else{if(!Ext.isNumber(a)){a=Ext.Array.indexOf(b.items,a)}}b.items[a].disabled=true;b.up("tablepanel").el.select("."+Ext.baseCSSPrefix+"button-col-"+a).addCls(b.disabledCls)},destroy:function(){delete this.items;delete this.renderer;return this.callParent(arguments)},processEvent:function(f,k,l,a,g,c){var d=this,b=c.getTarget().className.match(d.actionIdRe),m,h;if(b){Vulcan.Common.ExtJS.utils.Log.getLogger().trace(f);m=d.items[parseInt(b[1],10)];if(m){if(f=="click"){h=m.handler||d.handler;if(h&&!m.disabled){h.call(m.scope||d.scope||d,k,a,g,m,c)}}else{if(f=="mousedown"&&m.stopSelection!==false){return false}}}}return d.callParent(arguments)},cascade:function(b,a){b.call(a||this,this)},getRefItems:function(){return[]}});Ext.define("Vulcan.Common.ExtJS.ux.panel.ModelPanel",{extend:"Ext.panel.Panel",alias:["widget.modelpanel"],editController:"Vulcan.Common.ExtJS.controller.generic.GenericEditController",config:{mappingName:null},canEdit:true,canDelete:false,modelInstance:null,dynamicValidation:null,excludedFields:null,excludedEditFields:null,readonlyFields:null,saveCallback:null,deleteCallback:null,titleField:null,saveFunc:null,saveAction:null,cfgController:{},collapsible:true,margin:"0 0 10 0",bodyPadding:5,width:"100%",layout:{type:"table",columns:2,tableAttrs:{cls:"x-model-panel-table"}},horLinesPos:[],guid:null,setLabelText:function(a,c){if(a){if(c!==null&&((typeof c!="string")||Ext.String.trim(c))){try{a.setText(c.toString())}catch(b){a.setText(c)}}else{a.setText("&nbsp;",false)}}},refreshModel:function(c){var d=this;var a=0;if(c){d.modelInstance=c}d.suspendLayouts();var e=d.modelInstance.getGenericMapping(d.getMappingName());var b=0;if(e){e.fields.each(function(q){if(!d.excludedFields||!Ext.Array.contains(d.excludedFields,q.getField())){var k=q.getField().split(".");var h=(k.length===1);if(!h){q.setType(d.modelInstance.fields.get(k[0]).type.type)}var t;t=(d.guid+d.modelInstance.$className+q.getField()+"label").replace(/\./g,"");var p=d.down("label#"+t);if(!p){p=Ext.create("Ext.form.Label",{id:t,html:q.getLabel()+":",cellCls:"x-model-panel-label"});d.add(p)}t=(d.guid+d.modelInstance.$className+q.getField()+"value").replace(/\./g,"");p=d.down("label#"+t);if(!p){p=Ext.create("Ext.form.Label",{id:t,cls:"x-model-panel-value"});d.setLabelText(p,"");d.add(p)}var s=q.getStore();if(s){if(!(s instanceof Ext.data.Store)){var g=d.storeParams;if(!g){g=q.getStoreParams()}if(g&&g[q.getField()]){s=Ext.create(q.getStore());s.loadByParams(g[q.getField()])}else{s=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(q.getStore(),true)}}if(s.isLoading()){s.on("load",d.onStoreLoaded,{view:d,labelCmp:p,recId:d.modelInstance.get(q.getField()),displayField:q.getStoreDisplayField(),valueField:q.getStoreValueField()},{single:true})}else{var l=s.findRecord(q.getStoreValueField(),d.modelInstance.get(q.getField()),0,false,false,true);if(l){d.setLabelText(p,l.get(q.getStoreDisplayField()))}else{d.setLabelText(p,"")}}}else{var r="";if(h){r=d.modelInstance.get(q.getField())}else{if(d.modelInstance.get(k[0])!==null){r=d.modelInstance.get(k[0]);for(j=1;j<k.length;j++){r=r[k[j]]}}}if((q.getType()=="int"||q.getType()=="numeric"||q.getType()=="float")&&r){try{r=r.toString().replace(".",",")}catch(n){}}if(q.getType()=="date"&&r){try{r=Ext.Date.format(r,Vulcan.Common.ExtJS.utils.Settings.dateFormat)}catch(n){}}if(q.getType()=="time24"&&r){try{r=Ext.Date.format(r,Vulcan.Common.ExtJS.utils.Settings.timeFormat)}catch(n){}}d.setLabelText(p,r)}}var l=d.findRecord(d.editButtonsPos,"pos",b);if(l!==undefined){if(d.canEdit){var f;f=(d.guid+d.modelInstance.$className+q.getField()+"EditBtn").replace(/\./g,"");var o=Ext.create("Ext.toolbar.Spacer",{flex:1,cellCls:"x-model-panel-label"});p=d.down("button#"+f);if(!p){var m=Ext.create("Ext.button.Button",{id:f,text:d.editButtonsPos[a].btnText?d.editButtonsPos[a].btnText:"Zmień",cls:"edit-float-button",iconCls:"icon-edit",colspan:2});m.on("click",function(v,w){if(Ext.isFunction(d.editButtonHandler)){var u={mappingName:d.getMappingName(),excludedFields:l.excludedFields,canDelete:l.canDelete};if(l.windowTitle){u.windowTitle=l.windowTitle}if(l.dynamicValidation){u.dynamicValidation=l.dynamicValidation}Ext.callback(d.editButtonHandler,d,[v,w,u])}});d.add(m);if(l.hideLine===undefined||l.hideLine===false){d.add({autoCreate:{tag:"hr",cls:"x-fieldset-hr"},colspan:2,style:"padding:0px 0px 3px 0px"})}}}a++}if(Ext.isArray(d.horLinesPos)&&d.horLinesPos.indexOf(b)!==-1){d.add({xtype:"vhr",colspan:2})}b++})}d.resumeLayouts()},findRecord:function(e,a,d){var c,b;if(e!==undefined){for(c in e){if(e[c][a]===d){b=e[c]}}}return b},generateContent:function(){var b=this;if(!b.id){b.id=b.guid+b.modelInstance.$className}b.refreshModel();if(b.canEdit&&(b.editButtonsPos===undefined||b.editButtonsPos.length===0)){var a=Ext.create("Ext.toolbar.Spacer",{flex:1,cellCls:"x-model-panel-label"});var c=Ext.create("Ext.button.Button",{text:"Zmień",cls:"edit-float-button",iconCls:"icon-edit",colspan:2});c.on("click",function(f,g){if(b.fireEvent("beforeedit",b)===false){return}if(Ext.isFunction(b.editButtonHandler)){var d={mappingName:b.getMappingName(),excludedFields:b.excludedEditFields?b.excludedEditFields:(b.excludedFields?b.excludedFields:[])};Ext.apply(d,b.cfgController);if(b.windowTitle){d.windowTitle=b.windowTitle}if(b.dynamicValidation){d.dynamicValidation=b.dynamicValidation}Ext.callback(b.editButtonHandler,b,[f,g,d])}});b.add(c)}},fixPanel:function(){var c=this;if(c.titleField){var b=c.titleField.split(".");var d="";if(b.length==1){d=c.modelInstance.get(c.titleField)}else{if(c.modelInstance.get(b[0])!==null){d=c.modelInstance.get(b[0]);for(j=1;j<b.length;j++){d=d[b[j]]}}else{d="Obiekt jest pusty ("+b[0]+")"}}var a=c.caption+'"'+d+'"';if(c.titleSecondField&&c.captionSecond){valueSecond=c.captionSecond+'"'+c.modelInstance.get(c.titleSecondField)+'"';a+=valueSecond}c.setTitle(a)}else{if(!c.title&&c.modelInstance.genericMappings.previewTitle){c.setTitle(c.modelInstance.genericMappings.previewTitle)}}},initComponent:function(){var a=this;a.callParent(arguments);a.guid=Vulcan.Common.ExtJS.utils.helpers.MathHelper.getGuid();a.addEvents("beforeedit");a.generateContent();a.on("afterrender",a.fixPanel,a)},editButtonHandler:function(d,c,g){var f=this;var e={mappingName:f.mappingName,modelInstance:f.modelInstance,excludedFields:g.excludedFields.concat(f.excludedEditFields?f.excludedEditFields:f.excludedFields),readonlyFields:f.readonlyFields,textFieldsWithUnits:f.textFieldsWithUnits,canDelete:Ext.isDefined(g.canDelete)?g.canDelete:f.canDelete,storeParams:f.storeParams,extraButton:f.extraButton,parentController:f.parentController,saveCallback:function(a,b){f.refreshModel(a,b);if(f.saveCallback){f.saveCallback(a,b)}},deleteCallback:function(a,b){f.destroy();if(f.deleteCallback){f.deleteCallback(a,b)}}};Ext.apply(e,f.cfgController);if(g.dynamicValidation){e.dynamicValidation=g.dynamicValidation}else{if(f.dynamicValidation){e.dynamicValidation=f.dynamicValidation}}if(g.windowTitle){e.windowTitle=g.windowTitle}else{if(f.windowTitle){e.windowTitle=f.windowTitle}}if(f.saveFunc){e.saveFunc=f.saveFunc}if(f.saveAction){e.saveAction=f.saveAction}var h=App.addController(f.editController,e);f.mon(h,"aftersave",e.saveCallback);if(h&&h.launch){h.launch()}f.editControllerInstance=h},onStoreLoaded:function(a){var b=this;var c=a.findRecord(b.valueField,b.recId,0,false,false,true);if(c){b.view.setLabelText(b.labelCmp,c.get(b.displayField))}else{b.view.setLabelText(b.labelCmp,"")}}});Ext.define("Ext.ux.form.MultiSelect",{extend:"Ext.form.field.Base",alternateClassName:"Ext.ux.Multiselect",alias:["widget.multiselect","widget.multiselectfield"],uses:["Ext.view.BoundList","Ext.form.FieldSet","Ext.ux.layout.component.form.MultiSelect","Ext.view.DragZone","Ext.view.DropZone"],ddReorder:false,appendOnly:false,displayField:"text",allowBlank:true,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"To pole jest obowiązkowe",minSelectionsText:"Minimum wymaganych pozycji to {0}",maxSelectionsText:"Maximum dozwolonych pozycji to {0}",delimiter:",",componentLayout:"multiselectfield",fieldBodyCls:Ext.baseCSSPrefix+"form-multiselect-body",initComponent:function(){var a=this;a.bindStore(a.store,true);if(a.store.autoCreated){a.valueField=a.displayField="field1";if(!a.store.expanded){a.displayField="field2"}}if(!Ext.isDefined(a.valueField)){a.valueField=a.displayField}a.callParent()},bindStore:function(a,c){var d=this,e=d.store,b=d.boundList;if(e&&!c&&e!==a&&e.autoDestroy){e.destroyStore()}d.store=a?Ext.data.StoreManager.lookup(a):null;if(b){b.bindStore(a||null)}},onRender:function(e,a){var f=this,b,d,c;f.callParent(arguments);var g=Ext.create("Ext.XTemplate",'<ul><tpl for=".">','<li role="option" class="x-boundlist-item" >  {[this.test(parent)]} </li>',"</tpl></ul>",{test:function(h){return h<1}});d=f.boundList=Ext.create("Ext.view.BoundList",{deferInitialRefresh:false,multiSelect:true,store:f.store,displayField:f.displayField,border:false,disabled:f.disabled});c=d.getSelectionModel();f.mon(c,{selectionChange:f.onSelectionChange,scope:f});b=f.panel=Ext.create("Ext.panel.Panel",{title:f.listTitle,tbar:f.tbar,items:[d],renderTo:f.bodyEl,layout:"fit"});b.ownerCt=f;f.setRawValue(f.rawValue)},getSubTplMarkup:function(){return""},afterRender:function(){var a=this;a.callParent();if(a.ddReorder&&!a.dragGroup&&!a.dropGroup){a.dragGroup=a.dropGroup="MultiselectDD-"+Ext.id()}if(a.draggable||a.dragGroup){a.dragZone=Ext.create("Ext.view.DragZone",{view:a.boundList,ddGroup:a.dragGroup,dragText:"Pozycji {0}"})}if(a.droppable||a.dropGroup){a.dropZone=Ext.create("Ext.view.DropZone",{view:a.boundList,ddGroup:a.dropGroup,handleNodeDrop:function(h,g,b){var c=this.view,e=c.getStore(),d=h.records,f;h.view.store.remove(d);f=e.indexOf(g);if(b==="after"){f++}e.insert(f,d);c.getSelectionModel().select(d)}})}},onSelectionChange:function(){this.checkChange()},clearValue:function(){this.setValue([])},getSubmitValue:function(){var b=this,a=b.delimiter,c=b.getValue();return Ext.isString(a)?c.join(a):c},getRawValue:function(){var b=this,a=b.boundList;if(a){b.rawValue=Ext.Array.map(a.getSelectionModel().getSelection(),function(c){return c.get(b.valueField)})}return b.rawValue},setRawValue:function(c){var b=this,a=b.boundList,d;c=Ext.Array.from(c);b.rawValue=c;if(a){d=[];Ext.Array.forEach(c,function(g){var f,e=b.store.findRecord(b.valueField,g,f,f,true,true);if(e){d.push(e)}});a.getSelectionModel().select(d,false,true)}return c},valueToRaw:function(a){return a},isEqual:function(e,d){var b=Ext.Array.from,c,a;e=b(e);d=b(d);a=e.length;if(a!==d.length){return false}for(c=0;c<a;c++){if(d[c]!==e[c]){return false}}return true},getErrors:function(b){var a=this,c=Ext.String.format,e=a.callParent(arguments),d;b=Ext.Array.from(b||a.getValue());d=b.length;if(!a.allowBlank&&d<1){e.push(a.blankText)}if(d<this.minSelections){e.push(c(a.minSelectionsText,a.minSelections))}if(d>this.maxSelections){e.push(c(a.maxSelectionsText,a.maxSelections))}return e},onDisable:function(){var a=this;a.callParent();a.updateReadOnly();if(a.boundList){a.boundList.disable()}},onEnable:function(){var a=this;a.callParent();a.updateReadOnly();if(a.boundList){a.boundList.enable()}},setReadOnly:function(a){this.readOnly=a;this.updateReadOnly()},updateReadOnly:function(){var b=this,a=b.boundList,c=b.readOnly||b.disabled;if(a){a.getSelectionModel().setLocked(c)}},onDestroy:function(){Ext.destroyMembers(this,"panel","boundList","dragZone","dropZone");this.callParent()}});Ext.define("Ext.ux.form.field.VHtmlEditor",{extend:"Ext.form.field.HtmlEditor",alias:"widget.vhtmleditor",mixins:{formField:"Ext.form.field.Base"},msgTarget:"under",enableColors:false,enableAlignments:false,enableSourceEdit:false,enableCloseButton:false,stripTagsInValidation:false,createToolbar:function(){var b=this;var a=b.getToolbarCfg();if(b.enableCloseButton){a.items.push("->");a.items.push({itemId:"close",cls:Ext.baseCSSPrefix+"btn-icon",iconCls:Ext.baseCSSPrefix+"close-icon",enableToggle:false,scope:b,handler:b.onHtmlEditorBlur,clickEvent:"mousedown",tabIndex:-1,tooltip:"Zamknij edytor"})}b.toolbar=Ext.widget(a);return b.toolbar},getErrors:function(m){var f=this,k=f.callParent(arguments),a=f.validator,d=f.vtype,g=Ext.form.field.VTypes,h=f.regex,l=Ext.String.format,b,e,c;m=m||f.getRawValue();if(f.stripTagsInValidation===true&&m){m=m.replace(/<\/?[^>]+(>|$)/g,"")}if(Ext.isFunction(a)){b=a.call(f,m);if(b!==true){k.push(b)}}e=f.allowOnlyWhitespace?m:Ext.String.trim(m);if(e.length<1||(m===f.emptyText&&f.valueContainsPlaceholder)){if(!f.allowBlank){k.push(f.blankText)}if(!f.validateBlank){return k}c=true}if(!c&&m.length<f.minLength){k.push(l(f.minLengthText,f.minLength))}if(m.length>f.maxLength){k.push(l(f.maxLengthText,f.maxLength))}if(d){if(!g[d](m,f)){k.push(f.vtypeText||g[d+"Text"])}}if(h&&!h.test(m)){k.push(f.regexText||f.invalidText)}return k},isValid:function(a){return this.mixins.formField.isValid.apply(this,arguments)},markInvalid:function(){this.mixins.formField.markInvalid.apply(this,arguments)},renderActiveError:function(){var b=this,a=b.hasActiveError();if(b.containerEl){b.containerEl[a?"addCls":"removeCls"](b.invalidCls+"-field")}this.mixins.formField.renderActiveError.apply(this,arguments)},clearInvalid:function(){this.mixins.formField.clearInvalid.apply(this,arguments)},validateValue:function(b){var a=this,d=a.getErrors(b),c=Ext.isEmpty(d);if(!a.preventMark){if(c){a.clearInvalid()}else{a.markInvalid(d)}}return c},getActionEl:function(){return this.bodyEl||this.containerEl||this.inputEl||this.el},validator:function(f){var g=this,e=g.parent;if(g.disabled&&!g.forceValidation){g.clearInvalid()}else{if(g.validations!==undefined){for(var c=0;c<g.validations.length;c++){var d=g.validations[c];var b=Vulcan.Common.ExtJS.utils.helpers.ValidationHelper.getValidator(d.type);var a=b.validate(f,d);if(a!==true){return a}}}}if(e!==undefined&&e.testWarnings!==undefined){e.testWarnings(g,f)}return true},invalidCls:"invalid-container",linksInNewWindow:true,createLink:function(){var a=prompt(this.createLinkText,this.defaultLinkValue);if(a&&a!=="http://"){if(this.linksInNewWindow){this.relayCmd("insertHTML","<a href='"+a+"' target='_blank'>"+a+"</a>")}else{this.relayCmd("createlink",a)}}},checkChangeEvents:Ext.isIE&&(!document.documentMode||document.documentMode<9)?["sync","change","propertychange","keyup"]:["sync","change","input","textInput","keyup","dragdrop"],checkChangeBuffer:50,initEvents:function(){var f=this;f.on({scope:f,initialize:f.onInitializeHtmlEditor});var f=this,h=f.inputEl,b,k,c=f.checkChangeEvents,g,a=0,d;if(h){f.mon(h,Ext.EventManager.getKeyEvent(),f.fireKey,f);b=new Ext.util.DelayedTask(f.checkChange,f);f.onChangeEvent=k=function(){b.delay(f.checkChangeBuffer)};for(g=0;g<a;g++){d=c[g];if(d==="propertychange"){f.usesPropertychange=true}f.mon(h,d,k)}}},onHtmlEditorBlur:function(a){this.closeCellEditor(this);this.fireEvent("blur",this)},onInitializeHtmlEditor:function(){var c=this,b=c.getWin(),a=Ext.bind(c.onHtmlEditorBlur,c);if(c.enableCloseButton){return}if(b.attachEvent){b.addEventListener("blur",a)}else{b.addEventListener("blur",a,false)}},closeCellEditor:function(a){if(a.editing===true){a.completeEdit()}},getRawValue:function(){var b=this,a=(b.inputEl?b.getValue():Ext.value(b.rawValue,""));b.rawValue=a;return a}});Ext.define("Ext.ux.grid.column.StoreColumn",{extend:"Ext.grid.column.Column",alias:"widget.storecolumn",fieldMapping:{},initComponent:function(){var a=this;a.callParent(arguments);a.store=a.getStore(a.fieldMapping);if(a.store.isLoading()){a.store.on({load:{fn:function(){var b=a.up("vgrid");if(b){b.getView().refresh()}},scope:a,single:true}})}},defaultRenderer:function(f){var e=this,c=e.fieldMapping.getType(),b=e.fieldMapping.getStoreValueField(),d=e.store.findRecord(b,f,0,false,false,true),a="";if(c=="valdict"){a=f}else{if(d){a=d.get(e.fieldMapping.getStoreDisplayField())}}if(a!==""){return Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(a)}if(e.fieldMapping.store.showNullLabel===true&&e.fieldMapping.getStoreAllowNullLabel()){return e.fieldMapping.getStoreAllowNullLabel()}return a},getStore:function(c){var b=this,a=c.getStore();if(Ext.isString(a)){if(!(a instanceof Ext.data.Store)){var d=b.storeParams;if(d){d=d[c.getField()]}else{d=c.getStoreParams()}if(d){a=Ext.create(c.getStore());a.loadByParams(d)}else{a=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(c.getStore(),true)}}}else{a=c.getStoreInstance()}return a}});Ext.define("Ext.ux.grid.Printer",{requires:"Ext.XTemplate",statics:{print:function(a,g){var f=[];Ext.each(a.columns,function(s){if(s.items&&s.items.length>0){f=f.concat(s.items.items)}else{f.push(s)}});var k=[];var q=a.store.data;if(g===true){var d=a.getSelectionModel();if(d){var h=d.selected;q=h}}q.each(function(t,x){var w={};for(var s in t.data){var v=t.data[s];var u=false;Ext.each(f,function(A,z){if(A&&A.dataIndex==s){var B={item:"",tdAttr:"",style:""};v=A.renderer?A.renderer.call(A,v,B,t,x,z,a.store,a.view):v;var C=Ext.String.createVarName(A.dataIndex);w[C]=v;u=true}else{if(A&&A.xtype==="rownumberer"){var C=Ext.String.createVarName(A.id);w[C]=(x+1);u=true}else{if(A&&A.xtype==="templatecolumn"){v=A.tpl?A.tpl.apply(t.data):v;var C=Ext.String.createVarName(A.id);w[C]=v;u=true}}}},this);if(!u){var y=Ext.String.createVarName(s);w[y]=v}}k.push(w)});var e=[];Ext.each(f,function(s){if((s)&&(!Ext.isEmpty(s.dataIndex)&&!s.hidden)){e.push(s)}else{if(s&&s.xtype==="rownumberer"){s.text="";e.push(s)}else{if(s&&s.xtype==="templatecolumn"){e.push(s)}}}});f=e;if(this.stylesheetPath===null){var c=Ext.Loader.getPath("Ext.ux.grid.Printer");this.stylesheetPath=c.substring(0,c.indexOf("Printer.js"))+"gridPrinterCss/print.css"}var r=Ext.create("Ext.XTemplate",this.headerTpl).apply(f);var m=Ext.create("Ext.XTemplate",this.bodyTpl).apply(f);var p="",o=[];Ext.each(a.plugins,function(s){if(s.ptype=="rowexpander"){p+=s.rowBodyTpl.html}});if(p!==""){o=['<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}"><td colspan="'+f.length+'">',p,"</td></tr>"]}var b=['<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">','<html class="'+Ext.baseCSSPrefix+'ux-grid-printer">',"<head>",'<meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />','<link href="'+this.stylesheetPath+'" rel="stylesheet" type="text/css" />',"<title>"+a.printTitle+"</title>","</head>",'<body class="'+Ext.baseCSSPrefix+'ux-grid-printer-body">',"<h1>"+this.mainTitle+"</h1>","<table>","<tr>",r,"</tr>",'<tpl for=".">','<tr class="{[xindex % 2 === 0 ? "even" : "odd"]}">',m,"</tr>",o.join(""),"</tpl>","</table>","</body>","</html>"];var l=Ext.create("Ext.XTemplate",b).apply(k);var n=window.open("","printgrid");n.document.open();n.document.write(l);n.document.close();if(this.printAutomatically&&(!Ext.isChrome||Ext.chromeVersion<35)){n.print()}if(this.closeAutomaticallyAfterPrint&&(!Ext.isChrome||Ext.chromeVersion<35)){n.close()}},stylesheetPath:null,printAutomatically:false,closeAutomaticallyAfterPrint:false,mainTitle:"",printLinkText:"Print",closeLinkText:"Close",headerTpl:['<tpl for=".">',"<th>{text}</th>","</tpl>"],bodyTpl:['<tpl for=".">','<tpl if="values.dataIndex">',"<td>{{[Ext.String.createVarName(values.dataIndex)]}}</td>","<tpl else>","<td>{{[Ext.String.createVarName(values.id)]}}</td>","</tpl>","</tpl>"]}});Ext.define("Ext.ux.selection.VCellSelectionModel",{extend:"Ext.selection.Model",alias:"selection.vcellmodel",requires:["Ext.util.KeyNav"],enableKeyNav:true,preventWrap:false,selected:null,mode:"MULTI",allowDeselect:true,refresh:Ext.emptyFn,onViewRefresh:Ext.emptyFn,autoAdd:false,grid:undefined,left:"left",right:"right",up:"up",down:"down",constructor:function(){this.addEvents("deselect","select");this.callParent(arguments)},bindComponent:function(a){var b=this;b.primaryView=a;b.views=b.views||[];b.views.push(a);b.bindStore(a.getStore(),true);b.grid=a.ownerCt;if(b.grid.ownerCt&&(b.grid.ownerCt instanceof Vulcan.Common.ExtJS.widget.VGrid)){b.grid=b.grid.ownerCt}if(b.grid.editable===false){b.autoAdd=false}b.grid.getNormalGrid().on({cellclick:b.onMouseClick,cellmousedown:b.onMouseDown,cellMouseOver:b.onMouseOver,refresh:b.onViewRefresh,scope:b});if(b.enableKeyNav){b.initKeyNav(a)}},initKeyNav:function(a){var b=this;if(!a.rendered){a.on("render",Ext.Function.bind(b.initKeyNav,b,[a],0),b,{single:true});return}a.el.set({tabIndex:-1});b.keyNav=Ext.create("Ext.util.KeyNav",a.el,{up:b.onKeyArrow,down:b.onKeyArrow,right:b.onKeyArrow,left:b.onKeyArrow,tab:b.onKeyTab,scope:b})},getHeaderCt:function(){return this.primaryView.headerCt},allCellDeselect:function(){var c=this,b=0,a=c.selected.items.length;for(;b<a;b++){c.primaryView.onCellDeselect(c.selected.items[b].position)}c.fireEvent("deselect",c,this.selected);c.selected.items=[]},onKeyArrow:function(d,b){var c=this,a=c.getDirection(d);if(Ext.isDefined(a)){c.move(a,d)}},getDirection:function(b){var a=this;switch(b.getKey()){case b.UP:return a.up;case b.DOWN:return a.down;case b.LEFT:return a.left;case b.RIGHT:return a.right;default:Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Nieznany przycisk kierunkowy "+b.getKey());return undefined}},move:function(d,c){var b=this,f=Ext.isString(d)?b.primaryView.walkCells(b.getCurrentPosition(),d,c,b.preventWrap):d,a;c.ctrlKey=false;if(f===false){return undefined}if(f){b.setCurrentPosition(f)}a=b.grid.getNormalGrid().columns[f.column];if((a instanceof Ext.grid.column.Action||(a instanceof Ext.grid.RowNumberer))){return b.move((Ext.isString(d)?d:b.right),c)}b.selectWithEventMulti(c);return f},getCurrentPosition:function(){return this.position},setCurrentPosition:function(b){var a=this;a.position=new Ext.grid.CellContext(a.primaryView).setPosition(b.row,b.column)},onMouseDown:function(l,a,h,b,g,k,c,d){var f=this;f.onMouseClick(l,null,h,b,g,k,c)},onMouseClick:function(h,k,f,b,l,g,c){var d=this,a;c.ctrlKey=false;if(Vulcan.Common.ExtJS.utils.helpers.GridHelper.isGroupingEnabled(d.grid)){a=h.dataSource.data.get(l.getAttribute("data-recordId"));g=h.dataSource.data.indexOf(a)}d.setCurrentPosition({row:g,column:f});d.selectWithEvent(b,c)},onMouseOver:function(a,h,b,d,g,c){var f=this;if((Ext.isChrome&&g.button===-1)||g.browserEvent.buttons===0){return}g.ctrlKey=false;g.shiftKey=true;f.setCurrentPosition(h);f.selectWithEvent(b,g)},isSelected:function(a){a=Ext.isNumber(a)?this.store.getAt(a):a;if(this.selected.items===null||this.selected.items===""){return false}return Ext.Array.indexOf(this.selected.items,a)!==-1},isCellSelected:function(b,e,c){var d=this,f=d.getCurrentPosition(),a=d.view.getCellByPosition(f);return d.isSelected(a)},selectWithEventMulti:function(d){var c=this,a=c.view.getCellByPosition(c.getCurrentPosition());if(!a){return}a.position=c.getCurrentPosition();if(d.ctrlKey&&c.isSelected(a)){if(c.allowDeselect){var b=Ext.Array.indexOf(this.selected.items,a);this.selected.items.splice(b,1);c.primaryView.onCellDeselect(c.getCurrentPosition())}}else{if(d.shiftKey&&c.lastSelected&&d.getKey()!==d.TAB){if(c.getCurrentPosition()){c.allCellDeselect()}c.selectRange(a,false)}else{if(d.ctrlKey){c.doMultiSelect(a,true,true)}else{if(c.getCurrentPosition()){c.allCellDeselect()}c.doSingleSelect(a,true)}}}},selectWithEvent:function(a,c){var b=this;switch(b.selectionMode){case"MULTI":this.selectWithEventMulti(c);break;case"SIMPLE":if(b.isSelected(a)){b.doDeselect(a)}else{b.doSelect(a,true)}break;case"SINGLE":if(b.allowDeselect&&b.isSelected(a)){b.doDeselect(a)}else{b.doSelect(a,false)}break;default:Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Nieznany selection mode: "+b.selectionMode)}},doSingleSelect:function(a,b){var d=this,f=false,c=d.selected;if(d.locked){return}if(d.isSelected(a)){return}function e(){d.bulkChange=true;if(c.getCount()>0&&d.doDeselect(d.lastSelected,b)===false){delete d.bulkChange;return false}delete d.bulkChange;d.selected.items.push(a);d.lastSelected=a;f=true;return true}d.onSelectChange(a,true,b,e);d.primaryView.onCellSelect(a.position);d.primaryView.focusCell(a.position);if(f){if(!b){d.setLastFocused(a)}d.maybeFireSelectionChange(!b)}},doMultiSelect:function(a,l,k){var g=this,b=g.selected,h=false,d=0,f,e;if(g.locked){return}a=!Ext.isArray(a)?[a]:a;f=a.length;if(!l&&b.getCount()>0){if(g.doDeselect(g.getSelection(),k)===false){return}}function c(){b.items.push(e);h=true}for(;d<f;d++){e=a[d];if(l&&g.isSelected(e)){continue}g.onSelectChange(e,true,k,c);g.primaryView.onCellSelect(e.position);g.primaryView.focusCell(e.position)}g.setLastFocused(e,k);g.maybeFireSelectionChange(h&&!k)},selectRange:function(f,n){var g=this,b,d,k,h,a,l,e,c,m;if(g.isLocked()){return}b=f.position;d=g.lastSelected.position;if(!b||!d){return}if(b.column<d.column){a=b.column;e=d.column}else{a=d.column;e=b.column}if(b.row<d.row){l=b.row;c=d.row}else{l=d.row;c=b.row}for(k=a;k<=e;k++){for(h=l;h<=c;h++){m=g.view.getCellByPosition({row:h,column:k});m.position={row:h,column:k};g.doMultiSelect(m,n,true)}}},onSelectChange:function(b,e,d,g){var f=this,a=f.view,c=e?"select":"deselect";if((d||f.fireEvent("before"+c,f,b))!==false&&g()!==false){if(e){a.onItemSelect(b)}else{a.onItemDeselect(b)}if(!d){f.fireEvent(c,f,b)}}},isLastPosition:function(c){var b=this,a=b.grid.getNormalGrid();return c&&(((c.column+1)===a.columns.length)&&((c.row+1)===a.store.getCount()))},isFirstPosition:function(b){var a=this;return b&&((b.column===0)&&(b.row===0))},onKeyTab:function(k,d){var f=this,h=k.shiftKey?f.left:f.right,c=f.view.editingPlugin,g=(f.grid.getStore().getCount()===0),b=g||f.isLastPosition(f.position),a=f.move(h,k);if(c&&a&&f.wasEditing){c.startEditByPosition(a)}else{if(b){if(f.isAutoAdd()){f.grid.insertRow(f.grid.createNewRecord());if(g){f.move({column:0,row:0},k)}else{f.move(h,k)}}else{f.move({column:0,row:0},k)}}}delete f.wasEditing},onEditorTab:function(c,g){var d=this,f=g.shiftKey?d.left:d.right,b=d.isLastPosition(d.position),a=d.move(f,g);if(a){c.startEditByPosition(a);d.wasEditing=true}else{if(b){if(d.isAutoAdd()){d.grid.insertRow(d.grid.createNewRecord());a=d.move(f,g)}else{a=d.move({column:0,row:0},g)}c.startEditByPosition(a)}}delete d.wasEditing},onEditorArrow:function(b,d){var c=this,a=new Ext.util.DelayedTask(function(){c.move(c.getDirection(d),d)});b.completeEdit();a.delay(110)},selectByPosition:function(a){this.setCurrentPosition(a)},getSelectedCellRange:function(){var c=this,f,g,b,e,d;if(!Ext.isDefined(c.selected)||!c.selected.items||c.selected.items.length===0){return undefined}d=c.selected.items[0].position;f=d.row;g=d.column;b=d.row;e=d.column;for(var a=0;a<c.selected.items.length;a++){d=c.selected.items[a].position;if(d.row<f||d.column<g){f=d.row;g=d.column}else{if(d.row>b||d.column>e){b=d.row;e=d.column}}}return[f,g,b,e]},isAutoAdd:function(){var a=this;return a.autoAdd===true&&Vulcan.Common.ExtJS.utils.helpers.GridHelper.isGroupingDisabled(a.grid)}});Ext.define("Ext.ux.callout.Callout",{extend:"Ext.container.Container",alias:"widget.callout",cls:"default",componentCls:"x-ux-callout",floating:true,shadow:false,padding:16,config:{target:null,relativePosition:"c-c",relativeOffsets:null,calloutArrowLocation:"none",fadeInDuration:200,fadeOutDuration:200,autoHide:true,dismissDelay:0},dismissTimer:null,initComponent:function(){if(Ext.getVersion("extjs")&&Ext.getVersion("extjs").isLessThan("4.1.0")){Ext.applyIf(this,this.config)}return this.callParent(arguments)},destroy:function(){this.clearTimers();return this.callParent(arguments)},show:function(){var a;this.callParent(arguments);this.removeCls(["top","bottom","left","right","top-left","top-right","bottom-left","bottom-right","left-top","left-bottom","right-top","right-bottom"]);if(this.getCalloutArrowLocation()!=="none"){this.addCls(this.getCalloutArrowLocation())}if(this.getTarget()!==null){a=Ext.isString(this.getTarget())?Ext.ComponentQuery.query(this.getTarget())[0]:this.getTarget();this.getEl().anchorTo(a.el||a,this.getRelativePosition(),this.getRelativeOffsets()||[0,0],false,50,Ext.bind(function(){this.afterSetPosition(this.getEl().getLeft(),this.getEl().getRight())},this))}if(!(this.dismissTimer!==null)&&this.getDismissDelay()>0){this.dismissTimer=Ext.defer(this.hide,this.getDismissDelay(),this)}return this},hide:function(){this.clearTimers();this.getEl().removeAnchor();return this.callParent(arguments)},clearTimers:function(){if(this.dismissTimer!==null){clearTimeout(this.dismissTimer)}this.dismissTimer=null},onShow:function(){this.callParent(arguments);this.mon(Ext.getDoc(),"mousedown",this.onDocMouseDown,this);this.getEl().setOpacity(0);this.getEl().fadeIn({duration:this.getFadeInDuration()})},onHide:function(c,a,b){this.mun(Ext.getDoc(),"mousedown",this.onDocMouseDown,this);this.getEl().fadeOut({duration:this.getFadeOutDuration(),callback:function(){this.getEl().hide();this.afterHide(a,b)},scope:this})},onDocMouseDown:function(a){if(this.getAutoHide()&&!a.within(this.getEl())){this.hide()}}});Ext.define("Ext.ux.layout.component.form.SortItemSelector",{extend:"Ext.layout.component.field.Field",alias:["layout.sortitemselectorfield"],type:"sortitemselectorfield",defaultHeight:200,sizeBodyContents:function(b,a){var c=this;if(!Ext.isNumber(a)){a=c.defaultHeight}c.owner.innerCt.setSize(b,a)}});Ext.define("Vulcan.Common.ExtJS.controller.abstract.AbstractEditController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",viewClass:null,viewClassParams:null,modelInstance:null,viewInstance:null,canDelete:null,mapping:null,init:function(){},windowTitle:null,launch:function(){var c=this;c.viewInstance=c.createViewInstance();c.mon(c.viewInstance,"close",function(){c.destroy()},c);if(typeof c.cancelAction=="function"){c.viewInstance.on("beforeclose",c.cancelAction,c);c.viewInstance.mon(c.viewInstance.cancelButton,"click",function(){c.viewInstance.close()},c);c.viewInstance.mon(c.viewInstance.okButton,"click",function(){c.viewInstance.close()},c)}if(typeof c.saveAction=="function"){c.viewInstance.mon(c.viewInstance.saveButton,"click",c.saveAction,c)}if(typeof c.nextAction=="function"){c.viewInstance.mon(c.viewInstance.nextButton,"click",c.nextAction,c)}if(typeof c.prevAction=="function"){c.viewInstance.mon(c.viewInstance.prevButton,"click",c.prevAction,c)}if(typeof c.deleteAction=="function"){c.viewInstance.mon(c.viewInstance.deleteButton,"click",c.deleteAction,c)}var d=null;if(c.modelInstance){var b=c.viewInstance.contentPanel.getForm();var a=Ext.create(c.modelInstance.$className);b.updateRecord(a);b.loadRecord(c.modelInstance);b.clearInvalid();if(c.mappingName&&c.mapping===null){c.mapping=c.mappingName}if(Ext.isString(c.mapping)){d=c.modelInstance.getGenericMapping(c.mapping)}else{d=c.mapping}if(d&&c.canDelete===null){c.canDelete=d.getCanDelete()}if(Ext.isFunction(c.canDelete)){c.canDelete=c.canDelete(c)}}c.viewInstance.deleteButton.setVisible((c.modelInstance&&c.modelInstance.getId()&&c.canDelete)||(!c.modelInstance&&c.canDelete));if(d&&d.createTitle&&(!c.modelInstance||!c.modelInstance.getId())){c.viewInstance.setTitle(d.getCreateTitle())}if(c.windowTitle){c.viewInstance.setTitle(c.windowTitle)}c.viewInstance.on({activate:{fn:c.focusFirstField,scope:c},afterrender:{fn:function(){if(c.modelInstance&&c.modelInstance.getId()){c.viewInstance.areFormsValid()}},scope:c,single:true}});c.viewInstance.show()},focusFirstField:function(){var a=this;a.viewInstance.contentPanel.items.each(function(b){if(!b.isDisabled()&&b.focus){b.on({blur:{fn:function(){a.viewInstance.un("activate",a.focusFirstField,a)}}});Ext.defer(function(){try{b.focus(true,false)}catch(c){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("Unable to set focus on first field on the form")}},10);return false}})},createViewInstance:function(){var c=this,a=Ext.ClassManager.get(c.viewClass),d=(a!==null&&a.$isClass)?a.prototype.id:null,b=null;if(d){b=Ext.getCmp(d);if(b){b.destroy()}}c.viewInstance=Ext.create(c.viewClass,c.viewClassParams);return c.viewInstance},cancelAction:function(){var a=this},nextAction:function(){var a=this;a.viewInstance.navigateNext()},prevAction:function(){var a=this;a.viewInstance.navigatePrev()},saveAction:null,deleteAction:null});Ext.define("Vulcan.Common.ExtJS.controller.abstract.AbstractGridController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",init:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("AbstractGridController initialized")},viewClass:null,viewInstance:null,modelClass:null,modelInstance:null,storeInstance:null,createViewInstance:function(){var a=this;a.viewInstance=Ext.create(a.viewClass,{modelClass:a.modelClass,renderTo:a.renderTo,showRowNumber:a.showRowNumber,showActionColumn:a.showActionColumn,store:a.storeInstance});return a.viewInstance},launch:function(){var a=this;if(!a.viewInstance){a.viewInstance=a.createViewInstance()}},editAction:null});Ext.define("Vulcan.Common.ExtJS.controller.abstract.AbstractMassEditController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",viewClass:null,viewClassParams:null,storeInstance:null,viewInstance:null,canAdd:true,canDelete:true,init:function(){},windowTitle:null,launch:function(){var a=this;if(!a.viewInstance){a.viewInstance=a.createViewInstance();a.mon(a.viewInstance,"beforeclose",a.cancelAction,a);a.mon(a.viewInstance.cancelButton,"click",function(){a.viewInstance.close()},a);a.mon(a.viewInstance.saveButton,"click",a.saveAction,a);a.viewInstance.deleteButton.setVisible(false)}var b=null;if(a.windowTitle){a.viewInstance.setTitle(a.windowTitle)}a.viewInstance.show()},createViewInstance:function(){var a=this;a.viewInstance=Ext.create(a.viewClass,a.viewClassParams);return a.viewInstance},cancelAction:function(){var a=this;a.viewInstance.destroy();a.viewInstance=null},saveAction:null});Ext.define("Vulcan.Common.ExtJS.controller.editor.VEditorController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Vulcan.Common.ExtJS.widget.window.VGridEditor"],editorView:"Vulcan.Common.ExtJS.widget.window.VEditor",autoDestroy:true,cfgEditorView:{},cfgUI:{},viewInstance:null,launch:function(){var a=this;a.initDefaults();a.initEvents();a.initViewInstance();a.initViewControl();a.viewInstance.show();if(Ext.isDefined(a.helpId)){Vulcan.Common.ExtJS.utils.ContextHelp.setDialogHelp(a.helpId,a.viewInstance)}},initDefaults:function(){var a=this;Ext.applyIf(a.cfgUI,{txtDeleteConfirmation:"Czy na pewno chcesz usunąć wybrany element?",txtDeleteConfirmationTitle:"Potwierdzenie"})},initEvents:function(){var a=this},getDefaultEditorConfig:function(){return{}},initViewInstance:function(){var b=this,a=b.getDefaultEditorConfig();Ext.apply(a,b.cfgEditorView);if(b.editorView instanceof Ext.window.Window){b.viewInstance=Ext.apply(b.editorView,a)}else{b.viewInstance=Ext.create(b.editorView,a)}},close:function(){var a=this;if(a.viewInstance instanceof Ext.window.Window){a.viewInstance.close()}else{Vulcan.Common.ExtJS.utils.Log.getLogger().error("editor controller has no active viewInstance")}},initViewControl:function(){var a=this;a.viewInstance.saveButton.on({click:{fn:a.handleSaveButton,scope:a}});a.viewInstance.cancelButton.on({click:{fn:a.handleCancelButton,scope:a}});a.viewInstance.deleteButton.on({click:{fn:a.handleDeleteButton,scope:a}});if(a.autoDestroy!==true){return}a.mon(a.viewInstance,"close",function(){a.destroy()},a)},handleSaveButton:Ext.emptyFn,doDelete:function(a){var b=this;if(a==="yes"){b.deleteFn(b)}},deleteFn:Ext.emptyFn,handleDeleteButton:function(){var b=this;var a={buttons:Ext.MessageBox.YESNO,msg:b.cfgUI.txtDeleteConfirmation,title:b.cfgUI.txtDeleteConfirmationTitle,icon:Ext.MessageBox.QUESTION,closable:false,fn:b.doDelete,scope:b};Ext.MessageBox.show(a)},handleCancelButton:function(){var a=this;a.viewInstance.close()},storeEditSyncCallback:function(g,l,h){var k=this,b=true,d=null,a=g.operations,e,f;for(f=0;f<a.length;f++){e=a[f];if(!e.wasSuccessful()){var c=e.getFeedbackModel();c.show();d=c.getAction();b=!c.isError();break}}if(b){if(Ext.isString(h)&&k.fireEvent(h)===false){return}k.viewInstance.close()}}});Ext.define("Vulcan.Common.ExtJS.controller.editor.VFilterWindowController",{extend:"Vulcan.Common.ExtJS.controller.editor.VEditorController",requires:["Vulcan.Common.ExtJS.widget.window.VFilterWindow"],editorView:"Vulcan.Common.ExtJS.widget.window.VFilterWindow",model:"",grid:null,records:[],filteredRecords:null,filterType:"",restoreValues:Ext.emptyFn,saveValues:Ext.emptyFn,initViewControl:function(){var a=this;a.callParent(arguments);a.viewInstance.clearButton.on({click:{fn:a.handleClearButton,scope:a}})},handleSaveButton:function(){var a=this;a.saveFn(a)},saveFn:function(a){var b=this;b.fireEvent("filter",b,b.getFilteredRecords(),b.grid)},canDeleteFn:function(a){return false},handleClearButton:function(){var a=this;if(a.fireEvent("clearfilter",a)===false){return}a.reset()},reset:function(){var b=this,a=b.viewInstance.query("field");Ext.Array.forEach(a,function(c){c.reset()})},getFilteredRecords:function(){return this.filteredRecords},setFilteredRecords:function(a){this.filteredRecords=a}});Ext.define("Vulcan.Common.ExtJS.controller.editor.VGridEditorController",{extend:"Vulcan.Common.ExtJS.controller.editor.VEditorController",requires:["Vulcan.Common.ExtJS.widget.window.VEditor"],editorView:"Vulcan.Common.ExtJS.widget.window.VGridEditor",type:"edit",cancelOnClose:true,originalClearFilter:null,initEvents:function(){var a=this;a.callParent(arguments);a.addEvents("beforegridsave","aftergridsave")},isCheckboxSelection:function(){var b=this,a=b.viewInstance.gridSource,c=a.getSelectionModel().getSelection();return((a.getSelectionModel() instanceof Ext.selection.CheckboxModel)&&c.length>0)},launch:function(){var b=this,d=function(){return true},a,c;b.callParent(arguments);a=b.viewInstance.gridSource;b.originalClearFilter=a.getStore().clearFilter;switch(b.type){case"edit":if(b.isCheckboxSelection()){c=a.getCheckedItems();d=function(e){return e.phantom||Ext.Array.contains(c,e)}}break;case"add":d=function(e){return e.phantom};break;default:Vulcan.Common.ExtJS.utils.Log.getLogger().error("[vgrideditcontroller] nieznany typ dzialania: "+b.type);return}a.getStore().filterBy(d,b);a.getStore().clearFilter=Ext.Function.createSequence(a.getStore().clearFilter,function(){a.getStore().filterBy(d,b)});b.mon(b.viewInstance,"beforeclose",function(){var f=b.viewInstance.getGrid(),e=f.getStore();if(b.cancelOnClose!==true){return}try{e.suspendEvents();e.rejectChanges()}finally{e.resumeEvents();f.refresh()}if(Vulcan.Common.ExtJS.utils.helpers.GridHelper.isGroupingEnabled(f)){b.viewInstance.gridSource.refresh()}})},saveFn:function(a){var b=this;if(a.getModifiedRecords().length>0){a.suspendEvents();a.sync({callback:function(d,c){b.cancelOnClose=false;a.resumeEvents();b.viewInstance.getGrid().refresh();b.viewInstance.gridSource.refresh();return b.storeEditSyncCallback(d,c,"aftergridsave")},scope:b})}else{b.viewInstance.close()}},handleSaveButton:function(){var d=this,c=d.viewInstance.getGrid(),b=c.getStore(),a,e="";a=c.validate();if(a.isValid()){if(d.fireEvent("beforegridsave",b,c)===false){return}d.saveFn(b)}else{a.each(function(f){e+=f.message+"<br/>"});Ext.MessageBox.show({title:"Informacja",icon:Ext.MessageBox.WARNING,buttons:Ext.MessageBox.OK,msg:e})}},destroy:function(){var b=this,a=b.viewInstance.getGrid();a.getStore().clearFilter=b.originalClearFilter;if(b.cancelOnClose===true){a.getStore().clearFilter()}b.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.controller.editor.VWizardController",{extend:"Vulcan.Common.ExtJS.controller.editor.VEditorController",requires:["Vulcan.Common.ExtJS.widget.window.VWizard"],editorView:"Vulcan.Common.ExtJS.widget.window.VWizard",launch:function(){var a=this;a.callParent(arguments)},validateBeforeNavigate:["next"],initEvents:function(){var a=this;a.callParent(arguments);a.addEvents("beforenavigate","afternavigate")},initViewInstance:function(){var a=this;a.callParent(arguments);a.refreshNavigationButtons()},initViewControl:function(){var a=this;a.callParent(arguments);a.viewInstance.nextButton.on({click:{fn:a.handleNextButton,scope:a}});a.viewInstance.prevButton.on({click:{fn:a.handlePrevButton,scope:a}})},addWizardPanel:function(a){var b=this;b.insertWizardPanel(b.viewInstance.contentPanel.items.getCount(),a)},insertWizardPanel:function(e,b){var d=this,c=d.viewInstance.contentPanel.getLayout(),a=e;if(!Ext.isNumber(e)){a=d.viewInstance.contentPanel.items.getAt(e)}d.viewInstance.contentPanel.insert(a,b);d.viewInstance.handleAutoSize();if(d.viewInstance.contentPanel.items.getCount()===1){c.setActiveItem(b)}d.refreshNavigationButtons()},removeWizardPanel:function(b){var d=this,c=d.viewInstance.contentPanel.getLayout(),a=b;if(Ext.isNumber(b)){a=d.viewInstance.contentPanel.items.getAt(b)}if(c.getActiveItem()===a){if(c.getNext()){c.next()}else{if(c.getPrev()){c.prev()}}}d.viewInstance.contentPanel.remove(a);d.refreshNavigationButtons()},refreshNavigationButtons:function(){var b=this,a=b.viewInstance.contentPanel.getLayout();b.viewInstance.prevButton.setVisible(!!a.getPrev());b.viewInstance.nextButton.setVisible(b.viewInstance.contentPanel.items.length!==1&&!!a.getNext());b.viewInstance.saveButton.setVisible(b.viewInstance.contentPanel.items.length===1||!a.getNext())},navigate:function(k){var h=this,g=h.viewInstance.contentPanel.getLayout(),d=g.getActiveItem(),m=k,f="direct";if(Ext.isNumber(k)){m=h.viewInstance.contentPanel.items.getAt(k)}var b=h.viewInstance.contentPanel.items.indexOf(d);var l=h.viewInstance.contentPanel.items.indexOf(m);if(b+1===l){f="next"}if(b===l+1){f="prev"}var e=true;if(Ext.isArray(h.validateBeforeNavigate)&&Ext.Array.contains(h.validateBeforeNavigate,f)){var a=Vulcan.Common.ExtJS.utils.helpers.FormHelper.getForms(d);Ext.Array.forEach(a,function(n){e=e&&n.isValid()})}if(e){var c=h.fireEvent("beforenavigate",h,d,m,f);if(c!==false){g.setActiveItem(m);h.refreshNavigationButtons();h.fireEvent("afternavigate",h,d,m,f)}}},prev:function(){var b=this,a=b.viewInstance.contentPanel.getLayout();b.navigate(a.getPrev())},handlePrevButton:function(){var b=this,a=b.viewInstance.contentPanel.getLayout();b.prev()},next:function(){var b=this,a=b.viewInstance.contentPanel.getLayout();b.navigate(a.getNext())},handleNextButton:function(){var b=this,a=b.viewInstance.contentPanel.getLayout();b.next()},handleSaveButton:function(){var d=this,c=d.viewInstance.contentPanel.getLayout(),e=true;if(Ext.isArray(d.validateBeforeNavigate)){var b=Ext.Array.intersect(d.validateBeforeNavigate,["prev","next","direct"]);if(b.length>0){var a=Vulcan.Common.ExtJS.utils.helpers.FormHelper.getForms(c.getActiveItem());Ext.Array.forEach(a,function(f){e=e&&f.isValid()})}}if(e){d.saveFn(d)}},saveFn:Ext.emptyFn});Ext.define("Vulcan.Common.ExtJS.controller.AccessDeniedController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",views:["Vulcan.Common.ExtJS.view.blank.AccessDeniedView"],init:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init controller AccessDeniedController");a.callParent(arguments)},launch:function(){var a=this;a.callParent(arguments);a.viewInstance=Ext.create(Vulcan.Common.ExtJS.utils.security.AccessGuardian.accessDeniedView);a.replaceCenterContent(a.viewInstance)},destroy:function(){var a=this;a.viewInstance.destroy();a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.controller.BaseTabController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",tabPanel:null,tabViewConfig:{},parentController:undefined,createTabView:null,init:function(){var b=this,a=b.$className;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init controller "+a);if(typeof b.createTabView!="function"){throw {message:"definition of 'createTabView' method is required!"}}b.callParent(arguments)},launch:function(d){var b=this,a=null;if(!d||!(d instanceof Ext.tab.Panel)){var c="undefined or invalid instance of parent Ext.tab.Panel";Vulcan.Common.ExtJS.utils.Log.getLogger().warn(c);throw {message:c}}b.callParent(arguments);b.tabPanel=d;b.viewInstance=a=b.createTabView(b.tabViewConfig);a.controller=b;a.on("activate",function(){b.parentController.currentTabController=b},b);a.on("activate",b.preventBoxReady,b);a.on("activate",b.update,b);d.add(a)},preventBoxReady:function(){var a=this;if(typeof arguments[1]=="number"){return false}return true}});Ext.define("Vulcan.Common.ExtJS.controller.BaseTabPanelController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Ext.util.MixedCollection"],tabControllers:[],usingTree:true,createdControllers:null,refs:[{ref:"tabPanel",selector:"#center-container > #tabpanel-view"}],init:function(){var b=this,a=b.$className;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init controller "+a);b.createdControllers=Ext.create("Ext.util.MixedCollection");b.callParent(arguments)},launch:function(){var a=this;a.callParent(arguments);a.viewInstance=a.buildTabPanel();a.replaceCenterContent(a.viewInstance,a.usingTree?undefined:false)},update:function(){var b=this,a=b.$className,c=null;b.callParent(arguments);c=b.viewInstance.getActiveTab();if(c&&c.controller){c.controller.update()}},buildTabPanel:function(){var c=this,a=c.getTabPanel(),b=0;if(a){a.destroy()}a=Ext.create("Ext.tab.Panel",{id:"tabpanel-view",defaults:{bodyPadding:"10",autoScroll:true}});Ext.Array.each(c.tabControllers,function(f,d){if(f.ctr){var g=null;try{g=App.addController(f.ctr,f.cfg);g.parentController=c;if(!c.createdControllers.contains(g)){c.createdControllers.add(g)}}catch(e){Vulcan.Common.ExtJS.utils.Log.getLogger().error("próba utworzenia kontrolera "+f.ctr+" zakończona niepowodzeniem"+(e.message?(" :"+e.message):""));return}g.launch(a)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().debug("nie określono kontrolera dla zakładki o indeksie: "+d.toString());return}if(!b&&f.start){b=d}},c);a.setActiveTab(b);return a},destroy:function(){var a=this;a.callParent(arguments);a.createdControllers.each(function(b){b.destroy()});a.createdControllers.clear()}});Ext.define("Vulcan.Common.ExtJS.controller.BaseTreeSubController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Ext.util.MixedCollection"],refs:[{ref:"logoView",selector:"#center-container > #logo-view",xtype:"logo-view",autoCreate:true}],nodeControllers:{},singleExpand:false,createdControllers:null,currentNodeController:undefined,getTreeStore:function(){var a=this,b="derived class "+a.$className+" shoud provide definition for getTreeStore";Vulcan.Common.ExtJS.utils.Log.getLogger().warn(b);throw {message:b}},getFilterView:Ext.emptyFn,toolTipVisible:true,onBeforeToolTipShow:Ext.emptyFn,filterViewPosition:"top",rootVisible:true,initNode:undefined,expandFirstNode:true,treeWidth:200,treeColumns:null,treeItemChanging:null,treeItemChanged:function(f,b,c){var e=this,a=e.$className,d=null,g="Vulcan.Common.ExtJS.controller.BlankController";Vulcan.Common.ExtJS.utils.Log.getLogger().trace(a+".treeItemChanged oldElm: "+(b!==null?b.get("text"):"")+", newElm: "+c.get("text"));if(e.fireEvent("treeitemchanged",b,c)===false){return}if(typeof c.data.ctrid!="undefined"&&e.nodeControllers[c.data.ctrid]){g=e.nodeControllers[c.data.ctrid]}e.changeCurrentNodeController(g,c.get("ctrCfg"))},changeCurrentNodeController:function(e,a){var d=this,c;try{c=App.addController(e,a);if(!d.createdControllers.contains(c)){d.createdControllers.add(c)}}catch(b){Vulcan.Common.ExtJS.utils.Log.getLogger().error("próba utworzenia kontrolera "+e+" zakończona niepowodzeniem"+(b.message?(" :"+b.message):b.toString()));return}if(c!==d.currentNodeController){d.cleanUpCurrentCtr();d.currentNodeController=c;if(d.fireEvent("beforelaunchnodectr")!==false&&Ext.isFunction(c.launch)){c.launch()}}else{if(d.fireEvent("beforeupdatenodectr")!==false&&Ext.isFunction(c.update)){c.update()}}},cleanUpCurrentCtr:function(a){var b=this;if(b.currentNodeController){if(b.createdControllers.contains(b.currentNodeController)){b.createdControllers.remove(b.currentNodeController)}b.currentNodeController.destroy();b.currentNodeController=null}if(!a){return}var c=b.getLogoView();b.replaceCenterContent(c)},init:function(){var b=this,a=b.$className;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init controller "+a);b.addEvents("treeitemchanged","beforelaunchnodectr","beforeupdatenodectr");b.createdControllers=Ext.create("Ext.util.MixedCollection");b.callParent(arguments)},launch:function(){var a=this;a.currentNodeController=null;a.callParent(arguments);a.loadTree()},loadTree:function(d){var b=this,a=b.getTreeCnt();if(a){a.show();a.expand()}var c=App.addController("Vulcan.Common.ExtJS.controller.MainTreeController");if(c){c.subController=b}b.launchController(c,d)},selectNode:function(d,a,b){var c=this;c.getTreeCtr().selectNode(d,a,b)},expandNode:function(c,a){var b=this;return b.getTreeCtr().expandNode(c,a)},forceExpandAndSelectNode:function(e,d,b,a){var c=this;c.getTreeCtr().forceExpandAndSelectNode(e,d,b,a)},expandAndSelectNode:function(e,d,b,a){var c=this;c.getTreeCtr().expandAndSelectNode(e,d,b,a)},getNode:function(c,a){var b=this;return b.getTreeCtr().getNode(c,a)},getTreeCtr:function(){var a=this;return a.getController("Vulcan.Common.ExtJS.controller.MainTreeController")},destroy:function(){var a=this;a.createdControllers.each(function(b){b.destroy()});a.createdControllers.clear();a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.controller.BlankController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Vulcan.Common.ExtJS.view.blank.BlankView"],init:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init controller BlankController");var a=this;a.callParent(arguments)},launch:function(){var a=this;a.callParent(arguments);a.viewInstance=Ext.create("Vulcan.Common.ExtJS.view.blank.BlankView");a.replaceCenterContent(a.viewInstance)}});Ext.define("Vulcan.Common.ExtJS.controller.MainTreeController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Vulcan.Common.ExtJS.controller.AccessDeniedController","Vulcan.Common.ExtJS.model.TreeModel","Vulcan.Common.ExtJS.view.master.MainTreePanel"],refs:{ref:"treeview",selector:"#main-tree-panel",xtype:"main-tree-panel"},models:["Vulcan.Common.ExtJS.model.TreeModel"],subController:null,currentTreeItem:null,init:function(c){var b=this,a=b.$className;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init controller "+a);b.addEvents("checknodeaccess","checknodeexpandaccess");b.control({"#main-tree-panel":{beforeselect:{fn:b.treeItemChanging,scope:b},selectionchange:{fn:b.treeItemChanged,scope:b},beforeitemexpand:{fn:b.beforeExpand,scope:b}}});b.callParent(arguments)},launch:function(f){var d=this;var g=undefined;var a=function(){};if(Ext.isNumber(f)||Ext.isString(f)){g=f;a=function(){d.selectNode(g)}}else{if(Ext.isDefined(f)&&Ext.isDefined(f.initNode)){if(Ext.isDefined(f.initParent)){a=function(){d.expandAndSelectNode(f.initParent,f.initNode)}}else{a=function(){d.selectNode(f.initNode)}}}else{g=d.subController.initNode;a=function(){d.selectNode(g)}}}if(d.subController&&typeof d.subController.getTreeStore=="function"){var e=d.subController.getTreeStore(),c=d.getTreeview();if(e.getProxy().url===""){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("TreeStore proxy url jest puste.",d.subController,e);return}d.subController.mon(e,"load",a,d,{single:true});if(c){c.destroy()}c=Ext.create("Vulcan.Common.ExtJS.view.master.MainTreePanel",{store:e,rootVisible:d.subController.rootVisible,toolTipVisible:d.subController.toolTipVisible,onBeforeToolTipShow:d.subController.onBeforeToolTipShow,singleExpand:d.subController.singleExpand,columns:d.subController.treeColumns});if(d.subController.treeWidth){c.setWidth(d.subController.treeWidth)}c.flex=1;var b=[];if(d.subController.filterViewPosition==="bottom"){b.push(c);b.push(d.subController.getFilterView())}else{b.push(d.subController.getFilterView());b.push(c)}d.replaceContent(d.getTreeCnt(),Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch",pack:"start"},items:b}));a()}d.callParent(arguments)},selectNode:function(f,a,c){var e=this;var b=e.getTreeview();var d=c!==false?e.expandNode(f,a):e.getNode(f,a);if(f===null){return}if(d){b.getSelectionModel().select(d)}},expandNode:function(e,a){var d=this;if(!e&&!d.subController.expandFirstNode){return null}var b=d.getTreeview();var c=d.getNode(e,a);if(c){b.expandPath(c.getPath())}return c},forceExpandAndSelectNode:function(f,e,c,a){var d=this;var b=d.getNode(f,c);while(b.firstChild){b.removeChild(b.firstChild)}b.set("expanded",false);b.set("loaded",false);d.expandAndSelectNode(f,e,c,a)},expandAndSelectNode:function(g,f,d,a){var e=this;var c=e.expandNode(g,d);if(!c){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Zaznaczanie i rozwijanie drzewka - brak elementu nadrzędnego "+g);return}if(c.data.loaded===true){e.selectNode(f,a);return}var b=function(){Ext.defer(function(){e.selectNode(f,a)},1);c.un("expand",b)};c.on("expand",b)},getNode:function(g,b){var e=this,c=e.getTreeview(),a=c.getRootNode();if(!a){return null}var d=null;if(!g||Ext.encode(g)==="{}"){if(c.rootVisible){d=a}else{d=a.firstChild?a.firstChild:null}}else{var f=Ext.isDefined(b)&&Ext.encode(b)!=="{}"?b:"id";d=a.findChild(f,g,true)}return d},treeItemChanging:function(b,e,a,c){var d=this;if(!e||e===d.currentTreeItem){return false}if(d.subController&&typeof d.subController.treeItemChanging=="function"){if(d.subController.treeItemChanging(d,d.currentTreeItem,e)===false){return false}}},treeItemChanged:function(b,a,c){var e=this,d=(a&&a.length>0)?a[0]:null,f=e.currentTreeItem;if(!d||d===e.currentTreeItem){return false}if(e.subController&&typeof e.subController.treeItemChanged=="function"){e.currentTreeItem=d;if(e.fireEvent("checknodeaccess",e,d,b)===false){if(e.subController&&Ext.isFunction(e.subController.changeCurrentNodeController)){e.subController.changeCurrentNodeController("Vulcan.Common.ExtJS.controller.AccessDeniedController")}return false}e.subController.treeItemChanged(e,f,d)}},beforeExpand:function(b){var a=this;if(a.fireEvent("checknodeexpandaccess",a,b)===false){return false}return true}});Ext.define("Vulcan.Common.ExtJS.model.FeedbackModel",{extend:"Ext.data.Model",requires:["Vulcan.Common.ExtJS.utils.helpers.SecurityHelper"],fields:[{name:"Handled",type:"bool"},{name:"AllowHtml",type:"bool"},{name:"requestId",type:"string"},{name:"FType",type:"string",defaultValue:"error"},{name:"Action",type:"string",defaultValue:""},{name:"Message",type:"string",defaultValue:"Wystąpił błąd podczas komunikacji z serwerem. Spróbuj ponownie za chwilę."},{name:"ExceptionMessage",type:"string"},{name:"InnerExceptionMessage",type:"string"},{name:"Data",type:"object"}],parent:undefined,getAction:function(){var a=this;return a.get("Action").toLowerCase()},isInfo:function(){var a=this;return(a.get("FType").toLowerCase()=="information")},isError:function(){var a=this;return(a.get("FType").toLowerCase()=="error")},isWarn:function(){var a=this;return(a.get("FType").toLowerCase()=="warning")},isConfirmation:function(){var a=this;return(a.get("FType").toLowerCase()=="confirmation")},isNormalProcessing:function(){var a=this;return !a.isError()&&!a.isWarn()&&!a.isConfirmation()&&!a.isInfo()},show:function(d){var e=this;e.parent=d||e.parent;var g=e.get("Message");var b=e.get("ExceptionMessage");var a=g;var f=e.get("requestId");if(e.get("AllowHtml")!==true){a=Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(a)}var c={title:"Informacja",buttons:Ext.MessageBox.OK,msg:a,fn:Ext.bind(e.closeCallback,e)};if(e.isWarn()){c.title="Ostrzeżenie";c.icon=Ext.MessageBox.WARNING}if(e.isInfo()){c.title="Informacja";c.icon=Ext.MessageBox.INFO}if(e.isError()){c.title="Błąd";c.icon=Ext.MessageBox.ERROR}if(e.isConfirmation()){c.title="Wymagane potwierdzenie";c.icon=Ext.MessageBox.QUESTION;c.buttons=Ext.MessageBox.YESNOCANCEL}if(!e.get("Handled")&&f){c.title+=" "+f}e.log();Ext.MessageBox.show(c)},closeCallback:function(a){var b=this;Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.confirmationdialogclose,a,b)},log:function(){var a=this;if(a.isWarn()){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("[Handled] "+a.get("Handled"));Vulcan.Common.ExtJS.utils.Log.getLogger().warn("[Guid] "+a.get("requestId"))}else{if(a.isInfo()){Vulcan.Common.ExtJS.utils.Log.getLogger().info("[Handled] "+a.get("Handled"));Vulcan.Common.ExtJS.utils.Log.getLogger().info("[Guid] "+a.get("requestId"))}else{if(a.isError()){Vulcan.Common.ExtJS.utils.Log.getLogger().error("[Handled] "+a.get("Handled"));Vulcan.Common.ExtJS.utils.Log.getLogger().error("[Guid] "+a.get("requestId"));Vulcan.Common.ExtJS.utils.Log.getLogger().error("[Exception] "+a.get("ExceptionMessage"));Vulcan.Common.ExtJS.utils.Log.getLogger().error("[InnerException] "+a.get("InnerExceptionMessage"))}else{Vulcan.Common.ExtJS.utils.Log.getLogger().error("[Handled] "+a.get("Handled"));Vulcan.Common.ExtJS.utils.Log.getLogger().error("[Guid] "+a.get("requestId"));Vulcan.Common.ExtJS.utils.Log.getLogger().error("[Exception] "+a.get("ExceptionMessage"));Vulcan.Common.ExtJS.utils.Log.getLogger().error("[InnerException] "+a.get("InnerExceptionMessage"))}}}},toString:function(){var a=this;return"[FBM]["+a.get("FType")+"]["+a.get("Guid")+"]["+a.get("Message")+"]"}});Ext.define("Vulcan.Common.ExtJS.store.statics.AbstractStaticStore",{extend:"Vulcan.Common.ExtJS.store.AbstractStore"});Ext.define("Vulcan.Common.ExtJS.store.statics.GenderStore",{extend:"Vulcan.Common.ExtJS.store.statics.AbstractStaticStore",fields:["value","display"],data:[{value:"K",display:"K - Kobieta"},{value:"M",display:"M - Mężczyzna"}],getById:function(b){var a=this;if(b==="K"){return a.first()}if(b==="M"){return a.last()}return null}});Ext.define("Vulcan.Common.ExtJS.store.statics.YesNoStore",{extend:"Vulcan.Common.ExtJS.store.statics.AbstractStaticStore",fields:["value","display"],data:[{value:true,display:"Tak"},{value:false,display:"Nie"}],getById:function(b){var a=this;if(b===true){return a.first()}if(b===false){return a.last()}return null}});Ext.define("Vulcan.Common.ExtJS.store.AbstractFilterStore",{extend:"Vulcan.Common.ExtJS.store.AbstractStore",model:"Vulcan.Common.ExtJS.model.FilterModel",autoLoad:false});Ext.define("Vulcan.Common.ExtJS.view.abstract.AbstractGridView",{extend:"Ext.grid.Panel",requires:["Ext.ux.grid.HeaderToolTip","Ext.ux.grid.CellToolTip"],plugins:["celltooltip","checkboxextension"],columns:[],rows:[],store:[],enableColumnMove:false,enableColumnResize:false,enableColumnHide:false,sortableColumns:false,excludedGridColumns:[],excludedWindowFields:[],readonlyWindowFields:[],readonlyEditWindowFields:null,windowModelInstance:null,addWindowController:null,updateCallback:null,saveCallback:null,deleteCallback:null,orderUpdateAction:String.emptyFn,showAddButton:true,showSortButton:false,showGoToButton:false,showEditButton:true,showWindowDeleteButton:true,viewConfig:{getRowClass:Ext.emptyFn,loadMask:false,sortableColumns:false},sortDisplayField:"Nazwa",sortValueField:null,sortViewTitle:"Uporządkuj",addBtnText:"Dodaj",sortBtnText:"Uporządkuj",addWindowTitle:null,editWindowTitle:null,storeParams:null,showCheckBoxColumn:false,selectedRows:[]});Ext.define("Vulcan.Common.ExtJS.view.generic.GenericMassEditView",{extend:"Vulcan.Common.ExtJS.view.abstract.AbstractEditView",requires:["Vulcan.Common.ExtJS.widget.VPivotGrid"],autoSize:false,width:800,contentLayout:"fit",storeClass:null,excludedFields:null,readonlyFields:null,initComponent:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("initComoponent on GenericMassEditView");a.height=a.maxHeight;Ext.applyIf(a,{contentPanel:Ext.create("Ext.container.Container",{layout:"fit"})});a.pivot=Ext.create("Vulcan.Common.ExtJS.widget.VPivotGrid",{store:a.storeInstance,pivotHeaderColumnWidth:400,pivotHeaderCellWidth:75,excludedFields:a.excludedFields,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1,pluginId:"cellplugin"})]});a.contentPanel.add(a.pivot);a.callParent(arguments)}});Ext.define("Vulcan.Common.ExtJS.controller.generic.GenericMassEditController",{extend:"Vulcan.Common.ExtJS.controller.abstract.AbstractMassEditController",requires:["Vulcan.Common.ExtJS.view.generic.GenericMassEditView","Vulcan.Common.ExtJS.model.FeedbackModel"],viewClass:"Vulcan.Common.ExtJS.view.generic.GenericMassEditView",storeClass:null,excludedFields:null,readonlyFields:null,dynamicValidation:null,saveCallback:null,deleteCallback:null,saveFunc:null,init:function(){},createViewInstance:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace(a.storeInstance);if(!a.storeClass&&a.storeInstance){a.storeClass=a.storeInstance.$className}a.viewInstance=Ext.create(a.viewClass,{storeInstance:a.storeInstance,excludedFields:a.excludedFields,readonlyFields:a.readonlyFields,editButtonHandler:a.editButtonHandler,title:a.windowTitle});return a.viewInstance},saveAction:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("save mass editor");var a=this;a.storeInstance.update({callback:function(c,k,b){var h=null;try{var d=Ext.decode(b.responseText);Vulcan.Common.ExtJS.utils.Log.getLogger().trace(d);if(!d.success){h=Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel",d.feedback)}else{h=null}}catch(g){h=Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel")}var l=true;var f=null;if(h){h.show();f=h.getAction();l=!h.isError()}if(l){a.viewInstance.close();if(a.saveCallback){a.saveCallback(a.storeInstance,f)}}}})}});Ext.define("Vulcan.Common.ExtJS.view.generic.GenericPreviewView",{extend:"Ext.container.Container",requires:["Vulcan.Common.ExtJS.ux.panel.ModelPanel"],id:"generic-preview-view",alias:"widget.generic-preview-view",layout:"fit",items:[{xtype:"panel",bodyPadding:5}],canEdit:true,models:null,initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init component GenericPreviewView");var a=this;a.callParent(arguments);a.models=new Ext.util.MixedCollection()},addSection:function(a){var b=this,d=b.items.first();if(a&&a.modelInstance){if(!b.models.contains(a.modelInstance)){a.canEdit=b.canEdit;var c=Ext.create("Vulcan.Common.ExtJS.ux.panel.ModelPanel",a);d.add(c);b.models.add(a.modelInstance)}}},removeSections:function(){var a=this,b=a.items.first();if(b){b.removeAll()}a.models.clear()}});Ext.define("Vulcan.Common.ExtJS.widget.mixin.VGenericAddController",{mixins:["Vulcan.Common.ExtJS.widget.mixin.VWindowController"],showAddButton:true,addController:"Vulcan.Common.ExtJS.controller.editor.VModelEditorController",cfgAddController:{},cfgAddButton:{},txtAddButton:"Dodaj",onAddButtonClick:function(){},onAddControllerLaunch:function(a){},createAddButtonConfig:function(a){return a},createAddEvents:function(){var a=this;a.addEvents("addButtonClick")},addButtonClickHandler:function(f,c,e){var g=this;var a=g.fireEvent("addButtonClick",f,g,c,e);if(a!==false){var g=this;var b=Ext.clone(g.cfgAddController);if(!b){b={}}var d={application:App};Ext.applyIf(b,g.createAddButtonConfig(b));Ext.applyIf(b,d);g.onAddButtonClick();g.onAddControllerLaunch(g.launchWindowController(g.addController,b))}},createAddButton:function(b){var c=this;if(!c.showAddButton){return null}if(!Ext.isDefined(b)){b={}}var a={text:c.txtAddButton,iconCls:"icon-add",listeners:{click:c.addButtonClickHandler,scope:c}};Ext.applyIf(b,a);return Ext.create("Ext.Button",b)}});Ext.define("Vulcan.Common.ExtJS.widget.model.VModelEditor",{extend:"Vulcan.Common.ExtJS.widget.window.VEditor",alias:["widget.vmodeleditor","widget.v-modeleditor"],mixins:{VModelAbstract:"Vulcan.Common.ExtJS.widget.abstract.VModelAbstract"},title:"VModelEditor",cfgVModelForm:{},cfgValidation:{},initComponent:function(){var a=this;a.callParent(arguments)},autoSize:"height",vmodelformInstance:null,getContentPanel:function(){var b=this;var a={mapping:b.getMapping(),model:b.getModel(),cfgValidation:b.cfgValidation};Ext.apply(a,b.cfgVModelForm);b.vmodelformInstance=Ext.widget("vmodelform",a);return Ext.widget("panel",{bodyPadding:10,items:[b.vmodelformInstance]})},getVModelForm:function(){var a=this;return a.vmodelformInstance}});Ext.define("Vulcan.Common.ExtJS.controller.editor.VModelEditorController",{extend:"Vulcan.Common.ExtJS.controller.editor.VEditorController",requires:["Vulcan.Common.ExtJS.widget.model.VModelEditor"],mixins:{VModelAbstract:"Vulcan.Common.ExtJS.widget.abstract.VModelAbstract"},editorView:"Vulcan.Common.ExtJS.widget.model.VModelEditor",canDeletePolicy:"model",groupEditRecords:[],groupEditStore:undefined,serverParams:{saveParams:{},deleteParams:{}},launch:function(){var a=this;a.initGroupEdit();a.callParent(arguments);a.initFromModel()},initGroupEdit:function(){var a=this;if(!a.isGroupEdit()){return}a.model=a.groupEditRecords[0].$className},initEvents:function(){var a=this;a.callParent(arguments);a.addEvents("beforesave","beforegroupsave","aftersave","aftergroupsave","beforedelete","afterdelete")},initFromModel:function(){var d=this,b=d.getModel(),a=d.getMapping(),c=d.canDeleteFn(d);if(b.getId()){if(a){d.viewInstance.setTitle(a.getEditTitle())}d.viewInstance.getVModelForm().isValid()}else{if(a){d.viewInstance.setTitle(!d.isGroupEdit()?a.getCreateTitle():a.getEditTitle())}}d.viewInstance.deleteButton.setVisible(c)},isGroupEdit:function(){var a=this;return a.groupEditRecords&&a.groupEditRecords.length>0},getModel:function(){var b=this,a;if(b.isGroupEdit()){a=b.mixins.VModelAbstract.getModel.call(this);if(Ext.isObject(a)){return Ext.create(a.$className)}}return this.mixins.VModelAbstract.getModel.call(this)},getDefaultEditorConfig:function(){var a=this;return{model:a.getModel(),mapping:a.getMapping()}},getVModelForm:function(){var a=this;return a.viewInstance.contentPanel.items.first()},getForm:function(){var a=this;return a.getVModelForm().getForm()},handleSaveButton:function(){if(this.isGroupEdit()){this.handleGroupSaveButton();return}var d=this,c=d.getForm(),b=Ext.create(d.getModelClass(),d.getModel().getPersistData());b.phantom=!b.getId();if(c.isValid()){b.set(d.getVModelForm().getValues(false,false,false,true));if(d.dynamicValidationFn(c,b)){var a=d.fireEvent("beforesave",b);if(a!==false){d.saveFn(d,b)}}}},handleGroupSaveButton:function(){var e=this,d=e.getForm(),b,a;if(!d.isValid()){return}for(var c=0;c<e.groupEditRecords.length;c++){b=Ext.create(e.getModelClass(),e.groupEditRecords[c].getPersistData());b.phantom=!b.getId();b.set(e.getVModelForm().getValues());if(e.dynamicValidationFn(d,b)){a=e.groupEditRecords[c];a.set(e.getVModelForm().getValues());a.setDirty()}}if(e.fireEvent("beforegroupsave",e.groupEditRecords)===false){return}e.groupEditStore.sync({callback:function(g,f){return e.storeEditSyncCallback(g,f,"aftergroupsave")},scope:e})},dynamicValidationFn:function(b,a){return true},saveFn:function(b,a){var c=this;a.save({params:c.serverParams.saveParams,callback:function(e,d){var h=true;var f=null;if(!d.wasSuccessful()){var g=d.getFeedbackModel();g.show(c);f=g.getAction();h=g.isNormalProcessing()}if(h){c.fireEvent("aftersave",e,f);c.viewInstance.close()}}})},canDeleteFn:function(d){var e=this,b=e.getModel(),a=e.getMapping(),c=false;switch(e.canDeletePolicy){case"model":c=b.getId();break;case"form":c=!e.viewInstance.getVModelForm().isClean();break;default:log.error("Unrecognized canDeletePolicy: "+e.canDeletePolicy)}if(a){c=c&&a.getCanDelete()}return c},deleteFn:function(a){var b=this;if(b.fireEvent("beforedelete",b.getModel())===false){return}b.getModel().destroy({params:b.serverParams.deleteParams,callback:function(d,c){var g=true;var e=null;if(!c.wasSuccessful()){var f=c.getFeedbackModel();f.show();e=f.getAction();g=f.isNormalProcessing()}if(g){b.fireEvent("afterdelete",b.getModel(),e,d);b.viewInstance.close()}}})}});Ext.define("Vulcan.Common.ExtJS.widget.model.VModelForm",{extend:"Ext.form.Panel",alias:["widget.vmodelform","widget.v-modelform","widget.v-model-form"],requires:["Ext.ux.form.field.VHtmlEditor"],mixins:{VAbstractWidget:"Vulcan.Common.ExtJS.widget.abstract.VAbstractWidget",VModelAbstract:"Vulcan.Common.ExtJS.widget.abstract.VModelAbstract"},cls:"v-modelform",border:false,defaults:{anchor:"100%"},warningState:{},cfgUI:{},cfgValidation:{},initComponent:function(){var a=this;a.widgetTrace("initComponent");a.callParent(arguments);a.initDefaults();a.initEvents();a.initForm();a.refreshData();a.clearMessages()},initDefaults:function(){var a=this;Ext.applyIf(a.cfgUI,{labelSuffix:":",labelRequiredSuffix:'<span style="color: red; padding: 2px;">*</span>',labelWidth:"auto",getCustomLabelFn:Ext.emptyFn})},initEvents:function(){var a=this;a.addEvents("fieldchange","warningchange","fieldwarningchange")},initForm:function(){var a=this;if(a.getMapping()){a.initFromMapping()}a.initInternalEventHandlers();a.initFieldEvents()},getValidations:function(a){var c=this,b=c.getModelClass().getValidations(a);Ext.Array.each(b,function(d){Ext.apply(d,c.cfgValidation)});return b},initFieldEvents:function(){var b=this,a=b.getFields();Ext.Array.forEach(a,function(c){Ext.apply(c,{parent:b,validations:b.getValidations(c.getName()),tips:b.getModelClass().getTips(c.getName()),warnings:b.getModelClass().getWarnings(c.getName())});c.on({change:{fn:b.fieldChanged,scope:b},render:{fn:b.fieldRendered,scope:b}})})},getFields:function(){var a=this;return Vulcan.Common.ExtJS.utils.helpers.FormHelper.getFields(a)},initFromMapping:function(){var e=this,d=e.getMapping(),c=e.getModel(),b=e.getModelClass(),a=[];d.fields.each(function(n){if(!n.getExcludeFromEditor()){var f={cls:"v-modelform-field",fieldLabel:e.cfgUI.getCustomLabelFn!==Ext.emptyFn?e.cfgUI.getCustomLabelFn(n.getField(),n.getLabel()):n.getLabel(),labelWidth:e.getLabelWidth(),labelSeparator:e.cfgUI.labelSuffix,labelCls:"v-modelform-field-label",disabled:!n.getCanEdit(),name:n.getField(),itemId:n.getField()};var g=e.getAllowBlank(n.getField())===false;var l=null;if(n.getStore()){l="Vulcan.Common.ExtJS.widget.Valdict";var p=n.getStoreInstance(c);Ext.apply(f,{store:p,displayField:n.getStoreDisplayField(),valueField:n.getStoreValueField()});if(n.getType()==="valdict"){var o=2+2}else{if(n.getType()==="combo"){Ext.apply(f,{combo:true})}else{Ext.apply(f,{forceSelection:true})}}}else{switch(n.getType()){case"date":l="Ext.form.field.Date";Ext.apply(f,{format:n.getFormat()?n.getFormat():Vulcan.Common.ExtJS.utils.Settings.dateFormat,startDay:1,invalidText:"Niepoprawny format daty"});break;case"time24":l="Vulcan.Common.ExtJS.widget.VTime";Ext.apply(f,{format:n.getFormat()?n.getFormat():Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"time24",invalidText:""});break;case"month":l="Vulcan.Common.ExtJS.widget.VMonthPicker";Ext.apply(f,{format:n.getFormat()?n.getFormat():Vulcan.Common.ExtJS.utils.Settings.monthFormat,startDay:1,invalidText:"Niepoprawny format daty miesięcznej"});break;case"bool":l="Ext.form.field.Checkbox";break;case"timerange":l="Ext.form.field.Time";Ext.apply(f,{format:n.getFormat()?n.getFormat():Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"timerange",invalidText:"Nieprawidłowa wartość",minText:"Godzina powinna być równa lub późniejsza niż {0}",maxText:"Godzina powinna być równa lub wcześniejsza niż {0}"});break;case"int":l="Ext.form.field.Number";Ext.apply(f,{allowDecimals:false,hideTrigger:(n.getStep()===0),step:n.getStep()});break;case"numeric":case"float":l="Ext.form.field.Number";Ext.apply(f,{allowDecimals:true,decimalPrecision:n.getDecimalPrecision(),decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator,hideTrigger:(n.getStep()===0),step:n.getStep()});break;case"bankAccount":case"bankaccount":l="Ext.form.field.Text";Ext.apply(f,{listeners:{change:function(r,s,q){r.setValue(Vulcan.Common.ExtJS.utils.helpers.BankAccountHelper.getRawNumber(s))}}});break;case"html":case"vhtml":case"htmleditor":case"vhtmleditor":l="Ext.ux.form.field.VHtmlEditor";Ext.apply(f,{grow:true,completeOnEnter:false,height:150});break;default:var h=n.getCfgExtra();if(n.getHeight()||(h&&(h.height||h.minHeight))){l="Ext.form.field.TextArea";Ext.apply(f,{height:n.getHeight()})}else{l="Ext.form.field.Text"}}}if(n.getEditor()){l=n.getEditor()}Ext.apply(f,n.getCfgExtra());g=g||f.forceSelection;if(g){f.labelSeparator+=e.cfgUI.labelRequiredSuffix}var m=Ext.create(l,f);if(n.getStore()){var k={valdict:m,mapping:n,vmodelform:e};if(p.isLoading()){p.on({load:{fn:e.initValdict,scope:k,single:true}})}else{Ext.bind(e.initValdict,k)()}}a.push(m)}});if(a.length>0){e.add(a)}},initValdict:function(){var b=this;b.valdict.clearInvalid();if(b.mapping.getStoreAllowNull()){var d=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getNullableStore(b.valdict.getStore(),b.mapping.getStoreValueField(),b.mapping.getStoreDisplayField(),b.mapping.getStoreAllowNullLabel());b.valdict.bindStore(d);Ext.override(b.valdict,{getValue:function(){var e=this.callParent(arguments);if(e===-1){e=null}return e}});if(b.valdict.getValue()===null&&!b.vmodelform.getModel().phantom){b.valdict.setValue(-1)}}if(b.mapping.getStoreDefaultSelection()=="first"){try{var a=b.valdict.getStore().first();b.valdict.setValue(a)}catch(c){}}},getAllowBlank:function(d){var c=this,b=c.getValidations(d);for(var a=0;a<b.length;a++){if(b[a].field===d){if(b[a].type==="selected"){return false}if(b[a].type==="length"&&b[a].min&&b[a].min>0){return false}if(b[a].type==="range"){return false}if(b[a].type==="presence"){return false}}}return true},initInternalEventHandlers:function(){var a=this;a.on({fieldwarningchange:{fn:a.fieldWarningChanged,scope:a}})},clearInvalid:function(){var c=this,a=c.getFields();for(var b=0;b<a.length;b++){a[b].clearInvalid()}},clearWarnings:function(){var c=this,a=c.getFields();for(var b=0;b<a.length;b++){c.clearWarning(a[b])}},clearMessages:function(){var a=this;a.clearInvalid();a.clearWarnings()},isWarningFree:function(){var c=this,a=c.getFields();for(var b=0;b<a.length;b++){c.testWarnings(a[b],a[b].getValue())}return c.getStateAsBool(c.warningState)},fieldWarningChanged:function(c,e,f){var b=this;var a=b.getStateAsBool(b.warningState);b.warningState[e.getName()]=f;var d=b.getStateAsBool(b.warningState);if(a!==d){b.fireEvent("warningchange",b,d)}},refreshData:function(){var c=this,b=c.getForm(),a=c.getModel();b.loadRecord(a)},getStateAsBool:function(b){for(var a in b){if(b[a]===false){return false}}return true},fieldValidator:function(f){var g=this,e=g.parent;if(g.disabled&&!g.forceValidation){g.clearInvalid()}else{for(var c=0;c<g.validations.length;c++){var d=g.validations[c];var b=Vulcan.Common.ExtJS.utils.helpers.ValidationHelper.getValidator(d.type);var a=b.validate(f,d);if(a!==true){return a}}}e.testWarnings(g,f);return true},fieldChanged:function(d,c,a){var b=this;b.fireEvent("fieldchange",b,d)},fieldRendered:function(b){var a=this;b.validator=a.fieldValidator;Ext.callback(a.setTips,a,arguments)},getTipBody:function(d,c,b){var a='<table><tr><td><div class="'+c+'"></div></td><td><ul style="padding-left: 10px">';Ext.Array.each(d,function(e){if(b){a+="<li>"+e[b]+"</li>"}else{a+="<li>"+e+"</li>"}});a+="</ul></td></tr></table>";return a},setTips:function(f){var c=this;if(f&&f.inputEl){var a=f.inputEl.parent();if(f.tips.length>0){var e=a.parent();var d=Ext.DomHelper.append(e,{tag:"td",cls:"x-form-information-cell"},true);var b=Ext.DomHelper.append(d,{tag:"div",cls:"x-information-icon"},true);Ext.create("Ext.tip.ToolTip",{target:d,trackMouse:true,renderTo:Ext.getBody(),cls:"x-form-information-tip",html:c.getTipBody(f.tips,"x-information-icon","message")})}}},clearWarning:function(b){var a=this;if(b.tip){b.tip.destroy();b.tip=null;a.fireEvent("fieldwarningchange",a,b,true)}if(b.inputEl){b.inputEl.removeCls("x-form-warning-field")}},testWarnings:function(f){var c=this,e=f.inputEl,b=f.warnings;if(e&&b.length>0){var a=[];var d=f.getValue();Ext.Array.each(b,function(k){var h=Vulcan.Common.ExtJS.utils.helpers.ValidationHelper.getValidator(k.type);var g=h.validate(d,k);if(g!==true){a.push(g)}});if(a.length>0){if(!f.preventMark){if(!f.tip){f.tip=Ext.create("Ext.tip.ToolTip",{target:e,trackMouse:true,renderTo:Ext.getBody(),cls:"x-form-warning-tip"})}f.tip.update(c.getTipBody(a,"x-warning-icon"));e.addCls("x-form-warning-field")}}else{c.clearWarning(f)}}},setModel:function(a){var b=this;Ext.callback(b.mixins.VModelAbstract.setModel,b,arguments);b.refreshData()},getValues:function(){var e=this,a=e.getFields(),d={};for(var c=0;c<a.length;c++){var f=a[c].getValue();if(Ext.isString(f)){f=f.trim()}d[a[c].getName()]=f;if(Ext.isDefined(e.altValueField)&&e.altValueField!==null){var b=a[c].altValue;if(Ext.isString(b)){b=b.trim()}d[a[c].altValueField]=b}}return d},isClean:function(){var c=this,a=c.getFields();for(var b=0;b<a.length;b++){if(a[b].getValue()){return false}}return true},clean:function(){var c=this,a=c.getFields();for(var b=0;b<a.length;b++){a[b].setValue("")}}});Ext.define("Vulcan.Common.ExtJS.view.generic.GenericEditView",{extend:"Vulcan.Common.ExtJS.view.abstract.AbstractEditView",requires:["Vulcan.Common.ExtJS.ux.form.ModelValidatedPanel","Vulcan.Common.ExtJS.widget.model.VModelForm"],autoSize:true,mapping:true,config:{mappingName:null},modelClass:null,disableValidation:false,excludedFields:null,storeParams:null,readonlyFields:null,validationConfig:{},constructor:function(a){var b=this;b.callParent(arguments);b.initConfig(a)},initComponent:function(){var d=this;Ext.applyIf(d,{contentPanel:Ext.create("Vulcan.Common.ExtJS.ux.form.ModelValidatedPanel",{modelValidations:d.modelClass,validationConfig:d.validationConfig})});var h=0;var c=Ext.create(d.modelClass);var g=d.mapping;if(!(g instanceof Vulcan.Common.ExtJS.model.helpers.GenericMapping)){var f=d.mapping||d.getMappingName();g=c.getGenericMapping(f)}var a=[];if(g){if(!d.title&&g.getEditTitle()){d.title=g.getEditTitle()}d.contentPanel.suspendEvents();g.fields.each(function(r){var l=false;l|=d.excludedFields&&Ext.Array.contains(d.excludedFields,r.getField());l|=r.getExcludeFromEditor();if(!l){var n=r.getAllowBlank();if(n&&c.validations){n=d.getAllowBlank(r.getField(),c.validations)}var m={name:r.getField(),itemId:r.getField(),fieldLabel:r.getLabel(),allowBlank:n,maskRe:r.getMask()};var p=null;if(r.getStore()){var t=r.getStore();if(Ext.isString(t)){if(!(t instanceof Ext.data.Store)){var k=d.storeParams;if(k){k=k[r.getField()]}else{k=r.getStoreParams()}if(k){t=Ext.create(r.getStore());t.loadByParams(k)}else{t=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(r.getStore(),true)}}}else{t=r.getStoreInstance()}p="Vulcan.Common.ExtJS.widget.Valdict";Ext.apply(m,{store:t,displayField:r.getStoreDisplayField(),valueField:r.getStoreValueField()});if(r.getType()==="valdict"){var s=2+2}else{if(r.getType()==="combo"){Ext.apply(m,{combo:true})}else{Ext.apply(m,{forceSelection:true,value:-1})}}}else{switch(r.getType()){case"date":p="Ext.form.field.Date";Ext.apply(m,{format:r.getFormat()?r.getFormat():Vulcan.Common.ExtJS.utils.Settings.dateFormat,startDay:1});break;case"time24":p="Vulcan.Common.ExtJS.widget.VTime";Ext.apply(m,{format:r.getFormat()?r.getFormat():Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"time24",invalidText:""});break;case"bool":p="Ext.form.field.Checkbox";break;case"int":p="Ext.form.field.Number";Ext.apply(m,{allowDecimals:false,hideTrigger:(r.getStep()===0),step:r.getStep()});break;case"numeric":case"float":p="Ext.form.field.Number";Ext.apply(m,{allowDecimals:true,decimalPrecision:r.getDecimalPrecision(),decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator,hideTrigger:(r.getStep()===0),step:r.getStep()});break;default:if(r.getHeight()){p="Ext.form.field.TextArea";Ext.apply(m,{height:r.getHeight()})}else{p="Ext.form.field.Text"}}}if(r.getEditor()){p=r.getEditor()}m=Ext.apply(m,r.getCfgExtra());var q=Ext.create(p,m);if(r.getStore()){var o={combo:q,mapping:r};if(t.isLoading()){t.on({load:{fn:d.prepareComboField,scope:o,single:true}})}else{Ext.bind(d.prepareComboField,o)()}}q.labelWidth=r.getLabel().length*5+70;h=Math.max(q.labelWidth,h);if(!n){q.labelSeparator=__REQUIRED_SEPARATOR}a.push(q);if(!r.getCanEdit()||(d.readonlyFields&&Ext.Array.contains(d.readonlyFields,q.name))){q.disable()}}})}for(var b=0;b<a.length;b++){a[b].labelWidth=h}var e=d.width-h;if(e<200){d.width+=200-e}d.contentPanel.add(a);d.contentPanel.resumeEvents();d.callParent(arguments)},getAllowBlank:function(c,b){for(var a=0;a<b.length;a++){if(b[a].field===c){if(b[a].type==="selected"){return false}if(b[a].type==="length"&&b[a].min&&b[a].min>0){return false}if(b[a].type==="range"&&!b[a].allowEmpty){return false}}}return true},prepareComboField:function(){var b=this;b.combo.clearInvalid();if(b.mapping.getStoreAllowNull()){var d=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getNullableStore(b.combo.getStore(),b.mapping.getStoreValueField(),b.mapping.getStoreDisplayField(),b.mapping.getStoreAllowNullLabel());b.combo.bindStore(d);Ext.override(b.combo,{getValue:function(){var e=this.callParent(arguments);if(e===-1){e=null}return e}})}if(b.mapping.getStoreDefaultSelection()=="first"){try{var a=b.combo.getStore().first();b.combo.setValue(a)}catch(c){}}},hideField:function(b){var a=this;a.contentPanel.items.each(function(c){if(c.name==b){a.contentPanel.remove(c)}})}});Ext.define("Vulcan.Common.ExtJS.controller.generic.GenericEditController",{extend:"Vulcan.Common.ExtJS.controller.abstract.AbstractEditController",requires:["Vulcan.Common.ExtJS.view.generic.GenericEditView"],viewClass:"Vulcan.Common.ExtJS.view.generic.GenericEditView",modelClass:null,excludedFields:null,readonlyFields:null,dynamicValidation:null,saveCallback:null,storeParams:null,deleteCallback:null,closeAfterDeleteFailure:true,saveFunc:null,saveFn:null,serverParams:{saveParams:{},deleteParams:{}},validationConfig:{},init:function(){},constructor:function(a){var b=this;b.callParent(arguments);b.initDeprecated()},initDeprecated:function(){var a=this;if(!Ext.isFunction(a.saveFn)){a.saveFn=a.saveFunc}},createViewInstance:function(){var b=this;if(!b.modelClass&&b.modelInstance){b.modelClass=b.modelInstance.$className}var a={additionalButtonsOnLeft:b.additionalButtonsOnLeft,additionalButtonsOnRight:b.additionalButtonsOnRight,mapping:b.mapping,mappingName:b.mappingName,modelClass:b.modelClass,excludedFields:b.excludedFields,readonlyFields:b.readonlyFields,title:b.windowTitle,storeParams:b.storeParams,validationConfig:b.validationConfig};a=Ext.apply(a,b.viewClassParams);b.viewInstance=Ext.create(b.viewClass,a);return b.viewInstance},saveAction:function(){var c=this,b=c.viewInstance.contentPanel.getForm(),e;if(b.isValid()){Vulcan.Common.ExtJS.utils.Log.getLogger().trace(c.modelInstance);if(c.modelInstance instanceof Ext.data.Model){e=Ext.create(c.modelClass,c.modelInstance.getData());e.setProxy(c.modelInstance.getProxy());e.phantom=!c.modelInstance.getId()}else{e=Ext.create(c.modelClass)}var d={};var a=Vulcan.Common.ExtJS.utils.helpers.FormHelper.getFields(c.viewInstance.contentPanel);Ext.Array.forEach(a,function(f){var g=f.getValue();if(Ext.isString(g)){g=g.trim()}d[f.getName()]=g});e.set(d);if(!(c.dynamicValidation)||c.dynamicValidation(b,e)){if(Ext.isFunction(c.saveFn)){if(c.saveFn(b,e)===false){return false}}e.save({params:c.serverParams.saveParams,callback:function(g,f){var l=true;var h=null;if(!f.wasSuccessful()){var k=f.getFeedbackModel();k.show();h=k.getAction();l=!k.isError()}if(l){c.viewInstance.close();if(c.saveCallback){c.saveCallback(g,h)}}}});return true}else{return false}}else{return false}},doDelete:function(a){var b=this;if(a==="yes"){b.deleteFn()}},deleteFn:function(){var a=this;a.modelInstance.destroy({params:a.serverParams.deleteParams,callback:function(c,b,f){var g=true;var d=null;if(!b.wasSuccessful()){var e=b.getFeedbackModel();e.show();d=e.getAction();g=!e.isError()}if(g){if(b.wasSuccessful()||a.closeAfterDeleteFailure){a.viewInstance.close()}if(a.deleteCallback){a.deleteCallback(a.modelInstance,d,c)}}}})},deleteAction:function(){var b=this;var a={buttons:Ext.MessageBox.YESNO,msg:"Czy na pewno chcesz usunąć wybrany element?",title:"Potwierdzenie",icon:Ext.MessageBox.QUESTION,closable:false,fn:b.doDelete,scope:b};Ext.MessageBox.show(a)}});Ext.define("Vulcan.Common.ExtJS.widget.model.VModelSectionPanel",{extend:"Ext.panel.Panel",alias:["widget.vmodelpanel","widget.vmodelsectionpanel","widget.v-modelsectionpanel","widget.v-model-section-panel"],requires:["Vulcan.Common.ExtJS.widget.model.VModelSection"],mixins:["Vulcan.Common.ExtJS.widget.mixin.VGenericAddController","Vulcan.Common.ExtJS.widget.mixin.Guarded"],modelClass:"",dialogMapping:"",modelCollection:[],cfgVModelSection:{},maxItems:0,autoRefresh:true,insertPolicy:"begin",addButtonPosition:"top",collapsible:true,items:[],cls:"v-section-panel",initComponent:function(){var a=this;a.createAddEvents();a.callParent(arguments);a.setModelCollection(a.modelCollection)},setModelCollection:function(c){var e=this,f=e.showAddButton,h,g,d,a={};e.removeAll(true);Ext.apply(a,e.cfgAddButton);if(c){for(var b=0;b<c.length;b++){d=c[b];g=Ext.widget("vmodelsection",e.createSectionConfig(d));if(b>0){e.add({xtype:"vhr"})}e.add(g)}if(e.maxItems!==0&&c.length>=e.maxItems){f=false}}if(f){h=(e.addButtonPosition==="top"?0:c.length*2);if(c.length>0){e.insert(h,{xtype:"vhr"});if(e.addButtonPosition==="bottom"){h++}}if(e.addButtonPosition==="bottom"){Ext.applyIf(a,{cls:"edit-float-button"})}e.insert(h,e.createAddButton(a))}},createSectionConfig:function(c){var b=this;var a=Ext.clone(b.cfgVModelSection);if(!a.cfgEditorController){a.cfgEditorController={}}Ext.applyIf(a.cfgEditorController,{mapping:b.dialogMapping});var d={useCases:b.useCases};if(!b.modelClass){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Nie określono modelClass dla VModelSectionPanel")}else{Ext.apply(d,{model:(Ext.isDefined(c.$className)?c:Ext.create(b.modelClass,c))})}Ext.applyIf(a,d);return a},createAddButtonConfig:function(a){var c=this,b={model:c.modelClass,mapping:c.dialogMapping},d={};Ext.apply(d,a);Ext.applyIf(d,b);return d},insertNewItem:function(b){var c=this,d=Ext.widget("vmodelsection",c.createSectionConfig(b)),a;if(Ext.isNumber(c.insertPolicy)){c.insert(c.insertPolicy,d);c.insert(c.insertPolicy,Ext.widget("vhr"))}else{switch(c.insertPolicy){case"begin":if(c.showAddButton!==true||c.addButtonPosition==="bottom"){c.insert(0,Ext.widget("vhr"));c.insert(0,d)}else{c.insert(1,d);c.insert(1,Ext.widget("vhr"))}break;case"end":if(c.showAddButton!==true||c.addButtonPosition==="top"){c.add(Ext.widget("vhr"));c.add(d)}else{a=c.items.length-1;c.insert(a,Ext.widget("vhr"));c.insert(a,d)}break;default:Vulcan.Common.ExtJS.utils.Log.getLogger().error("Unkown insertPolicy: "+c.insertPolicy)}}},onAddControllerLaunch:function(b){var a=this;if(a.autoRefresh===true){b.on("aftersave",a.insertNewItem,a)}}});Ext.define("Vulcan.Common.ExtJS.widget.VGrid",{extend:"Ext.grid.Panel",alias:"widget.vgrid",requires:["Ext.grid.plugin.BufferedRenderer","Ext.ux.grid.column.StoreColumn","Ext.ux.grid.Printer","Ext.ux.selection.VCellSelectionModel"],mixins:{VGenericAddController:"Vulcan.Common.ExtJS.widget.mixin.VGenericAddController",Guarded:"Vulcan.Common.ExtJS.widget.mixin.Guarded",CfgProperties:"Vulcan.Common.ExtJS.widget.mixin.CfgProperties",Stateful:"Vulcan.Common.ExtJS.widget.mixin.Stateful"},store:undefined,mappingName:"default",mapping:"default",showRowNumber:false,sortableColumns:true,orderable:false,showSearchBox:true,showAddButton:false,showDeleteButton:false,showGoToButton:false,showEditButton:false,showGroupEditButton:false,showGridEditButton:false,showGridAddButton:false,showInsertButton:false,showAlphabeticOrderButton:false,showPrintButton:true,showPrintSelectedButton:false,showAdvFilterButton:true,toolbarItems:[],actionColumnButtons:[],editController:"Vulcan.Common.ExtJS.controller.editor.VModelEditorController",groupEditController:"Vulcan.Common.ExtJS.controller.editor.VModelEditorController",gridEditController:"Vulcan.Common.ExtJS.controller.editor.VGridEditorController",gridAddController:"Vulcan.Common.ExtJS.controller.editor.VGridEditorController",cfgEditController:{},cfgGroupEditController:{},cfgGridEditController:{},cfgGridAddController:{},cfgPrintButton:{},cfgAdvFilterButton:{},cfgGoToButton:{},cfgEditButton:{},cfgDeleteButton:{},cfgGroupEditButton:{},cfgGridEditButton:{},cfgGridAddButton:{},cfgActionColumn:{},cfgGridEdit:{},editable:false,buffered:false,actionColumnIndex:0,rowNumberColumnIndex:0,getCustomColumnHeaderFn:Ext.emptyFn,autoRefresh:true,printTitle:"Vulcan",wrapColumns:false,disableSelection:true,multiselect:false,insertPolicy:"end",stateful:true,viewConfig:{loadMask:false},headerAlign:"center",headerClsPrefix:"x-column-header-align-",cls:"vgrid",clsInvalidCell:"x-grid-cell-invalid",clsWrap:"x-grid-wrap",headerIdPrefix:"vgrid-header-",stateIdPrefix:"vgrid-",mappingLockedColumns:false,actionColumnExists:false,filterButton:undefined,searchBox:undefined,advFilterId:"advfilterids",txtSearchBoxHint:"Wpisz, by wyszukać",txtPrintButton:"Drukuj",txtPrintSelectedButton:"Drukuj zaznaczone",txtGroupEditButton:"Zmień seryjnie",txtGridEditButton:"Zmień",txtGridEditCheckboxButton:"Zmień zaznaczone",txtGridAddButton:"Dodaj grupowo",txtGridAdvFiltetrButton:"Filtruj",txtGridAdvFiltetrClearButton:"Wyczyść filtry",txtInsertAddButton:"Wstaw nowy wiersz",txtMoveToTop:"Przesuń na pierwszą pozycję",txtMoveToBottom:"Przesuń na ostatnią pozycję",txtMoveDown:"Jedna pozycja w dół",txtMoveUp:"Jedna pozycja do góry",txtSortAlphabetically:"Sortuj alfabetycznie",txtDeleteConfirmation:"Czy na pewno chcesz usunąć wiersz nr {0}?",txtDeleteConfirmationTitle:"Potwierdzenie",emptyText:"Brak danych",constructor:function(a){var b=this;if(Ext.isString(a.store)){Ext.apply(a,{store:Ext.data.StoreManager.lookup(a.store||"ext-empty-store")})}b.printTitle=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("appName");b.initStateful(a,b.stateIdPrefix,b.generateVGridStateId);Ext.apply(b,a);b.callParent(arguments);if(b.editable===true){b.addCls(b.cls+"-editable")}},generateVGridStateId:function(b,a,c){var d=c,e=d.generateStateId(b,a);if(Ext.isObject(b.store)){e+="-"+b.store.$className}e+="-"+d.getMapping()+"-"+d.addController+"-"+d.editController;e+="-2";return e},initComponent:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init VGrid");a.initCfg();if(a.wrapColumns===true){a.addCls(a.clsWrap)}a.initColumns();if(a.orderable){a.multiselect=true;a.sortableColumns=false;a.showSearchBox=false}if(a.multiselect){a.disableSelection=false;a.selType="rowmodel";a.selModel={mode:"MULTI"}}a.callParent(arguments);a.initPlugins();a.addVGridEvents();a.initToolbars();a.initBugFixes()},initBugFixes:function(){var a=this;if(a.getView() instanceof Ext.view.Table){Ext.override(a.getView(),{doStripeRows:function(c,b){if(c<0){c=0}if(this.all&&this.all.startIndex&&c<this.all.startIndex){c=this.all.startIndex}return this.callParent([c,b])}})}},initPlugins:function(){var a=this;if(a.buffered){a.addPlugin({ptype:"bufferedrenderer"})}},addVGridEvents:function(){var b=this,a=b.getNormalGrid();b.createAddEvents();b.addEvents("printButtonClick","groupEditButtonClick","gridEditButtonClick","gridAddButtonClick","insertButtonClick","goToButtonClick","editButtonClick","deleteButtonClick","searchBoxChange","cellMouseOver","recordCreated","beforeRecordDelete","recordDeleted");a.on("render",function(){if(a.view.trackOver!==true){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("[vgrid] nie odpalam cellmouseover - wyłączone trackOver");return}a.getTargetEl().on("mouseover",function(k,h){var d,g,f,l,c=k.getTarget(a.view.cellSelector);if(a.view.isDestroyed||!c){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("[vgrid] nie odpalam cellmouseover");return}g=a.view.getHeaderByCell(c);d=a.view.getRecord(k.getTarget(a.view.dataRowSelector||a.view.itemSelector,a.view.getTargetEl()));l=a.view.getPosition(d,g);a.fireEvent("cellMouseOver",c,l,d,g,k)},a,{buffer:10,delegate:a.view.cellSelector})});a.on("edit",b.onValidateEdit,b)},setLockedColumns:function(){var a=this;if(!a.mappingLockedColumns){return}if(a.actionColumnExists===true){Ext.apply(a.columns[a.actionColumnIndex],{locked:true})}if(a.showRowNumber===true){Ext.apply(a.columns[a.rowNumberColumnIndex],{locked:true})}},initColumns:function(){var a=this;a.columns=[];a.initMappingColumns();a.initConfigColumns();a.setLockedColumns()},initConfigColumns:function(){var a=this;a.initActionColumn();if(a.showRowNumber===true){if(a.rowNumberColumnIndex===a.actionColumnIndex){a.actionColumnIndex++}Ext.Array.insert(a.columns,a.rowNumberColumnIndex,[Ext.create("Ext.grid.RowNumberer",{headerId:a.headerIdPrefix+"row-number",width:30})])}},initActionColumn:function(){var b=this;var a=Ext.create("Ext.grid.column.Action",Ext.apply({hideable:false,width:0,items:[],headerId:b.headerIdPrefix+"action-column"},b.cfgActionColumn));if(b.showDeleteButton===true){b.addActionColumnButton(a,"icon-del",function(g,k,d,f,h,c){if(b.fireEvent("deleteButtonClick",c,f,b,k,d)===false){return}b.onDeleteButtonClick(c,f,b,k,d)},b.cfgDeleteButton)}if(b.showGoToButton===true){b.addActionColumnButton(a,"icon-step_into",function(g,k,d,f,h,c){b.fireEvent("goToButtonClick",c,f,b,k,d)},b.cfgGoToButton)}if(b.showEditButton===true){b.addActionColumnButton(a,"icon-edit",function(g,k,d,f,h,c){if(b.fireEvent("editButtonClick",c,f,b,k,d)===false){return}b.onEditButtonClick(c,f,b,k,d)},b.cfgEditButton)}Ext.Array.forEach(b.actionColumnButtons,function(c){b.addActionColumnButton(a,c.iconCls,c.handler,c.config)});if(a.items.length>0){Ext.Array.insert(b.columns,b.actionColumnIndex,[a]);b.actionColumnExists=true}},addActionColumnButton:function(a,c,d,b){a.width+=20;a.items.push(Ext.create("Ext.Button",Ext.apply({iconCls:c,iconHeight:24,iconWidth:24,handler:d},b)))},initMappingColumns:function(){var a=this,b=a.store.model.getGenericMapping(a.getMapping());if(!b){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("Brak mappingu generycznego "+a.getMapping()+" dla "+a.store.model.getName()+". Zostanie użyty pierwszy dostępny mapping.");b=a.store.model.getGenericMapping()}if(!b){Vulcan.Common.ExtJS.utils.Log.getLogger().error("Brak mappingu generycznego "+a.getMapping()+" dla "+a.store.model.getName());return}b.fields.each(function(d){if(d.getExcludeFromGrid()===true){return}var c=a.createColumn(d);a.mappingLockedColumns=a.mappingLockedColumns||c.locked;a.columns.push(c)})},createColumn:function(d){var c=this,e,a={sortable:c.sortableColumns,text:Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(c.getCustomColumnHeaderFn!==Ext.emptyFn?c.getCustomColumnHeaderFn(d.getField(),d.getLabel()):d.getLabel())+(d.getGridHeaderExtraHtml()||""),tooltip:Ext.util.Format.htmlEncode(Ext.util.Format.stripTags(c.getCustomColumnHeaderFn!==Ext.emptyFn?c.getCustomColumnHeaderFn(d.getField(),d.getLabel()):d.getLabel())),dataIndex:d.getField(),flex:d.getWidth()?0:1,width:d.getWidth(),filter:d.getFilter(),editor:c.getEditor(d),headerId:c.headerIdPrefix+(c.getCustomColumnHeaderFn!==Ext.emptyFn?c.getCustomColumnHeaderFn(d.getField(),d.getLabel()):d.getLabel()),summaryType:d.getSummaryType(),summaryRenderer:d.getSummaryRenderer(),cls:c.headerClsPrefix+c.headerAlign};if(d.getMinWidth()){a.minWidth=d.getMinWidth()}if(d.getMaxWidth()){a.maxWidth=d.getMaxWidth()}if(d.getRenderer()){a.renderer=d.getRenderer()}if(d.getTdCls()){a.tdCls=d.getTdCls()}e=c.getColumnClass(d,a);a=Ext.apply(a,d.getCfgExtra());var b=Ext.create(e,a);if(b.isDisabled()||b.locked===true){b.tdCls="x-cell-not-editable"}return b},getColumnClass:function(c,a){var b=this,d=null;if(c.getStore()){d="Ext.ux.grid.column.StoreColumn";Ext.apply(a,{fieldMapping:c})}else{switch(c.getType()){case"bool":d="Ext.grid.column.Boolean";Ext.apply(a,{trueText:"Tak",falseText:"Nie"});break;case"date":d="Ext.grid.column.Date";Ext.apply(a,{format:c.getFormat()?c.getFormat():Vulcan.Common.ExtJS.utils.Settings.dateFormat});break;case"month":d="Ext.grid.column.Date";Ext.apply(a,{format:c.getFormat()?c.getFormat():Vulcan.Common.ExtJS.utils.Settings.monthFormat});break;case"time24":case"timerange":d="Ext.grid.column.Date";Ext.apply(a,{format:c.getFormat()?c.getFormat():Vulcan.Common.ExtJS.utils.Settings.timeFormat});break;case"int":d="Ext.grid.column.Number";Ext.apply(a,{format:c.getFormat()?c.getFormat():"0"});break;case"float":d="Ext.grid.column.Number";Ext.apply(a,{format:c.getFormat()?c.getFormat():"0,000.00",decimalPrecision:c.getDecimalPrecision(),decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator});break;case"list":d="Ext.ux.grid.column.ButtonColumn";Ext.apply(a,{format:c.getFormat(),showButtons:true,items:[Ext.create("Ext.Button",{iconCls:"icon-edit",iconHeight:24,iconWidth:24,handler:function(f,g,e){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("ButtonColumn Ext.Button click");b.onButtonColumnButtonClick(f.getStore().getAt(g).data.Id,f.headerCt.getHeaderAtIndex(e).dataIndex)}})]});break;case"string":d="Ext.grid.column.Column";Ext.apply(a,{renderer:function(f){var e=f||"";e=Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(f);return e}});break;default:d="Ext.grid.column.Column";break}}return d},onButtonColumnButtonClick:function(b,a){this.fireEvent("buttonColumnButtonClick",this,b,a)},initToolbars:function(){var a=this;a.initUtilsToolbar();if(a.orderable){a.initOrderToolbar()}},initUtilsToolbar:function(){var b=this;var a=Ext.widget("toolbar",{dock:"top"});b.addToolbarItem(a,b.createGridEditButton(b.cfgGridEditButton),0);b.addToolbarItem(a,b.createGroupEditButton(b.cfgGroupEditButton),0);b.addToolbarItem(a,b.createGridAddButton(b.cfgGridAddButton),0);b.addToolbarItem(a,b.createAddButton(b.cfgAddButton),0);b.addToolbarItem(a,b.createInsertButton(),0);Ext.Array.forEach(b.toolbarItems,function(c){b.addToolbarItem(a,c)});b.filterButton=b.createAdvFilterButton(b.cfgAdvFilterButton);b.addToolbarItem(a,b.filterButton,0);b.searchBox=b.createToolbarSearchBox();b.addToolbarItem(a,b.searchBox,0);if(b.showRightAlignedToolbarButtons()){b.addToolbarItem(a,Ext.widget("tbfill"));b.addToolbarItem(a,b.createPrintButton(b.cfgPrintButton));b.addToolbarItem(a,b.createPrintSelectedButton(b.cfgPrintButton))}if(a.items.length>0){b.addDocked(a)}},initOrderToolbar:function(){var b=this;var a=Ext.widget("toolbar",{dock:"right",defaults:{cls:Ext.baseCSSPrefix+"form-itemselector-btn"}});b.addToolbarItem(a,Ext.widget("tbfill"));if(b.showAlphabeticOrderButton){b.addToolbarItem(a,Ext.widget("button",{tooltip:b.txtSortAlphabetically,text:"A-Z",listeners:{click:{fn:b.orderAlphabeticallyButtonClick,scope:b}}}))}b.addToolbarItem(a,Ext.widget("button",{tooltip:b.txtMoveToTop,iconCls:Ext.baseCSSPrefix+"form-itemselector-top",listeners:{click:{fn:b.orderTopButtonClick,scope:b}}}));b.addToolbarItem(a,Ext.widget("button",{tooltip:b.txtMoveUp,iconCls:Ext.baseCSSPrefix+"form-itemselector-up",listeners:{click:{fn:b.orderUpButtonClick,scope:b}}}));b.addToolbarItem(a,Ext.widget("button",{tooltip:b.txtMoveDown,iconCls:Ext.baseCSSPrefix+"form-itemselector-down",listeners:{click:{fn:b.orderDownButtonClick,scope:b}}}));b.addToolbarItem(a,Ext.widget("button",{tooltip:b.txtMoveToBottom,iconCls:Ext.baseCSSPrefix+"form-itemselector-bottom",listeners:{click:{fn:b.orderBottomButtonClick,scope:b}}}));b.addToolbarItem(a,Ext.widget("tbfill"));b.addDocked(a)},addToolbarItem:function(d,c,a){var b=this;if(!c){return}if(Ext.isDefined(a)){d.insert(a,c)}else{d.add(c)}},showRightAlignedToolbarButtons:function(){var a=this;return a.showPrintButton||a.showPrintSelectedButton},createPrintButton:function(b){var c=this;if(!c.showPrintButton){return null}if(!Ext.isDefined(b)){b={}}var a={text:c.txtPrintButton,iconCls:"icon-print",listeners:{click:function(d){if(c.fireEvent("printButtonClick",d,c)===false){return}c.onPrintButtonClick(d,c)},scope:c}};Ext.apply(a,b);return Ext.create("Ext.Button",a)},createPrintSelectedButton:function(b){var c=this;if(!c.showPrintSelectedButton){return null}if(!Ext.isDefined(b)){b={}}var a={text:c.txtPrintSelectedButton,iconCls:"icon-print",listeners:{click:function(d){if(c.fireEvent("printSelectedButtonClick",d,c)===false){return}c.onPrintSelectedButtonClick(d,c)},scope:c}};Ext.apply(a,b);return Ext.create("Ext.Button",a)},filterIds:function(d,c,b){var e=c||this,g,f,a=e.getStore();Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(e.getStore(),e.advFilterId);a.filters.add(e.advFilterId,Ext.create("Ext.util.Filter",{filterFn:function(h){return Ext.Array.contains(d,h.getId())}}));a.filter();if(!e.filterButton||!e.filterButton.menu){return}f=e.filterButton.menu;g=f.items.getAt(f.items.length-1);e.filterButton.addCls("btn-bold");if(!b){Vulcan.Common.ExtJS.utils.Log.getLogger().warn('Brak filtra - event "filter" powinien zawierać drugi parametr - filtr!');return}g.setText(e.txtGridAdvFiltetrClearButton+" ("+b.get("name")+")")},createAdvFilterButton:function(b){var d=this,a,f,e,g,c=Vulcan.Common.ExtJS.utils.FilterManager.getAdvancedFilter(d);if(!d.showAdvFilterButton){return null}if(!Ext.isDefined(b)){b={}}if(!c){f=Ext.create("Ext.menu.Menu");Vulcan.Common.ExtJS.utils.helpers.FilterHelper.addAdvancedFilters(f,d,d.filterIds,d);if(!f.items||!f.items.items||f.items.items.length===0){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("[vgrid] Brak zdefiniowanych zaawansowanych filtrów dla modelu");return null}f.add({text:d.txtGridAdvFiltetrClearButton,handler:function(){Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(d.getStore(),d.advFilterId)}});a={text:d.txtGridAdvFiltetrButton,menu:f};Ext.apply(a,b);e=Ext.create("Ext.Button",a);g=f.items.getAt(f.items.length-1);g.on("click",function(){g.setText(d.txtGridAdvFiltetrClearButton);e.removeCls("btn-bold")})}else{a={text:d.txtGridAdvFiltetrButton};Ext.apply(a,b);e=Ext.create("Ext.Button",a);Vulcan.Common.ExtJS.utils.FilterManager.configureAdvFilterButton(e,d,c,Vulcan.Common.ExtJS.utils.FilterManager.filterTypeFilter)}return e},createGroupEditButton:function(b){var c=this,a;if(!c.showGroupEditButton){return null}if(!Ext.isDefined(b)){b={}}a={text:c.txtGroupEditButton,iconCls:"icon-edit",listeners:{click:function(d){if(c.fireEvent("groupEditButtonClick",d,c)===false){return}c.onGroupEditButtonClick(d,c)},scope:c}};Ext.apply(a,b);return Ext.create("Ext.Button",a)},getGridEditButtonTxt:function(){var a=this,b=a.getSelectionModel();return((b instanceof Ext.selection.CheckboxModel)?a.txtGridEditCheckboxButton:a.txtGridEditButton)},createGridEditButton:function(b){var c=this,a;if(!c.showGridEditButton){return null}if(!Ext.isDefined(b)){b={}}a={text:c.getGridEditButtonTxt(),iconCls:"icon-edit",listeners:{click:function(d){if(c.fireEvent("gridEditButtonClick",d,c)===false){return}c.onGridEditButtonClick(d,c)},scope:c}};Ext.apply(a,b);return Ext.create("Ext.Button",a)},createGridAddButton:function(b){var c=this,a;if(!c.showGridAddButton){return null}if(!Ext.isDefined(b)){b={}}a={text:c.txtGridAddButton,iconCls:"icon-add",listeners:{click:function(d){if(c.fireEvent("gridAddButtonClick",d,c)===false){return}c.onGridAddButtonClick(d,c)},scope:c}};Ext.apply(a,b);return Ext.create("Ext.Button",a)},createInsertButton:function(a){var d=this,c,b;if(d.editable!==true||d.showInsertButton!==true){return}if(!Ext.isDefined(a)){a={}}cfg={text:d.txtInsertAddButton,iconCls:"icon-add",listeners:{click:function(e){if(d.fireEvent("insertButtonClick",e,d)===false){return}d.onInsertButtonClick(e,d)},scope:d}};Ext.apply(cfg,a);return Ext.create("Ext.Button",cfg)},renderedContent:null,generateRenderedContent:function(b,a){var d=this,e,c;if(b.length==a.length){for(c=0;c<a.length;c++){e=b[c].getId();d.renderedContent[e]=(d.renderedContent[e]?d.renderedContent[e]:"")+(a[c].innerText||a[c].textContent)}}else{Vulcan.Common.ExtJS.utils.Log.getLogger().error("Records count in grid's store mismatch rendered records count")}},initSearchBox:function(){var b=this;var a=b.store.getRange();b.renderedContent=[];if(Ext.isDefined(b.normalGrid)){b.generateRenderedContent(a,b.lockedGrid.getView().bufferRender(a));b.generateRenderedContent(a,b.normalGrid.getView().bufferRender(a))}else{b.generateRenderedContent(a,b.getView().bufferRender(a))}},clearRenderedContent:function(){var a=this;a.renderedContent=null;if(a.store){a.mon(a.store,"load",a.clearRenderedContent,a,{single:true})}},createToolbarSearchBox:function(){var a=this;if(!a.showSearchBox){return null}var b=Ext.create("Ext.form.field.Text",{emptyText:a.txtSearchBoxHint,width:200});b.on({change:{fn:function(f,d,c,e){if(a.fireEvent("searchBoxChange",f,a,d,c,e)===false){return}a.onSearchBoxChange(f,d,c,e)},scope:a}});a.mon(a.store,"beforeload",function(){b.reset();a.store.clearFilter()},a);a.on("destroy",function(){a.store.clearFilter()});a.on("reconfigure",a.clearRenderedContent,a);a.on("viewready",a.clearRenderedContent,a);return b},createAddButtonConfig:function(a){var c=this,b={cfgEditorView:{cfgValidation:{store:c.getStore()}},mapping:c.getMapping(),model:c.getStore().model.modelName},d={};Ext.apply(d,a);Ext.applyIf(d,b);return d},insertRow:function(b,e){var d=this,a=d.getStore(),c=e||d.insertPolicy;if(Ext.isNumber(c)){a.insert(c,b)}else{switch(c){case"begin":a.insert(0,b);break;case"end":a.add(b);break;default:Vulcan.Common.ExtJS.utils.Log.getLogger().error("Unkown insertPolicy: "+c)}}},onAddControllerLaunch:function(b){var a=this;if(a.autoRefresh===true){b.on("aftersave",a.insertRow,a)}},onPrintButtonClick:function(b,a){Ext.ux.grid.Printer.print(a,false)},onPrintSelectedButtonClick:function(b,a){Ext.ux.grid.Printer.print(a,true)},onEditButtonClick:function(e,d,a,g,k){var f=this,h={application:App,mapping:f.getMapping(),modelClass:f.getStore().model.modelName},b={},c,l;Ext.applyIf(f.cfgEditController,h);Ext.apply(b,f.cfgEditController.cfgEditorView);Ext.apply(b,{cfgValidation:{store:f.getStore(),model:e}});Ext.apply(f.cfgEditController,{validationConfig:{store:f.getStore(),model:e},cfgEditorView:b,modelInstance:e});c=f.editController;l=f.launchWindowController(c,f.cfgEditController);if(f.autoRefresh===true){l.on("aftersave",function(p,q){var o=f.getStore(),n=o.getAt(g);o.suspendAutoSync();o.remove(n,true);o.insert(g,p);o.resumeAutoSync()})}},onDeleteButtonClick:function(a,e,d,g,c){var f=this;var b={buttons:Ext.MessageBox.YESNO,msg:Ext.String.format(f.txtDeleteConfirmation,g+1),title:f.txtDeleteConfirmationTitle,icon:Ext.MessageBox.QUESTION,closable:false,fn:function(h){if(h!=="yes"){return}if(f.fireEvent("beforeRecordDelete",a,f)===false){return}f.doDeleteButton(a,e,d,g,c);f.fireEvent("recordDeleted",a,f)},scope:f};Ext.MessageBox.show(b)},doDeleteButton:function(a,e,d,g,c){var f=this,b=f.getStore();b.suspendAutoSync();b.remove(a);b.resumeAutoSync()},isCheckboxModelEnabled:function(){var a=this;return(a.getSelectionModel() instanceof Ext.selection.CheckboxModel)},getCheckedItems:function(){var a=this,b=a.getSelectionModel();if(!a.isCheckboxModelEnabled()){return undefined}return b.getSelection()},checkHasCheckedItems:function(){var a=this,b=a.getCheckedItems();if(!Ext.isDefined(b)){return false}if(b.length===0){Ext.MessageBox.show({title:"Informacja",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,msg:"Proszę zaznaczyć co najmniej jeden element."});return false}return b},onGroupEditButtonClick:function(f,e){var g=this,h=g.checkHasCheckedItems(),d={application:App,mapping:g.getMapping(),modelClass:g.getStore().model.modelName},c={},b,a;if(!h){return}Ext.applyIf(g.cfgGroupEditController,d);Ext.apply(c,g.cfgGroupEditController.cfgEditorView);Ext.apply(c,{cfgValidation:{store:g.getStore()}});Ext.apply(g.cfgGroupEditController,{validationConfig:{store:g.getStore()},cfgEditorView:c,groupEditRecords:h,groupEditStore:g.getStore()});b=g.groupEditController;a=g.launchWindowController(b,g.cfgGroupEditController);if(a.viewInstance){g.getStore().suspendEvents();a.mon(a.viewInstance,"close",function(){g.getStore().resumeEvents();g.refresh()},g)}},onGridEditButtonClick:function(e,a){var g=this,c=g.checkHasCheckedItems(),h={application:App},k={gridSource:g},f={},b={},d,l;if(g.isCheckboxModelEnabled()&&!c){return}Ext.apply(b,g.cfgGridEditController.cfgEditorView);Ext.apply(f,g.cfgGridEditController);Ext.applyIf(b,k);Ext.applyIf(f,h);Ext.apply(f,{cfgEditorView:b});d=g.gridEditController;l=g.launchWindowController(d,f)},onGridAddButtonClick:function(d,a){var f=this,g={application:App,type:"add"},h={gridSource:f},e={},b={},c,k;Ext.apply(b,f.cfgGridAddController.cfgEditorView);Ext.apply(e,f.cfgGridAddController);Ext.applyIf(b,h);Ext.applyIf(e,g);b.type=e.type;Ext.apply(e,{cfgEditorView:b});c=f.gridAddController;k=f.launchWindowController(c,e)},createNewRecord:function(){var b=this,a=b.getStore().getProxy().getModel().create();b.fireEvent("recordCreated",a,b);return a},onInsertButtonClick:function(b,a){var c=this;c.insertRow(c.createNewRecord())},storeItems:[],onSearchBoxChange:function(g,f,c){var d=this;var b=d.getStore();if(!d.renderedContent){d.initSearchBox()}var h=d.getSelectionModel().getSelection();Vulcan.Common.ExtJS.utils.helpers.FilterHelper.clearFilter(b,"searchboxchange");var e=f.toUpperCase();if(e){var a=d.createSearchBoxFilterFn(e);b.filters.add("searchboxchange",Ext.create("Ext.util.Filter",{filterFn:a}))}b.filter();if(d.editable===true){b.each(function(k,l){d.validateRecord(k,l)})}d.getSelectionModel().select(h)},createSearchBoxFilterFn:function(c){var b=this;var a=function(d){if(b.renderedContent){return b.checkNodeMatches(b.renderedContent,d,c)}else{return true}};return a},clearSearchBox:function(){var a=this;if(a.searchBox){a.searchBox.reset()}},checkNodeMatches:function(e,a,d){var b=this;if(a instanceof Ext.data.Model){var f=a.getId();if(f){var c=e[f];if(typeof c==="string"){return c.toUpperCase().indexOf(d)!==-1}}}return false},getEditor:function(h){var f=this,e=null,c={maskRe:h.getMask()};if(!f.editable){return null}if(h.getStore()){var l=h.getStore();if(Ext.isString(l)){if(!(l instanceof Ext.data.Store)){var b=f.storeParams;if(b){b=b[h.getField()]}else{b=h.getStoreParams()}if(b){l=Ext.create(h.getStore());l.loadByParams(b)}else{l=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore(h.getStore(),true)}}}else{l=h.getStoreInstance()}e="Vulcan.Common.ExtJS.widget.Valdict";Ext.apply(c,{store:l,displayField:h.getStoreDisplayField(),valueField:h.getStoreValueField()});if(h.getType()==="valdict"){var k=2+2}else{if(h.getType()==="combo"){Ext.apply(c,{combo:true})}else{Ext.apply(c,{forceSelection:true,value:-1})}}}else{switch(h.getType()){case"date":e="Ext.form.field.Date";Ext.apply(c,{format:h.getFormat()?h.getFormat():Vulcan.Common.ExtJS.utils.Settings.dateFormat,startDay:1});break;case"time24":e="Vulcan.Common.ExtJS.widget.VTime";Ext.apply(c,{format:h.getFormat()?h.getFormat():Vulcan.Common.ExtJS.utils.Settings.timeFormat,vtype:"time24",invalidText:""});break;case"bool":e="Vulcan.Common.ExtJS.widget.Valdict";Ext.apply(c,{store:Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getCachedStore("Vulcan.Common.ExtJS.store.statics.YesNoStore",true),displayField:h.getStoreDisplayField(),valueField:h.getStoreValueField()});break;case"int":e="Ext.form.field.Number";Ext.apply(c,{allowDecimals:false,hideTrigger:(h.getStep()===0),step:h.getStep()});break;case"numeric":case"float":e="Ext.form.field.Number";Ext.apply(c,{allowDecimals:true,decimalPrecision:h.getDecimalPrecision(),decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator,hideTrigger:(h.getStep()===0),step:h.getStep()});break;default:if(h.getHeight()){e="Ext.form.field.TextArea";Ext.apply(c,{height:h.getHeight()})}else{e="Ext.form.field.Text"}}}if(h.getEditor()){e=h.getEditor()}c=Ext.apply(c,h.getCfgExtra());var g=Ext.create(e,c);if(h.getStore()){var d={combo:g,mapping:h};if(l.isLoading()){l.on({load:{fn:f.prepareComboField,scope:d,single:true}})}else{Ext.bind(f.prepareComboField,d)()}}return g},prepareComboField:function(){var b=this;b.combo.clearInvalid();if(b.mapping.getStoreAllowNull()){var d=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.getNullableStore(b.combo.getStore(),b.mapping.getStoreValueField(),b.mapping.getStoreDisplayField(),b.mapping.getStoreAllowNullLabel());b.combo.bindStore(d);Ext.override(b.combo,{getValue:function(){var e=this.callParent(arguments);if(e===-1){e=null}return e}})}if(b.mapping.getStoreDefaultSelection()=="first"){try{var a=b.combo.getStore().first();b.combo.setValue(a)}catch(c){}}},getSelectedItemsSorted:function(e){var d=this,b=d.getStore(),a=d.getSelectionModel().selected.items,f=[];for(var c=0;c<a.length;c++){f.push({index:b.indexOf(a[c]),item:a[c]})}sortedMap=Ext.Array.sort(f,function(h,g){if(e){return h.index>g.index}else{return h.index<g.index}});return Ext.Array.pluck(sortedMap,"item")},moveSelectedItems:function(c){var h=this,l=h.getStore(),k=h.getView(),f;l.sorters.clear();var d=h.getSelectedItemsSorted(c<0);if(d.length>0){f=l.indexOf(d[0])+c;f=Math.max(f,0);f=Math.min(f,l.getCount()-1);c=f-l.indexOf(d[0]);if(c!==0){l.suspendEvents();for(var e=0;e<d.length;e++){f=l.indexOf(d[e])+c;l.remove(d[e]);l.insert(f,d[e])}l.resumeEvents();l.fireEvent("datachanged");k.refresh();var a=k.getNode(0).clientHeight;var b=k.getHeight()/a;var g=Math.floor(b/2);f=l.indexOf(d[0]);k.focusRow(Math.max(0,f-g));k.focusRow(Math.min(f+g,l.getCount()-1))}}},orderAlphabeticallyButtonClick:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().debug("functionality not implemented yet")},orderTopButtonClick:function(){var a=this;a.moveSelectedItems(-Infinity)},orderUpButtonClick:function(){var a=this;a.moveSelectedItems(-1)},orderDownButtonClick:function(){var a=this;a.moveSelectedItems(+1)},orderBottomButtonClick:function(){var a=this;a.moveSelectedItems(+Infinity)},getNormalGrid:function(){var a=this;return((Ext.isDefined(a.normalGrid))?a.normalGrid:a)},refresh:function(){var a=this;if(Ext.isDefined(a.normalGrid)){a.normalGrid.getView().refresh();a.lockedGrid.getView().refresh()}else{a.getView().refresh()}},getMapping:function(){var a=this;if(a.mapping!=="default"){return a.mapping}if(a.mappingName!=="default"){return a.mappingName}return(Ext.isDefined(a.mapping)?a.mapping:a.mappingName)},onValidateEdit:function(a,c){var b=this;b.validateRecord(c.record,c.rowIdx)},validateRecord:function(b,g){var f=this,e=f.getNormalGrid(),a,d,c;for(d=0;d<e.columns.length;d++){a=e.getView().getCellByPosition({row:g,column:d});a.removeCls(f.clsInvalidCell);a.set({"data-errorqtip":""})}c=b.validate();c.each(function(k){var l=-1,h;Ext.Array.findBy(e.columns,function(o,n){var m=(o.dataIndex===k.field);if(m===true){l=n}return m});if(l===-1){return}h=e.getView().getCellByPosition({row:g,column:l});h.addCls(f.clsInvalidCell);h.set({"data-errorqtip":k.message})});return c},validate:function(){var b=this,a=b.getNormalGrid(),e=true,d=[],f=new Ext.data.Errors(),c;if(Vulcan.Common.ExtJS.utils.helpers.GridHelper.isGroupingEnabled(a)){c=Vulcan.Common.ExtJS.utils.helpers.GridHelper.getGroupingFeature(a);c.expandAll()}try{Ext.suspendLayouts();a.getStore().clearFilter();Ext.Array.each(a.getView().getNodes(),function(l,k){var g=a.getView().getRecord(l),h=b.validateRecord(g,k);if(!h.isValid()){d.push(k+1);Vulcan.Common.ExtJS.utils.Log.getLogger().debug("[vgrid walidacja rekordu] indeks "+k+":");h.each(function(m){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("[vgrid walidacja rekordu] "+m.field+": "+m.message)})}e=(h.isValid()&&e)});if(!e){f.add({message:"Wprowadzono nieprawidłowe dane w wierszach nr: <br/>"+d.join(", ")})}}finally{Ext.resumeLayouts(true)}return f},isValid:function(){var a=this;return a.validate().isValid()}});Ext.define("Vulcan.Common.ExtJS.widget.model.VVariableModelSection",{extend:"Ext.container.Container",alias:["widget.vvrbmodelsection","widget.vvariablemodelsection","widget.v-variablemodelsection","widget.v-variable-model-section"],requires:["Vulcan.Common.ExtJS.widget.model.VModelSection","Vulcan.Common.ExtJS.widget.VGrid"],mixins:["Vulcan.Common.ExtJS.widget.mixin.Guarded","Vulcan.Common.ExtJS.widget.mixin.CfgProperties","Vulcan.Common.ExtJS.widget.mixin.VGenericAddController"],modelItems:undefined,propertyVariable:undefined,propertyTitle:"Nazwa",propertyParent:undefined,cfgVModelSection:{},cfgVGrid:{},items:[],cls:"v-variable-model-section",autoScroll:true,initComponent:function(){var a=this;a.initCfg();a.callParent(arguments);a.on("render",a.initSections);a.addSectionEvents()},initSections:function(){var b=this,a;if(b.modelItems instanceof Ext.data.Store){a=b.modelItems.snapshot||b.modelItems.data}else{a=b.modelItems}if(b.showAddButton===true){b.insert(0,b.createAddButton())}a.each(function(c){b.createItemSection(c)})},createItemSection:function(b){var c;var d=this,a,e;a=Ext.widget("panel",{title:b.get(d.propertyTitle),collapsible:true});e=Ext.widget("vmodelsection",d.createVModelSectionConfig(b,d.cfgVModelSection));e.on("afterdelete",function(g,h,f){if(d.fireEvent("afteritemdelete",g,h,f,a,e)===false){return false}d.remove(a);return true});a.items.add(e);a.items.add(Ext.widget("vhr"));c=Ext.widget("vgrid",d.createVGridConfig(b,d.cfgVGrid));c.onAddControllerLaunch=Ext.Function.createSequence(c.onAddControllerLaunch,function(f){f.on("beforesave",function(g){if(d.fireEvent("beforevariableitemsave",g)===false){return false}g.set(d.propertyParent,b.getId());return true})});a.items.add(c);d.add(a)},addSectionEvents:function(){var a=this;a.createAddEvents();a.addEvents("beforenewitemsave","beforevariableitemsave","afternewitemsave","afteritemdelete")},createVModelSectionConfig:function(b,a){var d=this,c={model:b,useCases:d.useCases},e={};Ext.apply(e,a);Ext.applyIf(e,c);return e},createVGridConfig:function(b,a){var e=this,d={showEditButton:true,showAddButton:true,useCases:e.useCases,stateId:"vvrbmodelsection-grid-"+b.$className+b.getId()},c,f={};if(Ext.isString(e.propertyVariable)){c=b[e.propertyVariable]()}else{c=e.propertyVariable}Ext.apply(d,{store:c});Ext.apply(f,a);Ext.applyIf(f,d);return f},createAddButtonConfig:function(a){var c=this,b={},d={};if(c.modelItems instanceof Ext.data.Store){Ext.apply(b,{model:c.modelItems.model.$className})}else{if(Ext.isDefined(c.modelItems)&&Ext.isDefined(c.modelItems[0])){Ext.apply(b,{model:c.modelItems[0].$className})}}Ext.apply(d,a);Ext.applyIf(d,b);return d},onAddControllerLaunch:function(b){var a=this;b.on("aftersave",function(c,d){if(a.fireEvent("afternewitemsave",c,d)===false){return false}a.createItemSection(c);return true});b.on("beforesave",function(c){return a.fireEvent("beforenewitemsave",c)})}});Ext.define("Vulcan.Common.ExtJS.utils.cache.CacheEngine",{extend:"Ext.util.Observable",requires:["Vulcan.Common.ExtJS.utils.cache.CacheItem"],alternateClassName:["VCacheEngine","VCache"],cache:[],constructor:function(a){this.addEvents({added:true,updated:true,removed:true,expired:true});Ext.apply(this,a);var b={run:function(){var h=this;var d=new Date().getTime();var f=[];for(var e=0,c=this.cache.length;e<c;e++){var g=this.cache[e];if(typeof(g.expires)!="undefined"&&g.expires<d){f.push(g)}}var l=[];for(var e=0,c=f.length;e<c;e++){var g=f[e];var k={key:g.key,value:g.cacheItem.value};l.push(k);this.cache.remove(g)}for(var e=0,c=f.length;e<c;e++){var g=f[e];g.cacheItem.fireEvent("expired",g.cacheItem,g.cacheItem.value)}if(l.length>0){this.fireEvent("expired",this,l)}},interval:1000,scope:this};Ext.TaskManager.start(b);this.callParent(a)},clear:function(){var e=this;var c=this.cache;this.cache=[];for(var b=0,a=c.length;b<a;b++){var d=c[b];d.cacheItem.fireEvent("removed",d.cacheItem,d.cacheItem.value)}},getItem:function(c){for(var b=0,a=this.cache.length;b<a;b++){var d=this.cache[b];if(c==d.key){return d.cacheItem}}return undefined},getOrCreateItem:function(a){var b=this;if(!b.has(a)){b.set(a,null)}return b.getItem(a)},get:function(a){var c=this;var b=c.getItem(a);return(typeof(b)!="undefined")?b.value:undefined},set:function(h,g,a){var d=this;if(!a){a={}}var e=a.timeout;for(var b=0,c=this.cache.length;b<c;b++){var k=this.cache[b];if(h==k.key){var f=k.cacheItem.value;k.cacheItem.value=g;k.expires=(typeof(e)!="undefined")?(new Date().getTime()+(e*1000)):undefined;k.cacheItem.fireEvent("updated",k.cacheItem,f,g);d.fireEvent("updated",this);return k.cacheItem}}var k={key:h,cacheItem:new Vulcan.Common.ExtJS.utils.cache.CacheItem({value:g})};if(typeof(e)!="undefined"){k.expires=new Date().getTime()+(e*1000)}this.cache.push(k);this.fireEvent("added",k,k.value);return k.cacheItem},remove:function(c){var e=this;for(var b=0,a=this.cache.length;b<a;b++){var d=this.cache[b];if(c==d.key){this.cache.remove(d);d.cacheItem.fireEvent("removed",d.cacheItem,d.cacheItem.value);this.fireEvent("removed",this);return true}}return false},has:function(c){for(var b=0,a=this.cache.length;b<a;b++){var d=this.cache[b];if(c==d.key){return true}}return false}});Ext.define("Vulcan.Common.ExtJS.controller.VMasterController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Vulcan.Common.ExtJS.utils.cache.CacheEngine","Vulcan.Common.ExtJS.view.blank.LogoView"],refs:[{ref:"ribbon",selector:"#ribbon-view"},{ref:"ribbonTab",selector:"#ribbon-view #ribbon-view-tab"},{ref:"logoView",selector:"#center-container > #logo-view",xtype:"logo-view",autoCreate:true},{ref:"komunikaty",selector:"#info-panel"}],initHeaderHeight:0,currentMenuItem:null,currentCtr:null,currentRibbonTab:null,currentContextTab:undefined,contextMenuCenter:undefined,useHistory:false,historyAutoSelectOnStart:true,historyTokenDelimiter:"/",historyTokenStarter:"_",init:function(){var a=this;Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init VMasterController");var b=a.getRibbon();a.useHistory=b.useHistory;a.historyAutoSelectOnStart=b.historyAutoSelectOnStart;a.initHistory();a.control({"ribbon-view button":{click:a.mainmenuHandler},"ribbon-view menu":{click:a.mainmenuHandler},"ribbon-view":{afterrender:a.onMainMenuRendered},"ribbon-view #ribbon-view-tab":{beforetabchange:a.onBeforeRibbonTabChange,tabchange:a.onRibbonTabChange},"#vviewport":{render:a.onApplicationStart,afterrender:a.onApplicationRendered}});a.callParent(arguments)},initHistory:function(){var b=this;if(b.useHistory){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init HistoryAPI");Ext.History.init();var a=function(){if(b._dontUpdateHistoryOnNextChange){b._dontUpdateHistoryOnNextChange=false;return}b.selectMenuItemByUrlParams()};Ext.History.on("change",a);Vulcan.Common.ExtJS.utils.MessageBus.on(Vulcan.Common.ExtJS.utils.MessageBusEvents.historySelectRibbonItem,a)}},selectMenuItemByUrlParams:function(){var b=this;if(b.useHistory){var a=Ext.History.getToken();if(a){var c=a.slice(b.historyTokenStarter.length).split(b.historyTokenDelimiter);b.selectMenuItem.apply(b,c);if(!c[1]){b.showLogoView({onSelectMenuItemByUrlParams:true})}}}},updateMenuHistory:function(){var b=this;if(!b.useHistory){return}var a=[];var c=b.currentRibbonTab||b.currentContextTab;if(!c&&b.currentMenuItem){c=b.currentMenuItem.up("tabpanel > [tab]")}if(!c){return}a.push(b.historyTokenStarter+c.id);if(b.currentMenuItem&&c.down("#"+b.currentMenuItem.id)){a.push(b.currentMenuItem.id)}newToken=a.join(b.historyTokenDelimiter);oldToken=Ext.History.getToken();if(oldToken===null||oldToken.search(newToken)===-1){Ext.History.suspendEvent("change");b._dontUpdateHistoryOnNextChange=true;Ext.History.add(newToken);Ext.History.resumeEvent("change")}},mainmenuHandler:function(d,b){var f=this;var e=d.isXType("menu")?b.lnk:d.lnk;var a=(!d.isTab&&(d&&d.ownerCt&&d.ownerCt.ownerCt))?d.ownerCt.ownerCt:undefined;if(d.isTab){f.launchMenuAction(d.card.lnk,d.card.ctr);return}if(d.isHidden()){return}if(Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.beforeribbonbuttonclick,d,a)===false){return}var g=d.ctr;var c=d.dialog;if(g&&!c){if(f.currentMenuItem){f.clearPressedCls(f.currentMenuItem)}if(d.scale=="large"){d.addCls("x-btn-default-toolbar-large-pressed")}else{if(d.scale=="medium"){d.addCls("x-btn-default-toolbar-medium-pressed")}else{if(d.scale=="small"){d.addCls("x-btn-default-toolbar-small-pressed")}}}f.currentMenuItem=d}else{if(!c){Vulcan.Common.ExtJS.utils.Log.getLogger().debug("Brak atrybutu ctr na elemencie menu głównego "+(d.text?d.text:""))}}if(c&&d.blur){d.blur()}f.updateMenuHistory();f.launchMenuAction(e,g,c)},launchMenuAction:function(c,d,a){var b=this;Vulcan.Common.ExtJS.utils.Link.onLinkClick(c);if(d){if(!a){b.cleanUpCurrentCtr();b.currentCtr=d;b.hideContextTabs(b.getRibbonTab());Vulcan.Common.ExtJS.utils.ContextHelp.clearContextHelp()}b.addAndLaunchController(d)}},showLogoView:function(c){var a=this;var b=a.getLogoView();a.replaceCenterContent(b,false);a.clearPressedCls(a.currentMenuItem);a.cleanUpCurrentCtr();Vulcan.Common.ExtJS.utils.ContextHelp.clearContextHelp();Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.aftershowlogoview,c)},onBeforeRibbonTabChange:function(c,a,b){return Vulcan.Common.ExtJS.utils.MessageBus.fireEvent(Vulcan.Common.ExtJS.utils.MessageBusEvents.beforeribbontabchange,a,b,c)},onRibbonTabChange:function(e,a,c,b){var d=this;if(d.currentRibbonTab){d.currentRibbonTab.tab.removeCls("ribbon-context-tab-active");d.currentRibbonTab.tab.removeCls("ribbon-context-tab")}if(d.currentContextTab){d.currentContextTab.tab.removeCls("ribbon-context-tab-active");d.currentContextTab.tab.removeCls("ribbon-context-tab")}if(a.isContextTab===true){d.currentContextTab=a;d.currentContextTab.tab.addCls("ribbon-context-tab-active");d.currentRibbonTab.tab.addCls("ribbon-context-tab")}else{if(a!==d.currentRibbonTab){d.currentRibbonTab=a;if(Ext.isDefined(d.currentContextTab)){d.toggleRibbonContextTab(d.currentContextTab.id,true)}d.showLogoView({onRibbonTabChange:true})}else{if(Ext.isDefined(d.currentContextTab)){d.currentContextTab.tab.addCls("ribbon-context-tab");d.currentRibbonTab.tab.addCls("ribbon-context-tab-active")}}}d.updateMenuHistory();d.launchMenuAction(a.lnk,a.ctr)},cleanUpCurrentCtr:function(){var a=this;if(a.currentCtr){App.getController(a.currentCtr).destroy();a.currentCtr=null;var b=a.getLogoView();a.replaceCenterContent(b,false)}},clearPressedCls:function(a){if(a){if(a.scale=="large"){a.removeCls("x-btn-default-toolbar-large-pressed")}else{if(a.scale=="medium"){a.removeCls("x-btn-default-toolbar-medium-pressed")}else{if(a.scale=="small"){a.removeCls("x-btn-default-toolbar-small-pressed")}}}}},onMainMenuRendered:function(){var d=this;var c=new Ext.util.TextMetrics();var b=Ext.getCmp("ribbon-user-tab");var a=c.getWidth(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("user"))+30;b.setWidth(a>90?a:90);var e=d.getRibbon();d.showLogoView({onMainMenuRendered:true});d.selectMenuItem(e.startTab,e.startButton);if(d.historyAutoSelectOnStart){d.selectMenuItemByUrlParams()}},selectMenuItem:function(b,a){var c=this;if(b){var d=c.getRibbonTab();d.setActiveTab(b);c.updateMenuHistory()}if(a){c.mainmenuHandler(Ext.getCmp(a))}},toggleRibbonContextTab:function(a,e){var d=this;if(a){var f=d.getRibbonTab();var b=Ext.Array.filter(f.items.items,function(g){return g.id===a});if(b.length===0){return}var c=b[0].tab;if(e===false){d.hideContextTabs(f);c.show()}else{c.hide();d.currentContextTab=undefined;d.selectMenuItem(d.currentRibbonTab.id)}if(!c.isHidden()){f.setActiveTab(b[0])}}},hideContextTabs:function(a){Ext.Array.forEach(a.items.items,function(b){if(b.isContextTab){b.tab.hide()}})},addBackendTask:function(a,b){var c=this;c.getKomunikaty().addTask(a,b)},changeNumberOfNotifications:function(b){var a=Ext.getCmp("ribbon-user-notifications-tab");if(!a){return}if(b&&b>0){a.setTitle(Ext.String.format(a.tabConfig.titleTemplate,b<=9?b:"9+"))}else{a.setTitle(a.tabConfig.titleTemplateNoNotifications)}},setNotificationsPopupContent:function(b){var a=Ext.getCmp("ribbon-user-notifications-tab");if(!a||!b||!Array.isArray(b)){return}a.tabConfig.popupItems=b},updateNotificationsPopupContent:function(c){var b=Ext.getCmp("ribbon-user-notifications-tab");if(!b||!c||!Array.isArray(c)||c.length!==b.tabConfig.popupItems.length){return}for(var a=0;a<b.tabConfig.popupItems.length;a++){b.tabConfig.popupItems[a]=c[a]}},onApplicationRendered:function(a){var b=this;if(a.showInfoPanel===true){b.getKomunikaty().show()}},addContextMenu:function(){var a=this;a.contextMenuCenter=Ext.create("Ext.menu.Menu",{renderTo:Ext.getBody(),items:[{text:"Drukuj zawartość ekranu",listeners:{click:function(){a.contextMenuCenter.hide();window.print()}}},{text:"Zapisz zawartość ekranu",listeners:{click:function(){a.contextMenuCenter.hide();a.saveWindowToFile()}}}]});Ext.fly(document.body).on("contextmenu",function(b){b.preventDefault()});Ext.fly("center-container").on("contextmenu",function(b){a.contextMenuCenter.showAt(b.getXY())})},saveWindowToFile:function(){var c=function(e){if(window.printWindow){window.printWindow.close()}var t=window.open("","");if(t){t.document.open();t.document.write(e);t.document.close();t.document.getElementById("center-container").style.left="0px";t.document.getElementById("center-container").style.height="100%";t.focus();window.printWindow=t}else{window.confirm("Proszę zezwolić na otwarcie okna aby zapisać dokument")}};var m=window.document.getElementsByTagName("head")[0],n=m.getElementsByTagName("title")[0],r=m.getElementsByTagName("link"),k=m.getElementsByTagName("meta"),s=m.getElementsByTagName("style"),l=window.document.getElementById("center-container"),d=n.outerHTML,f=undefined,h=undefined,o=undefined;for(element in k){d+=k[element].outerHTML?k[element].outerHTML:""}for(element in r){if(r[element].href){r[element].href=r[element].href}d+=r[element].outerHTML?r[element].outerHTML:""}for(element in s){d+=s[element].outerHTML?s[element].outerHTML:""}h='<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="x-border-box x-strict x-viewport"><head>'+d+'</head><body><div id="master-container" style="height: 100%;">'+l.outerHTML+"</div></body></html>";if(window.Blob&&window.URL&&window.URL.createObjectURL){try{o=document.implementation.createHTMLDocument("");o.open();o.write(h);o.close();o.getElementById("center-container").style.left="0px";o.getElementById("center-container").style.height="100%";f=o.documentElement.outerHTML;var b=new Blob([f],{type:"application/octet-stream"}),q=window.URL.createObjectURL(b),a=document.createElement("a");a.href=q;document.body.appendChild(a);var p=document.createEvent("HTMLEvents");p.initEvent("click",false,true);a.dispatchEvent(p)}catch(g){c(h)}}else{c(h)}},initStatePrivider:function(){if(Ext.supports.LocalStorage){Ext.state.Manager.setProvider(Ext.create("Ext.state.LocalStorageProvider"))}else{Ext.state.Manager.setProvider(Ext.create("Ext.state.CookieProvider"))}},onApplicationStart:function(a,b){var c=this;Vulcan.Common.ExtJS.utils.ClipboardManager.init();c.initStatePrivider();c.addLoadMask(a);c.addAjaxEventsHandlers();c.addMessageBusEvents();Ext.Array.forEach(App.controllers.items,function(e){if(e!==this&&Ext.isFunction(e.launch)){e.launch()}},c);var d={run:function(){var f=this;if(f.taskRunCount===1){return}var e=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.getActionUrl(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("homeController"),"RefreshSession");if(!e){return}Ext.Ajax.request({url:e,success:function(g){try{var k=Ext.decode(g.responseText);if(!k||!k.success||!k.data){throw"refreshSession error "}Vulcan.Common.ExtJS.utils.Log.getLogger().trace("refreshSession success ",g.responseText)}catch(h){Vulcan.Common.ExtJS.utils.Log.getLogger().error("refreshSession response error ",h)}}})},interval:(parseInt(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("sessionTime"),10)-1)*60*1000};Ext.TaskManager.start(d);Vulcan.Common.ExtJS.utils.helpers.FilterHelper.loadFilters(a.filterNamespace||[App.name+".store.filters."]);Vulcan.Common.ExtJS.utils.FilterManager.init(a.filterNamespace||[App.name+".controller.filters."]);c.showStartMessage()},showStartMessage:function(){var a=this;var b=Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("startMessageUrl");if(!b){return}Ext.Ajax.request({url:b,success:function(c,d){if(!c||!c.responseText){return}Ext.MessageBox.show({title:"Informacja",icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,msg:c.responseText})}})},addLoadMask:function(a){App.loadMask=new Ext.LoadMask(a,{msg:"Proszę czekać...",vulcan:true});App.loadMask.preventBringToFront=false},isBackgroundAjaxReq:function(b,a){return(a&&a.url&&((Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderUrl")&&(a.url.indexOf(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderUrl"))!==-1))||(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderArchiveUrl")&&(a.url.indexOf(Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("downloaderArchiveUrl"))!==-1))))||a.showLoaderMask===false},onAjaxCompleted:function(d,a,b){var c=this;if(c.isBackgroundAjaxReq(d,b)){return}--App.loaderCounter;if(App.loaderCounter<0){App.loaderCounter=0}if(App.loaderCounter===0){App.loadMask.hide()}},addAjaxEventsHandlers:function(){var a=this;Ext.app.Application.prototype.loaderCounter=0;Ext.Ajax.on("beforerequest",function(d,b,c){if(a.isBackgroundAjaxReq(d,b)){d.useDefaultXhrHeader=false;return}d.useDefaultXhrHeader=true;if(App.loaderCounter++===0){App.loadMask.show()}});Ext.Ajax.on("requestcomplete",function(f,b,c,d){a.onAjaxCompleted(f,b,c);if(a.isStartMessageRequest(c)){return}if(!b||!b.responseText){return}var g=Ext.decode(b.responseText);if(Ext.isDefined(g.success)&&!g.success&&(!g.code||(Ext.isDefined(g.code)&&g.code!==Vulcan.Common.ExtJS.utils.StatusCodes.downloaderWait&&g.code!==Vulcan.Common.ExtJS.utils.StatusCodes.downloaderUnknown))){if(g.feedback){var e=Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel",g.feedback);e.show();if(g.feedback.FType&&g.feedback.FType=="Information"){Vulcan.Common.ExtJS.utils.Log.getLogger().info("request information",b.responseText)}else{if(g.feedback.FType&&g.feedback.FType=="Warning"){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("request warning",b.responseText)}else{Vulcan.Common.ExtJS.utils.Log.getLogger().error("request error",b.responseText)}}}}});Ext.Ajax.on("requestexception",function(d,h,m){a.onAjaxCompleted(d,h,m);if(a.isStartMessageRequest(m)){return}var c="request exception ";var k=h.statusText;if(h){c+="[status: "+h.status+"]"}if(m&&m.url){c+="[url: "+m.url+"]"}if(h&&h.responseText){c+="["+h.responseText+"]"}if(k){c+="["+k+"]"}Vulcan.Common.ExtJS.utils.Log.getLogger().error(c,h);if(h&&h.status===Vulcan.Common.ExtJS.utils.StatusCodes.error){try{var f=Ext.decode(h.responseText);var g=Ext.create("Vulcan.Common.ExtJS.model.FeedbackModel",f);g.show()}catch(l){Ext.MessageBox.show({title:"Błąd",msg:"Wystąpił błąd aplikacji "+k,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}else{if(h&&h.status===Vulcan.Common.ExtJS.utils.StatusCodes.redirect){var b="";if(h.responseText){b=Ext.decode(h.responseText,true);if(!Ext.form.field.VTypes.url(b)){Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Podany url dla statusu "+Vulcan.Common.ExtJS.utils.StatusCodes.redirect+" jest nieprawidłowy: "+b);b=""}}if(b){window.location=b}else{window.location.reload()}}else{Ext.widget("vdetails",{msg:"Brak komunikacji z serwerem.",details:c})}}})},isStartMessageRequest:function(a){return(a&&a.url===Vulcan.Common.ExtJS.utils.helpers.ParamHelper.get("startMessageUrl"))},addMessageBusEvents:function(){var a=this;a.mon(Vulcan.Common.ExtJS.utils.MessageBus,Vulcan.Common.ExtJS.utils.MessageBusEvents.selectRibbonItem,a.selectMenuItem,a);a.mon(Vulcan.Common.ExtJS.utils.MessageBus,Vulcan.Common.ExtJS.utils.MessageBusEvents.toggleRibbonContextTab,a.toggleRibbonContextTab,a);a.mon(Vulcan.Common.ExtJS.utils.MessageBus,Vulcan.Common.ExtJS.utils.MessageBusEvents.addBackendTask,a.addBackendTask,a);a.mon(Vulcan.Common.ExtJS.utils.MessageBus,Vulcan.Common.ExtJS.utils.MessageBusEvents.changeNumberOfNotifications,a.changeNumberOfNotifications,a);a.mon(Vulcan.Common.ExtJS.utils.MessageBus,Vulcan.Common.ExtJS.utils.MessageBusEvents.setNotificationsPopupContent,a.setNotificationsPopupContent,a);a.mon(Vulcan.Common.ExtJS.utils.MessageBus,Vulcan.Common.ExtJS.utils.MessageBusEvents.updateNotificationsPopupContent,a.updateNotificationsPopupContent,a)}});Ext.define("Vulcan.Common.ExtJS.view.master.VViewport",{extend:"Ext.container.Viewport",requires:["Vulcan.Common.ExtJS.controller.VMasterController"],application:null,filterNamespace:undefined,showInfoPanel:true,id:"vviewport",layout:"border",items:[{region:"north",xtype:"ribbon-view",hideCollapseTool:true,margin:"0 0 2 0"},{xtype:"container",region:"center",layout:"border",id:"master-container",defaults:{collapsible:false,split:true,border:0},items:[{xtype:"container",id:"center-container",region:"center",margin:"0 2 0 0",layout:"fit"},{xtype:"south-container",id:"south-container",split:false},{id:"west-container",region:"west",collapsible:true,hideCollapseTool:true,hidden:true,margin:"0 0 0 2",border:0,layout:"fit"},{xtype:"info-panel",region:"east",hidden:true,collapsed:true,collapsible:true,border:true,split:false,titleCollapse:false,animCollapse:true}]}],initComponent:function(){var a=this;a.callParent(arguments);if(!a.application){Vulcan.Common.ExtJS.utils.Log.getLogger().error("Nie przekazano referencji do Ext.app.Application przy tworzeniu VViewport.");return}App=a.application;var b=App.addController("Vulcan.Common.ExtJS.controller.VMasterController");b.launch()}});Ext.define("Vulcan.Common.ExtJS.utils.helpers.StoreHelper",{requires:["Ext.data.StoreManager","Vulcan.Common.ExtJS.store.statics.AbstractStaticStore","Vulcan.Common.ExtJS.utils.helpers.ModelHelper","Vulcan.Common.ExtJS.utils.helpers.ParamHelper"],singleton:true,getCacheToken:function(a){return"cached_"+a.replace(/\./g,"_")},getCachedStore:function(a,h,g,e,f){if(!Vulcan.Common.ExtJS.utils.helpers.ParamHelper.getActionUrl()){return}var b=a,c=null;if(f&&f.storeId){b=f.storeId}c=Ext.data.StoreManager.lookup(b);if(!c&&h){var d={autoLoad:false};if(f){Ext.apply(d,f)}c=Ext.create(a,d);if(c.canCache){b=c.storeId||b;Ext.regStore(b,c)}if(!(c instanceof Vulcan.Common.ExtJS.store.statics.AbstractStaticStore)&&!g){if(e){c.loadByParams(e)}else{c.load()}}}return c},cloneStore:function(b){var a=Ext.create(b.$className,{autoLoad:false});var c=[];b.each(function(d){c.push(d.copy())});a.add(c);return a},doForLoadedStore:function(a,d,b){var c=this;c.doForLoadedStores([a],d,b)},doForLoadedStores:function(b,e,d){var a=0;for(var c=0;c<b.length;c++){if(b[c].isLoading()){a++}}if(a===0){Ext.callback(e,d)}else{for(var c=0;c<b.length;c++){if(b[c].isLoading()){b[c].on({load:{fn:function(){if(--a===0){Ext.callback(e,d)}},single:true}})}}}},waitForStores:function(d,b){var a=b.length;for(var c=0;c<b.length;c++){b[c].on({load:{fn:function(){if(--a===0){d()}},single:true}})}},fillStoreWithJsonModels:function(a,d){a.removeAll();var e=[];if(d){for(var c=0;c<d.length;c++){var b=Ext.create(a.model,d[c]);e.push(b)}}a.add(e)},createStoreWithJsonModels:function(a,c){var b=Ext.create(a);Vulcan.Common.ExtJS.utils.helpers.StoreHelper.fillStoreWithJsonModels(b,c);return b},getNullableStore:function(c,e,b,d){if(!d){d="(nie wybrano)"}var f=Vulcan.Common.ExtJS.utils.helpers.StoreHelper.cloneStore(c);var a=Ext.create(f.model.$className);a.set(e,-1);a.set(b,d);f.insert(0,a);return f}});Ext.define("Vulcan.Common.ExtJS.utils.ContextHelpManager",{extend:"Ext.Base",mixins:["Vulcan.Common.ExtJS.utils.mixin.ControlMixin"],requires:["Ext.ux.callout.Callout"],currentHelp:[],helpBox:null,constructor:function(a){var b=this;Ext.apply(b,a);b.callParent(arguments);b.initEvents()},initEvents:function(){var a=this;a.control({component:{added:function(c){var b=a.getContextHelp(c);if(b.length>0){a.addHelp(b);c.on("removed",function(d){a.removeHelp(d)})}}}})},generateHelpLink:function(){var a=this;return"Pomoc dla: "+a.currentHelp.join(", ")},addHelp:function(a){var b=this;b.currentHelp=b.currentHelp.concat(a);if(b.currentHelp.length>0){if(b.helpBox===null){Ext.defer(function(){this.helpBox=Ext.widget("callout",{cls:"default",maxWidth:200,html:this.generateHelpLink(),target:"#south-container",relativePosition:"b-t",fadeInDuration:1000,fadeOutDuration:1000});this.helpBox.show()},10,b)}else{b.helpBox.hide();b.helpBox.update(b.generateHelpLink());b.helpBox.show()}}},removeHelp:function(c){var b=this,a=b.getContextHelp(c);Ext.Array.forEach(a,function(d){Ext.Array.remove(b.currentHelp,d)});if(b.currentHelp.length===0){b.helpBox.hide()}},getContextHelp:function(b){var a=b.contextHelp;if(!Ext.isDefined(a)){return[]}if(Ext.isString(a)){return[a]}if(Ext.isArray(a)){return a}Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Nieznany typ pomocy kontekstowej dla komponentu "+b.$className+": "+a);return[]}});Ext.define("Ext.ux.form.SortItemSelector",{extend:"Ext.ux.form.MultiSelect",alias:["widget.sortitemselectorfield","widget.sortitemselector"],alternateClassName:["Ext.ux.SortItemSelector"],requires:["Ext.ux.layout.component.form.SortItemSelector","Ext.button.Button"],hideNavIcons:false,buttons:["sort","top","up","down","bottom"],buttonsText:{sort:"Sortuj alfabetycznie",top:"Przesuń na pierwszą pozycję",up:"Jedna pozycja do góry",down:"Jedna pozycja w dół",bottom:"Przesuń na ostatnią pozycję"},multiselects:[],componentLayout:"sortitemselectorfield",fieldBodyCls:Ext.baseCSSPrefix+"form-sortitemselector-body",displayField:null,bindStore:function(b,c){var d=this,a=d.toField,e;d.callParent(arguments);if(a){a.store.removeAll();e=[];d.store.each(function(f){e.push(f.copy(f.getId()))});a.store.add(e)}},onRender:function(e,c){var l=this,b=Ext.baseCSSPrefix,f="SortItemSelectorDD-"+Ext.id(),d={displayField:l.displayField,valueField:l.valueField,dragGroup:f,dropGroup:f,flex:1,height:250,hideLabel:true},h=Ext.apply({store:Ext.create("Ext.data.Store",{model:l.store.model}),listeners:{boundList:{scope:l},change:l.onToFieldChange,scope:l}},l.multiselects[1],d),g=Ext.widget("multiselect",h),a,k=[];this.displayField=l.displayField;this.valueField=l.valueField;l.callParent(e,c);l.toField=g;if(!l.hideNavIcons){Ext.Array.forEach(l.buttons,function(m){k.push({xtype:"button",tooltip:l.buttonsText[m],handler:l["on"+Ext.String.capitalize(m)+"BtnClick"],cls:b+"form-itemselector-btn",iconCls:b+"form-itemselector-"+m,scope:l});k.push({xtype:"component",height:3,width:1,style:"font-size:0;line-height:0"})})}a=l.innerCt=Ext.widget("container",{renderTo:l.bodyEl,layout:{type:"hbox",align:"middle"},items:[l.toField,{xtype:"container",margins:"0 4",items:k}]});a.ownerCt=l;l.bindStore(l.store);l.setRawValue(l.rawValue)},onToFieldChange:function(){this.checkChange()},getSelections:function(e){var b=e.getStore(),d=e.getSelectionModel().getSelection(),c=0,a=d.length;return Ext.Array.sort(d,function(g,f){g=b.indexOf(g);f=b.indexOf(f);if(g<f){return -1}else{if(g>f){return 1}}return 0})},onSortBtnClick:function(){var e=this.toField.boundList,a=e.getStore(),d=this.getSelections(e),b=d.length-1,c;a.suspendEvents();a.sort(this.displayField,"ASC");a.resumeEvents();e.refresh()},onTopBtnClick:function(){var e=this.toField.boundList,a=e.getStore(),d=this.getSelections(e),b=d.length-1,c;a.suspendEvents();for(;b>-1;--b){c=d[b];a.remove(d);a.insert(0,d)}a.resumeEvents();e.refresh()},onBottomBtnClick:function(){var f=this.toField.boundList,b=f.getStore(),e=this.getSelections(f),c=0,a=e.length,d;b.suspendEvents();for(;c<a;++c){d=e[c];b.remove(d);b.add(d)}b.resumeEvents();f.refresh()},onUpBtnClick:function(){var g=this.toField.boundList,b=g.getStore(),f=this.getSelections(g),d=0,a=f.length,e,c;b.suspendEvents();for(;d<a;++d){e=f[d];c=Math.max(0,b.indexOf(e)-1);b.remove(e);b.insert(c,e)}b.resumeEvents();g.refresh()},onDownBtnClick:function(){var h=this.toField.boundList,c=h.getStore(),g=this.getSelections(h),e=0,b=g.length,a=c.getCount(),f,d;c.suspendEvents();for(;e<b;++e){f=g[e];d=Math.min(a,c.indexOf(f)+1);c.remove(f);c.insert(d,f)}c.resumeEvents();h.refresh()},setRawValue:function(e){var c=this,b=Ext.Array,d,a,f;e=b.from(e);c.rawValue=e;if(c.toField){c.toField.store.removeAll();f=[];c.store.each(function(g){f.push(g.copy(g.getId()))});c.toField.store.add(f);d=c.toField.boundList.getStore()}return e},getRawValue:function(){var b=this,a=b.toField,c=b.rawValue;if(a){c=Ext.Array.map(a.boundList.getStore().getRange(),function(d){return d.get(b.valueField)})}b.rawValue=c;return c},onDestroy:function(){Ext.destroyMembers(this,"innerCt");this.callParent()}});Ext.define("Vulcan.Common.ExtJS.view.generic.GenericSortView",{extend:"Vulcan.Common.ExtJS.view.abstract.AbstractEditView",requires:["Ext.form.Panel","Ext.ux.form.MultiSelect","Ext.ux.form.SortItemSelector"],txtMoveToTop:"Przesuń na pierwszą pozycję",txtMoveToBottom:"Przesuń na ostatnią pozycję",txtMoveDown:"Jedna pozycja w dół",txtMoveUp:"Jedna pozycja do góry",txtSortAlphabetically:"Sortuj alfabetycznie",autoSize:true,grid:null,gridColumns:[],addButton:null,store:null,gridTitle:null,bodyBorder:false,border:false,sortTopButton:null,sortUpButton:null,sortDownButton:null,sortBottomButton:null,gridWidth:null,gridHeight:null,contentAutoScroll:false,initComponent:function(){var e=this;var d=Ext.create("Ext.panel.Panel",{layout:{type:"table",columns:1},bodyBorder:false,border:false});e.grid=Ext.create("Ext.grid.Panel",{enableCtxMenu:false,enableColLock:false,enableColumnMove:false,enableColumnHide:false,menuDisabled:true,forceFit:true,sortableColumns:false,title:e.gridTitle,store:e.store,multiSelect:true,columns:e.gridColumns,height:e.gridHeight?e.gridHeight:200,width:e.gridWidth?e.gridWidth:400,hideHeaders:true});var b=0;var a=[];a.push(e.grid);b+=e.grid.width;e.sortSortASCButton=Ext.create("Ext.Button",{tooltip:e.txtSortAlphabetically,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-top"});e.sortTopButton=Ext.create("Ext.Button",{tooltip:e.txtMoveToTop,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-top"});e.sortUpButton=Ext.create("Ext.Button",{tooltip:e.txtMoveUp,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-up"});e.sortDownButton=Ext.create("Ext.Button",{tooltip:e.txtMoveDown,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-down"});e.sortBottomButton=Ext.create("Ext.Button",{tooltip:e.txtMoveToBottom,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-bottom"});var c=Ext.create("Ext.panel.Panel",{layout:{type:"table",columns:1},bodyBorder:false,border:false});c.add(e.sortSortASCButton);c.add(e.sortTopButton);c.add(e.sortUpButton);c.add(e.sortDownButton);c.add(e.sortBottomButton);a.push(c);Ext.applyIf(e,{contentPanel:Ext.create("Ext.container.Container",{bodyPadding:10,layout:{type:"table",columns:a.length},style:{background:"none"},items:a})});e.callParent(arguments)},resizeToContents:function(g,d){var f=this,c,b={width:f.width,height:90},h,e,a;if(!g.autoSize){return}b.width=55;b.width+=f.grid.width;b.height=300;g.setSize(b)}});Ext.define("Vulcan.Common.ExtJS.controller.generic.GenericSortController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Vulcan.Common.ExtJS.view.generic.GenericSortView"],windowTitle:null,viewInstance:null,store:null,gridColumnTemplate:null,gridWidth:null,gridHeight:null,gridTitle:null,onSortUpdateSuccess:function(a){this.sender.onSortUpdateSuccess(a)},onSortUpdateFailure:function(a){this.sender.onSortUpdateFailure(a)},init:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init Vulcan.Common.ExtJS.controller.generic.GenericSortController");var a=this;a.callParent(arguments)},launch:function(c){var b=this;b.callParent(arguments);var a={title:b.windowTitle,store:b.store,gridColumns:b.gridColumnTemplate,gridTitle:b.gridTitle,gridWidth:b.gridWidth,gridHeight:b.gridHeight};b.viewInstance=Ext.create("Vulcan.Common.ExtJS.view.generic.GenericSortView",a);if(b.showSortPanel){b.viewInstance.sortSortASCButton.on("click",b.onSortBtnClick,b);b.viewInstance.sortTopButton.on("click",b.onTopBtnClick,b);b.viewInstance.sortUpButton.on("click",b.onUpBtnClick,b);b.viewInstance.sortDownButton.on("click",b.onDownBtnClick,b);b.viewInstance.sortBottomButton.on("click",b.onBottomBtnClick,b)}b.viewInstance.saveButton.on("click",function(){var g=this;var e=new Array();for(var d=0;d<g.orderedStore().length;d++){e[d]=g.orderedStore()[d].data}var f={list:e};if(g.sortParams.jsonData&&Ext.isObject(g.sortParams.jsonData)){f=Ext.apply(f,g.sortParams.jsonData)}Ext.Ajax.request({sender:g,defaultHeaders:{"Content-Type":"application/json"},url:g.sortParams.url,jsonData:f,callback:function(h,k,l){if(k){h.sender.onSortUpdateSuccess(l)}else{h.sender.onSortUpdateFailure(l)}}});g.viewInstance.close();g.viewInstance.destroy();g.viewInstance=null},b);b.mon(b.viewInstance.cancelButton,"click",function(){b.viewInstance.close()},b);b.viewInstance.grid.on("viewready",function(){b.viewInstance.grid.getSelectionModel().select(b.viewInstance.grid.getStore().first());b.viewInstance.grid.getView().focusRow(0);b.moveFocusOffset=Math.round(b.viewInstance.grid.getHeight()/50)},b);b.viewInstance.show()},orderedStore:function(){var a=this;return a.viewInstance.grid.getStore().data.items},onTopBtnClick:function(){var e=this;var a=e.viewInstance.grid.getStore(),d=e.viewInstance.grid.getSelectionModel().selected,b=d.length-1,c;a.sorters.clear();a.suspendEvents();for(;b>-1;--b){c=d.items[b];e.viewInstance.grid.getStore().remove(c);e.viewInstance.grid.getStore().insert(0,c)}a.resumeEvents();a.fireEvent("datachanged");e.viewInstance.grid.getView().refresh()},onBottomBtnClick:function(){var f=this;var b=f.viewInstance.grid.getStore(),e=f.viewInstance.grid.getSelectionModel().selected,c=0,a=e.items.length,d;b.sorters.clear();b.suspendEvents();for(;c<a;++c){d=e.items[c];b.remove(d);b.add(d)}b.resumeEvents();b.fireEvent("datachanged");f.viewInstance.grid.getView().refresh();f.viewInstance.grid.getView().focusRow(b.count()-1)},getSelectedItems:function(d){var e=this,b=e.viewInstance.grid.getStore(),a=e.viewInstance.grid.getSelectionModel().selected.items,f=[];for(var c=0;c<a.length;c++){f.push({index:b.indexOf(a[c]),item:a[c]})}sortedMap=Ext.Array.sort(f,function(h,g){if(d){return h.index>g.index}else{return h.index<g.index}});return Ext.Array.pluck(sortedMap,"item")},onUpBtnClick:function(){var g=this;var b=g.viewInstance.grid.getStore(),f=g.getSelectedItems(true),a=f.length,e,c;b.sorters.clear();test=f;b.suspendEvents();for(var d=0;d<a;d++){e=f[d];c=Math.max(0,b.indexOf(e)-1);b.remove(e);b.insert(c,e)}b.resumeEvents();b.fireEvent("datachanged");g.viewInstance.grid.getView().refresh();c+=g.moveFocusOffset;c=Math.min(b.count()-1,c);g.viewInstance.grid.getView().focusRow(c)},onDownBtnClick:function(){var h=this;var c=h.viewInstance.grid.getStore(),g=h.getSelectedItems(false),b=g.length,a=c.count(),f,d;c.sorters.clear();c.suspendEvents();for(var e=0;e<b;e++){f=g[e];d=Math.min(a,c.indexOf(f)+1);c.remove(f);c.insert(d,f)}c.resumeEvents();c.fireEvent("datachanged");h.viewInstance.grid.getView().refresh();d+=h.moveFocusOffset;d=Math.min(c.count()-1,d);h.viewInstance.grid.getView().focusRow(d)},onSortBtnClick:function(){var c=this;var b=c.viewInstance.grid.getStore();var a=c.sortValueField||c.sortDisplayField;if(a){b.suspendEvents();b.sort(a,"ASC");b.resumeEvents();b.fireEvent("datachanged");c.viewInstance.grid.getView().refresh()}}});Ext.define("Vulcan.Common.ExtJS.view.generic.GenericGridView",{extend:"Vulcan.Common.ExtJS.view.abstract.AbstractGridView",requires:["Vulcan.Common.ExtJS.view.generic.GenericSortView","Ext.data.*","Ext.ux.grid.column.CheckColumn","Ext.ux.grid.column.ButtonColumn"],config:{canDeleteOnEdit:true},mappingName:null,selectAllAfterLayout:false,additionalToolbarItems:[],alwaysShowToolbar:false,showSearchBox:false,canEditFn:function(a){return true},txtNoData:"brak danych",txtSortWindowTitle:"Porządkowanie elementów",txtSearchBoxHint:"wyszukaj",onSortUpdateSuccess:function(a){var b=Ext.decode(a.responseText).data;this.getStore().loadData(b);this.fireEvent("sortUpdateSuccess",this,a)},onSortUpdateFailure:function(a){this.fireEvent("sortUpdateFailure",this,a)},onGoToClick:function(a){this.fireEvent("gotoClick",this,a)},onButtonColumnButtonClick:function(b,a){this.fireEvent("buttonColumnButtonClick",this,b,a)},onButtonEditClick:function(b,a){this.fireEvent("buttonEditClick",this,b,a)},onButtnoAddClick:null,onBtnAddClick:function(a){this.fireEvent("buttonAddClick",this,a)},onSelectionChange:function(a){this.fireEvent("checkboxselectionchange",this,a)},selModel:null,initDeprecated:function(){var a=this;if(Ext.isDefined(a.showWindowDeleteButton)&&!Ext.isDefined(a.initialConfig.canDeleteOnEdit)){a.setCanDeleteOnEdit(a.showWindowDeleteButton)}},initBugFixes:function(){var a=this;if(a.getView() instanceof Ext.view.Table){Ext.override(a.getView(),{doStripeRows:function(c,b){if(c<0){c=0}return this.callParent([c,b])}})}},initComponent:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Init GenericGridView");var k=this,a,c,l,g;k.initDeprecated();this.plugins.push(Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}));if(k.viewConfig.getRowClass===Ext.emptyFn){k.viewConfig.getRowClass=Ext.bind(k.defaultGetRowClass,k)}if(k.txtNoData){k.viewConfig.emptyText="<div class='x-empty-grid'><p>"+k.txtNoData+"</p></div>"}if(k.selectAllAfterLayout){k.on({afterlayout:{fn:function(){var p=k.getStore();if(p){k.selectAll();p.on({load:{fn:function(){k.selectAll()},single:true}})}},single:true}})}var e=[];this.selModel=this.showCheckBoxColumn?Ext.create("Ext.selection.CheckboxModel",{pruneRemoved:false,listeners:{selectionchange:function(q,p){k.selectedRows=p;k.onSelectionChange(p)}}}):null;k.callParent(arguments);this.addEvents("sortUpdateSuccess","sortUpdateFailure","gotoClick","buttonColumnButtonClick","buttonAddClick","buttonEditClick","checkboxselectionchange");if(k.modelClass){a=Ext.create(k.modelClass)}else{a=Ext.create(k.store.model.getName())}Vulcan.Common.ExtJS.utils.Log.getLogger().trace("GenericGridView Model:"+a);var m=null;if(k.showAddButton||k.showSortButton||k.additionalToolbarItems.length||k.alwaysShowToolbar||k.showSearchBox){m=Ext.create("Ext.Toolbar",{xtype:"toolbar",cls:"vgrid-btn"});k.addDocked(m)}if(k.showAddButton){var b=Ext.create("Ext.Button",{text:k.addBtnText,iconCls:k.addBtnIconCls?k.addBtnIconCls:"icon-add",handler:k.onButtonAddClick?k.onButtonAddClick:function(){k.onBtnAddClick();var p={application:App,validationConfig:{store:k.getStore()},mappingName:k.mappingName,excludedFields:k.excludedWindowFields,readonlyFields:k.readonlyWindowFields,windowTitle:k.addWindowTitle,storeParams:k.storeParams,saveCallback:k.saveCallback?k.saveCallback:function(r){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("saveCallback from saved Object");k.getStore().add([r])}};if(k.dynamicValidation){p.dynamicValidation=k.dynamicValidation}if(k.windowModelInstance){p.modelInstance=k.windowModelInstance}else{p.modelClass=k.getStore().model.modelName}var q=null;if(k.addWindowController instanceof Ext.app.Controller){q=k.addWindowController;q=Ext.apply(q,p)}else{if(!k.addWindowController){q=Ext.create("Vulcan.Common.ExtJS.controller.generic.GenericEditController",p)}else{q=Ext.create(k.addWindowController,p)}}if(q&&q.launch){App.addController(q);q.launch()}}});if(m&&b){m.items.add(b)}}if(m&&k.additionalToolbarItems&&k.additionalToolbarItems.length){Ext.Array.each(k.additionalToolbarItems,function(p){m.items.add(p)})}if(k.showSortButton){var h=Ext.create("Ext.Button",{text:k.sortBtnText,iconCls:"icon-sort",listeners:{click:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("Click Vulcan.Common.ExtJS.view.generic.GenericSortView");ctr=Ext.create("Vulcan.Common.ExtJS.controller.generic.GenericSortController",{mappingName:k.mappingName,application:App,showSortPanel:true,store:Vulcan.Common.ExtJS.utils.helpers.StoreHelper.cloneStore(k.store),sortValueField:k.sortValueField,sortDisplayField:k.sortDisplayField,sortParams:k.sortParams,sender:k,windowTitle:k.txtSortWindowTitle,gridColumnTemplate:[{header:k.sortDisplayField,dataIndex:k.sortDisplayField}]});if(ctr&&ctr.launch){App.addController(ctr);ctr.launch()}}}});if(m&&h){m.items.add(h)}}if(k.showSearchBox){k.searchBox=Ext.create("Ext.form.field.Text",{emptyText:k.txtSearchBoxHint});k.searchBox.on({change:{fn:k.searchBoxChange,scope:k}});k.on("destroy",function(){k.store.clearFilter()});if(m&&k.searchBox){m.items.add(k.searchBox)}}if(k.showRowNumber){rc=Ext.create("Ext.grid.RowNumberer");e.push(rc)}if(k.showActionColumn){var d=0;var o=[];if(k.showGoToButton){d+=20;var n=Ext.create("Ext.Button",{iconCls:"icon-step_into",iconHeight:24,iconWidth:24,handler:function(q,s,p){var r=q.getStore().getAt(s);k.onGoToClick(r)}});o.push(n)}if(k.showEditButton){d+=20;o.push({iconCls:"icon-edit",iconHeight:24,iconWidth:24,handler:function(r,u,q){var t=r.getStore().getAt(u);if(k.canEditFn(t)){if(k.btnEditHandler){Ext.callback(k.btnEditHandler,this,arguments)}else{k.onButtonEditClick(r.getStore().getAt(u).data.Id,t);var p={application:App,validationConfig:{store:k.getStore(),model:r.getStore().getAt(u)},mappingName:k.mappingName,canDelete:k.getCanDeleteOnEdit(),modelClass:k.modelClass,modelInstance:r.getStore().getAt(u),excludedFields:k.excludedWindowFields,windowTitle:k.editWindowTitle,storeParams:k.storeParams,readonlyFields:k.readonlyEditWindowFields?k.readonlyEditWindowFields:k.readonlyWindowFields,saveCallback:k.updateCallback?k.updateCallback:function(w){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("saveCallback from saved Object");try{k.getStore().removeAt(u);k.getStore().insert(u,w)}catch(v){Vulcan.Common.ExtJS.utils.Log.getLogger().error("an errror occured while saving object in savecallback in GenericGridView: "+v)}},deleteCallback:k.deleteCallback?k.deleteCallback:function(v){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("deleteCallback from saved Object")}};if(k.dynamicValidation){p.dynamicValidation=k.dynamicValidation}var s=null;if(k.addWindowController instanceof Ext.app.Controller){s=k.addWindowController;s=Ext.apply(s,p)}else{if(!k.addWindowController){s=Ext.create("Vulcan.Common.ExtJS.controller.generic.GenericEditController",p)}else{s=Ext.create(k.addWindowController,p)}}if(s&&s.launch){App.addController(s);s.launch()}}}}})}k.ac=Ext.create("Ext.grid.column.Action",{hideable:false,width:d,items:o});e.push(k.ac)}var f=a.getGenericMapping(k.mappingName);if(f){f.fields.each(function(r){var p={sortable:k.sortableColumns,text:r.getLabel(),tooltip:r.getLabel(),dataIndex:r.getField(),flex:r.getWidth()?0:1,width:r.getWidth(),filter:r.getFilter()};if(r.getMinWidth()){p.minWidth=r.getMinWidth()}if(r.getMaxWidth()){p.maxWidth=r.getMaxWidth()}if(r.getTdCls()){p.tdCls=r.getTdCls()}var s=null;if(!r.getExcludeFromGrid()){switch(r.getType()){case"bool":s="Ext.grid.column.Boolean";Ext.apply(p,{trueText:"Tak",falseText:"Nie"});break;case"date":s="Ext.grid.column.Date";Ext.apply(p,{format:r.getFormat()?r.getFormat():Vulcan.Common.ExtJS.utils.Settings.dateFormat});break;case"time24":case"timerange":s="Ext.grid.column.Date";Ext.apply(p,{format:r.getFormat()?r.getFormat():Vulcan.Common.ExtJS.utils.Settings.timeFormat});break;case"int":s="Ext.grid.column.Number";Ext.apply(p,{format:r.getFormat()?r.getFormat():"0"});break;case"float":s="Ext.grid.column.Number";Ext.apply(p,{format:r.getFormat()?r.getFormat():"0,000.00",decimalPrecision:r.getDecimalPrecision(),decimalSeparator:Vulcan.Common.ExtJS.utils.Settings.decimalSeparator,thousandSeparator:Vulcan.Common.ExtJS.utils.Settings.thousandSeparator});break;case"list":s="Ext.ux.grid.column.ButtonColumn";Ext.apply(p,{format:r.getFormat(),showButtons:true,items:[Ext.create("Ext.Button",{iconCls:"icon-edit",iconHeight:24,iconWidth:24,handler:function(u,v,t){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("ButtonColumn Ext.Button click");k.onButtonColumnButtonClick(u.getStore().getAt(v).data.Id,u.headerCt.getHeaderAtIndex(t).dataIndex)}})]});break;default:s="Ext.grid.column.Column";Ext.apply(p,{renderer:function(u){var t=u||"";t=Vulcan.Common.ExtJS.utils.helpers.SecurityHelper.encode(u);return t}});break}p=Ext.apply(p,r.getCfgGridColumn());p=Ext.apply(p,r.getCfgExtra());var q=Ext.create(s,p);if(k.renderers&&k.renderers[r.getField()]){q.renderer=k.renderers[r.getField()]}if(r.getRenderer()){q.renderer=r.getRenderer()}if(!k.excludedFields||!Ext.Array.contains(k.excludedFields,r.getField())){if(!k.excludedGridColumns||!Ext.Array.contains(k.excludedGridColumns,r.getField())){if(k.isEditMode){q.getEditor=k.getEditor}e.push(q)}}}})}k.reconfigure(k.store,e);k.initBugFixes()},defaultGetRowClass:function(a,e,c,b){var d=this;if(d.canEditFn(a)===false){return"disabled"}else{return""}},getEditor:function(a,b){var c=this;var d=null;if(this.editorControl!==undefined){c.setEditor(this.editorControl);return this.editorControl}switch(this.editor){case"label":case"display":case"labelfield":case"displayfield":d=Ext.create("Ext.form.field.Display");break;default:d=Ext.create("Ext.form.field.Text");break}c.setEditor(d);return d},selectAll:function(){var a=this;if(a.selModel){a.selModel.selectAll()}},deselectAll:function(){var a=this;if(a.selModel){a.selModel.deselectAll()}},searchBoxChange:function(g,f){var d=this;var b=d.getStore();b.filters.removeAtKey("searchboxchange");var c=b.filters.items;b.clearFilter();b.filter(c);var a=d.getView();var e=f.toUpperCase();b.filters.add("searchboxchange",Ext.create("Ext.util.Filter",{filterFn:function(h){var k=a.getNodeByRecord(h);if(!k){var m="";if(h&&h.id){m=h.id}Vulcan.Common.ExtJS.utils.Log.getLogger().warn("Nie można określić filtra dla elementu "+m);return false}var l=k.innerText||k.textContent;return l.toUpperCase().indexOf(e)!==-1}}));b.filter()}});Ext.define("Vulcan.Common.ExtJS.controller.generic.GenericGridController",{extend:"Vulcan.Common.ExtJS.controller.abstract.AbstractGridController",requires:["Vulcan.Common.ExtJS.view.generic.GenericGridView"],init:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("GenericGridController initialized")},viewClass:"Vulcan.Common.ExtJS.view.generic.GenericGridView",excludedFields:null,createViewInstance:function(){var a=this;a.viewInstance=Ext.create(a.viewClass,{modelClass:a.modelClass,renderTo:a.renderTo,showRowNumber:a.showRowNumber,showActionColumn:a.showActionColumn,store:a.storeInstance});return a.viewInstance}});Ext.define("Vulcan.Common.ExtJS.view.generic.GenericTemplatedItemSelectorView",{extend:"Vulcan.Common.ExtJS.view.abstract.AbstractEditView",requires:["Ext.form.Panel","Ext.ux.form.MultiSelect","Ext.ux.form.SortItemSelector"],txtMoveToTop:"Przesuń na pierwszą pozycję",txtMoveToBottom:"Przesuń na ostatnią pozycję",txtMoveDown:"Jedna pozycja w dół",txtMoveUp:"Jedna pozycja do góry",autoSize:true,minHeight:300,leftGrid:null,rightGrid:null,rightGridColums:[],leftGridColumns:[],addButton:null,removeButton:null,addAllButton:null,removeAllButton:null,leftStore:null,rightStore:null,leftGridTitle:null,rightGridTitle:null,bodyBorder:false,border:false,showLeftGrid:null,showRightGrid:null,showButtonPanel:null,showSortPanel:false,sortTopButton:null,sortUpButton:null,sortDownButton:null,sortBottomButton:null,leftGridWidth:null,leftGridHeight:null,contentAutoScroll:false,rightGridWidth:null,rightGridHeight:null,cfgRightGrid:{},defAddButton:{itemId:"btnAdd",text:"+",width:30,height:30,margin:5},defRemoveButton:{itemId:"btnRemove",text:"-",width:30,height:30,margin:5},defAddAllButton:{itemId:"btnAddAll",text:">>",width:30,height:30,margin:5},defRemoveAllButton:{itemId:"btnRemoveAll",text:"<<",width:30,height:30,margin:5},showMoveAll:false,initComponent:function(){var h=this;var g=Ext.create("Ext.panel.Panel",{layout:{type:"table",columns:1},width:40,bodyBorder:false,border:false});h.leftGrid=Ext.create("Ext.grid.Panel",{viewConfig:{loadMask:false},enableCtxMenu:false,enableColLock:false,enableColumnMove:false,enableColumnHide:false,sortableColumns:false,menuDisabled:true,forceFit:true,sortableColumns:false,forceFit:true,title:h.leftGridTitle,store:h.leftStore,multiSelect:true,columns:h.leftGridColumns,height:h.leftGridHeight?h.leftGridHeight:200,width:h.leftGridWidth?h.leftGridWidth:400,plugins:((Ext.Array.some(h.leftGridColumns,function(k){return Ext.isDefined(k)&&Ext.isDefined(k.filter)}))?[{ptype:"filterbar",renderHidden:false,showClearAllButton:false,showShowHideButton:false},"celltooltip"]:["celltooltip"])});var e={viewConfig:{loadMask:false},menuDisabled:true,enableColumnHide:false,enableCtxMenu:false,enableColLock:false,enableColumnMove:false,sortableColumns:false,forceFit:true,title:h.rightGridTitle,store:h.rightStore,multiSelect:true,columns:h.rightGridColums,plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),"celltooltip"],height:h.rightGridHeight?h.rightGridHeight:200,width:h.rightGridWidth?h.rightGridWidth:400};Ext.apply(e,h.cfgRightGrid);h.rightGrid=Ext.create("Ext.grid.Panel",e);h.addButton=Ext.create("Ext.Button",h.defAddButton);h.removeButton=Ext.create("Ext.Button",h.defRemoveButton);if(h.showMoveAll){h.addAllButton=Ext.create("Ext.Button",h.defAddAllButton);h.removeAllButton=Ext.create("Ext.Button",h.defRemoveAllButton)}if(h.rightGrid.columns){for(var d=0;d<h.rightGrid.columns.length;d++){var a=h.rightGrid.columns[d];if(a.editor&&a.editor.xtype=="combo"&&a.editor.store){a.renderer=Vulcan.Common.ExtJS.utils.helpers.RenderHelper.comboRenderer(a.editor);if(a.editor.store.getCount()===0){a.editor.store.on("load",h.refreshGrid,h)}}}}if(h.showMoveAll){g.add(h.addAllButton)}g.add(h.addButton);g.add(h.removeButton);if(h.showMoveAll){g.add(h.removeAllButton)}var c=100;var b=[];if(h.showLeftGrid){b.push(h.leftGrid);c+=h.leftGrid.width}if(h.showButtonPanel){b.push(g);c+=g.width}if(h.showRightGrid){b.push(h.rightGrid);c+=h.rightGrid.width}if(h.showSortPanel){h.sortTopButton=Ext.create("Ext.Button",{tooltip:h.txtMoveToTop,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-top"});h.sortUpButton=Ext.create("Ext.Button",{tooltip:h.txtMoveUp,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-up"});h.sortDownButton=Ext.create("Ext.Button",{tooltip:h.txtMoveDown,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-down"});h.sortBottomButton=Ext.create("Ext.Button",{tooltip:h.txtMoveToBottom,margin:"3 3 3 3",cls:Ext.baseCSSPrefix+"form-itemselector-btn",iconCls:Ext.baseCSSPrefix+"form-itemselector-bottom"});var f=Ext.create("Ext.panel.Panel",{layout:{type:"table",columns:1},bodyBorder:false,border:false});f.add(h.sortTopButton);f.add(h.sortUpButton);f.add(h.sortDownButton);f.add(h.sortBottomButton);b.push(f);c+=f.width}Ext.applyIf(h,{contentPanel:Ext.create("Ext.container.Container",{bodyPadding:10,layout:{type:"table",columns:b.length},style:{background:"none"},items:b})});h.callParent(arguments)},refreshGrid:function(a){var b=this;b.rightGrid.getView().refresh();a.un("load",b.refreshGrid,b)},resizeToContents:function(g,d){var f=this,c,b={width:f.width,height:90},h,e,a;if(!g.autoSize){return}b.width=35;if(f.showLeftGrid){b.width+=f.leftGrid.width}if(f.showButtonPanel){b.width+=40}if(f.showSortPanel){b.width+=30}if(f.showRightGrid){b.width+=f.rightGrid.width}b.height=300;g.setSize(b);if(f.showLeftGrid&&f.leftGrid&&f.leftGrid.getStore()&&!f.leftGridHeight&&!f.rightGridHeight){Vulcan.Common.ExtJS.utils.helpers.StoreHelper.doForLoadedStore(f.leftGrid.getStore(),f.initHeight,f)}},initHeight:function(){var b=this;var a=b.leftGrid.getStore().getCount()*30+50;a=Math.min(b.maxHeight,a);if(a>b.minHeight){b.setHeight(a);if(b.leftGrid.isVisible()){b.leftGrid.setHeight(a-100)}if(b.rightGrid.isVisible()){b.rightGrid.setHeight(a-100)}var d=(b.maxWidth-b.width)/2;var c=(b.maxHeight-a)/2;b.setPosition(d,c)}}});Ext.define("Vulcan.Common.ExtJS.controller.generic.GenericTemplatedItemSelectorController",{extend:"Vulcan.Common.ExtJS.controller.VControllerBase",requires:["Vulcan.Common.ExtJS.view.generic.GenericTemplatedItemSelectorView"],windowTitle:null,autoDestroy:true,viewInstance:null,leftStore:null,leftGridColumnTemplate:null,rightGridColumnTemplate:null,rightStore:null,rightStoreName:null,rightStoreSorters:[],cloneLeftRecords:true,mapping:null,uniqeField:null,uniqeRequired:true,dynamicValidation:null,showLeftGrid:true,showRightGrid:true,showButtonPanel:true,showSortPanel:false,allowLeftGridDoubleClick:true,allowRightGridDoubleClick:true,leftGridWidth:null,leftGridHeight:null,rightGridWidth:null,rightGridHeight:null,removeClonedRecord:false,validateData:true,saveCallback:function(){},cancelCallback:function(){},itemRemoved:function(a){},itemInserted:function(a,b){},clonedRightStore:null,leftGridTitle:null,rightGridTitle:null,cfgRightGrid:{},viewClass:"Vulcan.Common.ExtJS.view.generic.GenericTemplatedItemSelectorView",cfgView:{},fromCancel:true,init:function(){Vulcan.Common.ExtJS.utils.Log.getLogger().trace("init Vulcan.Common.ExtJS.view.generic.GenericTemplatedItemSelectorController");var a=this;a.callParent(arguments)},launch:function(c){var b=this;b.callParent(arguments);if(!b.rightStoreName){b.rightStoreName=b.rightStore.$className}b.clonedRightStore=Ext.create(b.rightStoreName,{sorters:b.rightStoreSorters,model:b.rightStore.model.getName()});if(b.rightStore.isLoading()){b.rightStore.on("load",b.cloneRecods,b)}else{b.cloneRecods(b.rightStore)}var a={title:b.windowTitle,leftStore:b.leftStore,rightStore:b.clonedRightStore,leftGridColumns:b.leftGridColumnTemplate,rightGridColums:b.rightGridColumnTemplate,leftGridTitle:b.leftGridTitle,rightGridTitle:b.rightGridTitle,showLeftGrid:b.showLeftGrid,showRightGrid:b.showRightGrid,showButtonPanel:b.showButtonPanel,showSortPanel:b.showSortPanel,leftGridWidth:b.leftGridWidth,leftGridHeight:b.leftGridHeight,rightGridWidth:b.rightGridWidth,rightGridHeight:b.rightGridHeight,cfgRightGrid:b.cfgRightGrid,showMoveAll:b.showMoveAll};Ext.apply(a,b.cfgView);b.viewInstance=Ext.create(b.viewClass,a);b.viewInstance.addButton.on("click",b.handleAddButtonClick,b);b.viewInstance.removeButton.on("click",b.handleRemoveButtonClick,b);if(b.showMoveAll){b.viewInstance.addAllButton.on("click",b.handleAddAllButtonClick,b);b.viewInstance.removeAllButton.on("click",b.handleRemoveAllButtonClick,b)}if(b.showSortPanel){b.viewInstance.sortTopButton.on("click",b.onTopBtnClick,b);b.viewInstance.sortUpButton.on("click",b.onUpBtnClick,b);b.viewInstance.sortDownButton.on("click",b.onDownBtnClick,b);b.viewInstance.sortBottomButton.on("click",b.onBottomBtnClick,b)}b.mon(b.viewInstance,"close",function(){if(b.autoDestroy!==true){return}if(b.fromCancel){b.cancelCallback()}b.destroy()},b);b.viewInstance.saveButton.on("click",function(){b.fromCancel=false;if(b.viewInstance.rightGrid){var d=b.viewInstance.rightGrid.getView(),f=false,e=b.viewInstance.rightGrid.columns.length;if(b.validateData){b.clonedRightStore.each(function(l,k){for(var n=0;n<e;n++){var h=d.getCellByPosition({row:k,column:n});h.removeCls("x-form-invalid-field")}var m=l.validate();if(!m.isValid()){f=true;for(var o=0;o<m.items.length;o++){for(var n=0;n<e;n++){var h=d.getCellByPosition({row:k,column:n});if(m.items[o].field==b.viewInstance.rightGrid.columns[n].dataIndex){h.addCls("x-form-invalid-field");h.set({"data-errorqtip":m.items[o].message})}}}}})}}if(!f){if(b.dynamicValidation&&Ext.isFunction(b.dynamicValidation)){if(b.dynamicValidation(b.clonedRightStore)===true){var g=true;if(b.saveCallback){g=b.saveCallback(b.clonedRightStore)}if(g!==false){b.viewInstance.close()}}}else{var g=true;if(b.saveCallback){g=b.saveCallback(b.clonedRightStore)}if(g!==false){b.viewInstance.close()}}}},b);b.viewInstance.cancelButton.on("click",function(){b.fromCancel=true;b.viewInstance.close()},b);b.viewInstance.leftGrid.on("itemdblclick",b.handleLeftGridDoubleClick,b);b.viewInstance.rightGrid.on("itemdblclick",b.handleRightGridDoubleClick,b);b.viewInstance.leftGrid.on("viewready",function(){b.viewInstance.leftGrid.getSelectionModel().select(b.viewInstance.leftGrid.getStore().first());b.viewInstance.leftGrid.getView().focusRow(0)},b);b.viewInstance.rightGrid.on("viewready",function(){b.viewInstance.rightGrid.getSelectionModel().select(b.viewInstance.rightGrid.getStore().first());b.viewInstance.rightGrid.getView().focusRow(0);b.moveFocusOffset=Math.round(b.viewInstance.rightGrid.getHeight()/50)},b);b.viewInstance.show()},cloneRecods:function(a){var b=this;b.clonedRightStore.suspendEvents(false);a.each(function(c){b.clonedRightStore.add(c.copy())});b.clonedRightStore.resumeEvents();b.clonedRightStore.fireEvent("datachanged");if(b.viewInstance){b.viewInstance.rightGrid.getView().refresh()}a.un("load",b.cloneRecods,b)},handleAddButtonClick:function(){var b=this;var a=b.viewInstance.leftGrid.getSelectionModel().selected;if(a){a.each(function(d){var c=b.getMappedRecord(d,b.viewInstance.rightGrid.getStore().model.getName());b.addItem(b.viewInstance.rightGrid.getStore(),c,b.uniqeRequired);if(b.itemInserted){b.itemInserted(d,c)}if(b.removeClonedRecord){b.removeItem(b.viewInstance.leftGrid.getStore(),d)}})}},handleRemoveButtonClick:function(){var b=this;var a=b.viewInstance.rightGrid.getSelectionModel().selected;if(a){a.each(function(c){b.removeItem(b.viewInstance.rightGrid.getStore(),c);if(b.itemRemoved){b.itemRemoved(c,c)}if(b.removeClonedRecord){b.addItem(b.viewInstance.leftGrid.getStore(),c)}})}},handleAddAllButtonClick:function(){var b=this;var a=b.viewInstance.leftGrid.getStore().getRange();if(a){Ext.each(a,function(d){var c=b.getMappedRecord(d,b.viewInstance.rightGrid.getStore().model.getName());b.addItem(b.viewInstance.rightGrid.getStore(),c,b.uniqeRequired);if(b.itemInserted){b.itemInserted(d,c)}if(b.removeClonedRecord){b.removeItem(b.viewInstance.leftGrid.getStore(),d)}})}},handleRemoveAllButtonClick:function(){var b=this;var a=b.viewInstance.rightGrid.getStore().getRange();if(a){Ext.each(a,function(c){b.removeItem(b.viewInstance.rightGrid.getStore(),c);if(b.itemRemoved){b.itemRemoved(c,c)}if(b.removeClonedRecord){b.addItem(b.viewInstance.leftGrid.getStore(),c)}})}},handleLeftGridDoubleClick:function(f,b,h,c,k,d){var g=this;if(g.allowLeftGridDoubleClick===false){return}var a=g.getMappedRecord(b,g.viewInstance.rightGrid.getStore().model.getName());g.addItem(g.viewInstance.rightGrid.getStore(),a,g.uniqeRequired);if(g.removeClonedRecord){g.removeItem(g.viewInstance.leftGrid.getStore(),b)}if(g.itemInserted){g.itemInserted(b,a)}},handleRightGridDoubleClick:function(d,a,g,b,h,c){var f=this;if(f.allowRightGridDoubleClick===false){return}f.removeItemByIndex(d.getStore(),b);if(f.removeClonedRecord){f.addItem(f.viewInstance.leftGrid.getStore(),a)}if(f.itemRemoved){f.itemRemoved(a)}},removeItemByIndex:function(a,b){var c=this;a.removeAt(b)},removeItem:function(a,c){var b=this;a.remove([c])},addItem:function(c,a,b){var d=this;if(b){if(d.uniqeField){if(c.find(d.uniqeField,a.get(d.uniqeField),0,false,false,true)>=0){return}}else{if(c.getById(a.getId())!==null){return}}}c.add(a)},getMappedRecord:function(e,a){var c=this;if(c.mapping){var d=Ext.create(a);d.raw={};for(var b=0;b<c.mapping.length;b++){d.set(c.mapping[b].mapTo,e.get(c.mapping[b].mapFrom));d.raw[c.mapping[b].mapTo]=e.get(c.mapping[b].mapFrom)}d.endEdit();d.commit(false);return d}return c.cloneLeftRecords?Ext.create(e.modelName,e.data):e},onTopBtnClick:function(){var e=this;var a=e.viewInstance.rightGrid.getStore(),d=e.viewInstance.rightGrid.getSelectionModel().selected,b=d.length-1,c;a.sorters.clear();a.suspendEvents();for(;b>-1;--b){c=d.items[b];e.viewInstance.rightGrid.getStore().remove(c);e.viewInstance.rightGrid.getStore().insert(0,c)}a.resumeEvents();a.fireEvent("datachanged");e.viewInstance.rightGrid.getView().refresh()},onBottomBtnClick:function(){var f=this;var b=f.viewInstance.rightGrid.getStore(),e=f.viewInstance.rightGrid.getSelectionModel().selected,c=0,a=e.items.length,d;b.sorters.clear();b.suspendEvents();for(;c<a;++c){d=e.items[c];b.remove(d);b.add(d)}b.resumeEvents();b.fireEvent("datachanged");f.viewInstance.rightGrid.getView().refresh();f.viewInstance.rightGrid.getView().focusRow(b.count()-1)},getSelectedItems:function(d,e){var f=this,b=d.getStore(),a=d.getSelectionModel().selected.items,g=[];for(var c=0;c<a.length;c++){g.push({index:b.indexOf(a[c]),item:a[c]})}sortedMap=Ext.Array.sort(g,function(k,h){if(e){return k.index>h.index}else{return k.index<h.index}});return Ext.Array.pluck(sortedMap,"item")},onUpBtnClick:function(){var g=this;var b=g.viewInstance.rightGrid.getStore(),f=g.getSelectedItems(g.viewInstance.rightGrid,true),a=f.length,e,c;b.sorters.clear();b.suspendEvents();for(var d=0;d<a;d++){e=f[d];c=Math.max(0,b.indexOf(e)-1);b.remove(e);b.insert(c,e)}b.resumeEvents();b.fireEvent("datachanged");g.viewInstance.rightGrid.getView().refresh();c+=g.moveFocusOffset;c=Math.min(b.count()-1,c);g.viewInstance.rightGrid.getView().focusRow(c)},onDownBtnClick:function(){var h=this;var c=h.viewInstance.rightGrid.getStore(),g=h.getSelectedItems(h.viewInstance.rightGrid,false),b=g.length,a=c.getCount(),f,d;c.sorters.clear();c.suspendEvents();for(var e=0;e<b;e++){f=g[e];d=Math.min(a,c.indexOf(f)+1);c.remove(f);c.insert(d,f)}c.resumeEvents();c.fireEvent("datachanged");h.viewInstance.rightGrid.getView().refresh();d+=h.moveFocusOffset;d=Math.min(c.count()-1,d);h.viewInstance.rightGrid.getView().focusRow(d)}});Ext.define("Ext.ux.layout.component.form.MultiSelect",{extend:"Ext.layout.component.field.Field",alias:["layout.multiselectfield"],type:"multiselectfield",defaultHeight:200,sizeBodyContents:function(b,a){var c=this;if(!Ext.isNumber(a)){a=c.defaultHeight}c.owner.panel.setSize(b,a)}});var App=null;var VCmn=Vulcan.Common.ExtJS;var VHelpers=Vulcan.Common.ExtJS.utils.helpers;var VUtils=Vulcan.Common.ExtJS.utils;var VSecurity=Vulcan.Common.ExtJS.utils.security;var VAccessLevel=Vulcan.Common.ExtJS.utils.security.AccessLevel;var log=Vulcan.Common.ExtJS.utils.Log.getLogger();